<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-2018/netfilter-eiptables-i" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">[netfilter] Introduction to ebtables | hwchiu learning note</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.hwchiu.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://www.hwchiu.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://www.hwchiu.com/docs/2018/netfilter-eiptables-i"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="[netfilter] Introduction to ebtables | hwchiu learning note"><meta data-rh="true" name="description" content="本文是 iptables/ebtables 系列分享文的第一篇，會先著重於 iptables/ebtables 本身的架構，更準確的是 netfilter 的架構介紹，從 User-Space 到 Kernel-Space 的組成元件，並且簡單敘述一下整體的運作流程。最後開始介紹 ebtables 這個存在但是較少人知道的工具，不同於 iptables, ebtables 更專注於基於 MAC 地址的 Layer2 轉發。 文章最後介紹了 ebtables 的規則組成，並且將 ebtables 規則的處理順序以圖表的方式呈現，讓大家更容易理解在 Layer2 轉發時，該怎麼透過 `ebtables` 去設定相關的規則來處理封包。"><meta data-rh="true" property="og:description" content="本文是 iptables/ebtables 系列分享文的第一篇，會先著重於 iptables/ebtables 本身的架構，更準確的是 netfilter 的架構介紹，從 User-Space 到 Kernel-Space 的組成元件，並且簡單敘述一下整體的運作流程。最後開始介紹 ebtables 這個存在但是較少人知道的工具，不同於 iptables, ebtables 更專注於基於 MAC 地址的 Layer2 轉發。 文章最後介紹了 ebtables 的規則組成，並且將 ebtables 規則的處理順序以圖表的方式呈現，讓大家更容易理解在 Layer2 轉發時，該怎麼透過 `ebtables` 去設定相關的規則來處理封包。"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.hwchiu.com/docs/2018/netfilter-eiptables-i"><link data-rh="true" rel="alternate" href="https://www.hwchiu.com/docs/2018/netfilter-eiptables-i" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.hwchiu.com/docs/2018/netfilter-eiptables-i" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://L4HXL74VLW-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="hwchiu learning note RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="hwchiu learning note Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XCGL7X3W07"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-XCGL7X3W07",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="hwchiu learning note" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.5bc72551.css">
<link rel="preload" href="/assets/js/runtime~main.81c0ceb6.js" as="script">
<link rel="preload" href="/assets/js/main.da90dc4a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Hwchiu" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Hwchiu" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">HWCHIU 學習筆記</b></a><a class="navbar__item navbar__link" href="/about">我是誰</a><a class="navbar__item navbar__link" href="/">短篇筆記</a><a class="navbar__item navbar__link" href="/tags">短篇筆記-分類</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/category/2023">長篇技術文</a><a class="navbar__item navbar__link" href="/docs/tags">長篇技術文-分類</a><a class="navbar__item navbar__link" href="/course">線上課程</a><a class="navbar__item navbar__link" href="/public_sharing">演講紀錄</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2023">2023</a><button aria-label="Toggle the collapsible sidebar category &#x27;2023&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2022">2022</a><button aria-label="Toggle the collapsible sidebar category &#x27;2022&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2021">2021</a><button aria-label="Toggle the collapsible sidebar category &#x27;2021&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2020">2020</a><button aria-label="Toggle the collapsible sidebar category &#x27;2020&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2019">2019</a><button aria-label="Toggle the collapsible sidebar category &#x27;2019&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/2018">2018</a><button aria-label="Toggle the collapsible sidebar category &#x27;2018&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2018/cert-manager">Automatically Renew Your Certificated in kubernetes by Cert-Manager</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2018/cni-compare">常見 CNI (Container Network Interface) Plugin 介紹</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2018/cni-questions">CNI 常見問題整理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2018/gpu-gke">Install GPU in GKE(Google Kubernetes Engine)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2018/introduce-cni-i">[Container Network Interface] Bridge Network In Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2018/introduce-cni-ii">[Container Network Interface] CNI Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2018/introduce-cni-iii">[Container Network Interface] Implement Your CNI In Golang</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2018/k8s-security-11tips-i">11個保護你 Kubernetes 集群的技巧與觀念(上)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2018/k8s-security-11tips-ii">11個保護你 Kubernetes 集群的技巧與觀念(下)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2018/kubernetes-dns-ii">[Kubernetes] DNS Setting When DnsPolicy Is Default</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2018/kubernetes-dns-iii">[Kubernetes] DNS Setting with Dockerd(原始碼分析上)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2018/kubernetes-dns-iiii">[Kubernetes] DNS Setting with Dockerd(原始碼分析下)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2018/kubernetes-dns">[Kubernetes] DNS setting in your Pod</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2018/kubernetes-fedora">Install the kubernetes as single node in Fedora 28</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2018/kubernetes-service-i">[Kubernetes] What Is Service?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2018/kubernetes-service-ii">[Kubernetes] How to Implement Kubernetes Service - ClusterIP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2018/kubernetes-service-iii">[Kubernetes] How to Implement Kubernetes Service - NodePort</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2018/kubernetes-service-iiii">[Kubernetes] How to Implement Kubernetes Service - SessionAffinity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2018/kubernetes-storage-i">Kubernetes X Storage (I)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2018/kubernetes-storage-ii">NFS 於 Kubernetes 內的各種應用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2018/mgo-aggregate">[Golang] aggregate in mongo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/2018/netfilter-eiptables-i">[netfilter] Introduction to ebtables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2018/netfilter-eiptables-ii">[netfilter] Introduction to iptables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2018/netfilter-eiptables-iii">[netfilter] Dig Into Docker Bridge Network By iptables/ebtables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2018/paper-tensorflow-with-rdma">[論文導讀] - Towards Zero Copy Dataflows using RDMA</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2018/tools-ncdu">NCurses Disk Usage(ncdu)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2018/travisci-k8s">使用 Travis CI 為你的 Kubernetes 應用程式打造自動化測試</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2018/travisci-step-job-stage">[DevOps] Travis CI - Step/Job/Stage</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2017">2017</a><button aria-label="Toggle the collapsible sidebar category &#x27;2017&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2016">2016</a><button aria-label="Toggle the collapsible sidebar category &#x27;2016&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2015">2015</a><button aria-label="Toggle the collapsible sidebar category &#x27;2015&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2014">2014</a><button aria-label="Toggle the collapsible sidebar category &#x27;2014&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2013">2013</a><button aria-label="Toggle the collapsible sidebar category &#x27;2013&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/2018"><span itemprop="name">2018</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">[netfilter] Introduction to ebtables</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>[netfilter] Introduction to ebtables</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="preface">Preface<a href="#preface" class="hash-link" aria-label="Direct link to Preface" title="Direct link to Preface">​</a></h2><p>再之前的 <code>kubernetes server</code> 系列文中有稍微介紹過 <code>iptables</code> 的一些用法，以及如何透過 <code>iptables</code> 來完成 <code>kubernetes service</code>. 若有任何不熟悉的概念可以重新閱讀一次該系列文章.</p><ul><li><a href="https://www.hwchiu.com/docs/2018/kubernetes-service-ii" target="_blank" rel="noopener noreferrer">[Kubernetes] How To Implement Kubernetes Service - ClusterIP</a></li></ul><p>回到主題，這次想要跟大家慢慢介紹的就是 <code>iptables</code> 這個常見也常用的工具。
網路上其實已經可以搜尋到非常多關於 <code>iptables</code> 相關的文章。
不論是基本介紹，或是一些相關用法，其實都有滿多的資源可以學習，不過我認為這些文章都散落各地，所以想要整理一下這些資訊並且統整起來做一個一系列的<code>iptables</code>文章。
這個系列文的內容大致上如下</p><ol><li>iptables/ebtables 的基本架構介紹，包含下列各種組成的概念<ul><li>Target/Chain/Table/Match</li></ul></li><li>透過 <code>docker</code> 預設網路<code>Bridge</code>的情況來解釋，容器與外界網路，容器與容器彼此之間的網路傳輸，實際上再 <code>iptables</code> 中到底會怎麼運作，如果想要處理這些封包，該怎麼設定相關規則。</li><li>介紹相關 <code>iptables</code> 常見的使用問題</li><li>最後則是會跟大家介紹，如何自己手動撰寫一個 <code>iptables</code> 擴充模組，讓你的<code>iptables</code>擁有獨一無二的功能</li></ol><p>本文則是系列文第一篇，將著重於<code>netfilter</code>的架構介紹，讓大家對於<code>netfilter</code> 的概念有個基本的認知與瞭解。
最後則會介紹一下 <code>ebtables</code> 的概念以及封包傳遞過程。</p><p>相關系列文章</p><ul><li><a href="https://www.hwchiu.com/docs/2018/netfilter-eiptables-ii" target="_blank" rel="noopener noreferrer">[netfilter] Introduction to iptables</a></li><li><a href="https://www.hwchiu.com/docs/2018/netfilter-eiptables-iii" target="_blank" rel="noopener noreferrer">[netfilter] Dig Into Docker Bridge Network By iptables/ebtables</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">​</a></h2><p>一般我們常常在講的 <code>iptables</code>，其實背後真正的專案以及相關技術都跟 <code>netfilter</code> 密切相關。</p><p><code>netfilter</code> 的<a href="https://www.netfilter.org/" target="_blank" rel="noopener noreferrer">官方網站</a> 上面有非常詳細的介紹，同時有非常多相關的專案。
譬如從使用者會使用的指令到給使用者開發的函式庫全部都該網站上面找到，而今天我們的主角 <code>iptables</code> 則是屬於<code>給使用者使用的指令</code>.</p><p>下圖是一個可以簡單描述整個 <code>iptables/netfilter</code> 的架構圖。
整個系統的組成分成三大部分，分別是 <code>user-space</code>,<code>kernel-space</code> 以及 <code>network interface cards</code>.</p><p><img loading="lazy" src="https://i.imgur.com/WlcgN7L.png" alt="Imgur" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="user-space">User Space<a href="#user-space" class="hash-link" aria-label="Direct link to User Space" title="Direct link to User Space">​</a></h3><p>大家最常見也最熟悉的 <code>iptables</code> 以及比較少人知道的 <code>ebtalbes</code> 都是所謂的 <code>user-space</code> 的應用程式。
這類的應用程式提供了一個友善且易於操作的環境讓<code>使用者/系統管理者</code>有辦法去對<code>kernel</code>的 <code>netfilter</code> 進行操作。</p><p>除了 <code>netfilter</code> 專案本身提供的工具之外，使用者也可以自行的透過相關的程式語言函式庫來與 <code>kernel</code> 內的 <code>netfilter</code> 溝通。</p><p>與<code>kernel</code>的溝通方面，一般都是採用 <code>system call</code> 的方式來溝通，針對一些特別的應用甚至可以採用 <code>netlink</code> 的方式去接收封包來進行二次處理。</p><p>對二次處理有興趣的人可以搜尋 <code>NFQUEUE</code> 相關的資源</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kernel-space">Kernel Space<a href="#kernel-space" class="hash-link" aria-label="Direct link to Kernel Space" title="Direct link to Kernel Space">​</a></h3><p>整個 <code>netfilter</code> 的精華與操作基本上都是在 <code>kernel</code> 層級去完成的。再此 <code>netfilter</code> 的子系統內，包含了所有使用者透過 <code>iptables</code> 所傳達的所有指令，譬如<code>丟棄所有來自a.b.c.d的封包</code> 這種類似的規則，全部都會存在 <code>kernel</code> 內。</p><p>這邊值得注意的是，因為 <code>kernel</code> 每次重新開機後，上次存在記憶體內的資訊都會消失，這意味者所有<code>iptables</code>所傳達的命令都會消失，因此才會有所謂的 <code>iptables save/restore</code> 等相關的指令然後搭配上 <code>systemd/upstart</code> 等機制來確保每次重新開機後相關的規則都會重新部屬上去。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="network-interface-card">Network Interface Card<a href="#network-interface-card" class="hash-link" aria-label="Direct link to Network Interface Card" title="Direct link to Network Interface Card">​</a></h3><p>大家會使用 <code>iptables</code> 一定都是想要針對特定的網路封包進行一些處理，而這些網路封包必然伴隨網路設備 <code>Network Interface Card</code> 一同出現。
這些設備可以是實體的網路卡，也可以是系統上虛擬出來的，譬如<code>loopback</code>,<code>docker0(bridge0)</code>,<code>tuntap</code>,<code>veth</code> 等各式各樣的虛擬網卡。</p><p>當這些網卡跟 <code>kernel</code> 透過某種關係連結後，從這些網卡<code>進/出</code>的封包就會受到 <code>netfilter</code> 的影響，進而可以透過 <code>iptables</code> 所傳達的規則進行控制與約束</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="workflow">Workflow<a href="#workflow" class="hash-link" aria-label="Direct link to Workflow" title="Direct link to Workflow">​</a></h3><ol><li>網卡與系統掛勾，此時 <code>kernel</code> 知道有哪些網卡<strong>Physical/Virtaul</strong> 正在系統上</li><li>使用者透過 <code>iptables/ebtables</code> 等工具將相關的規則寫入到 <code>kernel</code> 裡面，此時 <code>kernel netfilter subsystem</code> 內就會有對應的規則。</li><li>當有任何封包從任何網卡內<code>進/出</code>時，這些封包就會被上述已經創立的規則進行比對，並且進行對應的動作。</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="iptablesebtables">iptables/ebtables<a href="#iptablesebtables" class="hash-link" aria-label="Direct link to iptables/ebtables" title="Direct link to iptables/ebtables">​</a></h2><p>有了上述的基本流程後，我們接下來要專注再<code>user-space</code> 的規則方面，瞭解該怎麼解讀每個規則。</p><p>大部分的人比較少聽到 <code>ebtalbes</code>, 然而為了更加理解容器本身的網路運作原理，因此這邊還是要跟大家介紹一下 <code>ebtalbes</code> 這個工具。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="component">Component<a href="#component" class="hash-link" aria-label="Direct link to Component" title="Direct link to Component">​</a></h3><p>規則組成方面，基本上 <code>iptables/ebtables</code> 的概念是一致的，所以為了節省空間，決定一起介紹。</p><p>這邊我們先隨便拿一個常見的 <code>iptables</code> 規則來當做範例</p><div class="language-bash= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iptables -t nat -A POSTROUTING ! -s 10.244.0.0/16 -d 10.244.0.0/16 -j MASQUERADE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上述的規則用中文來說就是<code>我希望來源IP不屬於 10.244.0.0/16, 且目的IP屬於 10.244.0.0/16的封包，都進行 MASQUERADE(SNAT) 這個動作</code></p><p>但是對於整個系統來說，該指令其實可以分成四大部分</p><ol><li>Table: <strong>-t nat</strong></li><li>Chain: <strong>-A POSTROUTING</strong></li><li>Match: <strong>! -s 10.244.0.0/16 -d 10.244.0.0/16</strong></li><li>TARGET: <strong>-j MASQUERADE</strong></li></ol><p>接下來會針對這四個部分進行說明與介紹</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="table">Table<a href="#table" class="hash-link" aria-label="Direct link to Table" title="Direct link to Table">​</a></h3><p>首先，我們已經知道整個 <code>iptables/ebtables/netfilter</code> 的運作是由各式各樣的規則所組成的。</p><p>然而每條規則的用途不會完全相同，為了妥善管理與使用，會希望將相同用途的規則放置在相同的 <code>Table</code> 裡面。</p><p>舉例來說，最常見也是大部分指令的預設值, <code>filter</code>
其功能就如同其名稱一樣，用來進行 <code>filter</code> 相關的規則，譬如將封包丟棄，讓封包通過等常見行為都放置在這個 <code>filter</code> 的 <code>table</code> 中。</p><p>針對上述的範例, <code>-t nat</code> 的意思就是這條規則要放置在 <code>nat</code> 這個<code>Table</code>之中。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="chain">Chain<a href="#chain" class="hash-link" aria-label="Direct link to Chain" title="Direct link to Chain">​</a></h3><p>Chain 的概念比較複雜，分為所謂的 <code>Build-in Chain</code> 以及使用者自己創立的 <code>Chain</code>.</p><p>使用者創立的 <code>Chain</code> 比較偏向用來管理，而且必須要從 <code>Build-in  Chain</code> 這邊進去，所以這邊還是會比較專注於 <code>Build-in Chain</code> 的介紹。</p><p>Chain 相對於 <code>Table</code> 來說，我覺得可以想成是一個狀態點，該狀態是用來描述該封包當前的階段。</p><p>用比較口語話的說法就是這條<code>iptables</code>規則會再什麼時間點去封包進行匹配。舉 <code>INPUT chain</code> 來說，這個狀態就代表封包準備進入到系統後但是還沒有被對應的應用程式接收。</p><p>以底層的實現來說， <code>Table</code> 與 <code>Chain </code> 彼此是互相連結綁定的。
只有特定相關邏輯的 <code>Table</code> 可以再特定時間點上 <code>Chain</code> 去組合成一個常見的 <code>iptables 規則</code></p><p>譬如 <code>filter Table</code> 就可以運行再 <code>INPUT</code> Chain 但是卻不能運行再 <code>PREROUTING Chain</code>.</p><p>實際上會有哪些 <code>Chain</code> 以及哪些 <code>Table</code> 會因為 <code>iptables/ebtables</code> 本身的架構而有所不同，因此會在下面的部份再詳細介紹。</p><p>針對上述的範例 <code>-A POSTROUTING</code> 來看一下，他的意思就是我希望當前這條規則要放到 <code>POSTROUTING</code> 這條 <code>chain</code> 裡面，同時因為 <code>Chain</code> 裡面的規則本身是有<strong>次序性的</strong>, 所以再寫入規則的時候
可以使用 <code>-I (insert) 或是 -A (append)</code> 的概念來決定這條新規則的位置。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="match">Match<a href="#match" class="hash-link" aria-label="Direct link to Match" title="Direct link to Match">​</a></h3><p>Match 的概念就非常簡單，每個規則都可以去描述符合該規則的封包格式，這部份除了預設的封包格式之外，也有不少擴充模組可以使用。
譬如最常見的就是
<code>-m tcp --dport 53</code> 這種針對 <code>TCP</code> 封包且目標連接埠是<code>53</code>的規則</p><p>回到上述的範例,<strong>! -s 10.244.0.0/16 -d 10.244.0.0/16</strong> 這個規則希望可以比對封包的來源/目的 <code>IP</code> 位置，同時藉由 <code>!</code> 這個符號來反轉比對結果。
因此就是所有來源不是 <code>10.244.0.0/16</code> 但是卻要送往 <code>10.244.0.0/16</code> 的封包。</p><p>此外，在 <code>Match</code> 方面，一條規則可以同時使用多個擴充模組來更加強化要比對的規則。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="target">Target<a href="#target" class="hash-link" aria-label="Direct link to Target" title="Direct link to Target">​</a></h3><p>最後一個部分，就是當規則符合之後，要進行什麼樣的動作。
常見的有 <code>Acceptr</code>,<code>Drop</code> 這種給 <code>filter Table</code> 使用的動作。
複雜的甚至可以是修改封包格式，譬如 <code>Source Network Address Translation(SNAT), Destination Network Address Translation(DNAT)</code> 這種。</p><p>回到上述的範例, <strong>-j MASQUERADE</strong>，這邊會透過 <code>-j</code> 的方式描述後面要銜接的參數就是 <code>Target</code>, 而 <code>MASQUERADE</code> 則是一種讓<code>kernel</code>幫你維護的 <code>SNAT</code> 動作。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ebtables">ebtables<a href="#ebtables" class="hash-link" aria-label="Direct link to ebtables" title="Direct link to ebtables">​</a></h2><p><code>ebtalbes</code> 相對於 <code>iptables</code> 來說使用的情境比較少，主要是其針對的目標範圍都著重於 <code>Layer2</code> 這層次，也就是 Ethernet Frame 這邊。</p><p>對於大部分的使用者以及管理者來說，通常都是以 <code>IP</code> 為基本單位來進行管理的，然而部分的網路元件設計者，譬如 <a href="https://github.com/Mirantis/virtlet/blob/master/docs/networking.md" target="_blank" rel="noopener noreferrer">
Virtlet, a Kubernetes runtime server</a> 再其架構中就有使用到 <code>ebtables</code> 來幫忙完成特定的功能。</p><p>此外，為了下一篇文章能夠更理解整個 <code>docker bridge network</code> 的傳輸過程，對於 <code>ebtables</code> 還是要有點基本概念，這樣才可以對整體架構有個完整的認識</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="table-1">Table<a href="#table-1" class="hash-link" aria-label="Direct link to Table" title="Direct link to Table">​</a></h3><p><code>Table</code> 方面，目前的 <code>ebtalbe</code> 總共有三張 <code>tables</code>, 分別是 <code>filter</code>,<code>nat</code> 以及 <code>broute</code>.</p><ol><li><code>filter</code> 則是專注於 <code>Accept/Drop</code> 相關過濾的行為</li><li><code>nat</code>  這邊則專注於針對 <code>MacAddress</code> 相關的轉換</li><li><code>broute</code> 這邊可以用來決定封包到底要進行 <code>Layer2 Bridging</code> 或是 <code>Layer3 Routing</code>。算是一個比較特別的規則。</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="chain-1">Chain<a href="#chain-1" class="hash-link" aria-label="Direct link to Chain" title="Direct link to Chain">​</a></h3><p><code>Chain</code> 的話，再 <code>ebtables</code> 中總共有六條 <code>chain</code>.</p><ul><li><code>brouting</code>: 這個 <code>chain</code> 的執行順序非常的早，基本上是<code>ebtalbes</code> 裡面最早的 <code>chain</code>. 只要當任何 <code>linux bridge</code> 上面的任何一個 <code>port</code> 有收到任何 <code>Frame</code> 進來後，就會到這個<code>Chain</code>裡面去進行比對. 這邊通常不太會去設定，而是都會依賴後續的 <code>Bridging Decision</code>透過<code>Mac Address</code> 去決定封包到底該怎麼走。</li></ul><p>因為 <code>Linux Bridge</code> 本身會有 <code>STP(Spanning Tree Protocol)</code> 的運作，因此只有歸類於可轉發的連接埠才需要去進行這些封包比對。</p><ul><li><p><code>input</code>: 如果今天封包的目標 <code>Mac Address</code> 是 <code>Linux Bridge</code> 本身的話，那封包就會進入到 <code>input chain</code> 來處理。最常見的範例就是 <code>docker</code> 容器想要對不同網段進行存取，會先進入到 <code>gateway</code> 也就是所謂的 <code>linux bridge</code> 本身。</p></li><li><p><code>output</code>:  針對要從 <code>Linux Bridge</code> 離開的封包都會進行處理的<code>Chain</code>，這類型的封包大致上有兩種可能。第一種是主機本身產生的封包，目的就是要從該<code>linux bridge</code>底下的某些 <code>Port</code> 轉發出去，或是該封包是從 <code>linux bridge</code> 的某些 <code>Port</code> 轉發到其他的 <code>Port</code>.</p></li><li><p><code>forward</code>: 針對會被<code>Linux Bridge</code>進行<code>Layer2 Bridging</code> 轉發的封包所進行的 <code>Chain</code>. 基本上同網段的容器間傳輸的封包都會到這個階段。</p></li><li><p><code>prerouting</code>: 這個 <code>Chian</code> 就是其名稱的解讀，<code>Pre-Routing</code>, 再封包進入到 <code>Linux Bridge</code> 後，但是還沒有碰到 <code>Bridging Decision</code> 前可以進行的階段。</p></li><li><p><code>postrouting</code>: 這個 <code>Chian</code> 就是其名稱的解讀，<code>Post-Routing</code>, 再封包準備離開 <code>Linux Bridge</code> 前，但是還沒有碰到 真正的透過網卡送出去前可以進行的階段。</p></li></ul><p>其實對於 <code>ebtables</code> 來說，用 <code>pre-forwarding</code> 以及 <code>post-forwarding</code> 會更貼切，畢竟 <code>routing</code> 是更偏向 <code>Layer3</code> 路由方面的規則。</p><p>這邊因為 <code>iptables</code> 長期的習慣所以在命名方面也就遷就於此</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="match-1">Match<a href="#match-1" class="hash-link" aria-label="Direct link to Match" title="Direct link to Match">​</a></h3><p>在比對的規則來說， <code>ebtalbes</code> 專至於 <code>Layer2</code> 相關的處理，譬如 <code>unitcast/multicast/broadcast</code>，甚至是 <code>vlan/stp</code> 等
封包都可以處理。</p><p>此外，除了常見的封包內容外，也可以透過<code>-m</code>這個方式去使用擴充模組來達到更靈活的比對功能。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="target-1">Target<a href="#target-1" class="hash-link" aria-label="Direct link to Target" title="Direct link to Target">​</a></h3><p>就如同前面所描述的，預設的 <code>Target</code> 其實都會跟對應的 <code>Table</code> 有關，譬如 <code>ACCEPT/DROP</code> 就會在 <code>filter/brouting</code> 這些<code>Table</code>.</p><p>雖然都叫做 <code>ACCEPT/DROP</code>, 其兩者的意思在 <code>filter/brouting</code> 的用途卻是不一樣的，有興趣的人可以直接參考 <code>man page</code> 來學習更多的用法與概念。</p><p>除此之外，也有許多的擴充模組提供更多強大的功能，譬如可以透過 <code>arp</code> 等相關的 <code>Target</code>, 針對 <code>ARP</code> 相關的封包直接讓系統幫你回應對應的 <code>ARP Reply</code>。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h3><p>看到這邊，我們用一張圖片，將上述的概念重新整合一次，將 <code>Table/Chain</code> 與 <code>ebtables</code> 進行整合。</p><p><img loading="lazy" src="https://i.imgur.com/q1SSG2l.png" alt="Imgur" class="img_ev3q"></p><p>首先，關於該圖片中我大致上分成三個層次，分別</p><ol><li><code>user-space</code> 的任何網路應用程式</li><li><code>kernel-space</code> 裡面偏向 <code>Layer3</code> 相關的處理，這部份其實是<code>iptables</code>的主戰場，但是因為整體架構的原因，這邊只會稍微帶過</li><li><code>kernel-space</code> 裡面偏向 <code>Layer2</code> 相關的處理，這邊就是偏向 <code>ebtalbes</code> 的處理</li></ol><p>首先當封包從跟<code>Linux Bridge</code>有關的網卡，左邊的<code>nic</code> 近來之後，首先會先進入到 <code>brouting</code> 這個 <code>chain</code>，<code>brouting</code> 這個 <code>chain</code> 裡面只支援 <code>brouintg Table</code>, 若有任何規則要將該封包直接透過<code>routing</code>處理的話，封包就會直接拉到 <code>kernel-space/layer3</code> 層級來處理， 這個範例中先用一個 <code>Magic</code> 的概念來代表任何跟 <code>Layer3</code> 有關的操作。</p><p>接者封包會跑到 <code>Prerouting</code> 這邊，該<code>chain</code>裡面只有<code>nat</code>可以執行，這意味到這個階段頂多只能對封包進行內容的修改，還沒有辦法丟棄。
這邊要注意，這時候還沒決定到底封包該怎麼轉送，所以可以透過修改封包的目標 <code>Mac Address</code> 來影響到底之後該怎麼轉送封包，因此這也是這邊 <code>Chian</code> 為什麼叫做 <code>PreRouting</code>.</p><p>接下來就會到所謂的 <code>Bridging Decision</code>. 這邊其實就會運行 <code>Learning Bridging</code> 相關的算法，根據 <code>Mac Address</code> 來決定轉發的方向，若目標對象是 <code>Linux Bridge</code> 本身，則會透過 <code>input chain</code> 一路往上送到 <code>Layer3</code> 去處理。
對於 <code>input</code> 來說，可以透過 <code>filter</code> 來進行封包的處理，決定哪些封包要過，哪些不要過。</p><p>如果只是該 <code>Linux Bridge</code> 下不同連接埠的轉發的話，就會走 <code>Forward</code> 這邊，最後透過 <code>Postrouting</code> 這邊進行後續的修改，最後就從目標的網卡將該封包送出去。</p><p>如果今天是主機上面的應用程式要送封包出去，且該封包目的地最後會透過 <code>Linux Bridge</code> 來轉發
則該封包最後經過 <code>Layer3</code> 神祕的處理後，最後會跑回到 <code>Layer2</code> 這邊，並且經過 <code>output chain</code> 以及 <code>postrouting</code> 依序的處理，最後也走到網卡出去。</p><p>本文到這邊我們先建立一個基本的概念，到底 <code>iptables/ebtables</code> 的組成元件以及對應的概念。
同時也稍微觀看了一下 <code>ebtables</code> 本身的封包傳輸流程。
然而只有單單的 <code>ebtables</code> 是沒有辦法理解以及解釋整個 <code>docker bridge network</code> 的運作及傳輸。
因此我們會在下篇文章以相同的觀點來分析 <code>iptables</code>, 並且將 <code>iptables</code> 以及 <code>ebtables</code> 給整合起來分析整體的運作流程。
到時候在分析 <code>docker bridge network</code> 的時候，能夠有更詳細的概念與背景去瞭解整體封包的傳輸過程</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="reference">Reference<a href="#reference" class="hash-link" aria-label="Direct link to Reference" title="Direct link to Reference">​</a></h2><ul><li><a href="https://linux.die.net/man/8/ebtables" target="_blank" rel="noopener noreferrer">ebtables man page</a></li><li><a href="http://ebtables.netfilter.org/br_fw_ia/br_fw_ia.html" target="_blank" rel="noopener noreferrer">ebtables/iptables interaction on a Linux-based bridge</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/network">Network</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/netfilter">Netfilter</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/linux">Linux</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/kernel">Kernel</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> by <b>HungWei Chiu</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/2018/mgo-aggregate"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">[Golang] aggregate in mongo</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/2018/netfilter-eiptables-ii"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">[netfilter] Introduction to iptables</div></a></nav><hr><br></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#preface" class="table-of-contents__link toc-highlight">Preface</a></li><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a><ul><li><a href="#user-space" class="table-of-contents__link toc-highlight">User Space</a></li><li><a href="#kernel-space" class="table-of-contents__link toc-highlight">Kernel Space</a></li><li><a href="#network-interface-card" class="table-of-contents__link toc-highlight">Network Interface Card</a></li><li><a href="#workflow" class="table-of-contents__link toc-highlight">Workflow</a></li></ul></li><li><a href="#iptablesebtables" class="table-of-contents__link toc-highlight">iptables/ebtables</a><ul><li><a href="#component" class="table-of-contents__link toc-highlight">Component</a></li><li><a href="#table" class="table-of-contents__link toc-highlight">Table</a></li><li><a href="#chain" class="table-of-contents__link toc-highlight">Chain</a></li><li><a href="#match" class="table-of-contents__link toc-highlight">Match</a></li><li><a href="#target" class="table-of-contents__link toc-highlight">Target</a></li></ul></li><li><a href="#ebtables" class="table-of-contents__link toc-highlight">ebtables</a><ul><li><a href="#table-1" class="table-of-contents__link toc-highlight">Table</a></li><li><a href="#chain-1" class="table-of-contents__link toc-highlight">Chain</a></li><li><a href="#match-1" class="table-of-contents__link toc-highlight">Match</a></li><li><a href="#target-1" class="table-of-contents__link toc-highlight">Target</a></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li></ul></li><li><a href="#reference" class="table-of-contents__link toc-highlight">Reference</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">其他資源</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://hwchiu.medium.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">英文部落格<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/technologynoteniu" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook Page(矽谷牛耕田筆記)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/hw_chiu" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/hung-wei-chiu-52561494/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Cloud Native Taiwan User Group(CNTUG)</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://cloudnative.tw/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Official Site<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/@cloudnativetaiwanusergroup" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/groups/298183320685010" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://community.cncf.io/cloud-native-taiwan-user-group/" target="_blank" rel="noopener noreferrer" class="footer__link-item">CNCF Page<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://t.me/cntug" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 hwchiu. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.81c0ceb6.js"></script>
<script src="/assets/js/main.da90dc4a.js"></script>
</body>
</html>
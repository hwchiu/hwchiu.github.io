<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-2019/iThome_Challenge/cni-flannel-i" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">CNI - Flannel - 安裝設定篇 | hwchiu learning note</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hwchiu.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://hwchiu.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://hwchiu.com/docs/2019/iThome_Challenge/cni-flannel-i"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="CNI - Flannel - 安裝設定篇 | hwchiu learning note"><meta data-rh="true" name="description" content="CNI 的選擇一直以來都是個探討的議題，各式各樣的 CNI 有者不同的特色與效果，使用者要怎麼選擇往往不知所措。老實說對於大部分的使用情況來說，其實 CNI 的選擇影響也不太大，畢竟很多情境只是要求網路可以通暢即可，沒有其他的需求。 而本文則針對一個常見的 CNI, Flannel 進行探討，來研究該 CNI 到底怎麼安裝的，安裝的過程怎麼處理設定檔案的問題。"><meta data-rh="true" property="og:description" content="CNI 的選擇一直以來都是個探討的議題，各式各樣的 CNI 有者不同的特色與效果，使用者要怎麼選擇往往不知所措。老實說對於大部分的使用情況來說，其實 CNI 的選擇影響也不太大，畢竟很多情境只是要求網路可以通暢即可，沒有其他的需求。 而本文則針對一個常見的 CNI, Flannel 進行探討，來研究該 CNI 到底怎麼安裝的，安裝的過程怎麼處理設定檔案的問題。"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hwchiu.com/docs/2019/iThome_Challenge/cni-flannel-i"><link data-rh="true" rel="alternate" href="https://hwchiu.com/docs/2019/iThome_Challenge/cni-flannel-i" hreflang="en"><link data-rh="true" rel="alternate" href="https://hwchiu.com/docs/2019/iThome_Challenge/cni-flannel-i" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="hwchiu learning note RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="hwchiu learning note Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XCGL7X3W07"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-XCGL7X3W07",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.a4f4719e.css">
<link rel="preload" href="/assets/js/runtime~main.187b671b.js" as="script">
<link rel="preload" href="/assets/js/main.1aa7f3cb.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Hwchiu" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Hwchiu" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">HWCHIU 學習筆記</b></a><a class="navbar__item navbar__link" href="/about">我是誰</a><a class="navbar__item navbar__link" href="/">短篇筆記</a><a class="navbar__item navbar__link" href="/tags">短篇筆記-分類</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/category/2023">長篇技術文</a><a class="navbar__item navbar__link" href="/docs/tags">長篇技術文-分類</a><a class="navbar__item navbar__link" href="/course">線上課程</a><a class="navbar__item navbar__link" href="/public_sharing">演講紀錄</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2023">2023</a><button aria-label="Toggle the collapsible sidebar category &#x27;2023&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2022">2022</a><button aria-label="Toggle the collapsible sidebar category &#x27;2022&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2021">2021</a><button aria-label="Toggle the collapsible sidebar category &#x27;2021&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2020">2020</a><button aria-label="Toggle the collapsible sidebar category &#x27;2020&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/2019">2019</a><button aria-label="Toggle the collapsible sidebar category &#x27;2019&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/aks-cni-i">Azure Kubernetes Service (AKS) - CNI (I)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/aws-profile">Management AWS Profiles</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/b4-after">[閱讀筆記] B4 and After: Managing Hierarchy, partitioning, and Asymmetry for Availability and Scale in Google&#x27;s Software-Defined WAN</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/circleci">CircleCI 使用經驗談</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/2019/iThome_Challenge/k8s-design">iThome_Challenge</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/k8s-design">淺談 Kubernetes 設計原理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/container-design-i">淺談 Container 實現原理, 以 Docker 為例(I)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/summary">完賽感想</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/container-design-ii">淺談 Container 實現原理, 以 Docker 為例(II)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/container-design-iii">淺談 Container 實現原理, 以 Docker 為例(III)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/k8s-cri-i">Kubernetes &amp; CRI (I)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/k8s-cri-ii">Kubernetes &amp; CRI (II) - containerd</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/k8s-cri-o">Container Runtime - CRI-O</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/container-runtime-security-container">Container Runtime - Security Container</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/container-runtime-vm">Container Runtime - Virtual Machine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/cni">Container Network Interface 介紹</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/k8s-cni">kubernetes 與 CNI 的互動</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/cni-golnag">使用 golang 開發第一個 CNI 程式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/cni-ipam">初探 CNI 的 IP 分配問題 (IPAM)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/2019/iThome_Challenge/cni-flannel-i">CNI - Flannel - 安裝設定篇</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/cni-flannel-ii">CNI - Flannel - IP 管理篇</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/cni-flannel-iii">CNI - Flannel - VXLAN 封包運作篇</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/cni-experience">CNI 閒談</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/csi">Container Storage Interface 基本介紹</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/csi-ii">Container Storage Interface 標準介紹</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/csi-iii">Container Storage Interface 與 kubernetes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/csi-nfs">Container Storage Interface(CSI) - NFS 初體驗</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/csi-other">CSI 雜談</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/k8s-device-plugin"> Device Plugin - Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/k8s-device-plugin-implement">Device Plugin - Implementation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/k8s-device-plugin-rdma">Kubernetes - Device Plugin - RDMA</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/k8s-device-plugin-sriov">Kubernetes - Device Plugin - SRIOV</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/k8s-operator-pattern">Kubernetes - Operator Pattern 介紹</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/k8s-service-catalog">Service Catalog</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iThome_Challenge/k8s-security">Kubernetes Container Security 探討</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/ingress-1">Introduction to Kubernetes Ingress (Nginx)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/iptables-masquerade">Linux NAT Masquerade 研究(上)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/k8s-concept">你到底知不知道什麼是 Kubernetes?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/2019/keel">[DevOps] 基於 Kubernetes 的自動部屬流程 - Keel</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2018">2018</a><button aria-label="Toggle the collapsible sidebar category &#x27;2018&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2017">2017</a><button aria-label="Toggle the collapsible sidebar category &#x27;2017&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2016">2016</a><button aria-label="Toggle the collapsible sidebar category &#x27;2016&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2015">2015</a><button aria-label="Toggle the collapsible sidebar category &#x27;2015&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2014">2014</a><button aria-label="Toggle the collapsible sidebar category &#x27;2014&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2013">2013</a><button aria-label="Toggle the collapsible sidebar category &#x27;2013&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/2019"><span itemprop="name">2019</span></a><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">iThome_Challenge</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">CNI - Flannel - 安裝設定篇</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>前言</h1><p>藉由前面四篇文章，我們對於 <strong>CNI</strong> 已經有了一些基本個概念，包含了</p><ol><li>CNI 的標準規範以及使用範例</li><li>CNI 與 kubernetes 的整合與設定</li><li>透過實際操作開發一個基於 Linux Bridge 的 CNI，並且知道如何透過設定檔與之互動</li><li>研究三個官方維護的 IPAM 解決方案，理解 IP 分配的問題以及可能的解決辦法</li></ol><p>接下來我們將實戰進行分析，直接對大家最常用也是最知名的 <strong>CNI</strong> 之一， <strong>flannel</strong></p><h1>環境建置</h1><p>為了搭建一個擁有三個節點的 kubernetes cluster，我認為直接使用 <strong>kubernetes-dind-cluster</strong> 是個滿不錯的選擇，可以快速搭建環境，又有多節點。</p><p>或是也可以土法煉鋼繼續使用 <strong>kubeadm</strong> 的方式創建多節點的 kubernetes cluster， 這部分並沒有特別規定，總之能搭建起來即可。</p><p>此外相關的版本資訊方面</p><ul><li>kubernetes version:v1.15.4</li><li>flannel: 使用<a href="https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml" target="_blank" rel="noopener noreferrer">官方安裝 Yaml</a></li><li>kubeadm 安裝過程使用的參數 <strong>--pod-network-cidr=10.244.0.0/16</strong></li></ul><h1>目標</h1><p>基於前述的觀察，針對 Flannel 這套 CNI 解決方案，我想要觀察並討論的重點有</p><ol><li>理解 <a href="https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml" target="_blank" rel="noopener noreferrer">官方安裝 Yaml</a> 實際上安裝了什麼元件到 kubernetes cluster 中，同時這些元件又各自扮演什麼角色</li><li>flannel 使用的 CNI config 有什麼特色以及用到什麼功能</li><li>IP 管理的問題 flannel 是怎麼解決的</li><li>flannel 是如何提供網路能力，單一 Pod 是如何存取外網的</li><li>跨節點的 Pod 是如何互相存取彼此的</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="安裝過程理解">安裝過程理解<a href="#安裝過程理解" class="hash-link" aria-label="Direct link to 安裝過程理解" title="Direct link to 安裝過程理解">​</a></h2><p>官方的 <a href="https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml" target="_blank" rel="noopener noreferrer">安裝yaml</a> 非常的長，這裡面包含了六種 kubernetes 的資源，分別如下。</p><ul><li>PodSecurityPolicy</li><li>ClusterRole</li><li>ClusterRoleBinding</li><li>ServiceAccount</li><li>ConfigMap</li><li>DaemonSet</li></ul><p>雖然這邊有六個資源，但是基於使用類別來看，我個人認為其實就是分成兩大類別，前面四個類別是相互依賴一起運作的，目的就是創造一個可控管且權利被限制的 <strong>kubernetes service account</strong>，而後面兩個則算是整個邏輯處理的核心，所有上述的問題都在這兩個資源內處理。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="podsecuritypolicy">PodSecurityPolicy<a href="#podsecuritypolicy" class="hash-link" aria-label="Direct link to PodSecurityPolicy" title="Direct link to PodSecurityPolicy">​</a></h3><p>用來限制每個被創造 <strong>Pod</strong> 的定義，一旦 <strong>Pod</strong> 本身資源的定義沒有滿足 <strong>PodSecurityPolicy</strong> 的規範，該 <strong>Pod</strong> 就不會被拒絕建立。</p><p>這些規範與限制都是希望能夠加強 <strong>Pod</strong> 本身的安全性，基於沒有用到的部分就不要打開，針對有需求的部分才去使用。</p><p>這個功能目前預設沒有開啟，若要開啟的話需要對 <strong>admission controller</strong> 設定參數，同時要注意的是一但開啟這個功能，但是卻沒有任何相關的 <strong>PodSecuirtyPolicy</strong> 設定的話，預設情況下所有的 <strong>Pod</strong> 都不能被創造，算是一個白名單的機制</p><blockquote><p>Pod security policy control is implemented as an optional (but recommended) admission controller. PodSecurityPolicies are enforced by enabling the admission controller, but doing so without authorizing any policies will prevent any pods from being created in the cluster.</p></blockquote><p>此功能沒有辦法單獨使用，需要搭配 Service Account 一併使用，所以接下來的 RBAC 等都是串連再一起使用的。</p><p>對於 <strong>flannel</strong> 來說，其規範了下列安全設定來確保其創建的 <strong>Pod</strong> 的能力是被限制的</p><ol><li>privileged</li><li>volumes</li><li>allowedHostPaths
這邊可以看到一個跟 <strong>cni</strong> 相關的地址，代表 <strong>flannel</strong> 的 <strong>pod</strong> 勢必會對該資料夾進行一些手腳</li><li>Users/Groups</li><li>Capabilities
這邊特別允許了只能給 <strong>NET_ADMIN</strong> 這個選項，這個意味 <strong>flannel</strong> 會想要針對 <strong>Pod</strong> 上的網路部分做些設定，這些設定跟其網路連接有很大的關係。</li><li>Host namespaces
之前 <strong>CNI</strong> 章節忘了提到的就是所謂的 <strong>hostnetwork</strong> 的設定，如果 <strong>pod</strong> 裡面有設定 <strong>hostnetwork:true</strong> 就意味該 <strong>pod</strong> 所屬的 <strong>infrastructure container: Pause</strong> 其實不會創建新的 <strong>network namespace</strong>，而是會跟 <strong>host</strong> 也就是 <strong>kubernetes node</strong> 共用相同的網路空間。
這個功能相對危險，只要該 <strong>Pod</strong> 也有其他的能力，譬如 <strong>NET_ADMIN</strong>，其實該 <strong>Pod</strong> 是有能力摧毀整個 <strong>kubernetes cluster</strong> 的連線能力的，譬如亂修改 <strong>route table</strong>, <strong>ip address</strong> 等</li></ol><p>更多關於這個資源的介紹可以參考 <a href="https://kubernetes.io/docs/concepts/policy/pod-security-policy/" target="_blank" rel="noopener noreferrer">PodSecurityPolicy</a>。</p><div class="language-json= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: policy/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: PodSecurityPolicy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: psp.flannel.unprivileged</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  annotations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    seccomp.security.alpha.kubernetes.io/allowedProfileNames: docker/default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    seccomp.security.alpha.kubernetes.io/defaultProfileName: docker/default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    apparmor.security.beta.kubernetes.io/allowedProfileNames: runtime/default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    apparmor.security.beta.kubernetes.io/defaultProfileName: runtime/default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  privileged: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - configMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - emptyDir</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - hostPath</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  allowedHostPaths:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - pathPrefix: &quot;/etc/cni/net.d&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - pathPrefix: &quot;/etc/kube-flannel&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - pathPrefix: &quot;/run/flannel&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  readOnlyRootFilesystem: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Users and groups</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  runAsUser:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule: RunAsAny</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  supplementalGroups:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule: RunAsAny</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fsGroup:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule: RunAsAny</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Privilege Escalation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  allowPrivilegeEscalation: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  defaultAllowPrivilegeEscalation: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Capabilities</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  allowedCapabilities: [&#x27;NET_ADMIN&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  defaultAddCapabilities: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  requiredDropCapabilities: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Host namespaces</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hostPID: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hostIPC: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hostNetwork: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hostPorts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - min: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    max: 65535</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # SELinux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  seLinux:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # SELinux is unsed in CaaSP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rule: &#x27;RunAsAny&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>這邊定義了 <strong>ClusterRole</strong> 的資源，其中會透過 <strong>use</strong> 這個動作與上述的 <strong>PodSecurityPolicy</strong> 給綁定，此外也可以看到其他相關的能力，譬如</p><ol><li>對 pod 的取得</li><li>對 node 本身要可以 list 以及 watch</li><li>對 nodes/status 執行 patch</li></ol><p>有 <strong>Patch</strong> 就可以期待 <strong>flannel</strong> 會對 <strong>node</strong> 本身添加什麼樣的資訊，之後會再討論。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="clusterrole">ClusterRole<a href="#clusterrole" class="hash-link" aria-label="Direct link to ClusterRole" title="Direct link to ClusterRole">​</a></h3><div class="language-json= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kind: ClusterRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: rbac.authorization.k8s.io/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: flannel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rules:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - apiGroups: [&#x27;extensions&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resources: [&#x27;podsecuritypolicies&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    verbs: [&#x27;use&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resourceNames: [&#x27;psp.flannel.unprivileged&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - apiGroups:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - pods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    verbs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - get</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - apiGroups:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - nodes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    verbs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - watch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - apiGroups:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - nodes/status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    verbs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - patch</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="clusterrolebindingservice-account">ClusterRoleBinding/Service Account<a href="#clusterrolebindingservice-account" class="hash-link" aria-label="Direct link to ClusterRoleBinding/Service Account" title="Direct link to ClusterRoleBinding/Service Account">​</a></h3><p>最後就是透過 <strong>Service Account</strong> 以及 <strong>ClusterRoleBinding</strong> 這兩個資源將上述的資源全部整合起來，創造出一個名為 <strong>flannel</strong>  的 <strong>service account</strong>。</p><p>可以預期之後看到 <strong>daemonset</strong> 的時候會使用這個 <strong>service account</strong> 來作為創建的使用者。</p><div class="language-json= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kind: ClusterRoleBinding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: rbac.authorization.k8s.io/v1beta1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: flannel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">roleRef:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  apiGroup: rbac.authorization.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kind: ClusterRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: flannel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subjects:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- kind: ServiceAccount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: flannel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: kube-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">----</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: ServiceAccount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: flannel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: kube-system</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-bash= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl -n kube-system get sa,clusterrole,clusterrolebinding,psp | grep flannel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">serviceaccount/flannel                              1         14h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterrole.rbac.authorization.k8s.io/flannel                                                                14h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">clusterrolebinding.rbac.authorization.k8s.io/flannel                                                14h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">podsecuritypolicy.extensions/psp.flannel.unprivileged   false   NET_ADMIN   RunAsAny   RunAsAny    RunAsAny   RunAsAny   false            configMap,secret,emptyDir,hostPath</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configmap">ConfigMap<a href="#configmap" class="hash-link" aria-label="Direct link to ConfigMap" title="Direct link to ConfigMap">​</a></h3><p>下一個要研究的資源就是牽扯到檔案的 <strong>configmap</strong>， <strong>flannel</strong> 這邊設定了兩個檔案，分別是 <strong>cni-conf.json</strong> 以及 <strong>net-conf.json</strong>。</p><div class="language-json= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kind: ConfigMap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: kube-flannel-cfg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: kube-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tier: node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    app: flannel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cni-conf.json: |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;name&quot;: &quot;cbr0&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;plugins&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;type&quot;: &quot;flannel&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;delegate&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;hairpinMode&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;isDefaultGateway&quot;: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;type&quot;: &quot;portmap&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;capabilities&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;portMappings&quot;: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  net-conf.json: |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Network&quot;: &quot;10.244.0.0/16&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;Backend&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;Type&quot;: &quot;vxlan&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>cni-conf</strong> 如其名稱，就是給 <strong>CNI</strong> 使用的設定檔案，我們可以觀察到其使用了 <strong>plugins</strong> 的關鍵字，其格式則是 <strong>Network Configuration List</strong>，而裡面包含了兩個 <strong>CNI</strong>，分別是 <strong>flannel</strong> 以及 <strong>portmap</strong>。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="portmap-cni">Portmap CNI<a href="#portmap-cni" class="hash-link" aria-label="Direct link to Portmap CNI" title="Direct link to Portmap CNI">​</a></h4><p><strong>portmap</strong> 這個 <strong>CNI</strong> 則是<a href="https://github.com/containernetworking/plugins/tree/master/plugins/meta/portmap" target="_blank" rel="noopener noreferrer">官方維護</a>的，其功能是類似提供 <strong>docker -p host_port:container_port</strong> 的功用，能夠幫忙在 <strong>host</strong> 也提供一個路口幫忙轉發封包到 <strong>container</strong> 裡面。 基本上我覺得有使用 <strong>kubernetes service</strong> 的話就不需要這個功能了。</p><p>若要開啟這個功能除了 <strong>CNI</strong> 有要支援之外，也必須要在 <strong>pod</strong> 裡面去描述 <strong>hostPort</strong>，這樣 <strong>CRI</strong> 創建的時候就會把這些資訊包裝起來一併傳給 <strong>CNI</strong> 去處理。</p><p>以下是一個範例，創建該資源後可以在有部署該 <strong>Pod</strong> 的節點上發現一些由 <strong>CNI</strong> 創建的 <strong>iptables</strong> 規則，這種情況下可以達到類似 <strong>NodePort</strong> 的效果。</p><div class="language-bash= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ cat server.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: k8s-udpserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      run: k8s-udpserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  replicas: 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  template:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        run: k8s-udpserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: k8s-udpserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        imagePullPolicy: IfNotPresent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image: hwchiu/pythontest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - containerPort: 20001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          hostPort: 20001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          protocol: UDP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ sudo iptables-save -t nat | grep 20001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-A CNI-DN-eb9116f984fef9374c9e2 -s 10.244.0.6/32 -p udp -m udp --dport 20001 -j CNI-HOSTPORT-SETMARK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-A CNI-DN-eb9116f984fef9374c9e2 -s 127.0.0.1/32 -p udp -m udp --dport 20001 -j CNI-HOSTPORT-SETMARK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-A CNI-DN-eb9116f984fef9374c9e2 -p udp -m udp --dport 20001 -j DNAT --to-destination 10.244.0.6:20001</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-A CNI-HOSTPORT-DNAT -p udp -m comment --comment &quot;dnat name: \&quot;cbr0\&quot; id: \&quot;c55a611c4b8e8a4bef86ac05a3328258a858165b3bf4a3982997f9662bd82916\&quot;&quot; -m mult</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">iport --dports 20001 -j CNI-DN-eb9116f984fef9374c9e2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vagrant@k8s-dev:~$</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>但是使用這個最大的問題是 <strong>host port</strong> 是獨佔的，所以如果今天 <strong>pod</strong> 的數量超過 <strong>node</strong> 的數量，就會發生很多 <strong>pod</strong> 創建不起來，譬如下圖</p><div class="language-bash= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                             READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">k8s-udpserver-5b989865bf-8jlwv   1/1     Running   0          15m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">k8s-udpserver-5b989865bf-jmljc   0/1     Pending   0          15m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">k8s-udpserver-5b989865bf-l25f4   1/1     Running   0          15m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">k8s-udpserver-5b989865bf-ps2wx   1/1     Running   0          15m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">k8s-udpserver-5b989865bf-t9glv   0/1     Pending   0          15m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">k8s-udpserver-5b989865bf-zvw6r   0/1     Pending   0          15m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl describe pod k8s-udpserver-5b989865bf-jmljc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Events:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Type     Reason            Age                 From               Message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ----     ------            ----                ----               -------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Warning  FailedScheduling  74s (x16 over 15m)  default-scheduler  0/3 nodes are available: 3 node(s) didn&#x27;t have free ports for the requested pod ports.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>CNI</strong>這邊除了 <strong>portmapping</strong> 之外還有各式各樣的組合，譬如可以限速的 <strong>bandwidth</strong>，調整 <strong>MAC</strong> 地址的，一時之間難以講完，就有遇到再來分享吧</p><p>除了 <strong>CNI</strong> 設定外，另外一個檔案 <strong>net-conf.json</strong> 則是給 <strong>flannel</strong> 程式使用的設定檔案。
這邊會設定 <strong>flannel</strong> 的相關資訊，特別要注意的是如果使用的是 <strong>kubeadm</strong> 來安裝 <strong>kubernetes</strong> 的話，要確認 <strong>net-conf.json</strong> 裡面關於 <strong>network</strong> 的資訊需要與 <strong>kubeadm init --pod-network-cidr=xxxx</strong> 一致。</p><p>如果沒有使用 <strong>kubeadm</strong> 的話，該參數則會被用來分配 <strong>ip</strong> 地址給所有的 <strong>Pod</strong>。</p><p>根據<a href="https://github.com/coreos/flannel/blob/443d773037ac0f3b8a996a6de018b903b6a58c62/Documentation/kubernetes.md" target="_blank" rel="noopener noreferrer">官方文件</a></p><blockquote><p>A ConfigMap containing both a CNI configuration and a flannel configuration. The network in the flannel configuration should match the pod network CIDR. The choice of backend is also made here and defaults to VXLAN.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="daemonset">DaemonSet<a href="#daemonset" class="hash-link" aria-label="Direct link to DaemonSet" title="Direct link to DaemonSet">​</a></h2><p>接下來就要來看最大的重點 <strong>DaemonSet</strong>，首先 <strong>flannel</strong> 準備了非常多的 <strong>daemonset</strong> 檔案，分別針對不同的系統架構，譬如 <strong>amd64</strong>, <strong>arm</strong>, <strong>ppc</strong> 之類的，由於內容大同小異，差別於 <strong>node selector</strong>  而已，因此這邊我們就針對 <strong>amd64</strong> 這個範例來看</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuration">Configuration<a href="#configuration" class="hash-link" aria-label="Direct link to Configuration" title="Direct link to Configuration">​</a></h3><p>前述文章都有探討到， <strong>CNI</strong> 本身是一個以節點為單位的設定檔案，每個節點都需要一份獨立的設定檔案，這意味者所有新加入的節點也都要有該設定檔案，不單純只是現在有的節點需要維護而已。
這個情況下最常用的方式就是透過 <strong>daemonset</strong> 的方式，讓每一台機器上都跑一個特定的 <strong>Pod</strong>，該 <strong>Pod</strong> 會透過</p><ol><li>configmap 的方式安裝相關設定檔案到 kubernetes 中</li><li>啟動一個 <strong>Pod</strong>，並且將相關資料夾掛載到 <strong>Pod</strong> 裡面</li><li>透過 <strong>cp</strong> 的方式將檔案安裝到各節點中</li></ol><p><strong>flannel</strong> 就是採用這樣的方式，並且把這個動作放到 <strong>init container</strong> 去執行，因為這類型的指令其實不太算是 <strong>daemon</strong>，比較類似 <strong>job</strong>，執行完就結束離開的應用程式，放到 <strong>Container</strong> 這邊則會使得該 <strong>Container</strong> 必須要一直利用 <strong>pause/sleep</strong> 等方式來運作得像一個 <strong>daemon</strong>，反而搞得複雜。</p><p>此外也可以觀察到該 <strong>DaemonSet</strong> 有特別指定 <strong>serviceAccountName: flannel</strong>， 算是把上述的資源跟這邊給接起來。更重要的是基於安全性方面的設定完全與上面的 <strong>PodSecutityPolicy</strong> 一致。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">securityContext:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    privileged: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    capabilities:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        add: [&quot;NET_ADMIN&quot;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-yaml= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: DaemonSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: kube-flannel-ds-amd64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: kube-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tier: node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    app: flannel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  selector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    matchLabels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      app: flannel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  template:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      labels:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tier: node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        app: flannel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      hostNetwork: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      nodeSelector:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        beta.kubernetes.io/arch: amd64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      tolerations:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - operator: Exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        effect: NoSchedule</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      serviceAccountName: flannel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      initContainers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: install-cni</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image: quay.io/coreos/flannel:v0.11.0-amd64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        command:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - cp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        args:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - -f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - /etc/kube-flannel/cni-conf.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - /etc/cni/net.d/10-flannel.conflist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        volumeMounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - name: cni</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          mountPath: /etc/cni/net.d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - name: flannel-cfg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          mountPath: /etc/kube-flannel/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: kube-flannel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        image: quay.io/coreos/flannel:v0.11.0-amd64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        command:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - /opt/bin/flanneld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        args:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - --ip-masq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - --kube-subnet-mgr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          requests:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            cpu: &quot;100m&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            memory: &quot;50Mi&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          limits:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            cpu: &quot;100m&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            memory: &quot;50Mi&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        securityContext:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          privileged: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          capabilities:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             add: [&quot;NET_ADMIN&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        env:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - name: POD_NAME</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          valueFrom:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fieldRef:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              fieldPath: metadata.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - name: POD_NAMESPACE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          valueFrom:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fieldRef:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              fieldPath: metadata.namespace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        volumeMounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - name: run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          mountPath: /run/flannel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - name: flannel-cfg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          mountPath: /etc/kube-flannel/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - name: run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          hostPath:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            path: /run/flannel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - name: cni</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          hostPath:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            path: /etc/cni/net.d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        - name: flannel-cfg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          configMap:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            name: kube-flannel-cfg</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>接下來看看主要的 <strong>Container</strong>，這個 <strong>Container</strong> 是一個額外的應用程式，會幫忙處理 <strong>CNI</strong> 當下不方便處理的事情。</p><p>目前官方預設的安裝檔案內只有設定兩個變數，分別是</p><ol><li>--ip-masq
會透過 <code>masquerade</code> 的功能幫往外送出的封包進行 SNAT，譬如下列這些規則就是 <strong>flannel</strong> 幫忙下的</li></ol><div class="language-bash= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-A POSTROUTING -s 10.244.0.0/16 -d 10.244.0.0/16 -j RETURN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-A POSTROUTING -s 10.244.0.0/16 ! -d 224.0.0.0/4 -j MASQUERADE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-A POSTROUTING ! -s 10.244.0.0/16 -d 10.244.0.0/24 -j RETURN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-A POSTROUTING ! -s 10.244.0.0/16 -d 10.244.0.0/16 -j MASQUERADE</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>--kube-subnet-mgr
這個主要是用來告訴 <strong>flannel</strong> 如何處理 <strong>IP Subnet</strong>，目前有兩種模式，如果有特別開啟 <strong>kube-subnet-mgr</strong> 的話就會使用 <strong>kubernetes</strong> API 來處理，同時相關的設定檔案也會從 <strong>net-conf.json</strong> 來讀取，反之就全部都從 <strong>etcd</strong> 來儲存與處理。</li></ol><p>此外我們還可以看一下相關的 <strong>Volume</strong> 到底有哪些，除了上述的 <strong>configMap</strong> 之外，我們發現該 <strong>Pod</strong> 也掛載了下列的位置</p><ol><li>/run/flannel</li></ol><p>接下來我們就實際看一下這個位置的檔案</p><div class="language-bash= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ sudo ls /run/flannel/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">subnet.env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ sudo cat /run/flannel/subnet.env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FLANNEL_NETWORK=10.244.0.0/16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FLANNEL_SUBNET=10.244.0.1/24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FLANNEL_MTU=1450</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FLANNEL_IPMASQ=true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>看到跟 <strong>IP</strong> 有關的設定，決定看一下另外幾台機器</p><div class="language-bash= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ sudo cat /run/flannel/subnet.env</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FLANNEL_NETWORK=10.244.0.0/16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FLANNEL_SUBNET=10.244.2.1/24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FLANNEL_MTU=1450</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FLANNEL_IPMASQ=true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以看到不同機器上面的 <strong>SUBNET</strong> 欄位不同，同時 <strong>Pod</strong> 得到的 <strong>IP</strong> 去觀察</p><div class="language-bash= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pods -o wide</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                             READY   STATUS    RESTARTS   AGE   IP           NODE        NOMINATED NODE   READINESS GATES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">k8s-udpserver-6576555bcb-7h8jh   1/1     Running   0          13m   10.244.0.8   k8s-dev     &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">k8s-udpserver-6576555bcb-c52rk   1/1     Running   0          13m   10.244.1.7   k8s-dev-1   &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">k8s-udpserver-6576555bcb-dxm8h   1/1     Running   0          13m   10.244.1.6   k8s-dev-1   &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">k8s-udpserver-6576555bcb-f49m4   1/1     Running   0          13m   10.244.2.7   k8s-dev-2   &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">k8s-udpserver-6576555bcb-hfhw2   1/1     Running   0          13m   10.244.2.8   k8s-dev-2   &lt;none&gt;           &lt;none&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">k8s-udpserver-6576555bcb-hswhn   1/1     Running   0          13m   10.244.2.6   k8s-dev-2   &lt;none&gt;           &lt;none&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>很巧的是每個 <strong>Node</strong> 上面該檔案的 <strong>SUBNET</strong> 都與運行 <strong>POD</strong> 的 <strong>IP</strong> 網段符合，看起來這個檔案勢必有動了一些手腳。</p><p>對於整體 <strong>IP</strong> 分配的過程我們將到下篇文章再來分析</p><h1>Summary</h1><p>本篇文章探討了的 <strong>Flannel</strong> 的安裝過程，從官方提供的 <strong>yaml</strong> 過程中來一一探討每個資源的用途，同時也觀察到了其利用 <strong>DaemonSet</strong> 配上 <strong>init container</strong> 來幫每個節點安裝 <strong>CNI</strong> 以及本身運行的設定檔案，確保未來任何新加入的節點都能夠順利的擁有這些檔案並正常運作。</p><p>用下圖幫本章節做個總結
<img loading="lazy" src="https://i.imgur.com/DlbQ55O.png" class="img_ev3q"></p><ul><li><a href="https://github.com/coreos/flannel/blob/443d773037ac0f3b8a996a6de018b903b6a58c62/Documentation/kubernetes.md" target="_blank" rel="noopener noreferrer">https://github.com/coreos/flannel/blob/443d773037ac0f3b8a996a6de018b903b6a58c62/Documentation/kubernetes.md</a></li><li><a href="https://github.com/kubernetes/kubernetes" target="_blank" rel="noopener noreferrer">https://github.com/kubernetes/kubernetes</a></li><li><a href="https://kubernetes.io/docs/concepts/policy/pod-security-policy/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/concepts/policy/pod-security-policy/</a></li><li><a href="https://github.com/coreos/flannel/blob/ba49cd4c1e49d566da4a08b370384ce8ced0c0e3/Documentation/troubleshooting.md" target="_blank" rel="noopener noreferrer">https://github.com/coreos/flannel/blob/ba49cd4c1e49d566da4a08b370384ce8ced0c0e3/Documentation/troubleshooting.md</a>?</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/cni">CNI</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/kubernetes">Kubernetes</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/flannel">Flannel</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/network">Network</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/i-thome">iThome</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> by <b>HungWei Chiu</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/2019/iThome_Challenge/cni-ipam"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">初探 CNI 的 IP 分配問題 (IPAM)</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/2019/iThome_Challenge/cni-flannel-ii"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">CNI - Flannel - IP 管理篇</div></a></nav><hr><br></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#安裝過程理解" class="table-of-contents__link toc-highlight">安裝過程理解</a><ul><li><a href="#podsecuritypolicy" class="table-of-contents__link toc-highlight">PodSecurityPolicy</a></li><li><a href="#clusterrole" class="table-of-contents__link toc-highlight">ClusterRole</a></li><li><a href="#clusterrolebindingservice-account" class="table-of-contents__link toc-highlight">ClusterRoleBinding/Service Account</a></li><li><a href="#configmap" class="table-of-contents__link toc-highlight">ConfigMap</a></li></ul></li><li><a href="#daemonset" class="table-of-contents__link toc-highlight">DaemonSet</a><ul><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">其他資源</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://hwchiu.medium.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">英文部落格<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/technologynoteniu" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook Page(矽谷牛耕田筆記)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/hw_chiu" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/hung-wei-chiu-52561494/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Cloud Native Taiwan User Group(CNTUG)</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://cloudnative.tw/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Official Site<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/@cloudnativetaiwanusergroup" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/groups/298183320685010" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://community.cncf.io/cloud-native-taiwan-user-group/" target="_blank" rel="noopener noreferrer" class="footer__link-item">CNCF Page<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://t.me/cntug" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 hwchiu. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.187b671b.js"></script>
<script src="/assets/js/main.1aa7f3cb.js"></script>
</body>
</html>
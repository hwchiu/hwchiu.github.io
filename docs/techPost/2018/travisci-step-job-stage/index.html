<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-techPost/2018/travisci-step-job-stage" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">[DevOps] Travis CI - Step/Job/Stage | hwchiu learning note</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://hwchiu.com/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://hwchiu.com/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://hwchiu.com/docs/techPost/2018/travisci-step-job-stage"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="robots" content="max-image-preview:large"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="[DevOps] Travis CI - Step/Job/Stage | hwchiu learning note"><meta data-rh="true" name="description" content="這次要跟大家分享的是一些關於 TravisCI 的使用心得，相信有在 Github 上面維護專案的人應該都對各式各樣的 CI 系統不陌生，不論是 公有服務的 TravisCI 或是 CircleCI 或是自己透過 Jenkins 來處理。本篇想要跟大家分享的重點是在 TravisCI 上關於 Build Stage 的概念，透過 Build Stage，我們可以更有架構的去設計該專案的 CI/CD 流程。"><meta data-rh="true" property="og:description" content="這次要跟大家分享的是一些關於 TravisCI 的使用心得，相信有在 Github 上面維護專案的人應該都對各式各樣的 CI 系統不陌生，不論是 公有服務的 TravisCI 或是 CircleCI 或是自己透過 Jenkins 來處理。本篇想要跟大家分享的重點是在 TravisCI 上關於 Build Stage 的概念，透過 Build Stage，我們可以更有架構的去設計該專案的 CI/CD 流程。"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://hwchiu.com/docs/techPost/2018/travisci-step-job-stage"><link data-rh="true" rel="alternate" href="https://hwchiu.com/docs/techPost/2018/travisci-step-job-stage" hreflang="en"><link data-rh="true" rel="alternate" href="https://hwchiu.com/docs/techPost/2018/travisci-step-job-stage" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/rss.xml" title="hwchiu learning note RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="hwchiu learning note Atom Feed"><link rel="stylesheet" href="/assets/css/styles.d69aff92.css">
<link rel="preload" href="/assets/js/runtime~main.66f04512.js" as="script">
<link rel="preload" href="/assets/js/main.987d1402.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="Hwchiu" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="Hwchiu" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">HWCHIU 學習筆記</b></a><a class="navbar__item navbar__link" href="/about">我是誰</a><a class="navbar__item navbar__link" href="/">短篇筆記</a><a class="navbar__item navbar__link" href="/tags">短篇筆記-分類</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/category/2023">長篇技術文</a><a class="navbar__item navbar__link" href="/docs/tags">長篇技術文-分類</a><a class="navbar__item navbar__link" href="/course">線上課程</a><a class="navbar__item navbar__link" href="/public_sharing">演講紀錄</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/hwchiu/docusaurus-blog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2023">2023</a><button aria-label="Toggle the collapsible sidebar category &#x27;2023&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2022">2022</a><button aria-label="Toggle the collapsible sidebar category &#x27;2022&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2021">2021</a><button aria-label="Toggle the collapsible sidebar category &#x27;2021&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2020">2020</a><button aria-label="Toggle the collapsible sidebar category &#x27;2020&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2019">2019</a><button aria-label="Toggle the collapsible sidebar category &#x27;2019&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/2018">2018</a><button aria-label="Toggle the collapsible sidebar category &#x27;2018&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techPost/2018/cert-manager">Automatically Renew Your Certificated in kubernetes by Cert-Manager</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techPost/2018/cni-compare">常見 CNI (Container Network Interface) Plugin 介紹</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techPost/2018/cni-questions">CNI 常見問題整理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techPost/2018/gpu-gke">Install GPU in GKE(Google Kubernetes Engine)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techPost/2018/introduce-cni-i">[Container Network Interface] Bridge Network In Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techPost/2018/introduce-cni-ii">[Container Network Interface] CNI Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techPost/2018/introduce-cni-iii">[Container Network Interface] Implement Your CNI In Golang</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techPost/2018/k8s-security-11tips-i">11個保護你 Kubernetes 集群的技巧與觀念(上)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techPost/2018/k8s-security-11tips-ii">11個保護你 Kubernetes 集群的技巧與觀念(下)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techPost/2018/kubernetes-dns-ii">[Kubernetes] DNS Setting When DnsPolicy Is Default</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techPost/2018/kubernetes-dns-iii">[Kubernetes] DNS Setting with Dockerd(原始碼分析上)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techPost/2018/kubernetes-dns-iiii">[Kubernetes] DNS Setting with Dockerd(原始碼分析下)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techPost/2018/kubernetes-dns">[Kubernetes] DNS setting in your Pod</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techPost/2018/kubernetes-fedora">Install the kubernetes as single node in Fedora 28</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techPost/2018/kubernetes-service-i">[Kubernetes] What Is Service?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techPost/2018/kubernetes-service-ii">[Kubernetes] How to Implement Kubernetes Service - ClusterIP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techPost/2018/kubernetes-service-iii">[Kubernetes] How to Implement Kubernetes Service - NodePort</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techPost/2018/kubernetes-service-iiii">[Kubernetes] How to Implement Kubernetes Service - SessionAffinity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techPost/2018/kubernetes-storage-i">Kubernetes X Storage (I)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techPost/2018/kubernetes-storage-ii">NFS 於 Kubernetes 內的各種應用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techPost/2018/mgo-aggregate">[Golang] aggregate in mongo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techPost/2018/netfilter-eiptables-i">[netfilter] Introduction to ebtables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techPost/2018/netfilter-eiptables-ii">[netfilter] Introduction to iptables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techPost/2018/netfilter-eiptables-iii">[netfilter] Dig Into Docker Bridge Network By iptables/ebtables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techPost/2018/paper-tensorflow-with-rdma">[論文導讀] - Towards Zero Copy Dataflows using RDMA</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techPost/2018/tools-ncdu">NCurses Disk Usage(ncdu)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/techPost/2018/travisci-k8s">使用 Travis CI 為你的 Kubernetes 應用程式打造自動化測試</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/techPost/2018/travisci-step-job-stage">[DevOps] Travis CI - Step/Job/Stage</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2017">2017</a><button aria-label="Toggle the collapsible sidebar category &#x27;2017&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2016">2016</a><button aria-label="Toggle the collapsible sidebar category &#x27;2016&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2015">2015</a><button aria-label="Toggle the collapsible sidebar category &#x27;2015&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2014">2014</a><button aria-label="Toggle the collapsible sidebar category &#x27;2014&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/2013">2013</a><button aria-label="Toggle the collapsible sidebar category &#x27;2013&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/2018"><span itemprop="name">2018</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">[DevOps] Travis CI - Step/Job/Stage</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Preface</h1><p>舉例來說，假設我的 <code>Github</code> 專案會希望每次<code>Release</code>時會有下列的行為</p><ol><li>進行 單元測試/整合測試 等各種確保程式碼正常運作的測試</li><li>建置 <code>Docker</code> 相關映像檔並且更新到相關的容器倉庫</li><li>將最新的程式碼部屬到相關的環境上</li></ol><p>接下來會跟大家分享一下，在 <code>TravisCI</code> 的設定中，我們有什麼辦法可以滿足上述的需求</p><p>本文最後用到的 <code>travisCI</code> 設定檔可以在 <a href="https://github.com/hwchiu/Travis-MultisStage/blob/master/.travis.yml" target="_blank" rel="noopener noreferrer">TravisCI Example</a> 找到</p><h1>Build Steps</h1><p>所謂的「工欲善其事，必先利其器」，在使用 <code>TravisCI</code> 來解決我們的問題之前，我們必須要先瞭解 <code>TravisCI</code> 的基本概念，然後思考如何用這些基本概念來完成我們的需求。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="installscript">install/script<a href="#installscript" class="hash-link" aria-label="Direct link to install/script" title="Direct link to install/script">​</a></h2><p>整個 <code>TravisCI</code> 的生命週期是由兩個主要步驟來構成</p><ol><li>install: 用來安裝任何相依性套件的階段</li><li>script: 真正用來進行 <code>CI</code> 相關測試的階段</li></ol><p>除了上述這兩個步驟外，也有所謂類似 <code>Environment</code> 這種<code>非必要</code>選項可以讓整個 <code>TrasivCI</code>設定更簡潔
譬如可以讓 <code>TravisCI</code> 幫你準備相關的環境程式語言環境與特定版本，譬如說 <code>golang 1.8, 1.9</code></p><p>對於 <code>install/script</code> 這兩個執行步驟來說，本身為了讓運作邏輯更加細膩，所以又衍生出了前後步驟的概念</p><ol><li>before_install: 該步驟會在 <code>install</code> 前運行，主要是用來準備任何 <code>install</code> 步驟所需要的資源，譬如透過 <code>apt-get update</code> 等更新套件倉庫。</li><li>before_script: 該步驟會在 <code>script</code> 前運行，如同 <code>before_install</code> 一樣，為了 <code>script</code> 進行資源準備來滿足真正測試所需，譬如資料庫的建置</li><li>after_script: 當 <code>script</code> 運行完畢後會執行的步驟，實際上還有所謂的<code>after_success</code> 以及 <code>after_failure</code> 更細部的針對測試的結果來區分的步驟。</li></ol><p>根據相關人員在 <code>Github Issue</code> 的回答， <code>before_install</code> 以及 <code>before_script</code> 的使用時機如下</p><p><strong>before_install</strong> runs before the install step, which is meant to install any required packages or dependencies. You can prepare things before you run this step, or you can e.g. run sudo apt-get update to refresh the apt indexes.</p><p><strong>before_script</strong> runs before the actual test/build script runs. It&#x27;s commonly used to run any preparation steps required to get the build running, for instance copy database configurations, set up any additional environment configuration, and so on.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="example">Example<a href="#example" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">​</a></h2><p>以下示範一個非常簡單的 <code>.travis.yml</code> 設定檔案，在此環境中，我們要求 <code>TravisCI</code> 準備一個 <code>golang 1.8</code> 版本的環境，同時對於 <code>install</code> 以及 <code>script</code> 這兩個階段我們都執行非常簡單的指令。</p><div class="language-yaml= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">language: go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - &quot;1.8&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">before_install:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - echo &quot;before_install&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">install:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - echo &quot;install&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">before_script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - echo &quot;before_script&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - echo &quot;script&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>上述的運行結果如下圖，該圖示我們可以觀察到</p><ol><li>golang 版本 1.8</li><li>四個步驟的結果依序輸出</li></ol><p><img loading="lazy" src="https://i.imgur.com/14TXbFV.png" alt="Imgur" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="solution">Solution<a href="#solution" class="hash-link" aria-label="Direct link to Solution" title="Direct link to Solution">​</a></h2><p>有了關於 <code>TravisCI</code> 建置週期的概念後，回過頭來探討一些下最初的需求</p><ol><li>進行 單元測試/整合測試 等各種確保程式碼正常運作的測試</li><li>建置 <code>Docker</code> 相關映像檔並且更新到相關的容器倉庫</li><li>將最新的程式碼部屬到相關的環境上</li></ol><p>首先，這三個要求是有依賴性的，前面的失敗，後面的就不需要運行。
這邊沒有一個標準答案，有非常多的實現方式，譬如說</p><ol><li>將所有的步驟都放在 <code>script</code> 這個步驟去依序執行</li><li>使用 <code>script</code>, <code>after_script</code> 甚至是其他 <code>deploy</code> 等不同的步驟來依序完成這些事情</li></ol><p>譬如下面範例 (單純舉例)</p><div class="language-yaml= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">language: go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - &quot;1.8&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">before_install:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - echo &quot;before_install&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">install:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - echo &quot;install&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">before_script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - echo &quot;before_script&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - go test -v ./...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">after_script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - sudo docker build -t ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - sudo docker push ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deploy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - ./deploy.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以到官方網頁這邊學到更多不同的建置步驟以及彼此之間的先後關係
<a href="https://docs.travis-ci.com/user/customizing-the-build/" target="_blank" rel="noopener noreferrer">https://docs.travis-ci.com/user/customizing-the-build/</a></p><p>用下列這張圖來幫這個章節做一個總結</p><p><img loading="lazy" src="https://i.imgur.com/Mrb22oE.png" alt="Imgur" class="img_ev3q"></p><h1>Job</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="definition">Definition<a href="#definition" class="hash-link" aria-label="Direct link to Definition" title="Direct link to Definition">​</a></h2><p>瞭解了基本的用法後，我們要來看看一些關於 <code>TravisCI</code> 的進階用法，看看透過這些進階用法我們能夠完成什麼樣更豐富的 <code>CI</code> 流程。</p><p>首先，我們先定義什麼叫做 <code>Job</code>, <code>Job</code> 就是一個歷經 <code>TravisCI</code> 生命週期所有步驟的基本單位。</p><p>所以一個<code>Job</code> 簡單來說會經歷過 <code>Environment</code>, <code>before_install</code>, <code>install</code>, <code>before_script</code>, <code>script</code> 以及 <code>after_script</code> 所有步驟</p><p>這邊列舉的步驟並不是<code>TravisCI</code>的所有步驟，只是舉出幾個常見的步驟</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="multiple-job">Multiple Job<a href="#multiple-job" class="hash-link" aria-label="Direct link to Multiple Job" title="Direct link to Multiple Job">​</a></h2><p>有了 <code>Job</code> 的基本概念後，我們就可以往下思考一些更進階的用法。</p><p>假設專案本身是透過 <code>golang</code> 程式語言撰寫而成的，我們現在希望測試該專案在不同 <code>golang</code> 版本下是否都能夠正常運行。
舉例來說，我希望使用 <code>golang 1.8</code> 以及 <code>golang 1.9</code> 這兩個版本來進行專案的測試。</p><p>問題來了，這種情況下，我們要如何透過<code>TravisCI</code>來完成呢?
最直覺的就是我們什麼都硬幹，自己在 <code>TravisCI</code> 內去安裝各式各樣的環境，然後撰寫腳本去分開各式各樣的測試，將所有的需求都在<strong>一個Job</strong> 內完成。
當然這種情況下整個環境準備/測試等相關的邏輯就會複雜且不好維護</p><p>為了讓整個測試的架構乾淨與明瞭，我們可以透過 <code>Travis</code> 平行的運行多個<code>Job</code> 來滿足我們的需求。
在此架構下， <code>Travis</code> 會併行的去運行這些 <code>Job</code>, 且每個 <code>Job</code> 都有自己的建置週期，所有的 <code>Job</code> 都要都要成功該次測試才算成功。</p><p>使用下列圖示再次說明 <code>Multiple Job</code> 的概念
<img loading="lazy" src="https://i.imgur.com/1knugMM.png" alt="Imgur" class="img_ev3q"></p><p>上方描述的是一個簡單的 <code>Jobs</code> 概念，涵蓋了本文提及的基本建置週期。
下面則是為了滿足特別需求，希望多個<code>golang</code> 版本同時測試，此時我們就可以一次運行多個 <code>Job</code>, 其中只有 <code>Environemnt</code> 的部份是完全獨立，其餘則是都會採用相同的設定。</p><p>在 <code>TravisCI</code> 的設定檔案 <strong>.travis.yml</strong> 裡面，我們可以用下列的方式完成這個需求</p><div class="language-yaml= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">language: go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - &quot;1.8&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - &quot;1.9&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">before_install:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - echo &quot;before_install&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">install:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - echo &quot;install&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">before_script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - echo &quot;before_script&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - echo &quot;script&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>最後運行的結果如下, 可以看到該次的測試同時運行了兩個 <code>Job</code>, 這兩個 <code>Job</code> 分別是不同的 <code>Golang</code> 版本。
<img loading="lazy" src="https://i.imgur.com/sr2xvlX.png" alt="Imgur" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="custom-job">Custom Job<a href="#custom-job" class="hash-link" aria-label="Direct link to Custom Job" title="Direct link to Custom Job">​</a></h2><p>上述我們利用個 <code>go</code> 這個由 <code>TravisCI</code> 所定義的語法來完成產生 <code>MultipleJob</code> 的功能。</p><p>這時候腦筋一轉，<code>install</code>,<code>script</code> 這些建置步驟是否也都可以有類似的概念呢?</p><p>舉例來說，我希望對我的專案進行不同的測試，譬如 <code>Unit Test</code>, <code>Integration test</code>。
而這些測試除了測試的方式不同之外，環境的準備也不同
此外，同時運行這些測試也能夠減少測試的時間，並且將測試結果更清楚的標示出是哪種測試出問題。</p><p>將上述的需求轉換成 <code>TravisCI</code> 的概念的話
就是需要同時運行多個 <code>Job</code>, 每個 <code>Job</code> 裡面對於每個建置步驟都有自己客製化的需求。</p><p>這個需求我們透過下圖視覺化的方式來重新檢視一次</p><p><img loading="lazy" src="https://i.imgur.com/Kr9KDi3.png" alt="Imgur" class="img_ev3q"></p><p>我們的需求很簡單，希望同時運行多個 <code>Job</code> 且這些 <code>Job</code> 針對不同的運行階段能夠選擇是否要使用預設的規則或是客製化自身的需求。</p><p><code>TravisCI</code> 就有提供了這樣的功能供各位去使用，在其 <code>.travis.yml</code> 這個 <code>yml</code> 的檔案中，我們要透過 <code>jobs:include</code> 的概念去撰寫</p><div class="language-yaml= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">language: go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - &quot;1.8&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">before_install:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - echo &quot;before_install&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">install:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - echo &quot;install&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">before_script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - echo &quot;before_script&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - echo &quot;script&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jobs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  include:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - stage: Custom Testing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name: Unit-Testing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      go: &quot;1.8&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      script: echo &quot;unit script&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: Integration-Testing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      before_install: &quot;Integration-Testing_before_install&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      go: &quot;1.9&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      script: &quot;Integration-Testing_script&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>其運行結果如下
<img loading="lazy" src="https://i.imgur.com/PhjZheD.png" alt="Imgur" class="img_ev3q"></p><p>我們可以觀察到我們的確運行了兩個 <code>Job</code>  而這兩個 <code>Job</code> 都有明確的名稱，這邊就沒有點進去看各自 <code>Job</code> 的運行結果，有興趣的人可以自行嘗試看看。</p><p>這邊先不討論語法，等到所有的概念都講述完畢後，再來討論語法的撰寫。</p><h1>Build Stage</h1><p>有了上述的 <code>Multiple Job</code> 的概念後，我們重新審視一下最初的需求</p><ol><li>進行 單元測試/整合測試 等各種確保程式碼正常運作的測試</li><li>建置 <code>Docker</code> 相關映像檔並且更新到相關的容器倉庫</li><li>將最新的程式碼部屬到相關的環境上</li></ol><p>首先，不同的測試本身可以透過同時運行多個 <code>Job</code> 來滿足，這邊好處理。</p><p>那建置/更新 <code>Docker Image</code> 這件事情，我們要讓誰來處理?</p><ol><li>上述的測試選一個 <code>Job</code>,  客製化其某些建置步驟來處理</li><li>額外產生一個 <code>Job</code> 來專門處理這類的需求</li></ol><p>只是採用第一種方式可能會有一個問題
假設我們需要 <code>所有</code> 測試都通過才能進行 <code>Docker</code> 相關的處理，那我們就沒有辦法在任意一個測試 <code>Job</code> 內去處理這個邏輯。</p><p>為了解決這個問題，除了將所有的工作重新集中回一個<code>Job</code>處理外，就只能在開啟第三個 <code>Job</code> 來處理。</p><p>但是這個 <code>Job</code> 本身有相依性的問題，它必須要確認前述相關測試的所有 <code>Job</code> 都完成才能夠繼續往下運行。
為了解決這個問題，我們要在這邊介紹 <code>Stage</code> 這個概念。</p><p><code>Stage</code> 的特色以及概念如下</p><ol><li>由一群 <code>Job</code> 組成</li><li>只要有一個 <code>Job</code> 失敗，該 <code>Stage</code> 就會被視為失敗</li><li>只有當該前 Stage 是成功的狀態，才會執行下一個 Stage</li></ol><p>有了 <code>Stage</code> 的概念，我們可以把上述的需求重新整理歸納成三個 <code>Stage</code></p><ul><li>Testing Stage<ul><li>Unit Testing Job</li><li>Integration Testing Job</li></ul></li><li>Docker Build Stage</li><li>Deploy Stage</li></ul><p>將這個概念用下圖再次檢視一次</p><p><img loading="lazy" src="https://i.imgur.com/YkGmTQN.png" alt="Imgur" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="example-1">Example<a href="#example-1" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">​</a></h2><p>每個 <code>Stage</code> 之間彼此有依賴性，只要當其中一個 <code>Stage</code> 失敗，就不會往下執行</p><p>下圖是每個 <code>Stage</code> 都順利執行的成果
<img loading="lazy" src="https://i.imgur.com/nm3COBH.png" alt="Imgur" class="img_ev3q"></p><p>下圖則是當第一個 <code>Testing Stage</code> 有任何失敗的結果
<img loading="lazy" src="https://i.imgur.com/pyyloCh.png" alt="Imgur" class="img_ev3q"></p><div class="language-go= codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go= codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">language: go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - &quot;1.8&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">before_install:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - echo &quot;before_install&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">install:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - echo &quot;install&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">before_script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - echo &quot;before_script&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - echo &quot;script&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jobs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  include:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - stage: Custom Testing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      name: Unit-Testing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      script: echo &quot;unit script&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: Integration-Testing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      before_install: echo &quot;Integration-Testing_before_install&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - stage: Build Docker Image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      script: echo &quot;docker build&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - stage: Deploy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      script: echo &quot;release&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>首先，我們要先定義 <code>Stage</code>, 在 <code>Stage</code> 裡面可以定義多個 <code>Job</code>, 而每個 <code>Job</code> 內又可以自定義每個建置階段，若沒有特別設定的，都會採用最上層的全域設定</p><p>定義 <code>Stage</code> 則採用 <code>stage</code> 這個關鍵字來幫建立，並且命名，針對每個 <code>job</code> 可以透過 <code>name</code> 的方式把對應的名稱替換掉讓整個測試報告更有閱讀性，然後接下來就可以去描述每個建置步驟，如 <code>script</code>, <code>install</code> 等各式各樣的建置週期步驟。</p><p>更詳細的設定可以直接參考<a href="https://docs.travis-ci.com/user/build-stages#how-do-build-stages-work" target="_blank" rel="noopener noreferrer">官網的說明</a></p><h1>Summary</h1><p>本文跟大家分享了關於 <code>TravisCI</code> 的使用心得，從基本的使用方法到進階的 <code>Multiple Job</code> 以及 <code>Stage</code></p><p>透過這些概念的組合，我們能夠將 <code>CI/CD</code> 的流程拆的更細緻，讓整個架構與流程更加清楚，同時透過平行運行的方式加快整體流程的速度 <strong>(這部份不一定，完全是看每個專案的流程)</strong>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="reference">Reference<a href="#reference" class="hash-link" aria-label="Direct link to Reference" title="Direct link to Reference">​</a></h2><ul><li><a href="https://github.com/travis-ci/travis-ci/issues/1392" target="_blank" rel="noopener noreferrer">https://github.com/travis-ci/travis-ci/issues/1392</a></li><li><a href="https://docs.travis-ci.com/user/customizing-the-build/" target="_blank" rel="noopener noreferrer">https://docs.travis-ci.com/user/customizing-the-build/</a></li><li><a href="https://docs.travis-ci.com/user/build-stages" target="_blank" rel="noopener noreferrer">https://docs.travis-ci.com/user/build-stages</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/travis-ci">TravisCI</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/dev-ops">DevOps</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/docs/tags/linux">Linux</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/techPost/2018/travisci-k8s"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">使用 Travis CI 為你的 Kubernetes 應用程式打造自動化測試</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/category/2017"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">2017</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#installscript" class="table-of-contents__link toc-highlight">install/script</a></li><li><a href="#example" class="table-of-contents__link toc-highlight">Example</a></li><li><a href="#solution" class="table-of-contents__link toc-highlight">Solution</a></li><li><a href="#definition" class="table-of-contents__link toc-highlight">Definition</a></li><li><a href="#multiple-job" class="table-of-contents__link toc-highlight">Multiple Job</a></li><li><a href="#custom-job" class="table-of-contents__link toc-highlight">Custom Job</a></li><li><a href="#example-1" class="table-of-contents__link toc-highlight">Example</a></li><li><a href="#reference" class="table-of-contents__link toc-highlight">Reference</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">其他資源</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://hwchiu.medium.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">英文部落格<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/technologynoteniu" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook Page(矽谷牛耕田筆記)<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/hw_chiu" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/hung-wei-chiu-52561494/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Cloud Native Taiwan User Group(CNTUG)</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://cloudnative.tw/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Official Site<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/@cloudnativetaiwanusergroup" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/groups/298183320685010" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://community.cncf.io/cloud-native-taiwan-user-group/" target="_blank" rel="noopener noreferrer" class="footer__link-item">CNCF Page<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://t.me/cntug" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 hwchiu. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.66f04512.js"></script>
<script src="/assets/js/main.987d1402.js"></script>
</body>
</html>
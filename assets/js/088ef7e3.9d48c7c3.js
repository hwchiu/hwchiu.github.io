"use strict";(self.webpackChunkhwchiu=self.webpackChunkhwchiu||[]).push([[31269],{3905:(e,t,o)=>{o.d(t,{Zo:()=>p,kt:()=>h});var a=o(67294);function n(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,a)}return o}function s(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e,t){if(null==e)return{};var o,a,n=function(e,t){if(null==e)return{};var o,a,n={},r=Object.keys(e);for(a=0;a<r.length;a++)o=r[a],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)o=r[a],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}var i=a.createContext({}),u=function(e){var t=a.useContext(i),o=t;return e&&(o="function"==typeof e?e(t):s(s({},t),e)),o},p=function(e){var t=u(e.components);return a.createElement(i.Provider,{value:t},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},k=a.forwardRef((function(e,t){var o=e.components,n=e.mdxType,r=e.originalType,i=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=u(o),k=n,h=d["".concat(i,".").concat(k)]||d[k]||c[k]||r;return o?a.createElement(h,s(s({ref:t},p),{},{components:o})):a.createElement(h,s({ref:t},p))}));function h(e,t){var o=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var r=o.length,s=new Array(r);s[0]=k;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l[d]="string"==typeof e?e:n,s[1]=l;for(var u=2;u<r;u++)s[u]=o[u];return a.createElement.apply(null,s)}return a.createElement.apply(null,o)}k.displayName="MDXCreateElement"},8593:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>i,contentTitle:()=>s,default:()=>c,frontMatter:()=>r,metadata:()=>l,toc:()=>u});var a=o(87462),n=(o(67294),o(3905));const r={title:"2024 Taiwan SRE Summit Workshop \u7684\u5fc3\u8def\u6b77\u7a0b",keywords:["Kubernetes"],tags:["Kubernetes","DevOps"],description:"\u7d00\u9304 2024 Taiwan SRE Summit Workshop \u7684\u5fc3\u8def\u6b77\u7a0b",image:"./assets/rJk8IQnHR.png"},s="Kubernetes Workshop \u7d93\u9a57\u5206\u4eab",l={unversionedId:"2024/sre-2024-workshop",id:"2024/sre-2024-workshop",title:"2024 Taiwan SRE Summit Workshop \u7684\u5fc3\u8def\u6b77\u7a0b",description:"\u7d00\u9304 2024 Taiwan SRE Summit Workshop \u7684\u5fc3\u8def\u6b77\u7a0b",source:"@site/docs/2024/sre-2024-workshop.md",sourceDirName:"2024",slug:"/2024/sre-2024-workshop",permalink:"/docs/2024/sre-2024-workshop",draft:!1,tags:[{label:"Kubernetes",permalink:"/docs/tags/kubernetes"},{label:"DevOps",permalink:"/docs/tags/dev-ops"}],version:"current",lastUpdatedBy:"HWC",frontMatter:{title:"2024 Taiwan SRE Summit Workshop \u7684\u5fc3\u8def\u6b77\u7a0b",keywords:["Kubernetes"],tags:["Kubernetes","DevOps"],description:"\u7d00\u9304 2024 Taiwan SRE Summit Workshop \u7684\u5fc3\u8def\u6b77\u7a0b",image:"./assets/rJk8IQnHR.png"},sidebar:"techPost",previous:{title:"Nginx Reverse Proxy \u7684 DNS Issue",permalink:"/docs/2024/nginx-dns"},next:{title:"2023",permalink:"/docs/category/2023"}},i={image:o(97770).Z},u=[{value:"Application Crash",id:"application-crash",level:2},{value:"Question:",id:"question",level:3},{value:"Root Cause:",id:"root-cause",level:3},{value:"Node Not Ready",id:"node-not-ready",level:2},{value:"Question:",id:"question-1",level:3},{value:"Root Cause:",id:"root-cause-1",level:3},{value:"Pod&#39;s information shows Invalid Ago",id:"pods-information-shows-invalid-ago",level:2},{value:"Question:",id:"question-2",level:3},{value:"Root Cause:",id:"root-cause-2",level:3},{value:"Not Able to Access Server Via Service",id:"not-able-to-access-server-via-service",level:2},{value:"Question:",id:"question-3",level:3},{value:"Root Cause:",id:"root-cause-3",level:3},{value:"Statefulset crash",id:"statefulset-crash",level:2},{value:"Question:",id:"question-4",level:3},{value:"Root Cause:",id:"root-cause-4",level:3},{value:"No Configmap auto update",id:"no-configmap-auto-update",level:2},{value:"Question:",id:"question-5",level:3},{value:"Root Cause:",id:"root-cause-5",level:3},{value:"HAP doesn&#39;t work",id:"hap-doesnt-work",level:2},{value:"Question:",id:"question-6",level:3},{value:"Root Cause:",id:"root-cause-6",level:3},{value:"Two Pods share the same ReadWriteOnce PVC",id:"two-pods-share-the-same-readwriteonce-pvc",level:2},{value:"Question:",id:"question-7",level:3},{value:"Root Cause:",id:"root-cause-7",level:3},{value:"Prometheus scraps no data",id:"prometheus-scraps-no-data",level:2},{value:"Question:",id:"question-8",level:3},{value:"Root Cause:",id:"root-cause-8",level:3},{value:"P99 latency spikes",id:"p99-latency-spikes",level:2},{value:"Question:",id:"question-9",level:3},{value:"Root Cause:",id:"root-cause-9",level:3}],p={toc:u},d="wrapper";function c(e){let{components:t,...r}=e;return(0,n.kt)(d,(0,a.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"kubernetes-workshop-\u7d93\u9a57\u5206\u4eab"},"Kubernetes Workshop \u7d93\u9a57\u5206\u4eab"),(0,n.kt)("p",null,"\u4eca\u5e74\u6709\u5e78\u53c3\u52a0 Taiwan SRE Summit 2024 \u4e26\u91dd\u5c0d Kubernetes \u7684\u5167\u5bb9\u8209\u8fa6\u4e00\u5834\u5c07\u8fd1\u5169\u5c0f\u6642\u7684 workshop\u3002\u7576\u521d\u6295\u7a3f\u6642\uff0c\u5e0c\u671b\u80fd\u5920\u8207\u904e\u5f80\u5927\u591a\u6578\u91dd\u5c0d\u65b0\u624b\u7684\u624b\u628a\u624b\u6559\u5b78\u6709\u6240\u4e0d\u540c\u3002\u56e0\u6b64\uff0c\u672c\u6b21 workshop \u63a1\u53d6\u4e86\u4e00\u7a2e\u9664\u932f\u7684\u601d\u7dad\uff0c\u70ba\u6bcf\u4f4d\u958b\u767c\u8005\u63d0\u4f9b\u4e00\u5957\u4e8b\u5148\u4f48\u7f6e\u597d\u7684 Kubernetes Cluster\uff0c\u4e26\u8981\u6c42\u8207\u6703\u8005\u5728\u5169\u5c0f\u6642\u5167\u76e1\u529b\u89e3\u6c7a\u9019\u4e9b\u554f\u984c\uff0c\u4e26\u5617\u8a66\u4e92\u76f8\u5206\u4eab\u89e3\u6c7a\u554f\u984c\u7684\u601d\u8def\u3002"),(0,n.kt)("p",null,"\u672c\u6587\u8a18\u9304\u4e86\u672c\u6b21 workshop \u7684\u5341\u500b\u554f\u984c\uff0c\u6bcf\u500b\u554f\u984c\u80cc\u5f8c\u8a2d\u8a08\u7684\u601d\u8def\u4ee5\u53ca\u671f\u671b\u8207\u6703\u8005\u6240\u638c\u63e1\u7684 Kubernetes \u80fd\u529b\u3002"),(0,n.kt)("h1",{id:"\u74b0\u5883"},"\u74b0\u5883"),(0,n.kt)("p",null,"\u9019\u6b21\u7684 workshop \u53c3\u8207\u4eba\u6578\u8d85\u4e4e\u9810\u671f\uff0c\u7dca\u6025\u52d5\u7528\u5099\u7528\u74b0\u5883\u624d\u8b93\u6bcf\u500b\u8207\u6703\u8005\u90fd\u6709\u4e00\u5957 Kubernetes \u53e2\u96c6\u53ef\u4ee5\u4f7f\u7528\uff0c\u4ee5\u4e0b\u662f\u672c\u6b21\u7684\u74b0\u5883\u8cc7\u8a0a"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"\u7e3d\u5171\u6709 50 \u5957 Kubernetes Cluster (1.28)"),(0,n.kt)("li",{parentName:"ol"},"\u6bcf\u5957 K8s cluster \u90fd\u6709\u4e09\u500b\u7bc0\u9ede (2C4G per node)"),(0,n.kt)("li",{parentName:"ol"},"45 \u5957\u53e2\u96c6\u7531 openstack \u70ba\u57fa\u790e\u6240\u67b6\u8a2d\u7684\u5730\u7aef\u6a5f\u5668"),(0,n.kt)("li",{parentName:"ol"},"5 \u5957\u53e2\u96c6\u7531 AKS \u63d0\u4f9b"),(0,n.kt)("li",{parentName:"ol"},"\u6bcf\u500b\u8207\u6703\u4eba\u54e1\u90fd\u6703\u63d0\u4f9b SSH Key \u7684\u65b9\u5f0f\u4f86\u9023\u63a5\u5230\u6240\u6709 Kubernetes \u7bc0\u9ede"),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("a",{parentName:"li",href:"https://github.com/cloud-native-taiwan/sre-2024-workshop"},"https://github.com/cloud-native-taiwan/sre-2024-workshop")," \u653e\u7f6e\u6bcf\u9053\u984c\u76ee\u9700\u8981\u7684 YAML \u6a94\u6848"),(0,n.kt)("li",{parentName:"ol"},"\u6bcf\u5957 Kubernetes \u90fd\u5167\u5efa\u7531 Prometheus Kubestack \u6240\u5b89\u88dd\u7684 Prometheus + Grafana\uff0c\u4f9b\u8207\u6703\u4eba\u54e1\u53bb\u89e3\u8b80\u8207\u76e3\u63a7")),(0,n.kt)("p",null,"\u53e2\u96c6\u67b6\u69cb\u5982\u4e0b\uff0c\u6bcf\u500b\u7bc0\u9ede\u90fd\u6703\u6709 Private \u8207 Public IP\uff0c\u8207\u6703\u8005\u53ef\u4ee5\u900f\u904e Public IP \u5b58\u53d6\u5230 Prometheus \u8207 Grafana\uff0c\u540c\u6642\u7bc0\u9ede\u4e4b\u9593\u4e5f\u53ef\u4ee5\u900f\u904e private IP \u4e92\u76f8\u5b58\u53d6\n",(0,n.kt)("img",{alt:"image",src:o(97770).Z,width:"724",height:"417"})),(0,n.kt)("p",null,"\u8a3b: AKS \u7684\u74b0\u5883\u5247\u662f\u7531 AKS \u8655\u7406 Control Plane\uff0c\u56e0\u6b64\u53ea\u6709 openstack \u81ea\u5efa\u74b0\u5883\u7684\u90e8\u5206\u624d\u6709 master node \u7684\u9700\u6c42"),(0,n.kt)("p",null,"\u6574\u500b workshop \u7684\u904b\u4f5c\u6d41\u7a0b\u5c31\u662f"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"\u5206\u914d\u74b0\u5883\uff0c\u78ba\u8a8d\u5b58\u53d6\u6c92\u6709\u554f\u984c"),(0,n.kt)("li",{parentName:"ol"},"\u4e3b\u6301\u4eba\u6bcf\u5169\u984c\u70ba\u4e00\u500b\u55ae\u4f4d\u4ecb\u7d39\u5167\u5bb9\uff0c\u8acb\u8207\u6703\u8005\u90e8\u7f72\u984c\u76ee\uff0c\u4e26\u4e14\u627e\u51fa\u554f\u984c\u4fee\u5fa9"),(0,n.kt)("li",{parentName:"ol"},"\u8acb\u89e3\u5b8c\u554f\u984c\u7684\u8207\u6703\u8005\u5206\u4eab\u89e3\u984c\u601d\u8def\uff0c\u600e\u9ebc\u53bb\u770b\u5f85\u9019\u500b\u554f\u984c\u7684")),(0,n.kt)("h1",{id:"\u984c\u76ee\u4ecb\u7d39"},"\u984c\u76ee\u4ecb\u7d39"),(0,n.kt)("p",null,"\u4ee5\u4e0b\u662f\u9019\u6b21\u5341\u500b\u984c\u76ee\u7684\u4e3b\u8ef8\uff0c\u5c07\u6703\u91dd\u5c0d\u6bcf\u500b\u554f\u984c\u8a73\u7d30\u4ecb\u7d39"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Application Crash"),(0,n.kt)("li",{parentName:"ol"},"Node Not Ready"),(0,n.kt)("li",{parentName:"ol"},"Pod's information shows Invalid Ago"),(0,n.kt)("li",{parentName:"ol"},"Not Able to Access Server Via Service"),(0,n.kt)("li",{parentName:"ol"},"Statefulset crash"),(0,n.kt)("li",{parentName:"ol"},"No Configmap auto update"),(0,n.kt)("li",{parentName:"ol"},"HAP doesn't work"),(0,n.kt)("li",{parentName:"ol"},"Two Pods share the same ReadWriteOnce PVC"),(0,n.kt)("li",{parentName:"ol"},"Prometheus scraps no data"),(0,n.kt)("li",{parentName:"ol"},"P99 latency spikes")),(0,n.kt)("h2",{id:"application-crash"},"Application Crash"),(0,n.kt)("h3",{id:"question"},"Question:"),(0,n.kt)("p",null,"\u90e8\u7f72\u4e00\u500b\u61c9\u7528\u7a0b\u5f0f\uff0c\u5927\u6982 70 \u5de6\u53f3\u5f8c\uff0c\u8a72\u61c9\u7528\u7a0b\u5f0f\u5c31\u6703\u9032\u5165\u5230 CrashLoopBackOff \u7684\u968e\u6bb5\uff0c\u5617\u8a66\u627e\u51fa\u554f\u984c\u4e26\u4e14\u9032\u884c\u4fee\u5fa9\uff0c\u78ba\u4fdd\u5176\u4e0d\u6703\u53cd\u8986 Crash"),(0,n.kt)("h3",{id:"root-cause"},"Root Cause:"),(0,n.kt)("p",null,"\u8a72 Pod \u6240\u4f7f\u7528\u7684 Memory \u8207 CPU Limit \u90fd\u904e\u4f4e\uff0cMemory \u8e29\u5230\u4e0a\u9650\u6700\u7d42\u89f8\u767c\u4e86 OOM \u7684\u9650\u5236\uff0c\u5c0e\u81f4 Pod \u88ab\u79fb\u9664\u3002"),(0,n.kt)("p",null,"\u6b64\u5916 CPU \u4e5f\u8e29\u5230\u4e0a\u9650\u9032\u5165\u4e86 CPU Throttling\uff0c\u5c0e\u81f4 Liveness Probe \u5f88\u5927\u7684\u6a5f\u7387\u6c92\u6709\u8fa6\u6cd5\u9806\u5229\u901a\u904e\uff0c\u6700\u7d42\u88ab\u91cd\u555f\u3002"),(0,n.kt)("h2",{id:"node-not-ready"},"Node Not Ready"),(0,n.kt)("h3",{id:"question-1"},"Question:"),(0,n.kt)("p",null,"\u900f\u904e kubectl get nodes \u5f8c\u89c0\u5bdf\u5230\u6709\u7bc0\u9ede\u986f\u793a\u70ba NotReady\uff0c\u7bc4\u4f8b\u5982\u4e0b\n",(0,n.kt)("img",{alt:"image",src:o(28935).Z,width:"1388",height:"238"})),(0,n.kt)("p",null,"\u627e\u51fa\u9020\u6210 NotReady \u7684\u539f\u56e0\u4e26\u4e14\u5617\u8a66\u4fee\u5fa9"),(0,n.kt)("h3",{id:"root-cause-1"},"Root Cause:"),(0,n.kt)("p",null,"\u7bc0\u9ede\u4e0a\u7684 Kubelet \u6c92\u6709\u8fa6\u6cd5\u9806\u5229\u904b\u884c\u56de\u5831\u72c0\u6cc1\uff0c\u539f\u56e0\u662f\u7bc0\u9ede\u4e0a\u7684 swap \u610f\u5916\u88ab\u6253\u958b\uff0c\u5c0e\u81f4 kubelet \u4e0d\u80fd\u9806\u5229\u904b\u884c\u3002\u95dc\u9589 swap \u4e26\u4e14\u91cd\u555f kubelet \u5373\u53ef\u8b93\u7bc0\u9ede\u6062\u5fa9\u6b63\u5e38\u3002    "),(0,n.kt)("h2",{id:"pods-information-shows-invalid-ago"},"Pod's information shows Invalid Ago"),(0,n.kt)("h3",{id:"question-2"},"Question:"),(0,n.kt)("p",null,"\u90e8\u7f72\u61c9\u7528\u7a0b\u5f0f\uff0c\u61c9\u7528\u7a0b\u5f0f\u81ea\u5df1 Crash\uff0c\u4f46\u662f\u5176 Restart \u5167\u986f\u793a\u7684\u6642\u9593\u6709\u554f\u984c\uff0c\u5982\u4e0b\n",(0,n.kt)("img",{alt:"image",src:o(56493).Z,width:"1756",height:"320"})),(0,n.kt)("p",null,"\u5617\u8a66\u89e3\u91cb\u70ba\u4ec0\u9ebc\u6703\u662f Invalid Ago\uff0c\u4e26\u4e14\u4fee\u5fa9"),(0,n.kt)("h3",{id:"root-cause-2"},"Root Cause:"),(0,n.kt)("p",null,"\u9019\u908a\u7684\u6642\u9593\u662f\u7531\u7bc0\u9ede\u4e0a\u7684 Kubelet \u56de\u5831\u8a08\u7b97\u7684\uff0c\u6240\u4ee5\u6aa2\u67e5\u7bc0\u9ede\u4e0a\u7684\u6642\u5340\u8207\u6642\u9593\u662f\u5426\u4e00\u6a23\uff0c\u672c\u554f\u984c\u662f\u7bc0\u9ede\u4e0a\u7684 ntpd client \u6c92\u6709\u6b63\u78ba\u555f\u52d5\uff0c\u5c0e\u81f4\u6642\u9593\u4e0d\u540c\u6b65\uff0c\u6700\u5f8c\u56de\u50b3\u7684\u6642\u9593\u5dee\u8ddd\u592a\u5927\uff0c\u56e0\u6b64\u88ab\u5224\u5b9a\u70ba Invalid Ago   "),(0,n.kt)("h2",{id:"not-able-to-access-server-via-service"},"Not Able to Access Server Via Service"),(0,n.kt)("h3",{id:"question-3"},"Question:"),(0,n.kt)("p",null,"\u90e8\u7f72\u5169\u500b\u61c9\u7528\u7a0b\u5f0f\uff0c\u5176\u4e2d\u5f7c\u6b64\u6703\u900f\u904e Kubernetes Service \u53bb\u5b58\u53d6\uff0c\u7d50\u679c Client \u7aef\u7684 Log \u4e00\u76f4\u986f\u793a\u6c92\u6709\u8fa6\u6cd5\u5b58\u53d6    "),(0,n.kt)("h3",{id:"root-cause-3"},"Root Cause:"),(0,n.kt)("p",null,"\u57fa\u672c\u7684 YAML \u64b0\u5beb\u554f\u984c\uff0cService \u5167\u7684\u6b04\u4f4d\u6709\u5f88\u591a\u8981\u6ce8\u610f\uff0c\u5305\u542b"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"selector \u7684 label"),(0,n.kt)("li",{parentName:"ol"},"ports \u88e1\u9762\u7684 port, taragetPort")),(0,n.kt)("p",null,"\u9084\u6709 Client \u5b58\u53d6\u7684\u6642\u5019\u4e0d\u8981\u8aa4\u7528 targetPort"),(0,n.kt)("h2",{id:"statefulset-crash"},"Statefulset crash"),(0,n.kt)("h3",{id:"question-4"},"Question:"),(0,n.kt)("p",null,"StatefulSet \u7684\u61c9\u7528\u7a0b\u5f0f\u4e00\u76f4 Crash\uff0c\u8981\u5982\u4f55\u518d\u4e0d\u5f71\u97ff\u6389\u8cc7\u6599\u7684\u60c5\u6cc1\u4e0b\u4fee\u5fa9\u6b64\u554f\u984c    "),(0,n.kt)("h3",{id:"root-cause-4"},"Root Cause:"),(0,n.kt)("p",null,"\u5f9e Pod \u7684 Log \u53ef\u4ee5\u89c0\u5bdf\u5230 PVC \u7684\u7a7a\u9593\u5df2\u7d93\u6eff\u4e86\uff0c\u6240\u4ee5\u9700\u8981\u52d5\u614b\u8abf\u6574 PVC \u7684\u5927\u5c0f\uff0c\u56e0\u6b64\u8207\u6703\u8005\u5fc5\u9808\u8981\u5148\u884c\u66f4\u65b0 PVC \u7684\u7a7a\u9593\u5927\u5c0f\uff0c\u63a5\u8005\u518d\u780d\u6389 Statefulset Pod\uff0c\u8b93\u5176\u91cd\u555f\u4f7f\u7528\u64f4\u5927\u5f8c\u7684\u7a7a\u9593\u3002"),(0,n.kt)("p",null,"\u5982\u679c\u76f4\u63a5\u4fee\u6539 StatefulSet YAML \u88e1\u9762\u7684 PVC \u7a7a\u9593\u4e26\u4e14\u4f7f\u7528 kubectl apply -f \u53bb\u66f4\u65b0\u5247\u662f\u6703\u5f97\u5230\u932f\u8aa4\uff0c\u56e0\u70ba PVC \u7684\u7a7a\u9593\u662f\u500b\u4e0d\u53ef\u66f4\u52d5\u7684\u5167\u5bb9\uff0c\u70ba\u4e86\u89e3\u6c7a\u9019\u500b\u554f\u984c\u5fc5\u9808\u63a1\u7528 cascade=orphan \u7684\u5f62\u5f0f\u53bb\u79fb\u9664\uff0c\u8b6c\u5982\nkubectl delete sts --cascade=orphan q5\n\u8a72\u64cd\u4f5c\u53ea\u6703\u79fb\u9664 etcd \u5167\u7684\u7d00\u9304\uff0c\u4f46\u662f\u904b\u884c\u7684 Pod \u4e0d\u6703\u79fb\u9664\uff0c\u900f\u904e\u9019\u7a2e\u65b9\u5f0f\u5c31\u53ef\u4ee5\u5c07\u65b0\u7248\u7684 YAML \u7d66\u5957\u7528\u5230\u74b0\u5883\u4e0a\u3002"),(0,n.kt)("h2",{id:"no-configmap-auto-update"},"No Configmap auto update"),(0,n.kt)("h3",{id:"question-5"},"Question:"),(0,n.kt)("p",null,"\u900f\u904e ConfigMap \u66f4\u65b0\u5167\u5bb9\uff0c\u4e26\u4e14\u91cd\u65b0 Apply \u5230\u74b0\u5883\u4e2d\uff0c\u7d50\u679c Pod \u88e1\u9762\u9072\u9072\u770b\u4e0d\u5230\u66f4\u65b0\u5f8c\u7684\u7d50\u679c\uff0c\u7406\u8ad6\u4e0a\u61c9\u8a72\u904e\u4e00\u5169\u5206\u9418\u5c31\u53ef\u4ee5\u770b\u5230\u66f4\u65b0\u5f8c\u7684 ConfigMap    "),(0,n.kt)("h3",{id:"root-cause-5"},"Root Cause:"),(0,n.kt)("p",null,"ConfigMap \u7684\u66f4\u65b0\u6703\u6709\u5169\u6bb5\u6d41\u7a0b\uff0c\u5f9e API Server \u5230 Node Kubelet \u518d\u5230 Container\uff0c\u4f46\u662f\u76ee\u524d\u5be6\u52d9\u4e0a\u662f\u6709\u9650\u5236\u7684\uff0c\u4efb\u4f55\u6709\u4f7f\u7528 SubPath \u7684 ConfigMap \u90fd\u6c92\u6709\u8fa6\u6cd5\u88ab\u81ea\u52d5\u66f4\u65b0\uff0c\u81ea\u7136\u4e5f\u7121\u6cd5\u900f\u904e iNotify \u53bb\u76e3\u63a7\u4f86\u8655\u7406\u3002\u552f\u4e00\u7684\u89e3\u6cd5\u53ea\u6709\u780d\u6389 Pod\uff0c\u8b93\u4ed6\u91cd\u65b0\u589e\u9577\u624d\u53ef\u4ee5 "),(0,n.kt)("h2",{id:"hap-doesnt-work"},"HAP doesn't work"),(0,n.kt)("h3",{id:"question-6"},"Question:"),(0,n.kt)("p",null,"\u90e8\u7f72\u61c9\u7528\u7a0b\u5f0f\u4e26\u4e14\u4e5f\u8a2d\u5b9a\u4e86 HPA \u7684\u898f\u5247\uff0c\u540c\u6642\u900f\u904e Prometheus \u89c0\u5bdf CPU \u7528\u91cf\u4e5f\u662f\u6709\u589e\u9577\u7684\uff0c\u5f9e\u8cc7\u6599\u4f86\u770b CPU \u4f7f\u7528\u7387\u662f\u6709\u8d85\u904e HPA \u8a2d\u5b9a\u7684\u9580\u6abb\uff0c\u4f46\u662f Deployment \u7684\u6578\u91cf\u5c31\u662f\u6c92\u6709\u589e\u52a0    "),(0,n.kt)("h3",{id:"root-cause-6"},"Root Cause:"),(0,n.kt)("p",null,"HPA \u8207 Prometheus \u662f\u5169\u4ef6\u7368\u7acb\u7684\u4e8b\u60c5\uff0c HPA \u672c\u8eab\u4ef0\u8cf4\u7684\u662f Metrics API\uff0c\u6700\u7c21\u55ae\u7684\u65b9\u5f0f\u5c31\u662f\u5b89\u88dd Metrics Server\uff0c\u74b0\u5883\u4e2d\u82e5\u6c92\u6709\u5b89\u88dd Metrics Server\uff0c\u5247 HPA \u5c31\u6c92\u6709\u8fa6\u6cd5\u904b\u4f5c"),(0,n.kt)("p",null,"\u53ef\u4ee5\u900f\u904e kubectl top \u7b49\u6307\u4ee4\u89c0\u5bdf\u770b\u770b\u74b0\u5883\u4e2d\u662f\u5426\u6709\u53ef\u4ee5\u904b\u4f5c\u7684 metrics API\uff0c\u82e5\u6c92\u6709\u7684\u8a71\u90a3 HPA \u5c31\u6c92\u6709\u8fa6\u6cd5\u6b63\u5e38\u904b\u4f5c\u3002"),(0,n.kt)("h2",{id:"two-pods-share-the-same-readwriteonce-pvc"},"Two Pods share the same ReadWriteOnce PVC"),(0,n.kt)("h3",{id:"question-7"},"Question:"),(0,n.kt)("p",null,"\u90e8\u7f72\u4e00\u500b ReadWriteOnce \u7684 PVC \u7269\u4ef6\uff0c\u7136\u5f8c\u6709\u5169\u500b Deployment \u7269\u4ef6\u90fd\u6307\u540d\u4f7f\u7528\u8a72 PVC\uff0c\u6700\u7d42\u90e8\u7f72\u7d50\u679c\u5982\u4e0b\n",(0,n.kt)("img",{alt:"image",src:o(2814).Z,width:"1456",height:"378"})),(0,n.kt)("p",null,"\u8a72 PVC \u6a19\u793a\u70ba ReadWriteOnce\uff0c\u90a3\u70ba\u4ec0\u9ebc\u53ef\u4ee5\u6709\u9019\u9ebc\u591a Pod \u540c\u6642\u4f7f\u7528\uff1f"),(0,n.kt)("h3",{id:"root-cause-7"},"Root Cause:"),(0,n.kt)("p",null,"\u773e\u4eba\u6240\u719f\u6089\u7684\u4e09\u7a2e\u90e8\u7f72\u6a21\u578b\u5176\u5be6\u90fd\u662f\u5f9e\u7bc0\u9ede\u51fa\u767c\uff0c\u540c\u6642\u9593\u53ea\u80fd\u6709\u4e00\u500b\u7bc0\u9ede\u53ef\u4ee5\u5b58\u53d6\uff0c\u56e0\u6b64\u540c\u7bc0\u9ede\u4e0a\u7684 Pod \u90fd\u9084\u662f\u53ef\u4ee5\u4e92\u76f8\u5b58\u53d6\u3002\u4ee5\u4e0a\u5716\u70ba\u7bc4\u4f8b\uff0c\u6240\u6709\u5361\u5728 ContainerCreating \u7684 Pod \u5176\u5be6\u90fd\u6703\u5361\u4f4f\uff0c\u56e0\u70ba\u4ed6\u5011\u88ab\u90e8\u7f72\u5230\u7684\u7bc0\u9ede\u4e0a\u6c92\u6709\u5c0d\u61c9\u7684 PVC \u53ef\u4ee5\u7528\u3002"),(0,n.kt)("p",null,"\u5982\u679c\u60f3\u8981\u771f\u6b63\u9054\u5230\u4ee5 Pod \u70ba\u4e3b\u8ef8\u53bb\u78ba\u4fdd\u540c\u6642\u9593\u53ea\u80fd\u6709\u4e00\u500b Pod \u4f7f\u7528\uff0c\u5247\u8981\u4f7f\u7528 ReadWriteOncePod \u9019\u7a2e\u898f\u5247\uff0c\u5176\u8a2d\u8a08\u6587\u4ef6\u5982\u4e0b\n",(0,n.kt)("a",{parentName:"p",href:"https://github.com/kubernetes/enhancements/blob/master/keps/sig-storage/2485-read-write-once-pod-pv-access-mode/README.md"},"https://github.com/kubernetes/enhancements/blob/master/keps/sig-storage/2485-read-write-once-pod-pv-access-mode/README.md"),"    "),(0,n.kt)("p",null,"\u7576 PVC \u63a1\u53d6\u6b64\u7a2e\u6a21\u5f0f\u6642\uff0c\u6240\u6709\u7684 Pod \u90fd\u6703\u9032\u5165\u5230 Pending \u72c0\u614b\uff0c\u7d50\u679c\u5982\u4e0b\u5716\n",(0,n.kt)("img",{alt:"image",src:o(75700).Z,width:"1958",height:"400"})),(0,n.kt)("h2",{id:"prometheus-scraps-no-data"},"Prometheus scraps no data"),(0,n.kt)("h3",{id:"question-8"},"Question:"),(0,n.kt)("p",null,"\u90e8\u7f72\u4e00\u500b\u5df2\u7d93\u5be6\u4f5c Prometheus Endpoint \u7684\u61c9\u7528\u7a0b\u5f0f\uff0c\u642d\u914d ServiceMonitor \u4f86\u544a\u77e5 Prometheus\uff0c\u7d50\u679c\u5f9e Prometheus \u4e0a\u90fd\u770b\u4e0d\u5230\u76f8\u95dc\u7684\u8cc7\u6599\uff0c\u624b\u52d5\u53bb\u9023\u63a5\u670d\u52d9\u90fd\u662f\u53ef\u4ee5\u6b63\u5e38\u5b58\u53d6\u7684\u3002"),(0,n.kt)("h3",{id:"root-cause-8"},"Root Cause:"),(0,n.kt)("p",null,"\u4f7f\u7528\u8005\u90e8\u7f72\u7684 ServiceMonitor \u7684\u7269\u4ef6\uff0c\u7d50\u679c Prometheus \u4e26\u6c92\u6709\u6b63\u78ba\u7684\u8b80\u53d6\u8a72\u7269\u4ef6\uff0c\u6240\u4ee5\u5f9e Prometheus \u7684\u7db2\u9801\u4e0a\u90fd\u770b\u4e0d\u5230\u76f8\u95dc\u7684 Taget\uff0c\u539f\u56e0\u662f Prometheus \u7684 Operator \u4e2d\u6709\u900f\u904e ServiceMonitorSelector \u7684\u7269\u4ef6\u53bb\u63cf\u8ff0 ServiceMonitor \u7684\u898f\u5247\u3002"),(0,n.kt)("p",null,"\u56e0\u6b64\u5718\u968a\u60f3\u8981\u4f7f\u7528 ServiceMonitor \u6642\u4e00\u5b9a\u8981\u78ba\u8a8d Label \u662f\u5426\u8a2d\u5b9a\u6b63\u78ba\uff0c\u5426\u5247\u5c31\u6703\u90e8\u7f72\u5230\u74b0\u5883\u4e2d\u537b\u6c92\u6709\u8fa6\u6cd5\u751f\u6548"),(0,n.kt)("h2",{id:"p99-latency-spikes"},"P99 latency spikes"),(0,n.kt)("h3",{id:"question-9"},"Question:"),(0,n.kt)("p",null,"\u90e8\u7f72\u61c9\u7528\u7a0b\u5f0f\u5f8c\u900f\u904e Grafana \u89c0\u5bdf HTTP Latency \u7684\u73fe\u8c61\uff0c\u6703\u89c0\u5bdf\u5230 P90 \u5f8c\u7684 Latency \u6709\u7279\u5225\u9ad8\u7684\u60c5\u6cc1\uff0c\u7bc4\u4f8b\u5982\u4e0b\n",(0,n.kt)("img",{alt:"image",src:o(26838).Z,width:"1164",height:"594"})),(0,n.kt)("h3",{id:"root-cause-9"},"Root Cause:"),(0,n.kt)("p",null,"Server \u7684 CPU Limit \u592a\u4f4e\uff0c\u5c0e\u81f4 CPU Throttling \u7684\u554f\u984c\u767c\u751f\uff0c\u56e0\u6b64\u7576\u9023\u7dda\u904e\u591a\u7684\u6642\u5019\u5c31\u6703\u6709\u90e8\u5206\u7684\u9023\u7dda\u6c92\u6709\u8fa6\u6cd5\u65bc\u6bcf\u500b CFS Period \u5167\u8655\u7406\u5b8c\u7562\uff0c\u9019\u90e8\u5206\u90fd\u53ef\u4ee5\u900f\u904e Prometheus \u5167\u53bb\u89c0\u5bdf Throttling \u7684\u60c5\u6cc1\u3002"),(0,n.kt)("p",null,"\u4fee\u6b63\u5f8c\u7684\u7d50\u679c\u61c9\u8a72\u8981\u985e\u4f3c\u4e0b\u5716\uff0c\u6700\u7d42\u90fd\u6703\u9760\u8fd1\u5f7c\u6b64"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"image",src:o(1860).Z,width:"2134",height:"496"})),(0,n.kt)("h1",{id:"\u7d50\u8ad6"},"\u7d50\u8ad6"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"\u4ee5\u6642\u9593\u4f86\u8aaa\uff0c\u5169\u500b\u5c0f\u6642\u5176\u5be6\u4e0d\u592a\u5920\uff0c\u524d\u9762\u7684\u74b0\u5883\u5b58\u53d6\u5c31\u6709\u9047\u5230\u4e00\u4e9b\u5c0f\u554f\u984c\uff0c\u7531\u65bc\u81ea\u5df1\u6e2c\u8a66\u7684\u74b0\u5883\u90fd\u662f\u57fa\u65bc MacOS/Linux \u7684\u7b46\u96fb\u70ba\u4e3b\uff0c\u6c92\u6709\u8003\u616e\u5230\u4f7f\u7528 windows \u7684\u8207\u6703\u8005\uff0c\u5176\u4e0b\u8f09 SSH Private Key \u7684\u6642\u5019\u53ef\u80fd\u6703\u6709\u683c\u5f0f\u4e0a\u7684\u554f\u984c\uff0c\u5c0e\u81f4\u6709\u6eff\u591a\u8207\u6703\u8005\u82b1\u4e86\u4e0d\u5c11\u6642\u9593\u5728\u8655\u7406\u9019\u4e9b\u554f\u984c"),(0,n.kt)("li",{parentName:"ol"},"\u5927\u5bb6\u7684\u80fd\u529b\u4e0d\u5747\uff0c\u6240\u4ee5\u89e3\u6c7a\u554f\u984c\u4e0a\u9762\u6240\u82b1\u8cbb\u7684\u6642\u9593\u6709\u6240\u5dee\u7570\uff0c\u5f88\u96e3\u8b93\u6240\u6709\u4eba\u4e00\u8d77\u524d\u9032\uff0c\u4e00\u5b9a\u6703\u6709\u4eba\u6c92\u6709\u8fa6\u6cd5\u5b8c\u5168\u8ddf\u4e0a"),(0,n.kt)("li",{parentName:"ol"},"\u8003\u616e\u5230 Kubernetes \u751f\u614b\u7cfb\u592a\u5ee3\uff0c\u6240\u4ee5\u8a2d\u8a08\u554f\u984c\u7684\u6642\u5019\u90fd\u76e1\u91cf\u4ee5 Kubernetes \u539f\u751f\u70ba\u4e3b\uff0c\u9019\u90e8\u5206\u7684\u51fa\u984c\u6703\u6108\u4f86\u6108\u96e3\u627e"),(0,n.kt)("li",{parentName:"ol"},"\u4e00\u76f4\u5f88\u60f3\u8981\u51fa\u8ddf CPU Throlling \u6709\u95dc\u7684\u554f\u984c\uff0c\u4f46\u662f\u9019\u985e\u578b\u7684\u554f\u984c\u592a\u8b1b\u6c42 CPU \u8ddf\u74b0\u5883\u554f\u984c\uff0c\u4ee5\u554f\u984c\u4e00\u4f86\u8aaa\uff0c\u7576\u5929\u6709\u5e7e\u4f4d\u8207\u6703\u4eba\u54e1\u7684\u74b0\u5883\u90fd\u6c92\u6709\u8e29\u5230\u4efb\u4f55\u554f\u984c\uff0c\u672a\u4f86\u5982\u679c\u8981\u7e7c\u7e8c\u8a2d\u8a08\u9019\u985e\u578b\u7684\u554f\u984c\u7684\u8a71\uff0c\u8981\u601d\u8003\u4e00\u4e0b\u8a72\u600e\u9ebc\u8a2d\u8a08\u3002"),(0,n.kt)("li",{parentName:"ol"},"\u6574\u9ad4\u6210\u6548\u4f86\u8aaa\u7b97\u6eff\u4e0d\u932f\u7684\uff0c\u5f97\u5230\u5f88\u591a\u6b63\u9762\u7684\u56de\u994b\uff0c\u90fd\u89ba\u5f97\u9019\u7a2e\u5be6\u969b\u52d5\u624b\u4e26\u4e14\u5f9e\u6280\u8853\u9762\u63a2\u8a0e\u554f\u984c\u7684 workshop \u80fd\u5920\u5e36\u56de\u53bb\u7684\u7d93\u9a57\u8207\u5b78\u7fd2\u66f4\u591a\uff0c\u666e\u904d\u90fd\u5e0c\u671b\u672a\u4f86\u80fd\u5920\u6709\u7b2c\u4e8c\u5834\u985e\u4f3c\u7684\u6d3b\u52d5\u3002")))}c.isMDXComponent=!0},28935:(e,t,o)=>{o.d(t,{Z:()=>a});const a=o.p+"assets/images/B1vLCQhB0-95a38d59d834a9c70dcdcb136705712e.png"},56493:(e,t,o)=>{o.d(t,{Z:()=>a});const a=o.p+"assets/images/BkNJ0XnSC-94df2f3169df3b8476f263182803396a.png"},26838:(e,t,o)=>{o.d(t,{Z:()=>a});const a=o.p+"assets/images/BkYdyN3BC-414d4a12476714517c0c86ddace0ac26.png"},1860:(e,t,o)=>{o.d(t,{Z:()=>a});const a=o.p+"assets/images/ByS0yV3B0-82adb8405a456226f29d34562e0fb473.png"},75700:(e,t,o)=>{o.d(t,{Z:()=>a});const a=o.p+"assets/images/r1kpOm2S0-08878dba57134c943783c9d2e5535416.png"},97770:(e,t,o)=>{o.d(t,{Z:()=>a});const a=o.p+"assets/images/rJk8IQnHR-d09864d9dc579e7ed7cfd621d77361fd.png"},2814:(e,t,o)=>{o.d(t,{Z:()=>a});const a=o.p+"assets/images/ryYJOQnSA-f4a6c109540310309dd8ef8c71f28dd3.png"}}]);
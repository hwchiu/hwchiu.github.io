"use strict";(self.webpackChunkhwchiu=self.webpackChunkhwchiu||[]).push([[70154],{3905:(e,r,n)=>{n.d(r,{Zo:()=>s,kt:()=>d});var t=n(67294);function a(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function o(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function l(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?o(Object(n),!0).forEach((function(r){a(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function c(e,r){if(null==e)return{};var n,t,a=function(e,r){if(null==e)return{};var n,t,a={},o=Object.keys(e);for(t=0;t<o.length;t++)n=o[t],r.indexOf(n)>=0||(a[n]=e[n]);return a}(e,r);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var i=t.createContext({}),p=function(e){var r=t.useContext(i),n=r;return e&&(n="function"==typeof e?e(r):l(l({},r),e)),n},s=function(e){var r=p(e.components);return t.createElement(i.Provider,{value:r},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var r=e.children;return t.createElement(t.Fragment,{},r)}},h=t.forwardRef((function(e,r){var n=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),u=p(n),h=a,d=u["".concat(i,".").concat(h)]||u[h]||m[h]||o;return n?t.createElement(d,l(l({ref:r},s),{},{components:n})):t.createElement(d,l({ref:r},s))}));function d(e,r){var n=arguments,a=r&&r.mdxType;if("string"==typeof e||a){var o=n.length,l=new Array(o);l[0]=h;var c={};for(var i in r)hasOwnProperty.call(r,i)&&(c[i]=r[i]);c.originalType=e,c[u]="string"==typeof e?e:a,l[1]=c;for(var p=2;p<o;p++)l[p]=n[p];return t.createElement.apply(null,l)}return t.createElement.apply(null,n)}h.displayName="MDXCreateElement"},40361:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>i,contentTitle:()=>l,default:()=>m,frontMatter:()=>o,metadata:()=>c,toc:()=>p});var t=n(87462),a=(n(67294),n(3905));const o={title:"Rancher \u8207 Infrastructure as Code",sidebar_position:15,tags:["iThome","Terraform","Kubernetes","Rancher"],description:"iThome-2021 \u7cfb\u5217\u6587\u7ae0"},l="\u524d\u8a00",c={unversionedId:"techPost/2021/iThome_Challenge/day15",id:"techPost/2021/iThome_Challenge/day15",title:"Rancher \u8207 Infrastructure as Code",description:"iThome-2021 \u7cfb\u5217\u6587\u7ae0",source:"@site/docs/techPost/2021/iThome_Challenge/day15.md",sourceDirName:"techPost/2021/iThome_Challenge",slug:"/techPost/2021/iThome_Challenge/day15",permalink:"/docs/techPost/2021/iThome_Challenge/day15",draft:!1,tags:[{label:"iThome",permalink:"/docs/tags/i-thome"},{label:"Terraform",permalink:"/docs/tags/terraform"},{label:"Kubernetes",permalink:"/docs/tags/kubernetes"},{label:"Rancher",permalink:"/docs/tags/rancher"}],version:"current",sidebarPosition:15,frontMatter:{title:"Rancher \u8207 Infrastructure as Code",sidebar_position:15,tags:["iThome","Terraform","Kubernetes","Rancher"],description:"iThome-2021 \u7cfb\u5217\u6587\u7ae0"},sidebar:"techPost",previous:{title:"Rancher - \u5176\u4ed6\u4e8b\u9805",permalink:"/docs/techPost/2021/iThome_Challenge/day14"},next:{title:"Rancher \u6307\u4ee4\u5de5\u5177\u7684\u64cd\u4f5c",permalink:"/docs/techPost/2021/iThome_Challenge/day16"}},i={},p=[],s={toc:p},u="wrapper";function m(e){let{components:r,...n}=e;return(0,a.kt)(u,(0,t.Z)({},s,n,{components:r,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"\u524d\u8a00"},"\u524d\u8a00"),(0,a.kt)("p",null,"\u524d\u7bc7\u63a2\u8a0e\u4e86\u5404\u5f0f\u5404\u6a23\u900f\u904e Rancher UI \u4f86\u7ba1\u7406 Rancher, Kubernetes \u7684\u5404\u7a2e\u65b9\u5f0f\uff0c\u6240\u6709\u7684\u64cd\u4f5c\u57fa\u672c\u4e0a\u90fd\u662f\u57fa\u65bc UI \u9ede\u64ca\u800c\u5b8c\u6210\u7684\u3002"),(0,a.kt)("p",null,"\u8a66\u60f3\u4e0b\u5217\u60c5\u5883\uff0c\u662f\u5426\u6703\u89ba\u5f97\u67d0\u4e9b\u60c5\u6cc1\u9084\u662f\u6709\u9ede\u5361?"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u516c\u53f8\u60f3\u8981\u6709\u91dd\u5c0d\u4e0d\u540c\u74b0\u5883\u6709\u4e0d\u540c\u7684 Rancher \u53e2\u96c6\uff0c\u8b6c\u5982 Production \u8ddf\u5176\u4ed6\u8981\u5206\u958b"),(0,a.kt)("li",{parentName:"ol"},"\u5e0c\u671b\u80fd\u5920\u6e1b\u5c11\u7ba1\u7406\u54e1\u900f\u904e UI \u7ba1\u7406\u7684\u983b\u7387\uff0c\u7562\u7adf\u900f\u904e UI \u9ede\u9078\u5275\u5efa\u6709\u6642\u4e26\u4e0d\u6703\u6709\u592a\u5b8c\u5584\u7684\u7a3d\u6838\u6027"),(0,a.kt)("li",{parentName:"ol"},"\u6709\u5feb\u901f\u91cd\u8907\u90e8\u7f72 RKE \u53e2\u96c6\u7684\u9700\u6c42\uff0c\u67d0\u4e9b\u60c5\u6cc1\u9084\u9700\u8981\u522a\u9664\u91cd\u5efa")),(0,a.kt)("p",null,"\u4e0a\u8ff0\u9019\u4e9b\u8981\u6c42\u5168\u90e8\u90fd\u53ef\u4ee5\u7528\u4e4b\u524d\u5206\u4eab\u7684\u65b9\u5f0f\u6162\u6162\u8655\u7406\uff0c\u4e0d\u904e\u6703\u4e0d\u6703\u6709\u66f4\u597d\u7684\u65b9\u5f0f\u8655\u7406?\n\u9019\u5e7e\u5e74\u6d41\u884c\u7684 IaC \u67b6\u69cb\uff0c Infrastructure as Code \u7684\u6982\u5ff5\u80fd\u4e0d\u80fd\u5957\u7528\u5230 Rancher \u8eab\u4e0a?\n\u8a66\u60f3\u4e00\u4e0b\u5982\u679c\u53ef\u4ee5\u900f\u904e\u7a0b\u5f0f\u78bc\u7684\u65b9\u5f0f\u5b9a\u7fa9 Rancher\uff0c\u5c0d\u65bc\u958b\u767c\u8005\u8207\u7ba1\u7406\u8005\u4f86\u8aaa\u53ef\u4ee5\u9054\u5230\u4ec0\u9ebc\u6a23\u7684\u597d\u8655"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u7576 Rancher \u6574\u500b\u640d\u6bc0\uff0c\u9700\u8981\u91cd\u65b0\u5b89\u88dd\u6216\u662f\u9700\u8981\u90e8\u7f72\u985e\u4f3c\u74b0\u5883\u6642\uff0c\u53ef\u4ee5\u975e\u5e38\u5feb\u7684\u90e8\u7f72\uff0c\u4e0d\u9700\u8981\u91cd\u65b0\u900f\u904e\u624b\u52d5\u7684\u65b9\u5f0f\u53bb\u91cd\u65b0\u8a2d\u5b9a\u6240\u6709\u7d30\u7bc0"),(0,a.kt)("li",{parentName:"ol"},"\u6240\u6709\u91cd\u5927\u64cd\u4f5c\u90fd\u4ee5\u7a0b\u5f0f\u78bc\u70ba\u57fa\u790e\u53bb\u8a2d\u5b9a\uff0c\u6e1b\u5c11\u4efb\u4f55\u4eba\u70ba\u64cd\u4f5c\u7684\u53ef\u80fd\u6027\uff0c\u540c\u6642\u6709\u4efb\u4f55\u51fa\u932f\u6642\u53ef\u4ee5\u57fa\u65bc\u7a0b\u5f0f\u78bc\u91cd\u65b0\u90e8\u7f72\u4f86\u4fee\u5fa9\u74b0\u5883\u3002"),(0,a.kt)("li",{parentName:"ol"},"\b\u8907\u88fd\u7a0b\u5f0f\u78bc\u5c31\u53ef\u4ee5\u8907\u88fd\u74b0\u5883\uff0c\u4fee\u6539\u4e00\u4e9b\u8b8a\u6578\u5c31\u53ef\u4ee5\u5275\u5efa\u51fa\u985e\u4f3c\u7684\u53e2\u96c6")),(0,a.kt)("p",null,"\u66f4\u91cd\u8981\u7684\u662f\uff0c\u5982\u679c\u5c07\u9019\u4e9b IaC \u7684\u6982\u5ff5\u8207 CI/CD \u6d41\u7a0b\u6574\u5408\uff0c\u9084\u53ef\u4ee5\u900f\u904e Code Review \u7684\u65b9\u5f0f\u4f86\u5408\u4f5c\u6aa2\u8996\u6240\u6709 Rancher \u4e0a\u7684\u4fee\u6539\uff0c\u540c\u6642\u900f\u904e\u81ea\u52d5\u5316\u7684\u65b9\u5f0f\u53bb\u7dad\u8b77 Rancher \u670d\u52d9\u3002\n\u6709\u4efb\u4f55\u4e0d\u9069\u7576\u7684\u4fee\u6539\u60f3\u8981\u5fa9\u539f\u4e5f\u53ef\u4ee5\u900f\u904e Git Revert \u7684\u65b9\u5f0f\u4f86\u56de\u5fa9\u5230\u4e4b\u524d\u7684\u72c0\u614b\u3002\n\u9019\u7a2e\u72c0\u6cc1\u4e0b Rancher \u6703\u8b8a\u5f97\u66f4\u52a0\u5bb9\u6613\u7dad\u8b77\u8207\u7ba1\u7406\u3002"),(0,a.kt)("h1",{id:"iac"},"IaC"),(0,a.kt)("p",null,"IaC \u7684\u5de5\u5177\u975e\u5e38\u7684\u591a\uff0c\u7576\u4eba\u5011\u8b1b\u5230\u8ddf Cloud Infrastructure \u6709\u95dc\u6642\uff0c\u5927\u90e8\u5206\u4eba\u90fd\u6703\u63d0\u5230 Terraform \u9019\u5957\u89e3\u6c7a\u65b9\u6848\uff0c\u800c\u8fd1\u5e74 Pulumi \u7684\u8072\u52e2\u4e5f\u6f38\u6f38\u63d0\u6607\uff0c\u6108\u4f86\u6108\u591a\u4eba\u5617\u8a66\u4f7f\u7528 Pulumi \u4f86\u53d6\u4ee3 Terraform\uff0c\u5169\u8005\u6700\u5927\u7684\u5dee\u5225\u5728\u65bc\u64b0\u5beb\u65b9\u5f0f\u3002\nTerraform \u6709\u81ea\u5df1\u8a2d\u8a08\u4e00\u5957\u8a9e\u6cd5\uff0c\u610f\u5473\u4f7f\u7528 Terraform \u5c31\u8981\u4f7f\u7528\u8a72\u8a9e\u6cd5\uff0c\u800c Pulumi \u5247\u662f\u57fa\u65bc\u4e0d\u540c\u7684\u7a0b\u5f0f\u8a9e\u8a00\u63d0\u4f9b\u4e0d\u540c\u7684 API \u4f86\u4f7f\u7528\u3113\uff0c\u6240\u4ee5\u958b\u767c\u8005\u53ef\u4ee5\u4f7f\u7528\u81ea\u5df1\u7fd2\u6163\u7684\u7a0b\u5f0f\u8a9e\u8a00\u53bb\u64b0\u5beb\u3002"),(0,a.kt)("p",null,"\u672c\u7bc7\u6587\u7ae0\u5c07\u4ecb\u7d39\u5982\u4f55\u900f\u904e Terraform \u4f86\u7ba1\u7406\u6211\u5011\u7684 Rancher\uff0c\u4e4b\u5f8c\u7684\u7ae0\u7bc0\u6709\u6a5f\u6703\u7684\u8a71\u4e5f\u6703\u9806\u4fbf\u5c55\u793a\u4e00\u4e0b\u4f7f\u7528 Terraform \u7684\u5beb\u6cd5\u3002"),(0,a.kt)("h1",{id:"terraform"},"Terraform"),(0,a.kt)("p",null,"\u95dc\u65bc Terraform \u7684\u4f7f\u7528\u65b9\u5f0f\u63a8\u85a6\u53c3\u95b1\u6211\u597d\u670b\u53cb ","[David \u6240\u64b0\u5beb\u7684 Terraform \u7cfb\u5217\u6587\u7ae0]","\n(xxx)"),(0,a.kt)("p",null,"\u672c\u7bc7\u6587\u7ae0\u5c31\u4e0d\u6703\u63a2\u8a0e\u592a\u591a Terraform \u7684\u57fa\u672c\u6982\u5ff5\u8207\u4f7f\u7528\u65b9\u5f0f\uff0c\u6703\u66f4\u52a0\u5c08\u6ce8\u65bc\u5982\u4f55\u900f\u904e Terraform \u4f86\u7ba1\u7406 Rancher\u3002"),(0,a.kt)("p",null,"Terraform \u5b98\u7db2\u4e2d\u6709\u975e\u5e38\u8a73\u7d30\u7684\u8cc7\u8a0a\u63a2\u8a0e Rancher \u6240\u6709 API \u7684\u4f7f\u7528\u65b9\u5f0f\uff0c\u6709\u8208\u8da3\u53ef\u4ee5\u53c3\u95b1",(0,a.kt)("a",{parentName:"p",href:"https://registry.terraform.io/providers/rancher/rancher2/latest/docs"},"Rancher2 Provider")),(0,a.kt)("p",null,"\u70ba\u4e86\u8981\u80fd\u5920\u8ddf Rancher \u6e9d\u901a\uff0c\u5fc5\u9808\u8981\u5148\u7372\u5f97\u4e00\u7d44 Access/Secrey Key \u4f86\u5b58\u53d6 Rancher\uff0c\u9019\u7d44 Key \u53ef\u4ee5\u5f9e Rancher \u7684\u4f7f\u7528\u8005\u5e33\u865f\u53bb\u53d6\u5f97\u3002"),(0,a.kt)("p",null,"\u9996\u5148\u7528\u4e00\u500b\u53ef\u4ee5\u7ba1\u7406 Rancher \u7684\u5e33\u865f\u767b\u5165\u5230 Rancher UI\uff0c\u63a5\u8005\u65bc\u53f3\u4e0a\u65b9\u4f7f\u7528\u8005\u90a3\u908a\u53bb\u9ede\u9078 API & Keys\uff0c\u5982\u4e0b\u5716\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/KgJ6v60.png",alt:null})),(0,a.kt)("p",null,"\u9032\u53bb\u4e4b\u5f8c\u53ef\u4ee5\u770b\u5230\u7cfb\u7d71\u9810\u8a2d\u6709\u4e00\u4e9b Key\uff0c\u9019\u4e9b\u5ffd\u7565\u5373\u53ef\u3002\n\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6bcf\u7d44 Key \u7522\u751f\u5f8c\u90fd\u6703\u5f97\u5230\u4e00\u7d44\u5c0d\u61c9\u7684 Secret Key\uff0c\u8a72 Key \u662f\u6c92\u6709\u8fa6\u6cd5\u900f\u904e UI \u627e\u56de\u4f86\u7684\uff0c\u9019\u610f\u5473\u5982\u679c\u4f60\u7576\u4e0b\u5fd8\u4e86\u5132\u5b58\u6216\u662f\u4e4b\u5f8c\u4e0d\u898b\u4e86\uff0c\u90a3\u9019\u628a secret key \u5c31\u518d\u4e5f\u6c92\u6709\u8fa6\u6cd5\u627e\u56de\u3002"),(0,a.kt)("p",null,"\u9ede\u9078\u53f3\u4e0a\u65b9\u7684 Add Key \u53ef\u4ee5\u770b\u5230\u5982\u4e0b\u7684\u756b\u9762\uff0c\u8a72\u756b\u9762\u53ef\u4ee5\u5148\u8a2d\u5b9a\u8a72 Key \u6703\u4e0d\u6703\u81ea\u52d5\u904e\u671f\u7684\u6642\u9593\uff0c\u4ee5\u53ca\u4f7f\u7528\u7bc4\u570d\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/Xip7yz6.png",alt:null})),(0,a.kt)("p",null,"\u8a2d\u5b9a\u540d\u7a31\u5f8c\u5c31\u6703\u770b\u5230\u5982\u4e0b\u5716\u7684\u756b\u9762\uff0c\u756b\u9762\u4e2d\u6709\u56db\u7a2e\u76f8\u95dc\u4e0d\u540c\u7684\u8cc7\u8a0a\uff0c\u5206\u5225\u662f"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Access Endpoint: \u5b58\u53d6\u7684 API \u4f4d\u7f6e"),(0,a.kt)("li",{parentName:"ol"},"Access Key"),(0,a.kt)("li",{parentName:"ol"},"Secret Key(\u53ea\u6709\u9019\u908a\u6703\u51fa\u73fe\uff0c\u4e00\u4f46\u6309\u4e0b Close \u5c31\u518d\u4e5f\u62ff\u4e0d\u56de\u4f86\u4e86)"),(0,a.kt)("li",{parentName:"ol"},"\u91dd\u5c0d HTTP \u9700\u6c42\u8b6c\u5982 kubectl \u662f\u6709\u6a5f\u6703\u76f4\u63a5\u4f7f\u7528\u6700\u5f8c\u4e00\u500b Bearer Token \u4f7f\u7528")),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/gBJ7sKJ.png",alt:null})),(0,a.kt)("p",null,"\u9019\u6b21\u7684 Terraform \u8981\u4f7f\u7528\u524d\u4e09\u7d44\u8cc7\u8a0a\uff0c\u9019\u908a\u4e0d\u8003\u616e\u4efb\u4f55 Terraform \u7684\u64b0\u5beb\u6280\u5de7\u8207 Style\uff0c\u55ae\u7d14\u7528\u6700\u7c21\u55ae\u7684\u98a8\u683c\u4f86\u4ecb\u7d39\u5982\u4f55\u5c07 Terraform \u8207 Rancher \u6574\u5408\u3002"),(0,a.kt)("p",null,"\u4ee5\u4e0b\u793a\u7bc4\u662f\u57fa\u65bc Terraform 1.0 \u8207 Rancher Provider 1.17.0 \u7684\u7248\u672c"),(0,a.kt)("p",null,"\u9996\u5148\u6e96\u5099\u4e00\u500b main.tf \u7684\u6a94\u6848\uff0c\u5167\u5bb9\u5982\u4e0b"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'\u2570\u2500$ cat main.tf\nterraform {\n  required_providers {\n    rancher2 = {\n      source = "rancher/rancher2"\n      version = "1.17.0"\n    }\n  }\n}\n\nprovider "rancher2" {\n  api_url    = "https://rancher.hwchiu.com"\n  access_key = "token-ng6df"\n  secret_key = "l8kjh7w5mdb5s5nzmp56c5rctpt59p9bcq9wbw2g8b66wsdchrkdv2"\n}\n')),(0,a.kt)("p",null,"\u63a5\u8005\u900f\u904e Terraform init \u5148\u521d\u59cb\u5316\u76f8\u95dc\u6a21\u7d44"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'\u2570\u2500$ terraform init\nInitializing the backend...\n\nInitializing provider plugins...\n- Finding rancher/rancher2 versions matching "1.17.0"...\n- Installing rancher/rancher2 v1.17.0...\n- Installed rancher/rancher2 v1.17.0 (signed by a HashiCorp partner, key ID 2EEB0F9AD44A135C)\n\nPartner and community providers are signed by their developers.\nIf you\'d like to know more about provider signing, you can read about it here:\nhttps://www.terraform.io/docs/cli/plugins/signing.html\n\nTerraform has created a lock file .terraform.lock.hcl to record the provider\nselections it made above. Include this file in your version control repository\nso that Terraform can guarantee to make the same selections by default when\nyou run "terraform init" in the future.\n\nTerraform has been successfully initialized!\n\nYou may now begin working with Terraform. Try running "terraform plan" to see\nany changes that are required for your infrastructure. All Terraform commands\nshould now work.\n\nIf you ever set or change modules or backend configuration for Terraform,\nrerun this command to reinitialize your working directory. If you forget, other\ncommands will detect it and remind you to do so if necessary.\n')),(0,a.kt)("p",null,"\u4e00\u5207\u90fd\u6e96\u5099\u5b8c\u7562\u5f8c\uff0c\u63a5\u4e0b\u4f86\u793a\u7bc4\u4e00\u4e0b\u5982\u4f55\u900f\u904e Rancher \u4f86\u5275\u9020\u4e00\u4e9b Rancher \u7684\u8cc7\u6e90\uff0c\u8b6c\u5982\u8aaa\u4f86\u5275\u9020\u4e00\u500b ",(0,a.kt)("a",{parentName:"p",href:"https://registry.terraform.io/providers/rancher/rancher2/latest/docs/resources/cluster_template"},"RKE Template"),"\u3002"),(0,a.kt)("p",null,"\u9019\u908a\u76f4\u63a5\u53c3\u8003\u7bc4\u4f8b\u5c07\u4e0b\u5217\u5167\u5bb9\u5beb\u5165\u5230 main.tf \u4e2d\n\u8a72\u7bc4\u4f8b\u6703\u5275\u5efa\u4e00\u500b RKE Template \u4e26\u4e14\u91dd\u5c0d etcd \u4ee5\u53ca\u4e00\u4e9b\u66f4\u65b0\u7b56\u7565\u9032\u884c\u8a2d\u5b9a\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'$ cat main.tf\nterraform {\n  required_providers {\n    rancher2 = {\n      source = "rancher/rancher2"\n      version = "1.17.0"\n    }\n  }\n}\n\nprovider "rancher2" {\n  api_url    = "https://rancher.hwchiu.com"\n  access_key = "token-ng6df"\n  secret_key = "l8kjh7w5mdb5s5nzmp56c5rctpt59p9bcq9wbw2g8b66wsdchrkdv2"\n}\n\nresource "rancher2_cluster_template" "foo" {\n  name = "ithome_terraforn"\n  template_revisions {\n    name = "V1"\n    cluster_config {\n      rke_config {\n        network {\n          plugin = "canal"\n        }\n        services {\n          etcd {\n            creation = "6h"\n            retention = "24h"\n          }\n        }\n        upgrade_strategy {\n          drain = true\n          max_unavailable_worker = "20%"\n        }\n      }\n    }\n    default = true\n  }\n  description = "Terraform cluster template foo"\n}\n')),(0,a.kt)("p",null,"\u63a5\u8005\u900f\u904e terraform apply \u53bb\u66f4\u65b0"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'$ terraform apply\n...\n              + rke_config {\n                  + addon_job_timeout     = 0\n                  + ignore_docker_version = true\n                  + kubernetes_version    = (known after apply)\n                  + prefix_path           = (known after apply)\n                  + ssh_agent_auth        = false\n                  + ssh_cert_path         = (known after apply)\n                  + ssh_key_path          = (known after apply)\n                  + win_prefix_path       = (known after apply)\n\n                  + network {\n                      + mtu     = 0\n                      + options = (known after apply)\n                      + plugin  = "canal"\n                    }\n\n                  + services {\n                      + etcd {\n                          + ca_cert    = (known after apply)\n                          + cert       = (sensitive value)\n                          + creation   = "6h"\n                          + extra_args = (known after apply)\n                          + gid        = 0\n                          + image      = (known after apply)\n                          + key        = (sensitive value)\n                          + path       = (known after apply)\n                          + retention  = "24h"\n                          + snapshot   = false\n                          + uid        = 0\n                        }\n                    }\n\n                  + upgrade_strategy {\n                      + drain                        = true\n                      + max_unavailable_controlplane = "1"\n                      + max_unavailable_worker       = "20%"\n                    }\n                }\n            }\n        }\n    }\n\nPlan: 1 to add, 0 to change, 0 to destroy.\n\nDo you want to perform these actions?\n  Terraform will perform the actions described above.\n  Only \'yes\' will be accepted to approve.\n\n  Enter a value: yes\n\nrancher2_cluster_template.foo: Creating...\nrancher2_cluster_template.foo: Creation complete after 2s [id=cattle-global-data:ct-rtd4f]\n\nApply complete! Resources: 1 added, 0 changed, 0 destroyed.\n')),(0,a.kt)("p",null,"\u4e00\u5207\u5275\u9020\u5b8c\u7562\u5f8c\u5c31\u53ef\u4ee5\u79fb\u52d5\u5230 Rancher UI \u4e2d\uff0c\u5f9e RKE Template \u53ef\u4ee5\u770b\u5230\u591a\u51fa\u4e86\u4e00\u500b\u65b0\u7684 RKE Template\uff0c\u540d\u7a31\u70ba ithome_terraform\uff0c\u8207\u6211\u5011\u524d\u8ff0 main.tf \u4e2d\u63cf\u8ff0\u7684\u4e00\u6a23\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/VISDJn9.png",alt:null})),(0,a.kt)("p",null,"\u9ede\u9032\u53bb\u8a72 RKE Template \u5c31\u53ef\u4ee5\u770b\u5230\u8a73\u7d30\u7684\u8a2d\u5b9a\uff0c\u9019\u908a\u8981\u88dc\u5145\u4e00\u4e0b\uff0c Rancher \u5927\u90e8\u5206\u7684\u7269\u4ef6\u90fd\u63d0\u4f9b\u5169\u7a2e\u95b1\u89bd\u6a21\u5f0f\uff0c\u4e00\u7a2e\u662f\u53cb\u5584\u7684 UI \u4ecb\u9762\u53e6\u4e00\u7a2e\u5247\u662f\u7d14 YAML \u7684\u63cf\u8ff0\u6a94\u6848\u3002\n\u6309\u7167\u4e0b\u65b9\u7684\u65b9\u5f0f\u9ede\u9078 View as a Form \u4f86\u770b\u770b\u57fa\u65bc YAML \u7684\u5167\u5bb9\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/o8W7jBz.png",alt:null})),(0,a.kt)("p",null,"\u5f9e YAML \u5167\u5c31\u53ef\u4ee5\u770b\u5230 Terraform \u63cf\u8ff0\u7684\u8a2d\u5b9a\u90fd\u6709\u6b63\u78ba\u7684\u5beb\u9032\u4f86\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/LUrbVVN.png",alt:null})),(0,a.kt)("p",null,"\u900f\u904e\u9019\u6a23\u7c21\u55ae\u7684\u65b9\u5f0f\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528\u7a0b\u5f0f\u78bc\u7684\u65b9\u5f0f\u4f86\u7ba1\u7406 Rancher\uff0c\u9664\u4e86 RKE Template \u4e4b\u5916\uff0c Cloud Credential, Node Template, Cluster \u4e5f\u90fd\u53ef\u4ee5\u900f\u904e Terraform \u7684\u65b9\u5f0f\u4f86\u7ba1\u7406\uff0c\u9019\u6a23\u6709\u53e6\u5916\u4e00\u500b\u597d\u8655\u5c31\u662f\u7cfb\u7d71\u7ba1\u7406\u54e1\u53ea\u8981\u64b0\u5beb\u597d\u9019\u4e9b\u8cc7\u6e90\u5f8c\uff0c\u63a5\u4e0b\u4f86\u7684\u4f7f\u7528\u8005\u5c31\u4e0d\u9700\u8981\u63a5\u89f8\u5230\u9019\u4e9b\u592a\u7d30\u7bc0\u7684\u6a5f\u5bc6\u8cc7\u8a0a\uff0c\u80fd\u5920\u5c08\u5fc3\u7684\u76ee\u6a19\u8cc7\u6e90\u8207\u908f\u8f2f\u53bb\u63cf\u8ff0\u8207\u5275\u9020\u5373\u53ef\u3002"),(0,a.kt)("p",null,"\u6700\u5f8c\u9019\u908a\u8981\u518d\u88dc\u5145\u4e00\u500b\u4f7f\u7528 API \u6e9d\u901a Rancher \u7684\u597d\u8655\uff0c\u4e8b\u5be6\u4e0a\uff0c Rancher UI \u6c92\u6709\u8fa6\u6cd5\u5c55\u73fe Rancher 100% \u7684\u80fd\u529b\uff0c RKE \u5167\u6709\u975e\u5e38\u591a\u7684\u8a2d\u5b9a\u53ef\u4ee5\u8655\u7406\uff0c\u4f46\u662f\u6709\u4e9b\u8655\u7406\u5be6\u969b\u4e0a\u6c92\u6709\u8fa6\u6cd5\u900f\u904e UI \u53bb\u8a2d\u5b9a\uff0c\u8b6c\u5982\u8aaa\u60f3\u8981\u91dd\u5c0d Kubelet \u7d66\u4e00\u4e9b\u984d\u5916\u53c3\u6578\u7684\u8a71\uff0c\u9019\u4e9b\u8a2d\u5b9a\u662f\u6c92\u6709\u8fa6\u6cd5\u5f9e Rancher UI \u5b8c\u6210\u7684\uff0c\u4f46\u662f\u5982\u679c\u662f\u900f\u904e Rancher API \u4f86\u8a2d\u5b9a\u7684\u8a71\u5c31\u6c92\u6709\u554f\u984c\u3002"),(0,a.kt)("p",null,"Rancher API \u6709\u5f88\u591a\u65b9\u5f0f\u53ef\u4ee5\u8655\u7406\uff0c\u4e0d\u8ad6\u662f\u76f4\u63a5\u64b0\u5beb\u61c9\u7528\u7a0b\u5f0f\u6e9d\u901a Rancher \u6216\u662f\u4f7f\u7528 Terraform/Pulumi \u7b49\u5de5\u5177\u90fd\u53ef\u4ee5\uff0c\u900f\u904e\u9019\u985e\u578b\u5de5\u5177\u53bb\u63cf\u8ff0 Rancher \u5be6\u969b\u4e0a\u53ef\u4ee5\u5c07 Rancher \u4f7f\u7528\u7684\u66f4\u9748\u6d3b\u8207\u66f4\u5f37\u5927\uff0c\u8a2d\u5b9a\u7684\u6771\u897f\u4e5f\u66f4\u591a\u5143\u5316\u3002"),(0,a.kt)("p",null,"\u5982\u679c\u5718\u968a\u6709\u610f\u9858\u9577\u671f\u4f7f\u7528 Rancher\uff0c\u6703\u975e\u5e38\u63a8\u85a6\u4f7f\u7528 IaC \u7684\u5de5\u5177\u4f86\u7dad\u8b77\u8207\u7ba1\u7406 Rancher\uff0c\u671f\u5e36\u4f86\u5f97\u597d\u975e\u5e38\u7684\u591a\u3002"))}m.isMDXComponent=!0}}]);
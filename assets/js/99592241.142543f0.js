"use strict";(self.webpackChunkhwchiu=self.webpackChunkhwchiu||[]).push([[97975],{3905:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>k});var a=t(67294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var p=a.createContext({}),s=function(e){var n=a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},d=function(e){var n=s(e.components);return a.createElement(p.Provider,{value:n},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},c=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,p=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),u=s(t),c=i,k=u["".concat(p,".").concat(c)]||u[c]||m[c]||r;return t?a.createElement(k,l(l({ref:n},d),{},{components:t})):a.createElement(k,l({ref:n},d))}));function k(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,l=new Array(r);l[0]=c;var o={};for(var p in n)hasOwnProperty.call(n,p)&&(o[p]=n[p]);o.originalType=e,o[u]="string"==typeof e?e:i,l[1]=o;for(var s=2;s<r;s++)l[s]=t[s];return a.createElement.apply(null,l)}return a.createElement.apply(null,t)}c.displayName="MDXCreateElement"},25509:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>l,default:()=>m,frontMatter:()=>r,metadata:()=>o,toc:()=>s});var a=t(87462),i=(t(67294),t(3905));const r={title:"Install GPU in GKE(Google Kubernetes Engine)",tags:["GPU","GCP","Kubernetes"],date:new Date("2018-07-14T17:41:45.000Z"),description:"\u904e\u53bb\u6240\u8b02\u7684 GPU \u904b\u7b97\u5e7e\u4e4e\u90fd\u662f\u500b\u4eba\u4e3b\u6a5f\u7684\u5e02\u5834\uff0c\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u5f88\u8f15\u9b06\u7684\u8cfc\u8cb7\u986f\u5361\u56de\u5bb6\u4e26\u4e14\u5b89\u88dd\u8d77\u4f86\u4f7f\u7528\uff0c\u4e0d\u8ad6\u662f\u73a9\u904a\u6232\u6240\u9700\u8981\uff0c\u6216\u662f\u9700\u8981 GPU \u904b\u7b97\uff0c\u9019\u90e8\u5206\u7684\u751f\u614b\u65e9\u5c31\u5b58\u5728\u5df2\u4e45\u3002 \u96a8\u8005 AI \u5e02\u5834\u7684\u84ec\u52c3\u767c\u5c55\uff0c GPU \u8cc7\u6e90\u7684\u9700\u6c42\u91cf\u4e0a\u5347\uff0c\u500b\u4eba\u5bb6\u7528\u6240\u64c1\u6709\u7684\u6578\u91cf\u5728\u90e8\u5206\u61c9\u7528\u60c5\u5883\u4e0b\u6240\u9700\u8981\u7684\u6642\u9593\u592a\u9577\u4e86\uff0c\u56e0\u6b64\u5c31\u6709\u4e86\u516c\u6709\u96f2\u8207 GPU \u7d50\u5408\u7684\u9700\u6c42\u51fa\u73fe\u3002\u4f7f\u7528\u8005\u53ef\u4ee5\u6839\u64da\u81ea\u8eab\u7684\u9700\u6c42\u53bb\u8a55\u4f30\u9700\u8981\u591a\u5c11\u5f35 GPU \u5361\uff0c\u7136\u5f8c\u5728\u5c0d\u61c9\u7684\u516c\u6709\u96f2\u4e0a\u53bb\u7533\u8acb\u5c0d\u61c9\u7684\u8cc7\u6e90\u4f86\u4f7f\u7528\u3002\u672c\u6587\u57fa\u65bc\u9019\u7a2e\u6982\u5ff5\u7684\u60c5\u6cc1\u4e0b\uff0c\u8ddf\u5927\u5bb6\u5206\u4eab\u4e00\u4e0b\u5728 Google Kubernetes Engine \u4e0a\u82e5\u8981\u4f7f\u7528 GPU \u7684\u8a71\uff0c\u5927\u81f4\u4e0a\u6709\u54ea\u4e9b\u6b65\u9a5f\u9700\u8981\u57f7\u884c\uff0c\u4e26\u4e14\u5206\u4eab\u4e00\u4e9b\u80cc\u5f8c\u7684\u5b89\u88dd\u539f\u7406\u3002"},l="Preface",o={unversionedId:"2018/gpu-gke",id:"2018/gpu-gke",title:"Install GPU in GKE(Google Kubernetes Engine)",description:"\u904e\u53bb\u6240\u8b02\u7684 GPU \u904b\u7b97\u5e7e\u4e4e\u90fd\u662f\u500b\u4eba\u4e3b\u6a5f\u7684\u5e02\u5834\uff0c\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u5f88\u8f15\u9b06\u7684\u8cfc\u8cb7\u986f\u5361\u56de\u5bb6\u4e26\u4e14\u5b89\u88dd\u8d77\u4f86\u4f7f\u7528\uff0c\u4e0d\u8ad6\u662f\u73a9\u904a\u6232\u6240\u9700\u8981\uff0c\u6216\u662f\u9700\u8981 GPU \u904b\u7b97\uff0c\u9019\u90e8\u5206\u7684\u751f\u614b\u65e9\u5c31\u5b58\u5728\u5df2\u4e45\u3002 \u96a8\u8005 AI \u5e02\u5834\u7684\u84ec\u52c3\u767c\u5c55\uff0c GPU \u8cc7\u6e90\u7684\u9700\u6c42\u91cf\u4e0a\u5347\uff0c\u500b\u4eba\u5bb6\u7528\u6240\u64c1\u6709\u7684\u6578\u91cf\u5728\u90e8\u5206\u61c9\u7528\u60c5\u5883\u4e0b\u6240\u9700\u8981\u7684\u6642\u9593\u592a\u9577\u4e86\uff0c\u56e0\u6b64\u5c31\u6709\u4e86\u516c\u6709\u96f2\u8207 GPU \u7d50\u5408\u7684\u9700\u6c42\u51fa\u73fe\u3002\u4f7f\u7528\u8005\u53ef\u4ee5\u6839\u64da\u81ea\u8eab\u7684\u9700\u6c42\u53bb\u8a55\u4f30\u9700\u8981\u591a\u5c11\u5f35 GPU \u5361\uff0c\u7136\u5f8c\u5728\u5c0d\u61c9\u7684\u516c\u6709\u96f2\u4e0a\u53bb\u7533\u8acb\u5c0d\u61c9\u7684\u8cc7\u6e90\u4f86\u4f7f\u7528\u3002\u672c\u6587\u57fa\u65bc\u9019\u7a2e\u6982\u5ff5\u7684\u60c5\u6cc1\u4e0b\uff0c\u8ddf\u5927\u5bb6\u5206\u4eab\u4e00\u4e0b\u5728 Google Kubernetes Engine \u4e0a\u82e5\u8981\u4f7f\u7528 GPU \u7684\u8a71\uff0c\u5927\u81f4\u4e0a\u6709\u54ea\u4e9b\u6b65\u9a5f\u9700\u8981\u57f7\u884c\uff0c\u4e26\u4e14\u5206\u4eab\u4e00\u4e9b\u80cc\u5f8c\u7684\u5b89\u88dd\u539f\u7406\u3002",source:"@site/docs/2018/gpu-gke.md",sourceDirName:"2018",slug:"/2018/gpu-gke",permalink:"/docs/2018/gpu-gke",draft:!1,tags:[{label:"GPU",permalink:"/docs/tags/gpu"},{label:"GCP",permalink:"/docs/tags/gcp"},{label:"Kubernetes",permalink:"/docs/tags/kubernetes"}],version:"current",frontMatter:{title:"Install GPU in GKE(Google Kubernetes Engine)",tags:["GPU","GCP","Kubernetes"],date:"2018-07-14T17:41:45.000Z",description:"\u904e\u53bb\u6240\u8b02\u7684 GPU \u904b\u7b97\u5e7e\u4e4e\u90fd\u662f\u500b\u4eba\u4e3b\u6a5f\u7684\u5e02\u5834\uff0c\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u5f88\u8f15\u9b06\u7684\u8cfc\u8cb7\u986f\u5361\u56de\u5bb6\u4e26\u4e14\u5b89\u88dd\u8d77\u4f86\u4f7f\u7528\uff0c\u4e0d\u8ad6\u662f\u73a9\u904a\u6232\u6240\u9700\u8981\uff0c\u6216\u662f\u9700\u8981 GPU \u904b\u7b97\uff0c\u9019\u90e8\u5206\u7684\u751f\u614b\u65e9\u5c31\u5b58\u5728\u5df2\u4e45\u3002 \u96a8\u8005 AI \u5e02\u5834\u7684\u84ec\u52c3\u767c\u5c55\uff0c GPU \u8cc7\u6e90\u7684\u9700\u6c42\u91cf\u4e0a\u5347\uff0c\u500b\u4eba\u5bb6\u7528\u6240\u64c1\u6709\u7684\u6578\u91cf\u5728\u90e8\u5206\u61c9\u7528\u60c5\u5883\u4e0b\u6240\u9700\u8981\u7684\u6642\u9593\u592a\u9577\u4e86\uff0c\u56e0\u6b64\u5c31\u6709\u4e86\u516c\u6709\u96f2\u8207 GPU \u7d50\u5408\u7684\u9700\u6c42\u51fa\u73fe\u3002\u4f7f\u7528\u8005\u53ef\u4ee5\u6839\u64da\u81ea\u8eab\u7684\u9700\u6c42\u53bb\u8a55\u4f30\u9700\u8981\u591a\u5c11\u5f35 GPU \u5361\uff0c\u7136\u5f8c\u5728\u5c0d\u61c9\u7684\u516c\u6709\u96f2\u4e0a\u53bb\u7533\u8acb\u5c0d\u61c9\u7684\u8cc7\u6e90\u4f86\u4f7f\u7528\u3002\u672c\u6587\u57fa\u65bc\u9019\u7a2e\u6982\u5ff5\u7684\u60c5\u6cc1\u4e0b\uff0c\u8ddf\u5927\u5bb6\u5206\u4eab\u4e00\u4e0b\u5728 Google Kubernetes Engine \u4e0a\u82e5\u8981\u4f7f\u7528 GPU \u7684\u8a71\uff0c\u5927\u81f4\u4e0a\u6709\u54ea\u4e9b\u6b65\u9a5f\u9700\u8981\u57f7\u884c\uff0c\u4e26\u4e14\u5206\u4eab\u4e00\u4e9b\u80cc\u5f8c\u7684\u5b89\u88dd\u539f\u7406\u3002"},sidebar:"techPost",previous:{title:"CNI \u5e38\u898b\u554f\u984c\u6574\u7406",permalink:"/docs/2018/cni-questions"},next:{title:"[Container Network Interface] Bridge Network In Docker",permalink:"/docs/2018/introduce-cni-i"}},p={},s=[],d={toc:s},u="wrapper";function m(e){let{components:n,...t}=e;return(0,i.kt)(u,(0,a.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"preface"},"Preface"),(0,i.kt)("p",null,"\u6700\u8fd1\u5617\u8a66\u8981\u518d GKE \u4e0a\u9762\u958b\u555f GPU \u7684\u670d\u52d9\uff0c\u7136\u5f8c\u5be6\u969b\u4e0a\u537b\u9047\u5230\u4e86\u4e00\u4e9b\u554f\u984c\uff0c\u56e0\u6b64\u7528\u672c\u7bc7\u6587\u7ae0\u4f86\u8a18\u9304\u9047\u5230\u554f\u984c\u4e26\u4e14\u9047\u5230\u554f\u984c\u7684\u89e3\u6c7a\u601d\u8def\u3002"),(0,i.kt)("p",null,"\u4e00\u958b\u59cb\u6709\u500b\u9700\u6c42\u6642\uff0c\u5f88\u76f4\u89ba\u7684\u518d Google \u4e0a\u9762\u76f4\u63a5\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"GKE GPU")," \u9032\u884c\u641c\u5c0b\uff0c\u7684\u78ba\u4e5f\u53ef\u4ee5\u627e\u5230\u4e0d\u5c11\u6587\u7ae0\u5728\u8b1b ",(0,i.kt)("inlineCode",{parentName:"p"},"GPU")," \u8207 ",(0,i.kt)("inlineCode",{parentName:"p"},"Kubernetes")," \u76f8\u95dc\u3002"),(0,i.kt)("p",null,"\u7b2c\u4e00\u500b\u641c\u5c0b\u7d50\u679c\u5247\u662f Google \u5b98\u65b9\u7684\u6587\u7ae0 ",(0,i.kt)("a",{parentName:"p",href:"https://cloud.google.com/kubernetes-engine/docs/concepts/gpus"},"Kubernetes Engine, GPUs")),(0,i.kt)("p",null,"\u76f4\u63a5\u6574\u7406\u8a72\u6587\u7ae0\u4e2d\u7684\u91cd\u9ede\u6d41\u7a0b."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"\u5f9e GCP \u7684\u7ba1\u7406\u9762\u677f\u4e2d\u53bb\u53d6\u5f97 GPU \u8cc7\u6e90"),(0,i.kt)("li",{parentName:"ol"},"\u5275\u9020 GPU Node Pool \u4f9b GKE \u3110"),(0,i.kt)("li",{parentName:"ol"},"\u900f\u904e ",(0,i.kt)("inlineCode",{parentName:"li"},"kubernetes DaemonSet")," \u7684\u65b9\u5f0f\u5b89\u88dd ",(0,i.kt)("inlineCode",{parentName:"li"},"NVIDIA Drivers")," \u5230\u6240\u6709 GPU Node \u4e0a"),(0,i.kt)("li",{parentName:"ol"},"\u63a5\u4e0b\u4f86\u5275\u9020 Pod \u5373\u53ef\u6b63\u5e38\u4f7f\u7528 ",(0,i.kt)("inlineCode",{parentName:"li"},"NVIDIA")," GPU \u8cc7\u6e90")),(0,i.kt)("h1",{id:"install"},"Install"),(0,i.kt)("p",null,"\u524d\u9762\u5169\u500b\u6b65\u9a5f\u57fa\u672c\u4e0a\u4e0d\u6703\u6709\u4ec0\u9ebc\u554f\u984c\uff0c\u900f\u904e\u7db2\u9801\u4ecb\u9762\u9ede\u9078\u6216\u662f\u53c3\u8003\u7db2\u9801\u4e2d\u7684\u6307\u4ee4\u53bb\u5275\u9020\u5373\u53ef\u9806\u5229\u5b8c\u6210\u3002\n\u6bd4\u8f03\u56f0\u64fe\u7684\u5247\u662f\u7b2c\u4e09\u500b\u6b65\u9a5f\uff0c\u6839\u64da\u8a72\u7bc7\u6587\u7ae0\u986f\u793a\u6211\u5011\u53ea\u9700\u8981\u90e8\u7f72\u4e00\u500b ",(0,i.kt)("inlineCode",{parentName:"p"},"yaml")," \u6a94\u6848\u5373\u53ef\u5b8c\u5168 ",(0,i.kt)("inlineCode",{parentName:"p"},"NVIDIA Drives")," \u5230\u6240\u6709 GPU \u7bc0\u9ede\u4e0a"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"kubectl apply -f https://raw.githubusercontent.com/GoogleCloudPlatform/container-engine-accelerators/stable/nvidia-driver-installer/cos/DaemonSet-preloaded.yaml\n")),(0,i.kt)("p",null,"\u4f46\u662f\u6211\u5728\u53e6\u5916\u4e00\u500b ",(0,i.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u7684\u6587\u7ae0\u4e2d ",(0,i.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/tasks/manage-gpus/scheduling-gpus/"},"Kubernetes scheduling-gpus"),"\n\u82e5\u8981\u518d ",(0,i.kt)("inlineCode",{parentName:"p"},"GKE")," \u4e0a\u9762\u5b89\u88dd GPU \u8cc7\u6e90\u7684\u8a71\uff0c\u5247\u9700\u8981\u6839\u64da\u60c5\u6cc1\u90e8\u7f72\u4e0b\u5217 ",(0,i.kt)("inlineCode",{parentName:"p"},"yaml")," \u6a94\u6848\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"On your 1.9 cluster, you can use the following commands to install the NVIDIA drivers and device plugin:\n\n# Install NVIDIA drivers on Container-Optimized OS:\nkubectl create -f https://raw.githubusercontent.com/GoogleCloudPlatform/container-engine-accelerators/k8s-1.9/DaemonSet.yaml\n\n# Install NVIDIA drivers on Ubuntu (experimental):\nkubectl create -f https://raw.githubusercontent.com/GoogleCloudPlatform/container-engine-accelerators/k8s-1.9/nvidia-driver-installer/ubuntu/DaemonSet.yaml\n\n# Install the device plugin:\nkubectl create -f https://raw.githubusercontent.com/kubernetes/kubernetes/release-1.9/cluster/addons/device-plugins/nvidia-gpu/DaemonSet.yaml\n")),(0,i.kt)("p",null,"\u9996\u5148\uff0c\u7b2c\u4e00\u7bc7\u6587\u7ae0\u8868\u660e\u53ea\u9700\u8981\u900f\u904e ",(0,i.kt)("inlineCode",{parentName:"p"},"DaemonSet")," \u7684\u65b9\u5f0f\u53bb\u5b89\u88dd ",(0,i.kt)("inlineCode",{parentName:"p"},"NVIDIA Drivers"),"\uff0c\u800c\u7b2c\u4e8c\u7bc7\u6587\u7ae0\u5247\u9700\u8981\u90e8\u7f72\u5169\u500b ",(0,i.kt)("inlineCode",{parentName:"p"},"DaemonSet"),"\uff0c\u5206\u5225\u4f86\u8655\u7406 ",(0,i.kt)("inlineCode",{parentName:"p"},"NVIDIA Drivers")," \u4ee5\u53ca ",(0,i.kt)("inlineCode",{parentName:"p"},"Device Plugin"),"."),(0,i.kt)("p",null,"\u6b64\u5916\uff0c\u91dd\u5c0d\u7b2c\u4e00\u500b ",(0,i.kt)("inlineCode",{parentName:"p"},"NVIDIA Drivers")," \u4e5f\u63d0\u4f9b\u4e0d\u540c\u4f5c\u696d\u7cfb\u7d71\u7684\u6a94\u6848(cos/ubuntu)\uff0c\u4e14\u5c31\u6211\u7684\u8a8d\u77e5\u4e0a ",(0,i.kt)("inlineCode",{parentName:"p"},"Device Plugin")," \u672c\u4f86\u5c31\u9700\u8981\u8dd1\u4e00\u500b ",(0,i.kt)("inlineCode",{parentName:"p"},"DaemonSet")," \u4f86\u76e3\u807d Kubernetes \u7684\u4e8b\u4ef6\u4f86\u8655\u7406\u5404\u5f0f\u5404\u6a23\u7684 Device \u64cd\u4f5c\u3002"),(0,i.kt)("p",null,"\u5728\u767e\u601d\u4e0d\u5f97\u5176\u89e3\u7684\u60c5\u6cc1\u4e0b\uff0c\u4e7e\u8106\u76f4\u63a5\u627e\u5230\u76f8\u95dc\u7684 Git \u5c08\u6848\u4f86\u770b\u770b\uff0c\u6709\u6c92\u6709\u66f4\u6e05\u695a\u7684\u89e3\u91cb\uff0c\u7562\u7adf\u6211\u5011\u90fd\u77e5\u9053\u6587\u4ef6\u66f4\u65b0\u7684\u901f\u5ea6\u6bd4\u4e0d\u4e0a\u7a0b\u5f0f\u78bc\u4fee\u6539\u7684\u901f\u5ea6\u3002"),(0,i.kt)("p",null,"\u6700\u5f8c\u627e\u5230\u4e86\u9019\u500b Git \u5c08\u6848 ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/GoogleCloudPlatform/container-engine-accelerators/tree/master/cmd/nvidia_gpu"},"GoogleCloudPlatform/container-engine-accelerators")),(0,i.kt)("p",null,"\u9019\u500b\u5c08\u6848\u7684\u6587\u4ef6\u76f4\u63a5\u89e3\u6c7a\u4e86\u6211\u95dc\u65bc ",(0,i.kt)("inlineCode",{parentName:"p"},"Device Plugin")," \u7684\u7591\u60d1"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"In GKE, from 1.9 onwards, this DaemonSet is automatically deployed as an addon. Note that DaemonSet pods are only scheduled on\nnodes with accelerators attached, they are not scheduled on nodes that don't have any accelerators attached.")),(0,i.kt)("p",null,"\u6839\u64da\u9019\u4efd\u6587\u4ef6\u6558\u8ff0\uff0c\u5728 GKE (1.9\u7248\u672c\u4e4b\u5f8c)\uff0c\u6703\u81ea\u52d5\u90e8\u7f72 ",(0,i.kt)("inlineCode",{parentName:"p"},"Daemonset")," \u5230\u96c6\u7fa4\u4e0a\u9762\u7684 GPU Node \u4f86\u8655\u7406 ",(0,i.kt)("inlineCode",{parentName:"p"},"Device Plugin")," \u76f8\u95dc\u7684\u4e8b\u5b9c\u3002"),(0,i.kt)("p",null,"\u7531\u65bc\u6211\u4f7f\u7528\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"GKE")," \u96c6\u7fa4\u7248\u672c\u662f 1.9 \u4e4b\u5f8c\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u81ea\u5df1\u624b\u52d5\u90e8\u7f72 ",(0,i.kt)("inlineCode",{parentName:"p"},"DaemonSet")," \u4f86\u5b89\u88dd ",(0,i.kt)("inlineCode",{parentName:"p"},"NVIDIA Drivers")," \u5230\u6240\u6709\u7684 GPU \u7bc0\u9ede\u4e0a\u3002\n\u7d50\u5408\u4e86\u4e0a\u8ff0\u5169\u8005\u500b\u6587\u4ef6\uff0c\u53ef\u4ee5\u6839\u64da\u7248\u672c\u4ee5\u53caGPU \u7bc0\u9ede\u4e0a\u9762\u7684\u4f5c\u696d\u7cfb\u7d71\u9078\u64c7\u9700\u8981\u4f7f\u7528\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"Yaml"),".\n\u5728 Github \u7684\u5c08\u6848\u5167\uff0c\u4f7f\u7528\u4e86 ",(0,i.kt)("inlineCode",{parentName:"p"},"Brnach")," \u7684\u65b9\u5f0f\u4f86\u5207\u63db\u4e0d\u540c\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u7248\u672c\uff0c\u6240\u4ee5\u9019\u908a\u5c31\u6839\u64da\u5404\u81ea\u7684\u9700\u6c42\u4f86\u9078\u64c7\u3002\n\u60f3\u8981\u7372\u5f97\u5982\u5b98\u65b9\u7bc4\u4f8b\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"raw.githubusercontent.com")," \u7684\u9023\u7d50\u53ea\u8981\u5230\u8a72 Github \u7684\u6a94\u6848\u4e2d\u9ede\u9078\u53f3\u4e0a\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"Raw")," \u6309\u9215\u5247\u6703\u7372\u5f97\u4e00\u500b\u95dc\u65bc\u8a72\u6a94\u6848\u7684\u5b58\u53d6\u9023\u7d50\u3002\n\u8b6c\u5982"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"kubectl create -f https://raw.githubusercontent.com/GoogleCloudPlatform/container-engine-accelerators/k8s-1.9/DaemonSet.yaml\n")),(0,i.kt)("p",null,"\u7531\u65bc\u8a72 ",(0,i.kt)("inlineCode",{parentName:"p"},"yaml")," \u4f7f\u7528\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"namespace")," \u662f\u5728 ",(0,i.kt)("inlineCode",{parentName:"p"},"kube-system"),", \u6240\u4ee5\u82e5\u8981\u89c0\u5bdf\u5176\u7d50\u679c\u5225\u5fd8\u8a18\u5207\u63db\u5c0d\u61c9\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"namespace")," \u4f86\u89c0\u5bdf\u3002"),(0,i.kt)("p",null,"\u9019\u908a\u53ea\u8981\u8a72 ",(0,i.kt)("inlineCode",{parentName:"p"},"Pod"),"\u7684\u72c0\u614b\u8b8a\u6210 ",(0,i.kt)("inlineCode",{parentName:"p"},"Running")," \u5247\u4ee3\u8868\u8a72 ",(0,i.kt)("inlineCode",{parentName:"p"},"NVIDIA Driver")," \u5df2\u7d93\u5b89\u88dd\u5b8c\u7562\u4e86\uff0c\u5c31\u53ef\u4ee5\u958b\u59cb\u90e8\u7f72\u81ea\u5df1\u7684 Pod \u4f86\u4f7f\u7528\u9019\u4e9b GPU \u8cc7\u6e90\u4e86\u3002"),(0,i.kt)("hr",null),(0,i.kt)("p",null,"\u984c\u5916\u8a71:\n\u70ba\u4ec0\u9ebc\u5b89\u88dd\u4e00\u500b ",(0,i.kt)("inlineCode",{parentName:"p"},"NVIDIA Driver")," \u5b8c\u6210\u6703\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"Running")," \u800c\u4e0d\u662f\u5176\u4ed6\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"Completed")," \u7b49\u770b\u8d77\u4f86\u7d50\u675f\u7684\u8cc7\u8a0a?"),(0,i.kt)("p",null,"\u9019\u908a\u4e3b\u8981\u53d7\u9650\u65bc\u76ee\u524d ",(0,i.kt)("inlineCode",{parentName:"p"},"Kubernetes")," \u8cc7\u6e90\u7684\u4f7f\u7528\u65b9\u6cd5\u8207 ",(0,i.kt)("inlineCode",{parentName:"p"},"NVIDIA Driver")," \u7684\u5b89\u88dd\u4f7f\u7528\u60c5\u5883\u3002"),(0,i.kt)("p",null,"\u9996\u5148\uff0c\u6211\u5011\u5e0c\u671b ",(0,i.kt)("inlineCode",{parentName:"p"},"NVIDIA Driver")," \u80fd\u5920\u5b89\u88dd\u5230\u6bcf\u4e00\u53f0\u64c1\u6709 GPU \u7684\u7bc0\u9ede\u4e0a\uff0c\u6240\u4ee5\u9019\u908a\u6211\u5011\u6703\u5e0c\u671b\u4f7f\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"DaemonSet")," \u4f86\u5e6b\u4f60\u90e8\u7f72\u5c0d\u61c9\u7684 Pod \u5230 GPU \u7bc0\u9ede\u3002"),(0,i.kt)("p",null,"\u7136\u800c ",(0,i.kt)("inlineCode",{parentName:"p"},"NVIDIA Driver")," \u7684\u5b89\u88dd\u5176\u5be6\u672c\u8eab\u5c31\u662f\u4e00\u500b\u6703\u7d50\u675f\u7684\u61c9\u7528\u7a0b\u5f0f\uff0c\u5982\u679c\u6b63\u5e38\u4f7f\u7528\u4e0a\uff0c\u7576\u76f8\u95dc\u8cc7\u6e90\u90fd\u5b89\u88dd\u5b8c\u7562\uff0c\u8a72 Pod \u5247\u6703\u7d50\u675f \u4e26\u4e14\u5c07\u72c0\u614b\u5207\u63db\u6210 ",(0,i.kt)("inlineCode",{parentName:"p"},"Succeed"),"."),(0,i.kt)("p",null,"\u6b64\u6642 ",(0,i.kt)("inlineCode",{parentName:"p"},"DaemonSet")," \u5247\u6703\u70ba\u4e86\u78ba\u4fdd\u5176\u9078\u64c7\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"Pod")," \u662f\u4e00\u500b\u985e\u4f3c ",(0,i.kt)("inlineCode",{parentName:"p"},"Daemon")," \u7684\u7a0b\u5f0f\uff0c\u5fc5\u9808\u4e00\u76f4\u5b58\u6d3b\uff0c\u5247\u53c8\u6703\u91cd\u65b0\u5c07\u8a72 Pod \u53eb\u8d77\u4f86\u7e7c\u7e8c\u91cd\u65b0\u5b89\u88dd\u3002"),(0,i.kt)("p",null,"\u5982\u6b64\u5247\u6703\u767c\u751f\u4e00\u500b\u53cd\u8986\u57f7\u884c\u7684\u7121\u7aae\u8ff4\u5708\uff0c\u70ba\u4e86\u89e3\u6c7a\u9019\u500b\u554f\u984c\uff0c\u4e0d\u5c11\u4eba\u5728\u63d0\u51fa\u6709\u6c92\u6709\u985e\u4f3c ",(0,i.kt)("inlineCode",{parentName:"p"},"DaemonJob")," \u7684\u8cc7\u6e90\u53ef\u4ee5\u4f7f\u7528?\n\u5e0c\u671b\u53ef\u4ee5\u5728\u6bcf\u500b\u7b26\u5408\u7684\u7bc0\u9ede\u4e0a\u90fd\u904b\u884c\u4e00\u500b",(0,i.kt)("inlineCode",{parentName:"p"},"Job"),"\u5c31\u597d\uff0c\u4e0d\u9700\u8981\u4e00\u76f4\u53cd\u8986\u57f7\u884c\uff0c\n\u53ef\u4ee5\u5728\u4e0b\u5217\u7684\u9023\u7d50\u770b\u5230\u76f8\u95dc\u7684\u8a0e\u8ad6\u4e32."),(0,i.kt)("p",null,"1.",(0,i.kt)("a",{parentName:"p",href:"https://github.com/kubernetes/kubernetes/issues/36601"},"CronJob DaemonSet (previously ScheduledJob)"),"\n2.",(0,i.kt)("a",{parentName:"p",href:"https://github.com/kubernetes/kubernetes/issues/50689"},"[DaemonSet] Considering run-once DaemonSet (Job DaemonSet)"),"\n3.",(0,i.kt)("a",{parentName:"p",href:"http://blog.phymata.com/2017/05/13/run-once-DaemonSet-on-kubernetes/"},"Run Once DaemonSet on Kubernetes")),(0,i.kt)("p",null,"\u5728\u9019\u500b\u554f\u984c\u88ab\u6b63\u5f0f\u89e3\u6c7a\u524d\uff0c\u6709\u4e0d\u5c11 ",(0,i.kt)("inlineCode",{parentName:"p"},"Workarouund")," \u53ef\u4ee5\u8655\u7406\u9019\u500b\u60c5\u5883\uff0c\u6700\u5e38\u7528\u7684\u63a1\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"Init-Container")," \u7684\u65b9\u5f0f\u4f86\u5b8c\u6210\u3002\n\u85c9\u7531 ",(0,i.kt)("inlineCode",{parentName:"p"},"Init-Container")," \u4f86\u57f7\u884c\u4e3b\u8981\u7684\u5b89\u88dd\u6d41\u7a0b\uff0c\u7136\u5f8c\u518d ",(0,i.kt)("inlineCode",{parentName:"p"},"Contianer")," \u88e1\u9762\u4f7f\u7528\u5247\u662f\u53ea\u7528\u4e86\u4e00\u500b\u4f4e\u8cc7\u6e90\u6c92\u505a\u4e8b\u60c5\u55ae\u7d14\u7121\u7aae\u8ff4\u5708\u5361\u4f4f\u7684\u61c9\u7528\u7a0b\u5e8f\u3002"),(0,i.kt)("p",null,"\u7576 ",(0,i.kt)("inlineCode",{parentName:"p"},"Pod")," \u958b\u59cb\u904b\u884c\u7684\u6642\u5019\uff0c\u5148\u57f7\u884c ",(0,i.kt)("inlineCode",{parentName:"p"},"Init-Contaienr")," \u4f86\u9032\u884c\u771f\u6b63\u7684\u4efb\u52d9\u4f86\u5b89\u88dd\u76f8\u95dc\u8cc7\u6e90\uff0c\u63a5\u4e0b\u4f86\u5207\u63db\u5230 ",(0,i.kt)("inlineCode",{parentName:"p"},"Contaienr")," \u9032\u884c\u4e00\u500b\u767c\u5446\u7684\u61c9\u7528\u7a0b\u5f0f\n\u78ba\u4fdd ",(0,i.kt)("inlineCode",{parentName:"p"},"Pod")," \u7684\u72c0\u614b\u6703\u7dad\u6301\u5728 ",(0,i.kt)("inlineCode",{parentName:"p"},"Running")," \u800c\u4e0d\u6703\u88ab ",(0,i.kt)("inlineCode",{parentName:"p"},"Daemonset")," \u7d66\u91cd\u555f\u3002\n\u9019\u4e5f\u662f\u70ba\u4ec0\u9ebc\u6211\u5011\u53ea\u8981\u770b\u5230 ",(0,i.kt)("inlineCode",{parentName:"p"},"Running")," \u5c31\u53ef\u4ee5\u8996\u70ba ",(0,i.kt)("inlineCode",{parentName:"p"},"NVIDIA Driver")," \u5df2\u7d93\u5b89\u88dd\u5b8c\u7562\u4e86\u3002\n\u53e6\u5916\uff0c\u5176\u5be6 ",(0,i.kt)("inlineCode",{parentName:"p"},"Flannel")," (CNI) \u4e5f\u662f\u4f7f\u7528\u9019\u7a2e\u65b9\u5f0f\u4f86\u5b89\u88dd\u76f8\u95dc\u7684 CNI \u8cc7\u6e90(config/bianry) \u5230\u6bcf\u53f0\u6a5f\u5668\u4e0a\u3002"),(0,i.kt)("hr",null),(0,i.kt)("p",null,"\u56de\u5230\u6b63\u984c\uff0c\u6309\u7167\u7b2c\u4e00\u7bc7\u6587\u7ae0\u63d0\u5230\u7684\u8aaa\u660e\u6587\u4ef6\uff0c\u6211\u5011\u7c21\u55ae\u90e8\u7f72\u4e00\u500b ",(0,i.kt)("inlineCode",{parentName:"p"},"Pod")," \u7684\u61c9\u7528\u7a0b\u5f0f\u4f86\u4f7f\u7528 GPU \u8cc7\u6e90"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: v1\nkind: Pod\nspec:\n  containers:\n  - name: my-gpu-container\n    resources:\n      limits:\n       nvidia.com/gpu: 1\n")),(0,i.kt)("p",null,"\u770b\u4f3c\u7c21\u55ae\u5408\u7406\u7d50\u679c\u7d50\u679c\u6700\u5f8c\u904b\u884c\u8d77\u4f86\u9047\u5230\u554f\u984c\uff0cPod \u5167\u7684 GPU \u61c9\u7528\u7a0b\u5f0f\u5728\u904b\u884c\u6642\u6703\u904b\u884c\u932f\u8aa4\uff0c\u932f\u8aa4\u8a0a\u606f\u985e\u4f3c"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'"libcuda.so.1 file" is not found.\n')),(0,i.kt)("p",null,"\u9019\u770b\u8d77\u4f86\u5c31\u662f\u627e\u4e0d\u5230 ",(0,i.kt)("inlineCode",{parentName:"p"},"CUDA")," \u76f8\u95dc\u7684\u51fd\u5f0f\u5eab\u6240\u4ee5\u6c92\u6709\u8fa6\u6cd5\u6b63\u5e38\u7684\u555f\u7528 GPU \u61c9\u7528\u7a0b\u5f0f\u3002"),(0,i.kt)("p",null,"\u9019\u6642\u5019\u518d\u91cd\u65b0\u6aa2\u8996\u4e86\u4e00\u4e0b\u8a72\u4efd Google \u6587\u4ef6\uff0c\u6709\u500b\u6bb5\u843d\u5728\u8b1b\u8ff0 ",(0,i.kt)("inlineCode",{parentName:"p"},"CUDA")," \u7684\u51fd\u5f0f\u5eab"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"CUDA\xae is NVIDIA's parallel computing platform and programming model for GPUs. The NVIDIA device drivers you install in your cluster include the CUDA libraries.\n\nCUDA libraries and debug utilities are made available inside the container at /usr/local/nvidia/lib64 and /usr/local/nvidia/bin, respectively.\n\nCUDA applications running in Pods consuming NVIDIA GPUs need to dynamically discover CUDA libraries. This requires including /usr/local/nvidia/lib64 in the LD_LIBRARY_PATH environment variable.\n")),(0,i.kt)("p",null,"\u9996\u5148\uff0c\u4f60\u5b89\u88dd ",(0,i.kt)("inlineCode",{parentName:"p"},"NVIDIA Driver")," \u7684\u540c\u6642\uff0c \u4e5f\u6703\u4e00\u8d77\u5b89\u88dd ",(0,i.kt)("inlineCode",{parentName:"p"},"CUDA")," \u7684\u51fd\u5f0f\u5eab\n\u518d\u4f86 CUDA \u76f8\u95dc\u7684\u51fd\u5f0f\u5eab\u8207\u4f7f\u7528\u5de5\u5177\u90fd\u53ef\u4ee5\u5728 ",(0,i.kt)("inlineCode",{parentName:"p"},"Container")," \u5167\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"/usr/local/nvidia/lib64")," \u4ee5\u53ca ",(0,i.kt)("inlineCode",{parentName:"p"},"/usr/local/nvidia/bin")," \u627e\u5230\u8207\u4f7f\u7528\u3002\n\u6700\u5f8c\u4f60\u5fc5\u9808\u8981\u8a2d\u5b9a\u4f60\u61c9\u7528\u7a0b\u5f0f\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"LD_LIBRARY_PATH")," \u4f86\u78ba\u4fdd\u4f60\u7684\u61c9\u7528\u7a0b\u5f0f\u5728\u5c0b\u627e\u9023\u7d50\u5eab\u7684\u6642\u5019\u4e0d\u8981\u5fd8\u8a18\u53bb\u627e ",(0,i.kt)("inlineCode",{parentName:"p"},"/usr/local/nvidia/lib64"),"."),(0,i.kt)("p",null,"\u6709\u4e86\u4e0a\u8ff0\u9019\u4e09\u500b\u6558\u8ff0\uff0c\u6211\u91cd\u65b0\u6aa2\u8996\u4e86\u4e00\u6b21\u81ea\u5df1\u904b\u884c\u7684 GPU \u61c9\u7528\u7a0b\u5f0f\u3002\n\u9996\u5148, ",(0,i.kt)("inlineCode",{parentName:"p"},"LD_LIBRARY_PATH")," \u6709\u6b63\u78ba\u7684\u8a2d\u5b9a\uff0c\u4f46\u662f\u6211\u5728\u7cfb\u7d71\u4e0a\u537b\u770b\u4e0d\u5230\u4efb\u4f55 ",(0,i.kt)("inlineCode",{parentName:"p"},"/usr/local/nvidia/")," \u4efb\u4f55\u6a94\u6848\uff0c\u9023\u6574\u500b\u8cc7\u6599\u593e\u90fd\u6c92\u6709\uff0c\u4e5f\u5b8c\u5168\u627e\u4e0d\u5230\u4efb\u4f55 ",(0,i.kt)("inlineCode",{parentName:"p"},"libcuda.so.1")," \u7684\u6a94\u6848\u3002"),(0,i.kt)("p",null,"\u6240\u4ee5\u6211\u958b\u59cb\u61f7\u7591 ",(0,i.kt)("inlineCode",{parentName:"p"},"NVIDIA Driver")," \u5230\u5e95\u6709\u6c92\u6709\u6b63\u78ba\u7684\u5b89\u88dd\u6210\u529f?"),(0,i.kt)("p",null,"\u6211\u5011\u91cd\u65b0\u770b\u4e00\u6b21\u8a72\u5b89\u88dd\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"yaml")," \u6a94\u6848\uff0c\u5982\u4e0b"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  name: nvidia-driver-installer\n  namespace: kube-system\n  labels:\n    k8s-app: nvidia-driver-installer\nspec:\n  selector:\n    matchLabels:\n      k8s-app: nvidia-driver-installer\n  updateStrategy:\n    type: RollingUpdate\n  template:\n    metadata:\n      labels:\n        name: nvidia-driver-installer\n        k8s-app: nvidia-driver-installer\n    spec:\n      affinity:\n        nodeAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            nodeSelectorTerms:\n            - matchExpressions:\n              - key: cloud.google.com/gke-accelerator\n                operator: Exists\n      tolerations:\n      - key: "nvidia.com/gpu"\n        effect: "NoSchedule"\n        operator: "Exists"\n      volumes:\n      - name: dev\n        hostPath:\n          path: /dev\n      - name: nvidia-install-dir-host\n        hostPath:\n          path:\n      - name: root-mount\n        hostPath:\n          path: /\n      initContainers:\n      - image: gcr.io/google-containers/ubuntu-nvidia-driver-installer@sha256:eea7309dc4fa4a5c9d716157e74b90826e0a853aa26c7219db4710ddcd1ad8bc\n        name: nvidia-driver-installer\n        resources:\n          requests:\n            cpu: 0.15\n        securityContext:\n          privileged: true\n        env:\n          - name: NVIDIA_INSTALL_DIR_HOST\n            value: /home/kubernetes/bin/nvidia\n          - name: NVIDIA_INSTALL_DIR_CONTAINER\n            value: /usr/local/nvidia\n          - name: ROOT_MOUNT_DIR\n            value: /root\n        volumeMounts:\n        - name: nvidia-install-dir-host\n          mountPath: /usr/local/nvidia\n        - name: dev\n          mountPath: /dev\n        - name: root-mount\n          mountPath: /root\n      containers:\n      - image: "gcr.io/google-containers/pause:2.0"\n        name: pause\n')),(0,i.kt)("p",null,"\u6211\u5011\u53ef\u4ee5\u89c0\u5bdf\u5230\u4e0b\u5217\u5e7e\u500b\u91cd\u9ede"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Init-Container \u7684\u540d\u7a31\u662f ",(0,i.kt)("inlineCode",{parentName:"li"},"nvidia-driver-installer")),(0,i.kt)("li",{parentName:"ol"},"\u8a72 ",(0,i.kt)("inlineCode",{parentName:"li"},"DaemonSet")," \u5c07\u7bc0\u9ede\u4e0a\u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"/home/kubernetes/bin/nvidia")," \u900f\u904e ",(0,i.kt)("inlineCode",{parentName:"li"},"HostPath")," \u65b9\u5f0f\u639b\u8f09\u5230 ",(0,i.kt)("inlineCode",{parentName:"li"},"Init-Container")," \u5167\u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"/usr/local/nvidia"),".")),(0,i.kt)("p",null,"\u63a5\u4e0b\u4f86\u6211\u5011\u4f7f\u7528\u4e0b\u5217\u6307\u4ee4\u53bb\u89c0\u5bdf\u8a72 ",(0,i.kt)("inlineCode",{parentName:"p"},"Init-Container nvidia-driver-installer")," \u7684\u5b89\u88dd\u8a0a\u606f\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"kubectl logs -n kube-system -l name=nvidia-driver-installer -c nvidia-driver-installer\n")),(0,i.kt)("p",null,"\u5176\u8f38\u51fa\u7684\u8cc7\u8a0a\u5982\u4e0b\uff0c\u800c\u4e14 ",(0,i.kt)("inlineCode",{parentName:"p"},"nvidia-smi")," \u7684\u8cc7\u8a0a\u7684\u78ba\u4e5f\u6709\u6293\u5230 ",(0,i.kt)("inlineCode",{parentName:"p"},"Tesla K80")," \u9019\u5f35\u5361\uff0c\u770b\u8d77\u4f86\u4e00\u5207\u90fd\u6b63\u5e38\u3002"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"+ COS_DOWNLOAD_GCS=https://storage.googleapis.com/cos-tools\n+ COS_KERNEL_SRC_GIT=https://chromium.googlesource.com/chromiumos/third_party/kernel\n+ COS_KERNEL_SRC_ARCHIVE=kernel-src.tar.gz\n+ TOOLCHAIN_URL_FILENAME=toolchain_url\n+ CHROMIUMOS_SDK_GCS=https://storage.googleapis.com/chromiumos-sdk\n+ ROOT_OS_RELEASE=/root/etc/os-release\n+ KERNEL_SRC_DIR=/build/usr/src/linux\n+ NVIDIA_DRIVER_VERSION=384.111\n+ NVIDIA_DRIVER_DOWNLOAD_URL_DEFAULT=https://us.download.nvidia.com/tesla/384.111/NVIDIA-Linux-x86_64-384.111.run\n+ NVIDIA_DRIVER_DOWNLOAD_URL=https://us.download.nvidia.com/tesla/384.111/NVIDIA-Linux-x86_64-384.111.run\n+ NVIDIA_INSTALL_DIR_HOST=/home/kubernetes/bin/nvidia\n+ NVIDIA_INSTALL_DIR_CONTAINER=/usr/local/nvidia\n++ basename https://us.download.nvidia.com/tesla/384.111/NVIDIA-Linux-x86_64-384.111.run\n+ NVIDIA_INSTALLER_RUNFILE=NVIDIA-Linux-x86_64-384.111.run\n+ ROOT_MOUNT_DIR=/root\n+ CACHE_FILE=/usr/local/nvidia/.cache\n+ set +x\n[INFO    2018-07-14 14:57:09 UTC] Running on COS build id 10323.85.0\n[INFO    2018-07-14 14:57:09 UTC] Checking if third party kernel modules can be installed\n[INFO    2018-07-14 14:57:09 UTC] Checking cached version\n[INFO    2018-07-14 14:57:09 UTC] Found existing driver installation for image version 10323.85.0           and driver version 384.111.\n[INFO    2018-07-14 14:57:09 UTC] Configuring cached driver installation\n[INFO    2018-07-14 14:57:09 UTC] Updating container's ld cache\n[INFO    2018-07-14 14:57:14 UTC] Verifying Nvidia installation\nSat Jul 14 14:57:15 2018\n+-----------------------------------------------------------------------------+\n| NVIDIA-SMI 384.111                Driver Version: 384.111                   |\n|-------------------------------+----------------------+----------------------+\n| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |\n| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |\n|===============================+======================+======================|\n|   0  Tesla K80           Off  | 00000000:00:04.0 Off |                    0 |\n| N/A   31C    P0    62W / 149W |      0MiB / 11439MiB |    100%      Default |\n+-------------------------------+----------------------+----------------------+\n\n+-----------------------------------------------------------------------------+\n| Processes:                                                       GPU Memory |\n|  GPU       PID   Type   Process name                             Usage      |\n|=============================================================================|\n|  No running processes found                                                 |\n+-----------------------------------------------------------------------------+\n[INFO    2018-07-14 14:57:16 UTC] Found cached version, NOT building the drivers.\n[INFO    2018-07-14 14:57:16 UTC] Updating host's ld cache\n")),(0,i.kt)("p",null,"\u4e0d\u904e\u81f3\u5c11\u6211\u5011\u77e5\u9053\u4e86\uff0c\u8a72 ",(0,i.kt)("inlineCode",{parentName:"p"},"nvidia-driver-installer")," \u6703\u5c07\u76f8\u95dc\u7684\u8cc7\u6e90\u90fd\u5b89\u88dd\u5230 ",(0,i.kt)("inlineCode",{parentName:"p"},"/usr/local/nvidia")," \u800c\u8a72\u8def\u5f91\u5247\u6703\u5c0d\u61c9\u5230\u8a72 GPU \u7bc0\u9ede\u4e0a\u9762\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"/home/kubernetes/bin/nvidia")," \u8cc7\u6599\u593e\u3002"),(0,i.kt)("p",null,"\u9019\u6a23\u60f3\u4e86\u4e00\u4e0b\uff0c\u6211\u89ba\u5f97\u6211\u5011\u7684\u61c9\u7528\u7a0b\u5f0f\u5728\u4f7f\u7528\u7684\u6642\u5019\uff0c\u61c9\u8a72\u8981\u624b\u52d5\u7684\u5c07\u76f8\u95dc\u8cc7\u6e90\u639b\u8f09\u9032\u4f86\uff0c\u6240\u4ee5\u6574\u500b ",(0,i.kt)("inlineCode",{parentName:"p"},"yaml")," \u6a94\u6848\u4fee\u6539\u5982\u4e0b"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: v1\nkind: Pod\nspec:\n  containers:\n  - name: my-gpu-container\n    resources:\n      limits:\n       nvidia.com/gpu: 1\n    volumeMounts:\n    - mountPath: /usr/local/bin/nvidia\n      name: nvidia-debug-tools\n    - mountPath: /usr/local/nvidia/lib64\n      name: nvidia-libraries\n  volumes:\n  - hostPath:\n      path: /home/kubernetes/bin/nvidia/bin\n      type: ""\n    name: nvidia-debug-tools\n  - hostPath:\n      path: /home/kubernetes/bin/nvidia/lib64\n      type: ""\n    name: nvidia-libraries\n')),(0,i.kt)("p",null,"\u6211\u5011\u624b\u52d5\u5c07 GPU \u7bc0\u9ede\u4e0a\u9762\u7684\u6a94\u6848\u639b\u8f09\u5230\u5bb9\u5668\u5167\uff0c\u5176\u5c0d\u61c9\u7684\u8def\u5f91\u5982\u4e0b"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"/home/kubernetes/bin/nvidia/bin"),"  ->  ",(0,i.kt)("inlineCode",{parentName:"p"},"/usr/local/nvidia/lib64"),"\n",(0,i.kt)("inlineCode",{parentName:"p"},"/home/kubernetes/bin/nvidia/lib64")," ->  ",(0,i.kt)("inlineCode",{parentName:"p"},"/usr/local/bin/nvidia")),(0,i.kt)("p",null,"\u63a5\u4e0b\u4f86\u5230\u6211\u5011\u7684\u61c9\u7528\u7a0b\u5f0f\u5167\u5c31\u53ef\u4ee5\u6b63\u78ba\u5730\u627e\u5230\u4e86\u76f8\u95dc\u7684\u6a94\u6848\uff0c\u5982 ",(0,i.kt)("inlineCode",{parentName:"p"},"libcuda.so.1")," \u4ee5\u53ca\u76f8\u95dc\u7684\u6e2c\u8a66\u5de5\u5177\u3002\n\u9019\u6642\u5019\u57f7\u884c\u4e00\u4e0b ",(0,i.kt)("inlineCode",{parentName:"p"},"nvidia-smi")," \u537b\u767c\u73fe\u4e0d\u80fd\u57f7\u884c\uff0c\u6703\u76f4\u63a5\u5f97\u5230\u4e0b\u5217\u7684\u932f\u8aa4"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},'"Failed to initialize NVML: Unknown Error"')),(0,i.kt)("p",null,"\u5617\u8a66 Google \u9019\u985e\u578b\u7684\u932f\u8aa4\u90fd\u6c92\u6709\u8fa6\u6cd5\u627e\u5230\u7b54\u6848\u4f86\u8655\u7406\u9019\u500b\u554f\u984c\uff0c\u6700\u5f8c\u6c7a\u5b9a\u9084\u662f\u81ea\u5df1\u4f86\u7814\u7a76\u4e00\u4e0b\u54ea\u88e1\u51fa\u932f\u4e86\n\u9019\u908a\u4f7f\u7528\u7684\u5de5\u5177\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"strace"),"\uff0c\u80fd\u5920\u986f\u793a\u51fa\u8a72\u61c9\u7528\u7a0b\u5f0f\u904b\u884c\u904e\u7a0b\u4e2d\u547c\u53eb\u5230\u7684\u6240\u6709 ",(0,i.kt)("inlineCode",{parentName:"p"},"system call"),"\uff0c\u662f\u500b\u975e\u5e38\u5f37\u5927\u597d\u7528\u7684\u9664\u932f\u5de5\u5177\u3002"),(0,i.kt)("p",null,"\u8dd1\u4e86\u4e00\u4e0b ",(0,i.kt)("inlineCode",{parentName:"p"},"strace")," \u99ac\u4e0a\u5c31\u767c\u73fe\u4e8b\u60c5\u7684\u4e0d\u5c0d\u52c1\uff0c\u7531\u8a72\u8f38\u51fa\u7d50\u679c\u53ef\u4ee5\u770b\u5230\u985e\u4f3c\u4e0b\u5217\u7684\u932f\u8aa4\u8a0a\u606f(\u539f\u8ad2\u6211\u6c92\u6709\u5b8c\u6574 log)"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"read(/dev/nvidiactl) no permission")),(0,i.kt)("p",null,"\u9019\u908a\u53ef\u4ee5\u770b\u5230 ",(0,i.kt)("inlineCode",{parentName:"p"},"nvidia-smi"),"\u60f3\u8981\u5617\u8a66\u8b80\u53d6 ",(0,i.kt)("inlineCode",{parentName:"p"},"/dev/nvidiactl")," \u7d50\u679c\u537b\u6c92\u6709\u6b0a\u9650\uff0c\u9019\u600e\u50cf\u90fd\u89ba\u5f97\u4e00\u5b9a\u662f\u5bb9\u5668\u6b0a\u9650\u4e0d\u5920\uff0c\u6240\u4ee5\u88dc\u4e0a ",(0,i.kt)("inlineCode",{parentName:"p"},"Privileged")," \u8a66\u8a66\u770b\u3002\n\u5c31\u767c\u73fe\u4e00\u5207\u90fd\u9806\u5229\u4e86, ",(0,i.kt)("inlineCode",{parentName:"p"},"nvidia-smi")," \u4e5f\u4e0d\u6703\u5674\u932f\uff0c\u800c\u61c9\u7528\u7a0b\u5f0f\u4e5f\u80fd\u5920\u9806\u5229\u904b\u884c\u4e86\u3002"),(0,i.kt)("p",null,"\u9644\u4e0a\u6700\u5f8c\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"yaml")," \u6a94\u6848\u5982\u4e0b"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'apiVersion: v1\nkind: Pod\nspec:\n  containers:\n  - name: my-gpu-container\n    resources:\n      limits:\n       nvidia.com/gpu: 1\n    volumeMounts:\n    - mountPath: /usr/local/bin/nvidia\n      name: nvidia-debug-tools\n    - mountPath: /usr/local/nvidia/lib64\n      name: nvidia-libraries\n    securityContext:\n      privileged: true\n  volumes:\n  - hostPath:\n      path: /home/kubernetes/bin/nvidia/bin\n      type: ""\n    name: nvidia-debug-tools\n  - hostPath:\n      path: /home/kubernetes/bin/nvidia/lib64\n      type: ""\n    name: nvidia-libraries\n')),(0,i.kt)("h1",{id:"summary"},"Summary"),(0,i.kt)("p",null,"\u7e3d\u7d50\u4e00\u4e0b\u4e0a\u8ff0\u7684\u6240\u6709\u6b77\u7a0b"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"\u5982\u679c\u4eca\u5929 GKE \u7684\u7248\u672c\u662f 1.9 \u4e4b\u5f8c\uff0c\u6211\u5011\u53ea\u9700\u8981\u904b\u884c\u4e00\u500b ",(0,i.kt)("inlineCode",{parentName:"li"},"DaemonSet")," \u53bb\u5b89\u88dd ",(0,i.kt)("inlineCode",{parentName:"li"},"NVIDIA Driver")," \u5373\u53ef\uff0c ",(0,i.kt)("inlineCode",{parentName:"li"},"Device Plugin")," \u6703\u81ea\u5df1\u88ab\u904b\u884c"),(0,i.kt)("li",{parentName:"ol"},"CUDA \u76f8\u95dc\u7684\u8cc7\u6e90\u90fd\u9700\u8981\u81ea\u5df1\u5f9e GPU \u7bc0\u9ede\u4e0a\u639b\u8f09\u5230\u6240\u6709\u904b\u884c\u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"Pod")," \u4e2d"),(0,i.kt)("li",{parentName:"ol"},"\u8a18\u5f97\u8a2d\u5b9a ",(0,i.kt)("inlineCode",{parentName:"li"},"privileged=true")," \u5230\u6240\u6709\u4f7f\u7528 GPU \u7684\u7bc0\u9ede\u4e0a\u3002")))}m.isMDXComponent=!0}}]);
"use strict";(self.webpackChunkhwchiu=self.webpackChunkhwchiu||[]).push([[17387],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>f});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=r.createContext({}),s=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=s(e.components);return r.createElement(c.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,c=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=s(n),m=o,f=p["".concat(c,".").concat(m)]||p[m]||d[m]||a;return n?r.createElement(f,i(i({ref:t},u),{},{components:n})):r.createElement(f,i({ref:t},u))}));function f(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=m;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l[p]="string"==typeof e?e:o,i[1]=l;for(var s=2;s<a;s++)i[s]=n[s];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},43855:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>s});var r=n(87462),o=(n(67294),n(3905));const a={title:"Kubernetes GKE \u7dad\u904b\u4e0a\u5c0f\u7b46\u8a18",authors:"hwchiu",tags:["Kubernetes","GKE"]},i=void 0,l={permalink:"/2023/06/11/k8s",source:"@site/blog/2023/06-11-k8s.md",title:"Kubernetes GKE \u7dad\u904b\u4e0a\u5c0f\u7b46\u8a18",description:"GKE \u74b0\u5883\u4e0a\u53ef\u4ee5\u555f\u52d5 CA(Cluster-Autoscaling) \u4f86\u6839\u64da\u8cc7\u6e90\u4f7f\u7528\u91cf\u8abf\u6574\u7bc0\u9ede\u7684\u6578\u91cf\uff0c\u53ef\u4ee5\u8996\u70ba\u7bc0\u9ede\u5c64\u7d1a\u7684 HPA",date:"2023-06-11T00:00:00.000Z",formattedDate:"June 11, 2023",tags:[{label:"Kubernetes",permalink:"/tags/kubernetes"},{label:"GKE",permalink:"/tags/gke"}],readingTime:2.11,hasTruncateMarker:!1,authors:[{name:"HungWei Chiu",title:"Blogger",url:"https://github.com/hwchiu",imageURL:"https://github.com/hwchiu.png",key:"hwchiu"}],frontMatter:{title:"Kubernetes GKE \u7dad\u904b\u4e0a\u5c0f\u7b46\u8a18",authors:"hwchiu",tags:["Kubernetes","GKE"]},prevItem:{title:"terraform",permalink:"/2023/06/21/terraform"},nextItem:{title:"Git \u4fee\u6539 author/committer",permalink:"/2023/06/06/git"}},c={authorsImageUrls:[void 0]},s=[],u={toc:s},p="wrapper";function d(e){let{components:t,...n}=e;return(0,o.kt)(p,(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"GKE \u74b0\u5883\u4e0a\u53ef\u4ee5\u555f\u52d5 CA(Cluster-Autoscaling) \u4f86\u6839\u64da\u8cc7\u6e90\u4f7f\u7528\u91cf\u8abf\u6574\u7bc0\u9ede\u7684\u6578\u91cf\uff0c\u53ef\u4ee5\u8996\u70ba\u7bc0\u9ede\u5c64\u7d1a\u7684 HPA"),(0,o.kt)("p",null,"\u57fa\u672c\u4e0a\u53ea\u8981\u7bc0\u9ede\u7684\u8cc7\u6e90\u4f7f\u7528\u7387\u904e\u4f4e\uff0c\u8a72\u7bc0\u9ede\u5c31\u6703\u88ab\u5617\u8a66\u56de\u6536\u4e26\u4e14\u5c07\u6240\u6709\u7684 Workload \u90fd\u8f49\u79fb\u5230\u5176\u4ed6\u7684\u7bc0\u9ede"),(0,o.kt)("p",null,"\u5982\u679c\u6709\u7279\u5225\u7279\u5225\u91cd\u8981\u7684 Pod \u5e0c\u671b\u8a72 Pod \u80fd\u5920\u6291\u5236 CA \u7684\u884c\u70ba\uff0c\u6709\u8a72 Pod \u904b\u884c\u7684\u7bc0\u9ede\u90fd\u4e0d\u80fd\u88ab\u8e22\u9664\u56de\u6536\u7684\u8a71\uff0c\u53ef\u4ee5\u65bc\nannotations \u4e2d\u52a0\u5165\u4e0b\u5217\u8a2d\u5b9a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"    cluster-autoscaler.kubernetes.io/safe-to-evict: 'false'\n")),(0,o.kt)("p",null,"\u8a72\u7bc0\u9ede\u5c31\u6703\u8b93\u7bc0\u9ede\u6c92\u6709\u8fa6\u6cd5\u9806\u5229\u8e22\u9664\u56e0\u6b64\u6700\u5f8c\u4e0d\u6703\u56de\u6536\u8a72\u7bc0\u9ede\uff0c\u8a72\u6307\u4ee4\u4e5f\u8981\u5c0f\u5fc3\u4f7f\u7528\uff0c\u82e5\u7528\u4e0d\u597d\u53ef\u80fd\u6703\u5c0e\u81f4\u7bc0\u9ede\u8cc7\u6e90\u4f7f\u7528\u7387\u904e\u4f4e\u6700\u5f8c\u7522\u751f\u984d\u5916\u7684\u82b1\u8cbb\u3002"),(0,o.kt)("p",null,"\u61c9\u7528\u7a0b\u5f0f\u672c\u8eab\u9700\u8981\u66f4\u9577\u6642\u9593\u53bb\u8abf\u6574 GracePeriod (\u9810\u8a2d 30 \u79d2)\uff0c\u53ef\u4ee5\u76f4\u63a5\u4fee\u6539 pod.spec.terminationGracePeriodSeconds \u6b64\u6b04\u4f4d\u5373\u53ef"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ kc explain pod.spec.terminationGracePeriodSeconds\nKIND:     Pod\nVERSION:  v1\n\nFIELD:    terminationGracePeriodSeconds <integer>\n\nDESCRIPTION:\n     Optional duration in seconds the pod needs to terminate gracefully. May be\n     decreased in delete request. Value must be non-negative integer. The value\n     zero indicates stop immediately via the kill signal (no opportunity to shut\n     down). If this value is nil, the default grace period will be used instead.\n     The grace period is the duration in seconds after the processes running in\n     the pod are sent a termination signal and the time when the processes are\n     forcibly halted with a kill signal. Set this value longer than the expected\n     cleanup time for your process. Defaults to 30 seconds.\n")),(0,o.kt)("p",null,"\u7c21\u6613 bash \u8173\u672c\u53ef\u4ee5\u5099\u4efd\u76ee\u524d\u74b0\u5883\u4e2d\u7684\u6240\u6709 secret \u7269\u4ef6"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"function dump_secret {\n  for i in $(kubectl -n $1 get --no-headers secret | awk '{print $1}'); do\n    kubectl -n $1 get secret -o yaml $i > $i.yaml;\n  done\n}\n\nfunction dump_secrets {\n  for i in $(kubectl get ns --no-headers | awk '{print $1}'); do\n      if [ ! -d \"./$i\" ]; then\n          mkdir $i\n      fi\n      echo \"Dump $i\"\n      cd $i\n      dump_secret $i\n      cd ..\n  done\n}\n")))}d.isMDXComponent=!0}}]);
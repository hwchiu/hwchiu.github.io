"use strict";(self.webpackChunkhwchiu=self.webpackChunkhwchiu||[]).push([[38422],{3905:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>k});var r=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=r.createContext({}),l=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},d=function(e){var n=l(e.components);return r.createElement(s.Provider,{value:n},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,d=p(e,["components","mdxType","originalType","parentName"]),u=l(t),m=a,k=u["".concat(s,".").concat(m)]||u[m]||c[m]||i;return t?r.createElement(k,o(o({ref:n},d),{},{components:t})):r.createElement(k,o({ref:n},d))}));function k(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var i=t.length,o=new Array(i);o[0]=m;var p={};for(var s in n)hasOwnProperty.call(n,s)&&(p[s]=n[s]);p.originalType=e,p[u]="string"==typeof e?e:a,o[1]=p;for(var l=2;l<i;l++)o[l]=t[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},80535:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>c,frontMatter:()=>i,metadata:()=>p,toc:()=>l});var r=t(87462),a=(t(67294),t(3905));const i={title:"Kubernetes & CRI (I)",sidebar_position:4,date:new Date("2019-09-20T07:23:43.000Z"),tags:["Kubernetes","CRI","Container","iThome"],description:"\u672c\u7bc7\u6587\u7ae0\u6703\u958b\u59cb\u63a2\u8a0e kubernetes Container Runtime Interface \u7684\u6982\u5ff5\u8207\u8a2d\u8a08\uff0c\u4e26\u4e14\u8a0e\u8ad6\u5176\u9918 OCI \u7684\u95dc\u4fc2\uff0c\u6700\u5f8c\u4ecb\u7d39\u4e86 Docker/Containerd \u9019\u4e9b\u4e0d\u7684 Container \u89e3\u6c7a\u65b9\u6848\u662f\u5982\u4f55\u65bc Kubernetes \u5171\u5b58\u7684"},o="\u524d\u8a00",p={unversionedId:"2019/iThome_Challenge/k8s-cri-i",id:"2019/iThome_Challenge/k8s-cri-i",title:"Kubernetes & CRI (I)",description:"\u672c\u7bc7\u6587\u7ae0\u6703\u958b\u59cb\u63a2\u8a0e kubernetes Container Runtime Interface \u7684\u6982\u5ff5\u8207\u8a2d\u8a08\uff0c\u4e26\u4e14\u8a0e\u8ad6\u5176\u9918 OCI \u7684\u95dc\u4fc2\uff0c\u6700\u5f8c\u4ecb\u7d39\u4e86 Docker/Containerd \u9019\u4e9b\u4e0d\u7684 Container \u89e3\u6c7a\u65b9\u6848\u662f\u5982\u4f55\u65bc Kubernetes \u5171\u5b58\u7684",source:"@site/docs/2019/iThome_Challenge/k8s-cri-i.md",sourceDirName:"2019/iThome_Challenge",slug:"/2019/iThome_Challenge/k8s-cri-i",permalink:"/docs/2019/iThome_Challenge/k8s-cri-i",draft:!1,tags:[{label:"Kubernetes",permalink:"/docs/tags/kubernetes"},{label:"CRI",permalink:"/docs/tags/cri"},{label:"Container",permalink:"/docs/tags/container"},{label:"iThome",permalink:"/docs/tags/i-thome"}],version:"current",lastUpdatedBy:"HWC",sidebarPosition:4,frontMatter:{title:"Kubernetes & CRI (I)",sidebar_position:4,date:"2019-09-20T07:23:43.000Z",tags:["Kubernetes","CRI","Container","iThome"],description:"\u672c\u7bc7\u6587\u7ae0\u6703\u958b\u59cb\u63a2\u8a0e kubernetes Container Runtime Interface \u7684\u6982\u5ff5\u8207\u8a2d\u8a08\uff0c\u4e26\u4e14\u8a0e\u8ad6\u5176\u9918 OCI \u7684\u95dc\u4fc2\uff0c\u6700\u5f8c\u4ecb\u7d39\u4e86 Docker/Containerd \u9019\u4e9b\u4e0d\u7684 Container \u89e3\u6c7a\u65b9\u6848\u662f\u5982\u4f55\u65bc Kubernetes \u5171\u5b58\u7684"},sidebar:"techPost",previous:{title:"\u6dfa\u8ac7 Container \u5be6\u73fe\u539f\u7406, \u4ee5 Docker \u70ba\u4f8b(III)",permalink:"/docs/2019/iThome_Challenge/container-design-iii"},next:{title:"Kubernetes & CRI (II) - containerd",permalink:"/docs/2019/iThome_Challenge/k8s-cri-ii"}},s={},l=[{value:"Docker &amp; Kubernetes",id:"docker--kubernetes",level:2}],d={toc:l},u="wrapper";function c(e){let{components:n,...t}=e;return(0,a.kt)(u,(0,r.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"\u524d\u8a00"},"\u524d\u8a00"),(0,a.kt)("p",null,"\u524d\u5e7e\u5929\u63a2\u8a0e\u4e86\u95dc\u65bc ",(0,a.kt)("inlineCode",{parentName:"p"},"Container")," \u7684\u4e00\u4e9b\u57fa\u672c\u6982\u5ff5\uff0c\u8b6c\u5982\u76f8\u95dc\u7684\u958b\u653e\u6a19\u6e96 ",(0,a.kt)("inlineCode",{parentName:"p"},"Open Container Initiative")," \u4ee5\u53ca ",(0,a.kt)("inlineCode",{parentName:"p"},"Linux")," \u4e0b\u7684\u5be6\u73fe\u65b9\u5f0f ",(0,a.kt)("inlineCode",{parentName:"p"},"Namespace ..etc")),(0,a.kt)("p",null,"\u63a5\u4e0b\u4f86\u6211\u5011\u8981\u6b63\u5f0f\u7684\u8d70\u5230 ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u7684\u67b6\u69cb\u4e2d\uff0c\u4f86\u63a2\u8a0e ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u518d ",(0,a.kt)("inlineCode",{parentName:"p"},"container")," \u9019\u4e00\u584a\u662f\u600e\u9ebc\u8655\u7406\u8207\u8a2d\u8a08\u7684\u3002"),(0,a.kt)("p",null,"\u96d6\u7136 ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u5df2\u767c\u5c55\u6578\u5e74\uff0c\u5176\u706b\u7d05\u7a0b\u5ea6\u4e5f\u5e2d\u6372\u6574\u500b\u7522\u696d\uff0c\u7136\u800c\u6211\u81ea\u5df1\u7684\u89c0\u5bdf\u7d50\u679c\u9084\u662f\u6eff\u591a\u4eba\u5c0d ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u6709\u4e00\u4e9b\u8aa4\u89e3\uff0c\u8a8d\u70ba ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"docker container")," \u7684\u7ba1\u7406\u5de5\u5177\uff0c\u4e8b\u5be6\u4e0a\u5f9e ",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io"},"kubernetes \u5b98\u7db2")," \u4e2d\u5c31\u76f4\u63a5\u660e\u78ba\u8aaa\u660e"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Kubernetes (K8s) is an open-source system for automating deployment, scaling, and management of containerized applications.")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u662f\u7528\u4f86\u7ba1\u7406 ",(0,a.kt)("inlineCode",{parentName:"p"},"containerized applications")," \u4e26\u4e0d\u662f\u5c08\u5c6c\u65bc ",(0,a.kt)("inlineCode",{parentName:"p"},"docker")," \u7368\u4eab\uff0c\u4f5c\u70ba\u4e00\u500b ",(0,a.kt)("inlineCode",{parentName:"p"},"container orchestrator")," \u7684\u89d2\u8272\uff0c ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u5e0c\u671b\u80fd\u5920\u7ba1\u7406\u6240\u6709\u5bb9\u5668\u5316\u7684\u61c9\u7528\u7a0b\u5f0f\u3002"),(0,a.kt)("p",null,"\u770b\u5230\u9019\u908a\u5927\u6982\u5c31\u53ef\u4ee5\u60f3\u5230\u5c31\u5982\u540c ",(0,a.kt)("inlineCode",{parentName:"p"},"Open Container Initiative (OCI)")," \u4e00\u6a23\uff0c\u70ba\u4e86\u80fd\u5920\u6709\u6548\u5730\u929c\u63a5\u5404\u5f0f\u5404\u6a23\u4e0d\u540c\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Container Runtime")," \u89e3\u6c7a\u65b9\u6848\uff0c\u52e2\u5fc5\u4e5f\u9700\u8981\u63a8\u51fa\u76f8\u95dc\u7684\u6a19\u6e96\uff0c\u5c31\u5982\u540c ",(0,a.kt)("inlineCode",{parentName:"p"},"OCI")," \u4e00\u6a23\uff0c\u7b26\u5408\u6a19\u6e96\u7684\u89e3\u6c7a\u65b9\u6848\u5c31\u80fd\u5920\u8f15\u9b06\u7684\u6574\u5408\u5230 ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u4e4b\u4e2d\u3002\u65bc\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"Container Runtime Interface(CRI)")," \u6a19\u6e96\u5c31\u88ab\u8a2d\u8a08\u4e14\u958b\u767c\u4f86"),(0,a.kt)("p",null,"\u63a5\u4e0b\u4f86\u6211\u5011\u5c07\u91dd\u5c0d\u9019\u500b\u6982\u5ff5\u4f86\u7d30\u7d30\u8a34\u8aaa\uff0c\u5230\u5e95\u4ec0\u9ebc\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"Container Runtime Interface(CRI)")," \u4ee5\u53ca\u5176\u5982\u4f55\u904b\u4f5c\u3002"),(0,a.kt)("h1",{id:"container-runtime-interface-cri"},"Container Runtime Interface (CRI)"),(0,a.kt)("p",null,"\u5c0d\u65bc ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u4f86\u8aaa\uff0c\u5e0c\u671b\u80fd\u5920\u900f\u904e\u4e00\u500b\u6a19\u6e96\u4ecb\u9762\u8207\u5404\u500b ",(0,a.kt)("inlineCode",{parentName:"p"},"contaienr rumtime")," \u89e3\u6c7a\u65b9\u6848\u929c\u63a5\uff0c\u9019\u500b\u929c\u63a5\u7684\u63a5\u53e3\u6a19\u6e96\u5c31\u662f\u6240\u8b02\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Container Runtime")),(0,a.kt)("p",null,"\u70ba\u4e86\u66f4\u52a0\u6e05\u695a\u7406\u89e3 ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI")," \u7684\u5b9a\u4f4d\uff0c\u6211\u5011\u7528\u4e0b\u5217\u7684\u8868\u683c\u4f86\u89e3\u91cb\n\u8868\u683c\u5217\u51fa\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u8207 ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI Runtime")," \u5404\u81ea\u7684\u8cac\u4efb"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Kubernetes"),(0,a.kt)("th",{parentName:"tr",align:null},"CRI Runtime"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Kubernetes Resources/API"),(0,a.kt)("td",{parentName:"tr",align:null},"Pod Life Cycle (Add/Delete)")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Storage  (CSI)"),(0,a.kt)("td",{parentName:"tr",align:null},"Image management")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Networking (CNI)"),(0,a.kt)("td",{parentName:"tr",align:null},"Status")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},"Dispatcher"),(0,a.kt)("td",{parentName:"tr",align:null},"Container Operations (attatch/exec)")))),(0,a.kt)("p",null,"\u57fa\u672c\u4e0a ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI Runtime")," \u5f88\u985e\u4f3c\u524d\u8ff0\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Containerd")," \u4e00\u6a23\uff0c\u80fd\u5920\u6839\u64da\u9700\u6c42\u7522\u751f\u51fa\u7b26\u5408 ",(0,a.kt)("inlineCode",{parentName:"p"},"OCI")," \u6a19\u6e96\u7684\u5bb9\u5668\u61c9\u7528\u7a0b\u5f0f\uff0c\u4f46\u662f\u57fa\u672c\u55ae\u4f4d\u4e0d\u518d\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"Container")," \u800c\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"Pod"),"\u3002\n\u800c ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u672c\u8eab\u5efa\u7bc9\u5728\u9019\u4e9b\u57fa\u790e\u4e4b\u4e0a\uff0c\u63d0\u4f9b\u66f4\u8c50\u5bcc\u7684\u61c9\u7528\u8207 API \u4f9b\u4f7f\u7528\u8005\u4f7f\u7528\u3002"),(0,a.kt)("p",null,"\u9019\u5169\u8005\u4e4b\u9593\u7684\u6e9d\u901a\u6a4b\u6a11\u5c31\u662f\u6240\u8b02\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI"),"\u3002"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"CRI")," \u6240\u8b02\u7684\u6a19\u6e96\u5176\u5be6\u975e\u5e38\u7c21\u55ae\uff0c\u5c31\u662f\u6240\u8b02\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"protobuf")," \u7684 ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/cri-api/pkg/apis/runtime/v1alpha2/api.proto"},"API \u4ecb\u9762"),"\uff0c"),(0,a.kt)("p",null,"\u5f9e\u5b98\u65b9\u64f7\u53d6\u8a72\u4ecb\u9762\u8cc7\u8a0a\u5982\u4e0b\uff0c\u4ed4\u7d30\u89c0\u5bdf\u4f60\u53ef\u4ee5\u88e1\u9762\u6709 ",(0,a.kt)("inlineCode",{parentName:"p"},"Pod")," \u4e5f\u6709 ",(0,a.kt)("inlineCode",{parentName:"p"},"Container"),"\uff0c\u540c\u6642\u4e5f\u6db5\u84cb\u4e86\u5404\u5f0f\u5404\u6a23\u7684\u64cd\u4f5c\uff0c\u5982 ",(0,a.kt)("inlineCode",{parentName:"p"},"Run"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"Stop"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"List"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"Remove"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"Start"),","),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go="},"// Runtime service defines the public APIs for remote container runtimes\nservice RuntimeService {\n    // Version returns the runtime name, runtime version, and runtime API version.\n    rpc Version(VersionRequest) returns (VersionResponse) {}\n\n    // RunPodSandbox creates and starts a pod-level sandbox. Runtimes must ensure\n    // the sandbox is in the ready state on success.\n    rpc RunPodSandbox(RunPodSandboxRequest) returns (RunPodSandboxResponse) {}\n    // StopPodSandbox stops any running process that is part of the sandbox and\n    // reclaims network resources (e.g., IP addresses) allocated to the sandbox.\n    // If there are any running containers in the sandbox, they must be forcibly\n    // terminated.\n    // This call is idempotent, and must not return an error if all relevant\n    // resources have already been reclaimed. kubelet will call StopPodSandbox\n    // at least once before calling RemovePodSandbox. It will also attempt to\n    // reclaim resources eagerly, as soon as a sandbox is not needed. Hence,\n    // multiple StopPodSandbox calls are expected.\n    rpc StopPodSandbox(StopPodSandboxRequest) returns (StopPodSandboxResponse) {}\n    // RemovePodSandbox removes the sandbox. If there are any running containers\n    // in the sandbox, they must be forcibly terminated and removed.\n    // This call is idempotent, and must not return an error if the sandbox has\n    // already been removed.\n    rpc RemovePodSandbox(RemovePodSandboxRequest) returns (RemovePodSandboxResponse) {}\n    // PodSandboxStatus returns the status of the PodSandbox. If the PodSandbox is not\n    // present, returns an error.\n    rpc PodSandboxStatus(PodSandboxStatusRequest) returns (PodSandboxStatusResponse) {}\n    // ListPodSandbox returns a list of PodSandboxes.\n    rpc ListPodSandbox(ListPodSandboxRequest) returns (ListPodSandboxResponse) {}\n\n    // CreateContainer creates a new container in specified PodSandbox\n    rpc CreateContainer(CreateContainerRequest) returns (CreateContainerResponse) {}\n    // StartContainer starts the container.\n    rpc StartContainer(StartContainerRequest) returns (StartContainerResponse) {}\n    // StopContainer stops a running container with a grace period (i.e., timeout).\n    // This call is idempotent, and must not return an error if the container has\n    // already been stopped.\n    // TODO: what must the runtime do after the grace period is reached?\n    rpc StopContainer(StopContainerRequest) returns (StopContainerResponse) {}\n    // RemoveContainer removes the container. If the container is running, the\n    // container must be forcibly removed.\n    // This call is idempotent, and must not return an error if the container has\n    // already been removed.\n    rpc RemoveContainer(RemoveContainerRequest) returns (RemoveContainerResponse) {}\n    // ListContainers lists all containers by filters.\n    rpc ListContainers(ListContainersRequest) returns (ListContainersResponse) {}\n    // ContainerStatus returns status of the container. If the container is not\n    // present, returns an error.\n    rpc ContainerStatus(ContainerStatusRequest) returns (ContainerStatusResponse) {}\n    // UpdateContainerResources updates ContainerConfig of the container.\n    rpc UpdateContainerResources(UpdateContainerResourcesRequest) returns (UpdateContainerResourcesResponse) {}\n    // ReopenContainerLog asks runtime to reopen the stdout/stderr log file\n    // for the container. This is often called after the log file has been\n    // rotated. If the container is not running, container runtime can choose\n    // to either create a new log file and return nil, or return an error.\n    // Once it returns error, new container log file MUST NOT be created.\n    rpc ReopenContainerLog(ReopenContainerLogRequest) returns (ReopenContainerLogResponse) {}\n\n    // ExecSync runs a command in a container synchronously.\n    rpc ExecSync(ExecSyncRequest) returns (ExecSyncResponse) {}\n    // Exec prepares a streaming endpoint to execute a command in the container.\n    rpc Exec(ExecRequest) returns (ExecResponse) {}\n    // Attach prepares a streaming endpoint to attach to a running container.\n    rpc Attach(AttachRequest) returns (AttachResponse) {}\n    // PortForward prepares a streaming endpoint to forward ports from a PodSandbox.\n    rpc PortForward(PortForwardRequest) returns (PortForwardResponse) {}\n\n    // ContainerStats returns stats of the container. If the container does not\n    // exist, the call returns an error.\n    rpc ContainerStats(ContainerStatsRequest) returns (ContainerStatsResponse) {}\n    // ListContainerStats returns stats of all running containers.\n    rpc ListContainerStats(ListContainerStatsRequest) returns (ListContainerStatsResponse) {}\n\n    // UpdateRuntimeConfig updates the runtime configuration based on the given request.\n    rpc UpdateRuntimeConfig(UpdateRuntimeConfigRequest) returns (UpdateRuntimeConfigResponse) {}\n\n    // Status returns the status of the runtime.\n    rpc Status(StatusRequest) returns (StatusResponse) {}\n}\n")),(0,a.kt)("p",null,"\u7531\u65bc ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI")," \u7684\u6a19\u6e96\u5c31\u662f\u4e00\u4e9b\u76f8\u95dc\u7684\u4ecb\u9762\uff0c\u9019\u610f\u5473\u53ea\u8981\u4efb\u4f55 ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI Runtime")," \u6709\u5be6\u4f5c\u9019\u4e9b\u4ecb\u9762\uff0c\u90fd\u53ef\u4ee5\u8ddf ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u929c\u63a5\u4f86\u8655\u7406\u6240\u6709\u8ddf ",(0,a.kt)("inlineCode",{parentName:"p"},"Pod")," \u6709\u95dc\u7684\u64cd\u4f5c\u3002"),(0,a.kt)("p",null,"\u5269\u4e0b\u7684\u4e00\u500b\u554f\u984c\u5c31\u662f\uff0c \u4e4b\u524d\u6240\u63a2\u8a0e\u904e\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"docker")," \u904b\u4f5c\u6d41\u7a0b"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},(0,a.kt)("inlineCode",{parentName:"p"},"docker client")," -> ",(0,a.kt)("inlineCode",{parentName:"p"},"docker engine")," -> ",(0,a.kt)("inlineCode",{parentName:"p"},"docker-containerd")," -> ",(0,a.kt)("inlineCode",{parentName:"p"},"docker-containerd-shim")," -> ",(0,a.kt)("inlineCode",{parentName:"p"},"runc")," -> ",(0,a.kt)("inlineCode",{parentName:"p"},"container"))),(0,a.kt)("p",null,"\u9019\u500b\u67b6\u69cb\u8981\u600e\u9ebc\u8ddf ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes & CRI")," \u6574\u5408?"),(0,a.kt)("h2",{id:"docker--kubernetes"},"Docker & Kubernetes"),(0,a.kt)("p",null,"\u89e3\u91cb ",(0,a.kt)("inlineCode",{parentName:"p"},"Docker")," \u8207 ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u7684\u6700\u597d\u65b9\u6cd5\u5c31\u662f\u95b1\u8b80\u5b98\u65b9\u90e8\u843d\u683c\u7684\u6587\u7ae0 ",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/blog/2018/05/24/kubernetes-containerd-integration-goes-ga/"},"kubernetes-containerd-integration-goes-ga"),"\u3002 \u70ba\u4e86\u7bc0\u7701\u8b80\u8005\u7684\u6642\u9593\uff0c\u63a5\u4e0b\u4f86\u5c31\u5e6b\u5927\u5bb6\u5c0e\u8b80\u4e00\u4e0b\u9019\u7bc7\u6587\u7ae0\uff0c\u4ee5\u4e0b\u7684\u5716\u7247\u90fd\u4f86\u81ea\u65bc\u4e0a\u8ff0\u7684",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/blog/2018/05/24/kubernetes-containerd-integration-goes-ga/"},"\u5b98\u65b9\u90e8\u843d\u683c")),(0,a.kt)("p",null,"\u4e0a\u9762\u63d0\u5230 ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI")," \u672c\u8eab\u662f\u500b\u6e9d\u901a\u4ecb\u9762\uff0c\u9019\u4ee3\u8868\u6e9d\u901a\u7684\u5169\u65b9\u90fd\u9700\u8981\u6839\u64da\u9019\u500b\u754c\u9762\u53bb\u5be6\u73fe\u8207\u6eff\u8db3\u3002 \u5c0d\u65bc ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u4f86\u8aaa\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"kubelet")," \u81ea\u5df1\u7dad\u8b77\u8207\u958b\u767c\u7684\uff0c\u8981\u652f\u63f4 ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI")," \u672c\u8eab\u5c31\u4e0d\u662f\u4ec0\u9ebc\u56f0\u96e3\u7684\u4e8b\u60c5\u3002"),(0,a.kt)("p",null,"\u4f46\u662f\u53e6\u5916\u4e00\u7aef\u5982\u679c\u8981\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"docker")," \u7684\u8a71\uff0c\u90a3\u5230\u5e95\u8981\u600e\u9ebc\u8fa6?\n",(0,a.kt)("inlineCode",{parentName:"p"},"docker")," \u80cc\u5f8c\u4e5f\u662f\u6709\u516c\u53f8\u518d\u7d93\u71df\uff0c\u4e5f\u4e0d\u662f\u8aaa\u6539\u5c31\u6539\uff0c\u9019\u7a2e\u60c5\u6cc1\u4e0b\u5230\u5e95\u8981\u5982\u4f55\u5c07 ",(0,a.kt)("inlineCode",{parentName:"p"},"docker")," \u7d66\u6574\u5408\u9032\u4f86\uff1f"),(0,a.kt)("p",null,"\u6700\u76f4\u89c0\u7684\u60f3\u6cd5\u5c31\u662f\u5982\u679c\u6c92\u6709\u8fa6\u6cd5\u4f7f\u5f97 ",(0,a.kt)("inlineCode",{parentName:"p"},"docker"),"  \u672c\u8eab\u652f\u63f4 ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI")," \u7684\u6a19\u6e96\uff0c\u90a3\u5c31\u984d\u5916\u64b0\u5beb\u4e00\u500b\u8f49\u63a5\u5668\uff0c\u5176\u904b\u4f5c\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"kubelet")," \u8207 ",(0,a.kt)("inlineCode",{parentName:"p"},"Docker"),"\uff0c\u8a72\u61c9\u7528\u7a0b\u5f0f\u4e0a\u627f ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI")," \u8207 ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u6e9d\u901a\uff0c\u4e0b\u627f ",(0,a.kt)("inlineCode",{parentName:"p"},"Docker API")," \u8207 ",(0,a.kt)("inlineCode",{parentName:"p"},"Docker Engine")," \u6e9d\u901a"),(0,a.kt)("p",null,"\u65e9\u671f\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u63a1\u53d6\u4e86\u9019\u7a2e\u505a\u6cd5\uff0c",(0,a.kt)("inlineCode",{parentName:"p"},"kuberlet")," \u5167\u5efa\u76f8\u95dc\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"dockershim")," \u7684\u7a0b\u5f0f\u78bc\u4f86\u8655\u7406\u9019\u6bb5\u908f\u8f2f\u3002\u9019\u7a2e\u505a\u6cd5\u53ef\u884c\uff0c\u4f46\u662f\u5176\u5be6\u6548\u80fd\u5927\u5927\u5247\u6263\uff0c\u540c\u6642\u4e5f\u628a\u6574\u9ad4\u67b6\u69cb\u5e36\u5230\u4e86\u66f4\u8907\u96dc\u7684\u5883\u754c\uff0c\u5f15\u9032\u6108\u4f86\u6108\u591a\u7684\u5143\u4ef6\u6703\u5c0d\u958b\u767c\u8207\u9664\u932f\u5e36\u4f86\u66f4\u5927\u7684\u6210\u672c\u3002"),(0,a.kt)("p",null,"\u53ef\u4ee5\u53c3\u8003\u4e0b\u5716\u4e2d\u7684\u4e0a\u534a\u90e8\u4efd\uff0c\u800c\u5716\u4e2d\u7684\u4e0b\u534a\u90e8\u5206\u5247\u662f\u5f8c\u4f86\u7684\u6539\u8b8a\u4e4b\u8655"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/2XQwc9B.png",alt:null}),"\n(\u5716\u7247\u64f7\u53d6\u81ea\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/blog/2018/05/24/kubernetes-containerd-integration-goes-ga/"},"kubernetes blog kubernetes-containerd-integration-goes-ga"),")"),(0,a.kt)("p",null,"\u53cd\u6b63\u6700\u5f8c\u90fd\u662f\u900f\u904e ",(0,a.kt)("inlineCode",{parentName:"p"},"containerd")," \u9032\u884c\u64cd\u4f5c\uff0c\u800c\u672c\u8eab\u4e5f\u4e0d\u592a\u9700\u8981 ",(0,a.kt)("inlineCode",{parentName:"p"},"docker")," \u81ea\u5df1\u7684\u529f\u80fd\uff0c\u90a3\u662f\u5426\u5c31\u76f4\u63a5\u5c07 ",(0,a.kt)("inlineCode",{parentName:"p"},"dockershim")," \u6e9d\u901a\u7684\u89d2\u8272\u5f9e ",(0,a.kt)("inlineCode",{parentName:"p"},"docker engine")," \u8f49\u79fb\u5230 ",(0,a.kt)("inlineCode",{parentName:"p"},"containerd")," \u5373\u53ef\u3002 \u56e0\u6b64\u5f8c\u4f86\u53c8\u6709\u6240\u8b02\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI-Containerd")," \u7684\u51fa\u73fe\u3002"),(0,a.kt)("p",null,"\u5230\u9019\u500b\u968e\u6bb5\uff0c\u5df2\u7d93\u6e1b\u5c11\u4e86\u4e00\u500b\u6e9d\u901a\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Daemon"),", \u4e5f\u5c31\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"docker engine"),"\u3002 \u4f46\u662f\u9019\u6a23\u4e26\u4e0d\u80fd\u6eff\u8db3\u60f3\u8981\u6700\u4f73\u5316\u7684\u5fc3\u60c5\u3002"),(0,a.kt)("p",null,"\u4f34\u96a8\u8005 ",(0,a.kt)("inlineCode",{parentName:"p"},"Containerd")," \u672c\u8eab\u7684\u529f\u80fd\u958b\u767c\uff0c\u63d0\u4f9b\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"Plugin")," \u9019\u7a2e\u5916\u639b\u529f\u80fd\u7684\u7279\u8272\u5f8c\uff0c\u5c07 ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI-Containerd")," \u7684\u529f\u80fd\u76f4\u63a5\u6574\u5408\u5230\u8a72 ",(0,a.kt)("inlineCode",{parentName:"p"},"Plugin")," \u5167\u5c31\u53ef\u4ee5\u76f4\u63a5\u518d\u6b21\u6e1b\u5c11\u4e00\u500b\u5143\u4ef6\uff0c\u76f4\u63a5\u8b93 ",(0,a.kt)("inlineCode",{parentName:"p"},"kubelet")," \u8207 ",(0,a.kt)("inlineCode",{parentName:"p"},"containerd")," \u76f4\u63a5\u6e9d\u901a\u4f86\u5275\u5efa\u76f8\u95dc\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"container"),"."),(0,a.kt)("p",null,"\u76f8\u95dc\u7684\u6f14\u9032\u53ef\u4ee5\u53c3\u8003\u4e0b\u5716\n",(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/wjxTNU9.png",alt:null}),"\n(\u5716\u7247\u64f7\u53d6\u81ea\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/blog/2018/05/24/kubernetes-containerd-integration-goes-ga/"},"kubernetes blog kubernetes-containerd-integration-goes-ga"),")"),(0,a.kt)("p",null,"\u540c\u6642\u6839\u64da\u8a72\u7bc7\u6587\u7ae0\u5167\u95dc\u65bc\u6548\u80fd\u7684\u8a55\u6bd4\uff0c\u53ef\u4ee5\u770b\u5230\u76ee\u524d\u9019\u500b\u6574\u5408\u7684\u7248\u672c\u4e0d\u8ad6\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"CPU")," \u6216\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"Memory")," \u7b49\u7cfb\u7d71\u8cc7\u6e90\u7684\u6d88\u8017\u90fd\u9060\u6bd4\u904e\u5f80\u9084\u4f86\u5f97\u5c11\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/ZVC8Qoa.png",alt:null}),"\n(\u5716\u7247\u64f7\u53d6\u81ea\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/blog/2018/05/24/kubernetes-containerd-integration-goes-ga/"},"kubernetes blog kubernetes-containerd-integration-goes-ga"),")"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/GteIewU.png",alt:null}),"\n(\u5716\u7247\u64f7\u53d6\u81ea\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/blog/2018/05/24/kubernetes-containerd-integration-goes-ga/"},"kubernetes blog kubernetes-containerd-integration-goes-ga"),")"),(0,a.kt)("p",null,"\u9019\u7a2e\u67b6\u69cb\u4e0b\uff0c\u4f7f\u7528\u8005\u53ef\u4ee5\u5728\u4e00\u53f0\u4f3a\u670d\u5668\u4e2d\u540c\u6642\u5b89\u88dd ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u8207 ",(0,a.kt)("inlineCode",{parentName:"p"},"docker"),", \u540c\u6642\u5f7c\u6b64\u6703\u5171\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"containerd")," \u4f86\u7ba1\u7406\u81ea\u5df1\u6240\u9700\u8981\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"container"),"."),(0,a.kt)("p",null,"\u67b6\u69cb\u5982\u4e0b\u5716\uff0c\u6709\u8da3\u7684\u4e00\u9ede\u5728\u65bc\u9019\u7a2e\u60c5\u6cc1\u4e0b\u8981\u5982\u4f55\u78ba\u4fdd ",(0,a.kt)("inlineCode",{parentName:"p"},"docker")," \u7684\u6307\u4ee4\u4e0d\u6703\u770b\u5230 ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u6240\u8981\u6c42\u5275\u5efa\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"container"),", \u53cd\u4e4b\u4ea6\u7136\u3002\n\u5169\u8005\u90fd\u662f\u900f\u904e ",(0,a.kt)("inlineCode",{parentName:"p"},"containerd")," \u4f86\u5275\u5efa ",(0,a.kt)("inlineCode",{parentName:"p"},"Container"),", \u5e78\u597d\u6709\u9452\u65bc ",(0,a.kt)("inlineCode",{parentName:"p"},"containerd")," \u672c\u8eab\u63d0\u4f9b\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"namespace")," \u7684\u529f\u80fd\uff0c\u53ef\u4ee5\u78ba\u4fdd\u4e0d\u540c\u7684\u5ba2\u6236\u7aef ",(0,a.kt)("inlineCode",{parentName:"p"},"docekrd, CRI-plugin")," \u90fd\u53ef\u4ee5\u6709\u81ea\u5df1\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"namespace"),"\uff0c\u6240\u4ee5\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"docker ps")," \u5c31\u4e0d\u6703\u4e92\u76f8\u5f71\u97ff\u5230\u5f7c\u6b64\u7684\u904b\u4f5c\u3002\n",(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/IChs25N.png",alt:null}),"\n(\u5716\u7247\u64f7\u53d6\u81ea\uff1a",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/blog/2018/05/24/kubernetes-containerd-integration-goes-ga/"},"kubernetes blog kubernetes-containerd-integration-goes-ga"),")"),(0,a.kt)("p",null,"\u4e0d\u904e\u4e0a\u8ff0\u7684\u5047\u8a2d\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"\u555f\u7528 containerd")," \u65bc ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes cluster")," \u5167\u624d\u6703\u6709\u9019\u500b\u6548\u679c\u3002"),(0,a.kt)("p",null,"\u6839\u64da \u9019\u7bc7\u5b98\u65b9\u6587\u7ae0 ",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#installing-runtime"},"install-kubeadm"),"\uff0c\u76ee\u524d\u9810\u8a2d\u7684\u60c5\u6cc1\u4e0b\u90fd\u9084\u662f\u63a1\u7528\u7b2c\u4e00\u7a2e\u65b9\u6848, ",(0,a.kt)("inlineCode",{parentName:"p"},"dockershim")," \u7684\u65b9\u5f0f\u4f86\u4f7f\u7528\uff0c\u82e5\u9700\u8981\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"containerd")," \u5247\u5fc5\u9808\u8981\u5148\u5b89\u88dd ",(0,a.kt)("inlineCode",{parentName:"p"},"containerd")," \u5230\u7cfb\u7d71\u4e4b\u4e2d\u4e26\u4e14\u5b89\u88dd ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u6642\u8a2d\u5b9a\u7279\u5b9a\u7684\u53c3\u6578\u4f86\u5207\u63db\u904e\u53bb\u3002"),(0,a.kt)("p",null,"\u4e0b\u4e00\u7bc7\u6587\u7ae0\u5c31\u6703\u8ddf\u5927\u5bb6\u5206\u4eab\u8981\u5982\u4f55\u900f\u904e\u5275\u5efa\u4e00\u500b\u53ef\u4ee5\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"containerd")," \u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"local kubernetes cluster"),", \u4e26\u4e14\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI")," \u7684\u5de5\u5177 ",(0,a.kt)("inlineCode",{parentName:"p"},"crictl")," \u4f86\u64cd\u4f5c\u76f8\u95dc\u7684\u5bb9\u5668\u5275\u5efa\u3002"))}c.isMDXComponent=!0}}]);
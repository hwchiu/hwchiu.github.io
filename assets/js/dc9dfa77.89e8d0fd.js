"use strict";(self.webpackChunkhwchiu=self.webpackChunkhwchiu||[]).push([[98790],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>g});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=r.createContext({}),p=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},s=function(e){var t=p(e.components);return r.createElement(c.Provider,{value:t},e.children)},h="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,c=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),h=p(n),m=o,g=h["".concat(c,".").concat(m)]||h[m]||u[m]||a;return n?r.createElement(g,i(i({ref:t},s),{},{components:n})):r.createElement(g,i({ref:t},s))}));function g(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=m;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l[h]="string"==typeof e?e:o,i[1]=l;for(var p=2;p<a;p++)i[p]=n[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},57249:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>l,toc:()=>p});var r=n(87462),o=(n(67294),n(3905));const a={title:"\u81ea\u67b6 Registry - Harbor",sidebar_position:21,tags:["iThome","DevOps","Kubernetes"],description:"iThome-2020 \u7cfb\u5217\u6587\u7ae0",date:new Date("2020-12-30T10:46:46.000Z")},i=void 0,l={unversionedId:"techPost/2020/iThome_Challenge/cicd-21",id:"techPost/2020/iThome_Challenge/cicd-21",title:"\u81ea\u67b6 Registry - Harbor",description:"iThome-2020 \u7cfb\u5217\u6587\u7ae0",source:"@site/docs/techPost/2020/iThome_Challenge/cicd-21.md",sourceDirName:"techPost/2020/iThome_Challenge",slug:"/techPost/2020/iThome_Challenge/cicd-21",permalink:"/docs/techPost/2020/iThome_Challenge/cicd-21",draft:!1,tags:[{label:"iThome",permalink:"/docs/tags/i-thome"},{label:"DevOps",permalink:"/docs/tags/dev-ops"},{label:"Kubernetes",permalink:"/docs/tags/kubernetes"}],version:"current",sidebarPosition:21,frontMatter:{title:"\u81ea\u67b6 Registry - Harbor",sidebar_position:21,tags:["iThome","DevOps","Kubernetes"],description:"iThome-2020 \u7cfb\u5217\u6587\u7ae0",date:"2020-12-30T10:46:46.000Z"},sidebar:"techPost",previous:{title:"Container Registry \u7684\u65b9\u6848\u4ecb\u7d39",permalink:"/docs/techPost/2020/iThome_Challenge/cicd-20"},next:{title:"\u81ea\u67b6 Registry \u8207 Kubernetes \u7684\u6574\u5408",permalink:"/docs/techPost/2020/iThome_Challenge/cicd-22"}},c={},p=[{value:"Harbor Config",id:"harbor-config",level:2},{value:"Push/Pull Container Image",id:"pushpull-container-image",level:2},{value:"\u5b89\u5168\u6027\u6383\u63cf",id:"\u5b89\u5168\u6027\u6383\u63cf",level:2},{value:"\u529f\u80fd\u5c0e\u89bd",id:"\u529f\u80fd\u5c0e\u89bd",level:2}],s={toc:p},h="wrapper";function u(e){let{components:t,...n}=e;return(0,o.kt)(h,(0,r.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"\u4e0a\u7bc7\u6587\u7ae0\u4e2d\u6211\u5011\u63a2\u8a0e\u4e86\u9664\u4e86 DockerHub \u4e4b\u5916\u7684\u5176\u4ed6 Container Registry \u89e3\u6c7a\u65b9\u6848\uff0c\u800c\u672c\u7ae0\u6211\u5011\u5c31\u6703\u8ddf\u5927\u5bb6\u5c55\u793a\u4e00\u4e0b\u5982\u4f55\u5b89\u88dd\u4e00\u500b Harbor Contaienr Registry \u4e26\u4e14\u4f7f\u7528\u5176\u4e2d\u7684\u4e00\u4e9b\u529f\u80fd"),(0,o.kt)("h1",{id:"\u4ecb\u7d39"},"\u4ecb\u7d39"),(0,o.kt)("p",null,"\u9019\u908a\u5c31\u4e0d\u518d\u6b21\u4ecb\u7d39 Harbor \u7684\u529f\u80fd\u8207\u5176\u67b6\u69cb\uff0c\u67b6\u69cb\u5716\u4f86\u81ea  ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/goharbor/harbor/wiki/Architecture-Overview-of-Harbor"},"Architecture Overview of Harbor"),"\uff0c\u8a73\u7d30\u4ecb\u7d39\u9ede\u9078\u4e0a\u65b9\u9023\u7d50\u6216\u662f\u5230 ",(0,o.kt)("a",{parentName:"p",href:"https://goharbor.io/docs/2.0.0/"},"Harbor 2.0 Documentation")," \u77ad\u89e3\u66f4\u591a"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://github.com/goharbor/harbor/raw/release-2.0.0/docs/img/architecture/architecture.png",alt:"arch"})),(0,o.kt)("p",null,"\u6574\u500b Harbor \u662f\u7531\u591a\u500b\u5143\u4ef6\u7d44\u6210\u7684\uff0c\u56e0\u6b64\u529f\u80fd\u65b9\u9762\u8c50\u5bcc\u8a31\u591a\uff0c\u4f46\u662f\u4e5f\u9020\u6210\u5176\u67b6\u69cb\u76f8\u5c0d\u8907\u96dc"),(0,o.kt)("h1",{id:"\u5b89\u88dd"},"\u5b89\u88dd"),(0,o.kt)("p",null,"Harbor \u7684\u5b89\u88dd\u4e26\u4e0d\u6703\u592a\u56f0\u96e3\uff0c\u6240\u6709\u7684\u670d\u52d9\u90fd\u662f\u900f\u904e Docker Container \u4f86\u670d\u52d9\u7684\uff0c\u53ea\u8981\u7cfb\u7d71\u6709\u652f\u63f4 Docker Container \u57fa\u672c\u4e0a\u90fd\u53ef\u4ee5\u904b\u884c\u8d77 Harbor \u7684\u670d\u52d9\u3002"),(0,o.kt)("p",null,"\u5b89\u88dd\u7684\u7b2c\u4e00\u6b65\u9a5f\u5c31\u662f\u5230\u5b98\u65b9 Github \u7684 ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/goharbor/harbor/releases"},"Release Page")," \u627e\u5c0b\u9700\u8981\u7684\u7248\u672c\u4e26\u4e14\u4e0b\u8f09\u4e0b\u4f86"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ wget https://github.com/goharbor/harbor/releases/download/v2.0.2/harbor-offline-installer-v2.0.2.tgz\n$ tar -xvf harbor-offline-installer-v2.0.2.tgz\n$ cd harbor\n$ tree .\n.\n\u251c\u2500\u2500 common.sh\n\u251c\u2500\u2500 harbor.v2.0.2.tar.gz\n\u251c\u2500\u2500 harbor.yml.tmpl\n\u251c\u2500\u2500 install.sh\n\u251c\u2500\u2500 LICENSE\n\u2514\u2500\u2500 prepare\n")),(0,o.kt)("p",null,"Harbor \u7684\u904b\u4f5c\u6982\u5ff5\u662f"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u6e96\u5099\u4e00\u500b harbor.yml \u7684\u8a2d\u5b9a\u6a94\u6848"),(0,o.kt)("li",{parentName:"ol"},"\u57f7\u884c prepare \u9019\u500b\u8173\u672c\uff0c\u6b64\u8173\u672c\u6703\u8b80\u53d6 harbor.yml \u7684\u8a2d\u5b9a\u6a94\u6848\uff0c\u4e26\u6839\u64da\u6b64\u7522\u751f\u4e00\u500b\u5408\u9069\u7684 docker-compose \u6a94\u6848"),(0,o.kt)("li",{parentName:"ol"},"\u6700\u5f8c\u6839\u64da\u904b\u884c\u7522\u751f\u51fa\u4f86\u7684 docker-compose \u6a94\u6848\u5373\u53ef")),(0,o.kt)("h2",{id:"harbor-config"},"Harbor Config"),(0,o.kt)("p",null,"\u8a2d\u5b9a\u6a94\u6848\u5167\u6709\u975e\u5e38\u591a\u7684\u7d30\u90e8\u8a2d\u5b9a\u53ef\u4ee5\u8655\u7406\uff0c\u8b6c\u5982 ",(0,o.kt)("inlineCode",{parentName:"p"},"HTTPS")," \u6191\u8b49\u7684\u4f4d\u7f6e\uff0c ",(0,o.kt)("inlineCode",{parentName:"p"},"HTTP/HTTPS")," \u8981\u4f7f\u7528\u7684\u9023\u63a5\u57e0\uff0c\u9810\u8a2d\u7684 admin \u5e33\u865f\u5bc6\u78bc\uff0c\u76f8\u95dc\u5143\u4ef6\u7684\u8a2d\u5b9a\uff0c\u5927\u90e8\u5206\u8a2d\u5b9a\u90fd\u53ef\u4ee5\u4f7f\u7528\u9810\u8a2d\u503c\uff0c\u552f\u7368 ",(0,o.kt)("inlineCode",{parentName:"p"},"hostname")," \u9019\u500b\u4e00\u5b9a\u8981\u4fee\u6b63\uff0c\u540c\u6642\u5efa\u8b70\u90fd\u8981\u4f7f\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"HTTPS")," \u4f86\u63d0\u4f9b\u5b89\u5168\u7684\u9023\u7d50\u80fd\u529b"),(0,o.kt)("p",null,"\u9019\u908a\u6211\u7684\u7bc4\u4f8b\u662f\u5275\u5efa\u4e00\u500b ",(0,o.kt)("inlineCode",{parentName:"p"},"registry.hwchiu.com")," \u7684DNS \u7d00\u9304\uff0c\u63a5\u4e0b\u4f86\u904e ",(0,o.kt)("inlineCode",{parentName:"p"},"Let's Encrypt")," \u4f86\u7372\u5f97\u4e00\u500b\u5408\u6cd5\u6191\u8b49\uff0c\u6700\u5f8c\u5c07\u9019\u500b\u5408\u6cd5\u6191\u8b49\u7684\u8def\u5f91\u8a2d\u5b9a\u5230 Harbor \u7684\u8a2d\u5b9a\u6a94\u6848\u5167"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"# Configuration file of Harbor\n\n# The IP address or hostname to access admin UI and registry service.\n# DO NOT use localhost or 127.0.0.1, because Harbor needs to be accessed by external clients.\nhostname: registry.hwchiu.com\n\n# http related config\nhttp:\n # port for http, default is 80. If https enabled, this port will redirect to https port\n port: 80\n\n# https related config\nhttps:\n # https port for harbor, default is 443\n port: 443\n # The path of cert and key files for nginx\n certificate: /etc/letsencrypt/live/registry.hwchiu.com/fullchain.pem\n private_key: /etc/letsencrypt/live/registry.hwchiu.com/privkey.pem\n....\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u9019\u908a\u8981\u7279\u5225\u6ce8\u610f\uff0c Harbor \u672c\u8eab\u6c92\u6709\u8ddf Let's Encrypt \u6574\u5408\uff0c\u9019\u610f\u5473\u8005\u5982\u679c\u4f7f\u7528\u9019\u500b\u65b9\u5f0f\uff0c\u8981\u7279\u5225\u8655\u7406\u6bcf\u4e09\u500b\u6708\u7684 Renew\uff0c\u6700\u7c21\u55ae\u7684\u65b9\u5f0f\u5c31\u662f\u5beb\u500b\u7576 Let's Encrypt Renew\u5f8c\uff0c\u91cd\u65b0\u904b\u884c Harbor \u8b93\u5176\u5c07\u65b0\u7684\u6191\u8b49\u6a94\u6848\u8907\u88fd\u5230\u5bb9\u5668\u5167\u53bb\u4f7f\u7528\u3002"),(0,o.kt)("p",{parentName:"blockquote"},"\u5982\u679c\u8981\u4f7f\u7528\u5916\u90e8 Load balancer \u7684\u65b9\u5f0f\u4f86\u8655\u7406 HTTPS\uff0c\u8acb\u7279\u5225\u6ce8\u610f\u9019\u4e9b\u76f8\u95dc Issue\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/goharbor/harbor/issues/12959"},"https://github.com/goharbor/harbor/issues/12959"),"\n",(0,o.kt)("a",{parentName:"p",href:"https://goharbor.io/docs/1.10/install-config/troubleshoot-installation/#using-nginx-or-load-balancing"},"https://goharbor.io/docs/1.10/install-config/troubleshoot-installation/#using-nginx-or-load-balancing"))),(0,o.kt)("p",null,"\u8a18\u5f97\u5c07\u8a2d\u5b9a\u6a94\u6848\u8907\u88fd\u4e00\u4efd\u547d\u540d\u70ba ",(0,o.kt)("inlineCode",{parentName:"p"},"harboy.yaml"),"\uff0c\u63a5\u8005\u53ef\u4ee5\u547c\u53eb ",(0,o.kt)("inlineCode",{parentName:"p"},"prepare")," \u4f86\u57f7\u884c\uff0c\u5f9e\u5176\u8aaa\u660e\u6587\u4ef6\u53ef\u4ee5\u770b\u5230\u6709\u56db\u500b\u53c3\u6578\u53ef\u4ee5\u7528\u4f86\u6c7a\u5b9a\u662f\u5426\u8981\u984d\u5916\u652f\u63f4\u5176\u4ed6\u7b2c\u4e09\u65b9\u8edf\u9ad4\uff0c\u8b6c\u5982 \u5b89\u5168\u6027\u6383\u63cf\uff0c\u6216\u662f Helm3 \u4f7f\u7528\u7684 Chart Museum \u7b49"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ ./prepare --help\nprepare base dir is set to /home/ubuntu/harbor\nUsage: main.py prepare [OPTIONS]\n\nOptions:\n  --conf TEXT         the path of Harbor configuration file\n  --with-notary       the Harbor instance is to be deployed with notary\n  --with-clair        the Harbor instance is to be deployed with clair\n  --with-trivy        the Harbor instance is to be deployed with Trivy\n  --with-chartmuseum  the Harbor instance is to be deployed with chart\n                      repository supporting\n\n  --help              Show this message and exit.\n$ ./prepare --with-trivy --with-chartmuseum\nprepare base dir is set to /home/ubuntu/harbor\nGenerated configuration file: /config/log/logrotate.conf\nGenerated configuration file: /config/log/rsyslog_docker.conf\nGenerated configuration file: /config/nginx/nginx.conf\nGenerated configuration file: /config/core/env\nGenerated configuration file: /config/core/app.conf\nGenerated configuration file: /config/registry/config.yml\nGenerated configuration file: /config/registryctl/env\nGenerated configuration file: /config/registryctl/config.yml\nGenerated configuration file: /config/db/env\nGenerated configuration file: /config/jobservice/env\nGenerated configuration file: /config/jobservice/config.yml\nloaded secret from file: /data/secret/keys/secretkey\nGenerated configuration file: /config/trivy-adapter/env\nGenerated configuration file: /config/chartserver/env\nGenerated configuration file: /compose_location/docker-compose.yml\nClean up the input dir\n")),(0,o.kt)("p",null,"\u9019\u6642\u4faf\u6574\u500b\u8cc7\u6599\u593e\u5167\u7522\u751f\u5f88\u591a\u8cc7\u6599"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ tree .\n.\n\u251c\u2500\u2500 common\n\u2502\xa0\xa0 \u2514\u2500\u2500 config\n\u2502\xa0\xa0     \u251c\u2500\u2500 chartserver\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u2514\u2500\u2500 env\n\u2502\xa0\xa0     \u251c\u2500\u2500 core\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u251c\u2500\u2500 app.conf\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u251c\u2500\u2500 certificates\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u2514\u2500\u2500 env\n\u2502\xa0\xa0     \u251c\u2500\u2500 db\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u2514\u2500\u2500 env\n\u2502\xa0\xa0     \u251c\u2500\u2500 jobservice\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u251c\u2500\u2500 config.yml\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u2514\u2500\u2500 env\n\u2502\xa0\xa0     \u251c\u2500\u2500 log\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u251c\u2500\u2500 logrotate.conf\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u2514\u2500\u2500 rsyslog_docker.conf\n\u2502\xa0\xa0     \u251c\u2500\u2500 nginx\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u251c\u2500\u2500 conf.d\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u2514\u2500\u2500 nginx.conf\n\u2502\xa0\xa0     \u251c\u2500\u2500 registry\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u251c\u2500\u2500 config.yml\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u2514\u2500\u2500 passwd\n\u2502\xa0\xa0     \u251c\u2500\u2500 registryctl\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u251c\u2500\u2500 config.yml\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u2514\u2500\u2500 env\n\u2502\xa0\xa0     \u251c\u2500\u2500 shared\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u2514\u2500\u2500 trust-certificates\n\u2502\xa0\xa0     \u2514\u2500\u2500 trivy-adapter\n\u2502\xa0\xa0         \u2514\u2500\u2500 env\n\u251c\u2500\u2500 common.sh\n\u251c\u2500\u2500 docker-compose.yml\n\u251c\u2500\u2500 harbor.v2.0.2.tar.gz\n\u251c\u2500\u2500 harbor.yml\n\u251c\u2500\u2500 harbor.yml.tmpl\n\u251c\u2500\u2500 install.sh\n\u251c\u2500\u2500 LICENSE\n\u2514\u2500\u2500 prepare\n")),(0,o.kt)("p",null,"\u6700\u5167\u5c64\u6709\u5404\u7a2e\u670d\u52d9\u6703\u4f7f\u7528\u5230\u7684\u8a2d\u5b9a\u6a94\u6848\uff0c\u6700\u5916\u5c64\u5247\u662f\u63d0\u904e\u7684 dokcer-compose\uff0c"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ docker-compose up -d\n....\n$ docker-compose ps\n      Name                     Command                  State                          Ports\n---------------------------------------------------------------------------------------------------------------\nchartmuseum         ./docker-entrypoint.sh           Up (healthy)   9999/tcp\nharbor-core         /harbor/entrypoint.sh            Up (healthy)\nharbor-db           /docker-entrypoint.sh            Up (healthy)   5432/tcp\nharbor-jobservice   /harbor/entrypoint.sh            Up (healthy)\nharbor-log          /bin/sh -c /usr/local/bin/ ...   Up (healthy)   127.0.0.1:1514->10514/tcp\nharbor-portal       nginx -g daemon off;             Up (healthy)   8080/tcp\nnginx               nginx -g daemon off;             Up (healthy)   0.0.0.0:80->8080/tcp, 0.0.0.0:443->8443/tcp\nredis               redis-server /etc/redis.conf     Up (healthy)   6379/tcp\nregistry            /home/harbor/entrypoint.sh       Up (healthy)   5000/tcp\nregistryctl         /home/harbor/start.sh            Up (healthy)\ntrivy-adapter       /home/scanner/entrypoint.sh      Up (healthy)   8080/tcp\n")),(0,o.kt)("p",null,"\u9019\u908a\u53ef\u4ee5\u770b\u5230 Harbor \u5e95\u4e0b\u6709\u8d85\u591a\u7684\u670d\u52d9\u5728\u904b\u4f5c\uff0c\u5176\u4e2d\u5167\u90e8\u4e5f\u6709\u4e00\u500b\u81ea\u5df1\u7684 Nginx \u518d\u904b\u884c\uff0c\u9019\u4e5f\u662f\u70ba\u4ec0\u9ebc\u5982\u679c\u4f60\u5916\u90e8\u6709\u4e00\u500b nginx \u6216\u662f\u5176\u4ed6\u7684 load-balancer \u7684\u8a71\uff0c\u4f60\u9700\u8981\u91dd\u5c0d\u88e1\u9762\u7684 nginx \u53bb\u9032\u884c\u8a2d\u5b9a\uff0c\u5426\u5247\u50b3\u9001\u9032\u4f86\u7684 HTTP Header \u6703\u6709\u932f\u8aa4\u3002"),(0,o.kt)("p",null,"\u4e00\u5207\u6e96\u5099\u5c31\u7dd2\u5f8c\u5c31\u53ef\u4ee5\u5617\u8a66\u900f\u904e\u7db2\u9801\u6253\u958b ",(0,o.kt)("inlineCode",{parentName:"p"},"https://registry.hwchiu.com")," \u4f86\u5b58\u53d6\u770b\u770b ",(0,o.kt)("inlineCode",{parentName:"p"},"harbor")," \u7684\u670d\u52d9"),(0,o.kt)("p",null,"\u9810\u8a2d\u7684\u767b\u5165\u5bc6\u78bc\u5982\u679c\u6c92\u6709\u4fee\u6539\u7684\u8a71\u90fd\u6703\u662f ",(0,o.kt)("inlineCode",{parentName:"p"},"Harbor12345"),"\uff0c \u6240\u4ee5\u53ef\u4ee5\u4f7f\u7528 admin/Harbor12345 \u767b\u5165\u770b\u770b\u7db2\u9801"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/1pCJ1St.png",alt:null})),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/Npl0D2O.png",alt:null})),(0,o.kt)("h1",{id:"\u4f7f\u7528"},"\u4f7f\u7528"),(0,o.kt)("p",null,"\u67b6\u8a2d\u597d\u7b2c\u4e00\u500b Harbor \u7684\u670d\u52d9\u5f8c\uff0c\u63a5\u4e0b\u4f86\u6211\u5011\u60f3\u8981\u4f86\u8a66\u8a66\u770b\u5e7e\u500b\u529f\u80fd"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Push/Pull Container Image"),(0,o.kt)("li",{parentName:"ol"},"\u5b89\u5168\u6027\u6383\u63cf"),(0,o.kt)("li",{parentName:"ol"},"\u529f\u80fd\u5c0e\u89bd")),(0,o.kt)("h2",{id:"pushpull-container-image"},"Push/Pull Container Image"),(0,o.kt)("p",null,"\u70ba\u4e86\u5c55\u793a\u9019\u500b\u529f\u80fd\uff0c\u6211\u5011\u5fc5\u9808\u5148\u5728 Harbor \u4e0a\u9762\u5275\u9020\u4e00\u500b\u5168\u65b0\u7684\u5c08\u6848\uff0c\u57fa\u672c\u4e0a UI \u4e0d\u7b97\u8907\u96dc\uff0c\u6309\u7167\u63d0\u793a\u4e00\u6b65\u4e00\u6b65\u5373\u53ef\u5b8c\u6210"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/biq0BuZ.png",alt:null})),(0,o.kt)("p",null,"\u5b8c\u6210\u5f8c\uff0c\u9032\u5165\u5230\u8a72\u5c08\u6848\u9801\u9762\uff0c\u5c31\u5982\u540c Docker Hub \u4e00\u6a23\uff0c\u90fd\u6703\u63d0\u793a\u4f60\u8a72\u5c08\u6848\u8981\u600e\u9ebc\u4f7f\u7528\uff0c\u8b6c\u5982\u4f60\u7684tag, push \u6307\u4ee4\u3002"),(0,o.kt)("p",null,"\u6211\u7684\u7bc4\u4f8b\u5c31\u6703\u662f ",(0,o.kt)("inlineCode",{parentName:"p"},"docker push registry.hwchiu.com/ithome/REPOSITORY[:TAG]")),(0,o.kt)("p",null,"\u5176\u4e2d\u9019\u908a\u8981\u6ce8\u610f\u7684\u662f\uff0c\u4ed6\u7684 URL \u662f\u7531 server/project/repository:tag \u56db\u500b\u8b8a\u6578\u6c7a\u5b9a\uff0c\u6240\u4ee5\u4e00\u500b\u5c08\u6848\u5e95\u4e0b\u53ef\u4ee5\u6709\u5f88\u591a\u7684 image repository, \u800c\u6bcf\u500b repository \u5167\u53c8\u53ef\u4ee5\u6709\u5f88\u591a\u500b tag \u7248\u672c\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/w4I1oCv.png",alt:null})),(0,o.kt)("p",null,"\u56e0\u70ba\u9019\u500b\u65b0\u67b6\u8a2d\u5275\u5efa\u7684\u5c08\u6848\u662f Private, \u6c92\u6709\u7d93\u904e\u767b\u5165\u662f\u4e0d\u80fd\u5b58\u53d6\u8207\u89c0\u770b\u7684\uff0c\u6240\u4ee5\u6211\u5011\u63a5\u4e0b\u4f86\u8981"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u900f\u904e Docker login \u5230 ",(0,o.kt)("a",{parentName:"li",href:"https://registry.hwchiu.com"},"https://registry.hwchiu.com")),(0,o.kt)("li",{parentName:"ol"},"\u4e0b\u8f09\u6211\u672c\u4f86\u653e\u5728 Docker hub \u4e0a\u7684 Image\uff0c\u4e26\u900f\u904e ",(0,o.kt)("inlineCode",{parentName:"li"},"docker tag")," \u5c07\u5176\u91cd\u65b0\u547d\u540d"),(0,o.kt)("li",{parentName:"ol"},"\u5c07\u65b0\u547d\u540d\u7684 docker image \u63a8\u5411\u6211\u5011\u5efa\u7f6e\u7684 Harbor container registry")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ docker login --username admin --password Harbor12345  https://registry.hwchiu.com\nWARNING! Using --password via the CLI is insecure. Use --password-stdin.\nWARNING! Your password will be stored unencrypted in /home/ubuntu/.docker/config.json.\nConfigure a credential helper to remove this warning. See\nhttps://docs.docker.com/engine/reference/commandline/login/#credentials-store\n\nLogin Succeeded\n$ docker pull hwchiu/netutils                                                                                                               [22/9415]\nUsing default tag: latest\nlatest: Pulling from hwchiu/netutils\n6aa38bd67045: Pull complete\n981ae4862c05: Pull complete\n5bad8949dcb1: Pull complete\nca9461589e70: Pull complete\n58028a0a00a4: Pull complete\n869f1b12c2d6: Pull complete\nDigest: sha256:be44189c4ebb9923e15885eac9cc976c121029789c2ddc7b7862a976a3f752a5\nStatus: Downloaded newer image for hwchiu/netutils:latest\ndocker.io/hwchiu/netutils:latest\n$ docker tag hwchiu/netutils registry.hwchiu.com/ithome/netutils:latest\n$ docker push registry.hwchiu.com/ithome/netutils:latest\nThe push refers to repository [registry.hwchiu.com/ithome/netutils]\n33bd8247fba5: Pushed\n733e8cbb9402: Pushed\n377c01c3f4e3: Pushed\n968d3b985bf4: Pushed\n631dfaad8559: Pushed\nd908d9ad6713: Pushed\nlatest: digest: sha256:be44189c4ebb9923e15885eac9cc976c121029789c2ddc7b7862a976a3f752a5 size: 1569\n")),(0,o.kt)("p",null,"\u7576\u4e00\u5207\u90fd\u5efa\u7f6e\u5b8c\u7562\u5f8c\uff0c\u56de\u5230 Harbor UI\u5c31\u6703\u767c\u73fe\u65b0\u7684 image \u5df2\u7d93\u63a8\u4e0a\u4f86\u4e86"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/MIhpQtG.png",alt:null})),(0,o.kt)("h2",{id:"\u5b89\u5168\u6027\u6383\u63cf"},"\u5b89\u5168\u6027\u6383\u63cf"),(0,o.kt)("p",null,"\u63a5\u4e0b\u4f86\u770b\u4e00\u4e0b\u9810\u8a2d\u7684\u5b89\u5168\u6027\u6383\u63cf\uff0c\u6b64\u529f\u80fd\u652f\u63f4\u4e0d\u540c\u7684\u5be6\u4f5c\u65b9\u6848\uff0c\u9810\u8a2d\u4e2d\u6211\u5011\u4f7f\u7528\u7684\u662f ",(0,o.kt)("inlineCode",{parentName:"p"},"Trivy")," \u9019\u500b\u5c08\u6848"),(0,o.kt)("p",null,"\u9ede\u9078\u5230\u76ee\u6a19 repository (netutils) \u88e1\u9762\u5f8c\uff0c\u9078\u8d77\u6211\u5011\u7684 tag\uff0c\u4e26\u65bc\u5de6\u4e0a\u65b9\u9ede\u9078 SCAN \u529f\u80fd\uff0c\u5c31\u53ef\u4ee5\u770b\u5230\u53f3\u65b9\u7684\u9032\u5ea6\u689d\u6b63\u5728\u904b\u884c\uff0c\u4ee3\u8868\u6383\u63cf\u4e2d"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/q2J5p1G.png",alt:null})),(0,o.kt)("p",null,"\u6383\u7784\u5b8c\u7562\u4e4b\u5f8c\u9ede\u9078 image \u540d\u7a31\u9032\u5165\u5230\u8a72 image \u88e1\u9762\u5c31\u53ef\u4ee5\u770b\u5230\u6eff\u6eff\u7684\u6f5b\u5728\u5371\u96aa\u6027\u5831\u544a\uff0c\u5176\u4e2d\u6703\u91dd\u5c0d\u6bcf\u500b CVE \u90fd\u6709\u8a73\u7d30\u7684\u9023\u7d50\uff0c\u4e26\u4e14\u628a\u7b49\u7d1a\u4ee5\u53ca\u76f8\u95dc\u7684\u8edf\u9ad4\u90fd\u5217\u51fa\u4f86\uff0c\u5c0d\u65bc\u6709\u5b89\u5168\u6027\u9700\u6c42\u7684\u4eba\u53ef\u4ee5\u8003\u616e\u8a66\u8a66\u770b\u9019\u500b\u65b9\u6848\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/dzreBQw.png",alt:null})),(0,o.kt)("h2",{id:"\u529f\u80fd\u5c0e\u89bd"},"\u529f\u80fd\u5c0e\u89bd"),(0,o.kt)("p",null,"\u6700\u5f8c\u6211\u5011\u4f86\u770b\u4e00\u4e0b\u5176\u4ed6\u7684\u529f\u80fd\uff0c\u9996\u5148\u5728\u767b\u5165\u7684\u90e8\u5206\uff0c Harbor \u63d0\u4f9b\u591a\u7a2e\u6a5f\u5236\uff0c\u6700\u7c21\u55ae\u7684\u5c31\u662f\u8b93 Harbor \u7684\u8cc7\u6599\u5eab\u4f86\u7ba1\u7406\u4f7f\u7528\u8005"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/fLLXQ8t.png",alt:null})),(0,o.kt)("p",null,"\u5982\u679c\u60f3\u8981\u8ddf\u5718\u968a\u5167\u5df2\u7d93\u4f7f\u7528\u7684\u767b\u5165\u7cfb\u7d71\u6574\u5408\uff0c\u53ef\u4ee5\u4f7f\u7528 LDAP/UAA/OIDC \u7b49\u4e09\u7a2e\u5354\u5b9a\u9032\u884c\u4e92\u52d5\uff0c\u5982\u679c\u8d70\u7684\u662f OIDC \u53ef\u4ee5\u8003\u616e\u4f7f\u7528 DEX \u9019\u500b\u958b\u6e90\u5c08\u6848\u4f86\u6574\u5408\uff0c\u4e00\u65e6\u6574\u5408\u5b8c\u7562\u5f8c\uff0c\u4f7f\u7528\u8005\u767b\u5165\u7684\u9801\u9762\u5c31\u6703\u8b8a\u6210"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/mS22pBK.png",alt:null})),(0,o.kt)("p",null,"\u6b64\u5916\u9084\u6709\u4e00\u500b ",(0,o.kt)("inlineCode",{parentName:"p"},"Replication")," \u7684\u529f\u80fd\uff0c\u53ef\u4ee5\u8b93\u4f60\u7684 Harbor \u8207\u5176\u4ed6\u7684 Container Registry \u4e92\u52d5\uff0c\u9054\u6210\u540c\u6b65\u7684\u529f\u80fd\u3002\u9019\u500b\u529f\u80fd\u6709\u5169\u500b\u8d70\u6cd5\uff0c\u4e00\u500b\u662f\u4e3b\u52d5\u5c07\u672c\u5730\u7684 image \u63a8\u5230\u9060\u65b9\uff0c\u4e00\u7a2e\u5247\u662f\u5b9a\u671f\u5c07\u9060\u65b9\u7684 image \u62c9\u56de\u5230\u672c\u5730\u7aef\u3002"),(0,o.kt)("p",null,"\u9019\u529f\u80fd\u5c0d\u65bc\u6709\u5927\u91cf container registry \u9700\u6c42\u7684\u74b0\u5883\u4f86\u8aaa\u975e\u5e38\u7684\u597d\uff0c\u8b6c\u5982\u908a\u7de3\u904b\u7b97\u7b49\uff0c\u53ef\u4ee5\u8b93\u5927\u90e8\u5206\u8981\u4f7f\u7528\u7684 Container Image \u90fd\u6709\u4e00\u4efd\u5728\u672c\u5730\u7aef\uff0c\u52a0\u5feb\u5b58\u53d6\u901f\u5ea6\uff0c\u85c9\u7531\u9019\u7a2e\u591a\u5c64\u6b21\u7684\u67b6\u69cb\u4f86\u63d0\u4f9b\u66f4\u9748\u6d3b\u8207\u5f48\u6027\u7684\u7ba1\u7406\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/X97AB3J.png",alt:null})),(0,o.kt)("p",null,"\u5230\u9019\u908a\u6211\u5011\u5c31\u5927\u6982\u7406\u89e3\u4e86 Harbor \u7684\u57fa\u672c\u529f\u80fd\uff0c\u4e0b\u4e00\u7ae0\u7bc0\u6211\u5011\u5c07\u4f86\u770b\u770b\u8981\u5982\u4f55\u5c07 Harbor \u8207 Kubernetes \u6574\u5408\uff0c\u8b93\u6211\u5011\u7684 Kubernetes \u53ef\u4ee5\u5b58\u53d6 Harbor \u4e0a\u7684 Container Image\u3002"))}u.isMDXComponent=!0}}]);
"use strict";(self.webpackChunkhwchiu=self.webpackChunkhwchiu||[]).push([[99045],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>b});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=a.createContext({}),p=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=p(e.components);return a.createElement(l.Provider,{value:n},e.children)},c="mdxType",k={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=p(t),d=r,b=c["".concat(l,".").concat(d)]||c[d]||k[d]||i;return t?a.createElement(b,o(o({ref:n},u),{},{components:t})):a.createElement(b,o({ref:n},u))}));function b(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,o=new Array(i);o[0]=d;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[c]="string"==typeof e?e:r,o[1]=s;for(var p=2;p<i;p++)o[p]=t[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},33104:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>k,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var a=t(87462),r=(t(67294),t(3905));const i={title:"kubernetes \u8207 CNI \u7684\u4e92\u52d5",sidebar_position:10,date:new Date("2019-09-26T04:52:37.000Z"),tags:["Kubernetes","Network","CNI","iThome"],description:"Container Network Interface \u7684\u6a19\u6e96\u5236\u5b9a\u5f8c\uff0c\u63a5\u4e0b\u4f86\u8981\u63a2\u8a0e kubernetes \u672c\u8eab\u8207 CNI \u7684\u6574\u5408\uff0c\u9019\u90e8\u5206\u5c31\u5982\u540c Contaienr Runtime Interface \u4e00\u6a23\uff0c\u53ef\u4ee5\u900f\u904e kubelet \u7684\u65b9\u5f0f\u544a\u77e5 kubernetes cluster \u8a72\u555f\u7528\u4ec0\u9ebc\u6a23\u7684\u8a2d\u5b9a\u4f86\u8a2d\u5b9a cluster \u7684\u7db2\u8def\uff0c\u540c\u6642\u7cfb\u7d71\u4e0a\u4e5f\u6709\u76f8\u95dc\u7684\u53c3\u6578\u7528\u4f86\u8a2d\u5b9a CNI \u76f8\u95dc\u7684\u6a94\u6848\uff0c\u8b6c\u5982\u57f7\u884c\u6a94\u4ee5\u53ca\u8a2d\u5b9a\u6a94\uff0c\u540c\u6642\u8981\u6ce8\u610f\u7684\u662f CNI \u662f\u57fa\u65bc\u7bc0\u9ede\u70ba\u55ae\u4f4d\uff0c\u6240\u4ee5\u8a2d\u5b9a\u7684\u6642\u5019\u662f\u6bcf\u53f0\u6a5f\u5668\u90fd\u8981\u8a2d\u5b9a\u3002"},o="\u524d\u8a00",s={unversionedId:"techPost/2019/iThome_Challenge/k8s-cni",id:"techPost/2019/iThome_Challenge/k8s-cni",title:"kubernetes \u8207 CNI \u7684\u4e92\u52d5",description:"Container Network Interface \u7684\u6a19\u6e96\u5236\u5b9a\u5f8c\uff0c\u63a5\u4e0b\u4f86\u8981\u63a2\u8a0e kubernetes \u672c\u8eab\u8207 CNI \u7684\u6574\u5408\uff0c\u9019\u90e8\u5206\u5c31\u5982\u540c Contaienr Runtime Interface \u4e00\u6a23\uff0c\u53ef\u4ee5\u900f\u904e kubelet \u7684\u65b9\u5f0f\u544a\u77e5 kubernetes cluster \u8a72\u555f\u7528\u4ec0\u9ebc\u6a23\u7684\u8a2d\u5b9a\u4f86\u8a2d\u5b9a cluster \u7684\u7db2\u8def\uff0c\u540c\u6642\u7cfb\u7d71\u4e0a\u4e5f\u6709\u76f8\u95dc\u7684\u53c3\u6578\u7528\u4f86\u8a2d\u5b9a CNI \u76f8\u95dc\u7684\u6a94\u6848\uff0c\u8b6c\u5982\u57f7\u884c\u6a94\u4ee5\u53ca\u8a2d\u5b9a\u6a94\uff0c\u540c\u6642\u8981\u6ce8\u610f\u7684\u662f CNI \u662f\u57fa\u65bc\u7bc0\u9ede\u70ba\u55ae\u4f4d\uff0c\u6240\u4ee5\u8a2d\u5b9a\u7684\u6642\u5019\u662f\u6bcf\u53f0\u6a5f\u5668\u90fd\u8981\u8a2d\u5b9a\u3002",source:"@site/docs/techPost/2019/iThome_Challenge/k8s-cni.md",sourceDirName:"techPost/2019/iThome_Challenge",slug:"/techPost/2019/iThome_Challenge/k8s-cni",permalink:"/docs/techPost/2019/iThome_Challenge/k8s-cni",draft:!1,tags:[{label:"Kubernetes",permalink:"/docs/tags/kubernetes"},{label:"Network",permalink:"/docs/tags/network"},{label:"CNI",permalink:"/docs/tags/cni"},{label:"iThome",permalink:"/docs/tags/i-thome"}],version:"current",sidebarPosition:10,frontMatter:{title:"kubernetes \u8207 CNI \u7684\u4e92\u52d5",sidebar_position:10,date:"2019-09-26T04:52:37.000Z",tags:["Kubernetes","Network","CNI","iThome"],description:"Container Network Interface \u7684\u6a19\u6e96\u5236\u5b9a\u5f8c\uff0c\u63a5\u4e0b\u4f86\u8981\u63a2\u8a0e kubernetes \u672c\u8eab\u8207 CNI \u7684\u6574\u5408\uff0c\u9019\u90e8\u5206\u5c31\u5982\u540c Contaienr Runtime Interface \u4e00\u6a23\uff0c\u53ef\u4ee5\u900f\u904e kubelet \u7684\u65b9\u5f0f\u544a\u77e5 kubernetes cluster \u8a72\u555f\u7528\u4ec0\u9ebc\u6a23\u7684\u8a2d\u5b9a\u4f86\u8a2d\u5b9a cluster \u7684\u7db2\u8def\uff0c\u540c\u6642\u7cfb\u7d71\u4e0a\u4e5f\u6709\u76f8\u95dc\u7684\u53c3\u6578\u7528\u4f86\u8a2d\u5b9a CNI \u76f8\u95dc\u7684\u6a94\u6848\uff0c\u8b6c\u5982\u57f7\u884c\u6a94\u4ee5\u53ca\u8a2d\u5b9a\u6a94\uff0c\u540c\u6642\u8981\u6ce8\u610f\u7684\u662f CNI \u662f\u57fa\u65bc\u7bc0\u9ede\u70ba\u55ae\u4f4d\uff0c\u6240\u4ee5\u8a2d\u5b9a\u7684\u6642\u5019\u662f\u6bcf\u53f0\u6a5f\u5668\u90fd\u8981\u8a2d\u5b9a\u3002"},sidebar:"techPost",previous:{title:"Container Network Interface \u4ecb\u7d39",permalink:"/docs/techPost/2019/iThome_Challenge/cni"},next:{title:"\u4f7f\u7528 golang \u958b\u767c\u7b2c\u4e00\u500b CNI \u7a0b\u5f0f",permalink:"/docs/techPost/2019/iThome_Challenge/cni-golnag"}},l={},p=[{value:"Vagrant",id:"vagrant",level:2},{value:"kubelet",id:"kubelet",level:2},{value:"CNI",id:"cni",level:3},{value:"Kubenet",id:"kubenet",level:3},{value:"Pause Container",id:"pause-container",level:2},{value:"CRI Impact",id:"cri-impact",level:2}],u={toc:p},c="wrapper";function k(e){let{components:n,...t}=e;return(0,r.kt)(c,(0,a.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"\u524d\u8a00"},"\u524d\u8a00"),(0,r.kt)("p",null,"\u524d\u7bc7\u6587\u7ae0\u63a2\u8a0e\u4e86 ",(0,r.kt)("inlineCode",{parentName:"p"},"CNI")," \u7684\u57fa\u672c\u6982\u5ff5\uff0c\u5305\u542b\u4e86"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"CNI \u547c\u53eb\u7684\u7bc4\u4f8b"),(0,r.kt)("li",{parentName:"ul"},"\u8a2d\u5b9a\u6a94\u6848\u7684\u683c\u5f0f"),(0,r.kt)("li",{parentName:"ul"},"\u57f7\u884c\u6d41\u7a0b"),(0,r.kt)("li",{parentName:"ul"},"Sanbox Container")),(0,r.kt)("p",null,"\u63a5\u4e0b\u4f86\u672c\u7bc7\u6587\u7ae0\u8981\u8457\u91cd\u5728\u5982\u4f55\u628a\u4e0a\u8ff0\u6982\u5ff5\u8ddf Kubernetes \u878d\u6703\u8cab\u901a\uff0c\u4f86\u77ad\u89e3\u5230\u5e95 kubernete \u662f\u5982\u4f55\u900f\u904e CNI \u8b93\u6bcf\u500b Pod \u90fd\u6709\u7db2\u8def\u53ef\u4ee5\u4f7f\u7528\u7684\u3002"),(0,r.kt)("h1",{id:"kubernetes"},"Kubernetes"),(0,r.kt)("h2",{id:"vagrant"},"Vagrant"),(0,r.kt)("p",null,"\u9019\u908a\u5148\u8ddf\u5927\u5bb6\u5206\u4eab\u4e00\u4e0b\u81ea\u5df1\u5e73\u5e38\u4f7f\u7528\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"Vagrant")," \u8173\u672c\uff0c\u6211\u7fd2\u6163\u5728 MAC \u4e0a\u9762\u900f\u904e Vagrant \u7684\u65b9\u5f0f\u53bb\u5275\u5efa\u4e00\u500b\u55ae\u6a5f\u7684 Kubernetes Cluster \u4f86\u9032\u884c\u6e2c\u8a66\uff0c\u4e3b\u8981\u662f\u5feb\u901f\u4e14\u65b9\u4fbf\uff0c\u4e14\u8a72\u8173\u672c\u4e2d\u9084\u6703\u900f\u904e kubeadm \u7684\u65b9\u5f0f\u81ea\u52d5\u5efa\u7acb kubernetes cluster \uff0c\u5b89\u88dd Flannel CNI \u4ee5\u53ca\u900f\u904e taint \u7684\u65b9\u5f0f\u5141\u8207 master node \u904b\u884c Pod\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ruby="},'# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\nVagrant.configure("2") do |config|\n  config.vm.box = "bento/ubuntu-18.04"\n  config.vm.hostname = \'k8s-dev\'\n  config.vm.define vm_name = \'k8s\'\n\n  config.vm.provision "shell", privileged: false, inline: <<-SHELL\n    set -e -x -u\n    export DEBIAN_FRONTEND=noninteractive\n\n    #change the source.list\n    sudo apt-get update\n    sudo apt-get install -y vim git cmake build-essential tcpdump tig jq\n    # Install ntp\n    sudo apt-get install -y ntp\n    # Install Docker\n    # kubernetes official max validated version: 17.03.2~ce-0~ubuntu-xenial\n    export DOCKER_VERSION="18.06.3~ce~3-0~ubuntu"\n    curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -\n    sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"\n    sudo apt-get update\n    sudo apt-get install -y docker-ce=${DOCKER_VERSION}\n\n    # Install Kubernetes\n    export KUBE_VERSION="1.13.5"\n    export NET_IF_NAME="enp0s8"\n    curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -\n    echo "deb http://apt.kubernetes.io/ kubernetes-xenial main" | sudo tee --append /etc/apt/sources.list.d/kubernetes.list\n    sudo apt-get update\n    sudo apt-get install -y kubeadm=${KUBE_VERSION}-00 kubelet=${KUBE_VERSION}-00 kubectl=${KUBE_VERSION}-00 kubernetes-cni=0.7.5-00\n    # Disable swap\n    sudo swapoff -a && sudo sysctl -w vm.swappiness=0\n    sudo sed \'/swap.img/d\' -i /etc/fstab\n    sudo kubeadm init --kubernetes-version v${KUBE_VERSION} --apiserver-advertise-address=172.17.8.101 --pod-network-cidr=10.244.0.0/16\n    mkdir -p $HOME/.kube\n    sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n    sudo chown $(id -u):$(id -g) $HOME/.kube/config\n    kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/a70459be0084506e4ec919aa1c114638878db11b/Documentation/kube-flannel.yml\n    kubectl taint nodes --all node-role.kubernetes.io/master-\n\n\n  SHELL\n\n  config.vm.network :private_network, ip: "172.17.8.101"\n  config.vm.provider :virtualbox do |v|\n      v.customize ["modifyvm", :id, "--cpus", 2]\n      v.customize ["modifyvm", :id, "--memory", 4096]\n      v.customize [\'modifyvm\', :id, \'--nicpromisc1\', \'allow-all\']\n  end\nend\n')),(0,r.kt)("p",null,"\u63a5\u4e0b\u4f86\u6211\u7684\u64cd\u4f5c\u74b0\u5883\u90fd\u6703\u57fa\u65bc\u9019\u500b\u7bc4\u4f8b\u53bb\u64cd\u4f5c\uff0c\u552f\u4e00\u8981\u6ce8\u610f\u7684\u5c31\u662f\u5982\u679c\u8981\u4fee\u6539 kubernetes \u7248\u672c\u7684\u8a71\uff0c\u8981\u6ce8\u610f flannel \u7684 yaml \u662f\u5426\u652f\u63f4\u7576\u524d\u7248\u672c\u3002 \u8b6c\u5982 kubernetes 1.16  \u4e2d daemonset \u5c31\u985e\u578b\u5c31\u8981\u4fee\u6539\u6210 apps/v1\u3002"),(0,r.kt)("h2",{id:"kubelet"},"kubelet"),(0,r.kt)("p",null,"kubernetes \u76ee\u524d\u5728\u7db2\u8def\u65b9\u9762\u63d0\u4f9b\u5169\u8005\u8a2d\u5b9a\uff0c\u518d\u555f\u52d5 ",(0,r.kt)("inlineCode",{parentName:"p"},"kubelet"),"  \u7684\u6642\u5019\u53ef\u4ee5\u900f\u904e\u53c3\u6578 ",(0,r.kt)("strong",{parentName:"p"},"--network-plugin")," \u7684\u65b9\u5f0f\u4f86\u6c7a\u5b9a\u8981\u5982\u4f55\u8a2d\u5b9a\u8a72 kubernetes cluster \u7684\u7db2\u8def\u89e3\u6c7a\u65b9\u6848\n\u76ee\u524d\u652f\u63f4\u5169\u7a2e\u8a2d\u5b9a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"cni"),(0,r.kt)("li",{parentName:"ol"},"kubenet")),(0,r.kt)("p",null,"\u63a5\u4e0b\u4f86\u91dd\u5c0d\u9019\u5169\u7a2e\u9078\u9805\u8a0e\u8ad6\u4e00\u4e0b\u5f7c\u6b64\u7684\u7528\u6cd5\u8207\u67b6\u69cb"),(0,r.kt)("h3",{id:"cni"},"CNI"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"CNI")," \u9867\u540d\u601d\u7fa9\u5c31\u662f\u4f7f\u7528\u5404\u5f0f\u5404\u6a23\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"CNI")," \u89e3\u6c7a\u65b9\u6848\u4f86\u70ba Kubernetes cluster \u63d0\u4f9b\u7db2\u8def\u80fd\u529b\uff0c \u524d\u8ff0\u6587\u7ae0\u8a0e\u8ad6 CNI \u7684\u6642\u5019\uff0c\u6709\u63d0\u5230\u5169\u500b\u8ddf\u6a94\u6848\u6709\u95dc\u7684\u6982\u5ff5\uff0c\u4e00\u500b\u662f ",(0,r.kt)("inlineCode",{parentName:"p"},"CNI")," \u89e3\u6c7a\u65b9\u6848\u7684 binary\uff0c\u53e6\u5916\u4e00\u500b\u5247\u662f\u57fa\u65bc json \u683c\u5f0f\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"CNI")," \u8a2d\u5b9a\u6a94\u6848\u3002"),(0,r.kt)("p",null,"\u6709\u9019\u4e9b\u6a94\u6848\u5c31\u6703\u6709\u6a94\u6848\u5b58\u53d6\u7684\u554f\u984c\u9700\u8981\u8655\u7406\uff0c\u56e0\u6b64 kubelet \u9019\u908a\u5c31\u5fc5\u9808\u8981\u91dd\u5c0d\u4e0a\u8ff0\u5169\u7a2e\u985e\u578b\u7684\u6a94\u6848\u8a2d\u5b9a\u5176\u7cfb\u7d71\u4f4d\u7f6e\u3002 \u8a72\u5169\u500b\u53c3\u6578\u5206\u5225\u662f"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"--cni-bin-dir\n\u9810\u8a2d\u60c5\u6cc1\u662f\u5728 /opt/cni/bin\uff0c\u7528\u4f86\u5b58\u653e\u5404\u5f0f\u5404\u6a23\u7684 CNI \u89e3\u6c7a\u65b9\u6848\u7684\u57f7\u884c\u6a94"),(0,r.kt)("li",{parentName:"ol"},"--cni-conf-dir\n\u9810\u8a2d\u60c5\u6cc1\u662f\u5728 /etc/cni/net.d/\uff0c\u7528\u4f86\u5b58\u653e\u7576\u524d\u8981\u63d0\u4f9b\u7d66 CNI \u4f7f\u7528\u7684\u8a2d\u5b9a\u6a94\u6848\uff0c\u6a94\u6848\u683c\u5f0f\u5c31\u5982\u540c\u524d\u7bc7\u8a0e\u8ad6\u904e\u7684 ",(0,r.kt)("strong",{parentName:"li"},"Network Configuration"),"  \u6216\u662f ",(0,r.kt)("strong",{parentName:"li"},"Network Configuration List"),"\u3002")),(0,r.kt)("p",null,"\u6211\u5011\u5148\u4f86\u89c0\u5bdf\u4e00\u4e0b\u7576\u524d kubelet \u7684\u8a2d\u5b9a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash="},"vagrant@k8s-dev:~$ ps axuw | grep kubelet | grep cni\nroot      2433  2.0  2.2 1346404 90016 ?       Ssl  00:37   4:21 /usr/bin/kubelet\n--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf\n--kubeconfig=/etc/kubernetes/kubelet.conf --config=/var/lib/kubelet/config.yaml\n--cgroup-driver=cgroupfs --network-plugin=cni\n--pod-infra-container-image=k8s.gcr.io/pause:3.1 --resolv-conf=/run/systemd/resolve/resolv.conf\n")),(0,r.kt)("p",null,"\u53ef\u4ee5\u89c0\u5bdf\u5230\u9810\u8a2d\u60c5\u6cc1\u4e0b\uff0c kubeadm \u6703\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"cni")," \u7684\u65b9\u5f0f\u4f5c\u70ba network-plugin \u7684\u9078\u9805\uff0c\u6b64\u6642\u6211\u5011\u4f86\u770b\u770b\u4e0a\u8ff0\u63d0\u5230\u7684\u5169\u500b\u8cc7\u6599\u593e\u5230\u5e95\u653e\u4e86\u4ec0\u9ebc\u6a94\u6848"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash="},"vagrant@k8s-dev:~$ sudo ls /opt/cni/bin/\nbridge  dhcp  flannel  host-device  host-local  ipvlan  loopback  macvlan  portmap  ptp  sample  tuning  vlan\n\nvagrant@k8s-dev:~$ file /opt/cni/bin/*\n/opt/cni/bin/bridge:      ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, with debug_info, not stripped\n/opt/cni/bin/dhcp:        ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, with debug_info, not stripped\n/opt/cni/bin/flannel:     ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, with debug_info, not stripped\n/opt/cni/bin/host-device: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, with debug_info, not stripped\n/opt/cni/bin/host-local:  ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, with debug_info, not stripped\n/opt/cni/bin/ipvlan:      ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, with debug_info, not stripped\n/opt/cni/bin/loopback:    ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, with debug_info, not stripped\n/opt/cni/bin/macvlan:     ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, with debug_info, not stripped\n/opt/cni/bin/portmap:     ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, with debug_info, not stripped\n/opt/cni/bin/ptp:         ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, with debug_info, not stripped\n/opt/cni/bin/sample:      ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, with debug_info, not stripped\n/opt/cni/bin/tuning:      ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, with debug_info, not stripped\n/opt/cni/bin/vlan:        ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, with debug_info, not stripped\n")),(0,r.kt)("p",null,"\u9996\u5148\u6211\u5011\u5148\u89c0\u5bdf ",(0,r.kt)("strong",{parentName:"p"},"--cni-bin-dir")," \u8a2d\u5b9a\u7684\u8cc7\u6599\u593e\uff0c\u88e1\u9762\u653e\u7f6e\u4e86\u5404\u5f0f\u5404\u6a23\u7684\u57f7\u884c\u6a94\uff0c\u6bcf\u500b\u57f7\u884c\u6a94\u6848\u7684\u540d\u7a31\u5fc5\u9808\u8207 ",(0,r.kt)("strong",{parentName:"p"},"Network Configuration")," \u88e1\u9762\u7684 ",(0,r.kt)("strong",{parentName:"p"},"type")," \u4e00\u81f4\u3002"),(0,r.kt)("p",null,"\u4e0a\u8ff0\u6240\u6709\u7684\u57f7\u884c\u6a94\u9664\u4e86 ",(0,r.kt)("strong",{parentName:"p"},"flannel")," \u5916\u90fd\u662f\u5167\u5efa\u7684\uff0c\u5176\u4ed6\u7684\u57f7\u884c\u6a94\u90fd\u662f ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/containernetworking/plugins/tree/master/plugins/main"},"ContainerNetworking GitHub")," \u5b98\u65b9\u7dad\u8b77\u7684\uff0c\u7b97\u662f\u63d0\u4f9b\u4e00\u4e9b\u6700\u57fa\u672c\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"CNI")," \u89e3\u6c7a\u65b9\u6848\u7d66\u5176\u4ed6\u7684\u958b\u767c\u8005\u91cd\u8907\u5229\u7528\u3002\n\u6240\u4ee5\u5982\u679c\u4eca\u5929\u9700\u8981\u81ea\u884c\u958b\u767c\u4e00\u5957 CNI\uff0c\u5247\u5fc5\u9808\u8981\u5c07\u8a72\u57f7\u884c\u6a94\u4e5f\u653e\u5165\u5230\u9019\u500b\u8cc7\u6599\u593e\u4e2d\u624d\u53ef\u4ee5\u88ab\u4f7f\u7528\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash="},'vagrant@k8s-dev:~$ sudo ls /etc/cni/net.d/\n10-flannel.conflist\n\nvagrant@k8s-dev:~$ sudo cat /etc/cni/net.d/10-flannel.conflist\n{\n  "name": "cbr0",\n  "plugins": [\n    {\n      "type": "flannel",\n      "delegate": {\n        "hairpinMode": true,\n        "isDefaultGateway": true\n      }\n    },\n    {\n      "type": "portmap",\n      "capabilities": {\n        "portMappings": true\n      }\n    }\n  ]\n}\nvagrant@k8s-dev:~$\n')),(0,r.kt)("p",null,"\u9996\u5148\u6211\u5011\u5148\u89c0\u5bdf ",(0,r.kt)("strong",{parentName:"p"},"--cni-conf-dir")," \u8a2d\u5b9a\u7684\u8cc7\u6599\u593e\uff0c\u88e1\u9762\u53ea\u6709\u653e\u7f6e\u4e00\u500b\u6a94\u6848 ",(0,r.kt)("strong",{parentName:"p"},"10-flannel.conflist"),"\uff0c \u9019\u500b\u6a94\u6848\u662f\u5b89\u88dd ",(0,r.kt)("inlineCode",{parentName:"p"},"flannel")," \u6642\u4e00\u4f75\u5b89\u88dd\u9032\u4f86\u7684\u3002\u9810\u8a2d\u60c5\u6cc1\u4e0b\u8a72\u8cc7\u6599\u593e\u662f\u5b8c\u5168\u7a7a\u7684\uff0c\u4e0d\u6703\u6709\u4efb\u4f55\u8a2d\u5b9a\u3002"),(0,r.kt)("p",null,"\u6240\u4ee5\u9019\u500b\u904b\u4f5c\u6d41\u7a0b\u662f\u6b32\u4f7f\u7528\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"CNI")," \u89e3\u6c7a\u65b9\u6848\u5fc5\u9808\u8981"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u5b89\u88dd\u6b32\u4f7f\u7528\u7684 binary \u6a94\u6848\u653e\u5230 --cni-bin-dir \u7684\u4f4d\u7f6e"),(0,r.kt)("li",{parentName:"ol"},"\u5c07\u8981\u4f7f\u7528\u7684 CNI \u8a2d\u5b9a\u6a94\u6848(json) \u653e\u5230 --cni-conf-dir \u7684\u4f4d\u7f6e")),(0,r.kt)("p",null,"\u540c\u6642\u9019\u908a\u8981\u6ce8\u610f\u7684\u662f ",(0,r.kt)("strong",{parentName:"p"},"CNI")," \u662f\u4f34\u96a8 ",(0,r.kt)("strong",{parentName:"p"},"kubelet")," \u53bb\u904b\u884c\u7684\uff0c\u56e0\u6b64 kubernetes cluster \u5167\u7684\u6240\u6709\u7bc0\u9ede\u90fd\u8981\u7368\u7acb\u9032\u884c\u4e0a\u8ff0\u7684\u8a2d\u5b9a\uff0c\u6240\u4ee5\u5176\u5be6\u4e5f\u662f\u53ef\u4ee5\u505a\u5230\u6bcf\u4e00\u53f0\u7bc0\u9ede\u4f7f\u7528\u4e0d\u540c\u7684 CNI \u89e3\u6c7a\u65b9\u6848\u6216\u662f\u76f8\u540c\u89e3\u6c7a\u65b9\u6848\u4f46\u662f\u63a1\u7528\u4e0d\u540c\u7684\u8a2d\u5b9a\u6a94\u6848\u3002"),(0,r.kt)("p",null,"\u53e6\u5916\u4e0a\u8ff0 ",(0,r.kt)("strong",{parentName:"p"},"flannel")," \u5b89\u88dd\u7684\u6a94\u6848 ",(0,r.kt)("strong",{parentName:"p"},"10-flannel.conflist")," \u662f\u4e00\u500b ",(0,r.kt)("strong",{parentName:"p"},"Network Configuration List")," \u7684\u683c\u5f0f"),(0,r.kt)("p",null,"\u5176\u88e1\u9762\u63cf\u8ff0\u4e86\u5169\u500b\u8981",(0,r.kt)("strong",{parentName:"p"},"\u4f9d\u5e8f"),"\u57f7\u884c\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"CNI")," binary,\u5206\u5225\u662f ",(0,r.kt)("strong",{parentName:"p"},"flannel")," \u4ee5\u53ca ",(0,r.kt)("strong",{parentName:"p"},"portmap"),"\uff0c\u6240\u4ee5\u4e5f\u8981\u78ba\u8a8d\u9019\u5169\u500b\u6a94\u6848\u90fd\u6709\u5728 ",(0,r.kt)("strong",{parentName:"p"},"--cni-bin-dir")," \u7684\u4f4d\u7f6e\u5167\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash="},'  "plugins": [\n    {\n      "type": "flannel",\n      "delegate": {\n        "hairpinMode": true,\n        "isDefaultGateway": true\n      }\n    },\n    {\n      "type": "portmap",\n      "capabilities": {\n        "portMappings": true\n      }\n    }\n  ]\n')),(0,r.kt)("p",null,"\u7531\u9019\u908a\u53ef\u4ee5\u89c0\u5bdf\u5230 ",(0,r.kt)("strong",{parentName:"p"},"flannel")," \u672c\u8eab\u4e26\u4e0d\u662f\u55ae\u7d14\u53ea\u4f9d\u8cf4\u81ea\u5df1\u7684 binary \u53bb\u5b8c\u6210\u6240\u9700\u529f\u80fd\u7684\uff0c\u5be6\u969b\u4e0a\u80cc\u5f8c\u7528\u5230\u7684 binary \u6578\u91cf\u66f4\u591a\uff0c\u4e4b\u5f8c\u6703\u6709\u7bc7\u6587\u7ae0\u8a73\u7d30\u4ecb\u7d39 ",(0,r.kt)("strong",{parentName:"p"},"flannel")," \u7684\u904b\u4f5c\u539f\u7406\u8207\u5b89\u88dd\u904e\u7a0b\u3002"),(0,r.kt)("p",null,"\u6240\u4ee5\u7528\u4e00\u500b\u6d41\u7a0b\u4f86\u63cf\u8ff0\u4e00\u4e0b\u7576\u524d\u74b0\u5883\u5167\u7684 CNI \u904b\u4f5c\u6d41\u7a0b"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u4f7f\u7528\u8005\u767c\u9001\u5275\u5efa Pod \u7684\u8acb\u6c42\uff0c\u6700\u5f8c\u9001\u5230 Kubelet"),(0,r.kt)("li",{parentName:"ol"},"Kubelet \u900f\u904e dockershim + docker-containerd \u7684\u65b9\u5f0f\u5275\u5efa\u51fa\u9700\u8981\u7684 container"),(0,r.kt)("li",{parentName:"ol"},"\u7576 Pod \u5275\u5efa\u5b8c\u7562\u5f8c\uff0c kubelet \u6e96\u5099\u900f\u904e CNI \u7684\u6d41\u7a0b\u4f86\u8a2d\u5b9a\u8a72 Pod \u5167\u7684\u7db2\u8def\na. \u53bb\u641c\u5c0b --cni-conf-dir \u8cc7\u6599\u593e\u4e0b\u7684\u6240\u6709\u6a94\u6848\uff0c\u4f9d\u7167\u5b57\u6bcd\u6392\u5e8f\u7684\u65b9\u5f0f\u627e\u5230\u7b2c\u4e00\u500b\u5408\u6cd5\u7684\u8a2d\u5b9a\u6a94\u6848\uff0c\u9019\u500b\u7bc4\u4f8b\u5c31\u662f ",(0,r.kt)("strong",{parentName:"li"},"10-flannel.conflist"),"\nb. \u89e3\u8b80\u8a72\u8a2d\u5b9a\u6a94\u6848\u7684\u5167\u5bb9 ",(0,r.kt)("strong",{parentName:"li"},"Network Configuration List"),"\uff0c \u63a5\u8005\u91dd\u5c0d\u6bcf\u500b\u8a72\u9663\u5217\u5167\u7684\u5167\u5bb9\u53bb\u89e3\u8b80\uff0c\u8b80\u53d6\u5230\u7b2c\u4e00\u500b\u9805\u76ee\u7684 ",(0,r.kt)("strong",{parentName:"li"},"type")," \u662f ",(0,r.kt)("strong",{parentName:"li"},"flannel"),"\nc. \u5c07\u6240\u6709\u9700\u8981\u7684\u53c3\u6578\u6e96\u5099\uff0c\u547c\u53eb --cni-bin-dir \u5e95\u4e0b\u7684 ",(0,r.kt)("strong",{parentName:"li"},"flannel")," binary\nd. \u57f7\u884c\u5b8c\u7562\u5c07\u76f8\u95dc\u7684 STDOUT \u6e96\u5099\u597d\uff0c\u7136\u5f8c\u518d\u6b21\u547c\u53eb --cni-bin-dir \u5e95\u4e0b\u7684 ",(0,r.kt)("strong",{parentName:"li"},"portmap")," binary"),(0,r.kt)("li",{parentName:"ol"},"CNI \u76f8\u95dc\u7a0b\u5e8f\u57f7\u884c\u5b8c\u7562")),(0,r.kt)("h3",{id:"kubenet"},"Kubenet"),(0,r.kt)("p",null,"\u525b\u525b\u524d\u8ff0\u8ac7\u4e86\u9019\u9ebc\u591a\uff0c\u63a5\u4e0b\u4f86\u770b\u4e00\u4e0b\u53e6\u5916\u4e00\u500b ",(0,r.kt)("strong",{parentName:"p"},"network-plugin")," \u7684\u9078\u9805 ",(0,r.kt)("strong",{parentName:"p"},"kubenet")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"kubenet")," \u662f\u500b\u975e\u5e38\u7c21\u55ae\u7684 L2 Bridge \u5be6\u73fe\uff0c\u80cc\u5f8c\u7684\u5be6\u73fe\u4e5f\u9084\u662f\u900f\u904e\u57fa\u672c\u7684 CNI \u89e3\u6c7a\u65b9\u6848\u4f86\u5efa\u7acb\u4e00\u500b\u975e\u5e38\u7c21\u55ae\u7684\u74b0\u5883\uff0c\u9019\u500b\u74b0\u5883\u7c21\u55ae\u5230\u6839\u672c\u4e0d\u80fd\u5be6\u73fe\u7bc0\u9ede\u5c0d\u7bc0\u9ede\u6e9d\u901a\uff0c\u53ea\u80fd\u7528\u5728\u55ae\u4e00\u7bc0\u9ede\u6216\u662f\u4f60\u6709\u5176\u4ed6\u7684\u65b9\u5f0f\u53bb\u8a2d\u5b9a\u7bc0\u9ede\u9593\u7684\u7db2\u8def\u8def\u7531\u554f\u984c\u3002"),(0,r.kt)("p",null,"\u4f7f\u7528\u9019\u500b ",(0,r.kt)("strong",{parentName:"p"},"Kubenet")," \u9078\u9805\u7684\u8a71\uff0c\u4e5f\u662f\u8981\u78ba\u8a8d\u7cfb\u7d71\u4e0a ",(0,r.kt)("strong",{parentName:"p"},"--cni-bin-conf")," \u88e1\u9762\u6709\u4e0b\u5217\u7684 binary"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"bridge"),(0,r.kt)("li",{parentName:"ul"},"lo"),(0,r.kt)("li",{parentName:"ul"},"host-local")),(0,r.kt)("p",null,"\u6240\u4ee5\u57fa\u672c\u4e0a\u9019\u500b\u9078\u9805\u5c31\u662f\u62ff\u4f86\u6e2c\u8a66\u7528\uff0c\u4e0d\u6703\u62ff\u4f86\u5546\u7528\u73fe\u5728\u4e5f\u4e0d\u662f\u9810\u8a2d\u9078\u9805\uff0c\u6709\u8208\u8da3\u7684\u77ad\u89e3\u66f4\u591a\u7d30\u7bc0\u7684\u7d30\u7bc0\u53ef\u4ee5\u53c3\u8003",(0,r.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/network-plugins/#kubenet"},"\u5b98\u7db2\u8aaa\u660e")),(0,r.kt)("h2",{id:"pause-container"},"Pause Container"),(0,r.kt)("p",null,"\u4e0a\u7bc7\u6587\u7ae0\u6709\u8a0e\u8ad6\u904e\u6240\u6709\u7684 Sandbox Container \u7684\u6982\u5ff5\uff0c\u4f5c\u70ba\u4e00\u500b\u5275\u4e16 container\uff0c\u8b93\u4f7f\u7528\u8005\u7684 container \u90fd\u8ddf\u5176\u5171\u4eab ",(0,r.kt)("inlineCode",{parentName:"p"},"network namespace"),"\uff0c\u85c9\u6b64\u6eff\u8db3\u591a\u500b container \u53ef\u4ee5\u5171\u7528"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u7db2\u5361\u540d\u7a31"),(0,r.kt)("li",{parentName:"ul"},"IP \u5730\u5740"),(0,r.kt)("li",{parentName:"ul"},"IPtables \u898f\u5247"),(0,r.kt)("li",{parentName:"ul"},"\u8def\u7531\u898f\u5247"),(0,r.kt)("li",{parentName:"ul"},"...\u7b49\u5404\u7a2e\u7db2\u8def\u8cc7\u6e90")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/K95n3LP.png",alt:null}),"\n\u4e0a\u5716\u7bc0\u9304\u81ea",(0,r.kt)("a",{parentName:"p",href:"https://kubernetes.io/blog/2017/11/containerd-container-runtime-options-kubernetes/"},"Containerd Brings More Container Runtime Options for Kubernetes\n")),(0,r.kt)("p",null,"\u800c ",(0,r.kt)("strong",{parentName:"p"},"kubernetes")," \u4e4b\u4e2d\u4e5f\u662f\u7528\u4e86\u76f8\u540c\u6982\u5ff5\u7684\u65b9\u5f0f\u53bb\u5be6\u73fe\u6240\u8b02\u7684 ",(0,r.kt)("strong",{parentName:"p"},"Pod"),"\uff0c\u800c\u9019\u500b ",(0,r.kt)("strong",{parentName:"p"},"Sandbox Contaienr")," \u4e5f\u88ab\u7a31\u70ba ",(0,r.kt)("strong",{parentName:"p"},"Infrastructure Container"),"\u3002"),(0,r.kt)("p",null,"\u5982\u679c\u4ed4\u7d30\u89c0\u5bdf ",(0,r.kt)("strong",{parentName:"p"},"kubelet")," \u7684\u8a2d\u5b9a\u53c3\u6578\u5c31\u6703\u770b\u5230\u4e00\u500b\u76f8\u95dc\u7684\u8a2d\u5b9a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash="},"vagrant@k8s-dev:~$ ps axuw | grep kubelet | grep cni\nroot      2433  2.0  2.2 1346404 90016 ?       Ssl  00:37   4:21 /usr/bin/kubelet\n--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf\n--kubeconfig=/etc/kubernetes/kubelet.conf --config=/var/lib/kubelet/config.yaml\n--cgroup-driver=cgroupfs --network-plugin=cni\n--pod-infra-container-image=k8s.gcr.io/pause:3.1 --resolv-conf=/run/systemd/resolve/resolv.conf\n")),(0,r.kt)("p",null,"\u4e0a\u8ff0\u7684\u8a2d\u5b9a\u4e2d\u5c07 ",(0,r.kt)("strong",{parentName:"p"},"--pod-infra-container-image")," \u8a2d\u5b9a\u6210 k8s.gcr.io/pause:3.1, \u9019\u500b\u662f\u5176 container image \u7684\u4f4d\u7f6e\uff0c\u4ee3\u8868 kubernetes \u6703\u900f\u904e\u9019\u500b image \u5275\u7acb\u4e00\u500b sandbox container \u7576\u505a\u57fa\u5e95\uff0c\u63a5\u4e0b\u4f86\u624d\u628a\u4f7f\u7528\u8005\u898f\u5283\u7684 container \u90fd\u8207\u5176\u5171\u4eab ",(0,r.kt)("strong",{parentName:"p"},"network namespace")),(0,r.kt)("p",null,"\u9019\u6642\u5019\u5982\u679c\u900f\u904e ",(0,r.kt)("strong",{parentName:"p"},"docekr ps")," \u7684\u6307\u4ee4\u53bb\u89c0\u5bdf\uff0c\u53ef\u4ee5\u89c0\u5bdf\u5230\u6709\u975e\u5e38\u591a\u7684 ",(0,r.kt)("strong",{parentName:"p"},"pause")," container \u88ab\u5275\u7acb\uff0c\u800c\u5176 container name \u90fd\u662f\u4e00\u500b\u4e00\u500b\u7684 ",(0,r.kt)("strong",{parentName:"p"},"Pod")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash="},'vagrant@k8s-dev:~$ sudo docker ps | grep pause\n10a6fcd1692d        k8s.gcr.io/pause:3.1   "/pause"                 6 hours ago         Up 6 hours                              k8s_POD_coredns-86c58d9df4-srncw_kube-system_a448c5f9-dc93-11e9-9d35-080027c2be11_3\n104bb6a0c83e        k8s.gcr.io/pause:3.1   "/pause"                 6 hours ago         Up 6 hours                              k8s_POD_coredns-86c58d9df4-v8f5d_kube-system_a449ee4f-dc93-11e9-9d35-080027c2be11_4\n4581173892a6        k8s.gcr.io/pause:3.1   "/pause"                 6 hours ago         Up 6 hours                              k8s_POD_kube-proxy-dl4bm_kube-system_a46016b1-dc93-11e9-9d35-080027c2be11_1\n209b3af9308c        k8s.gcr.io/pause:3.1   "/pause"                 6 hours ago         Up 6 hours                              k8s_POD_kube-flannel-ds-amd64-5xmgf_kube-system_a4626d19-dc93-11e9-9d35-080027c2be11_1\n1710678a5a02        k8s.gcr.io/pause:3.1   "/pause"                 6 hours ago         Up 6 hours                              k8s_POD_kube-scheduler-k8s-dev_kube-system_15c129447b0aa0f760fe2d7ba217ecd4_1\nc63c097c20c5        k8s.gcr.io/pause:3.1   "/pause"                 6 hours ago         Up 6 hours                              k8s_POD_kube-controller-manager-k8s-dev_kube-system_8a8f55dd50b2821b309adc83a00139ff_1\n3bee914719b2        k8s.gcr.io/pause:3.1   "/pause"                 6 hours ago         Up 6 hours                              k8s_POD_kube-apiserver-k8s-dev_kube-system_d834af7c4c9483e2d999ded255dd7798_1\n82aa2e03cec9        k8s.gcr.io/pause:3.1   "/pause"                 6 hours ago         Up 6 hours                              k8s_POD_etcd-k8s-dev_kube-system_71e763946160f2ea04d6946ece43e176_1\n')),(0,r.kt)("p",null,"Pause container \u7684\u539f\u59cb\u5167\u5bb9\u90fd\u53ef\u4ee5\u5728 ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/kubernetes/kubernetes/blob/master/build/pause/pause.c"},"GitHub")," \u9019\u908a\u627e\u5230\uff0c\u5176\u5be6\u4f5c\u975e\u5e38\u7c21\u55ae\uff0c\u5c31\u662f\u4e00\u500b\u6514\u622a\u76f8\u95dc\u7cfb\u7d71\u8a0a\u865f\u5f8c\u900f\u904e system call \u9032\u884c ",(0,r.kt)("strong",{parentName:"p"},"pause")," \u7684\u61c9\u7528\u7a0b\u5f0f\u800c\u5df2\uff0c\u76f8\u95dc\u5167\u5bb9\u5982\u4e0b\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c="},'/*\nCopyright 2016 The Kubernetes Authors.\nLicensed under the Apache License, Version 2.0 (the "License");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n    http://www.apache.org/licenses/LICENSE-2.0\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\n#include <signal.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <sys/types.h>\n#include <sys/wait.h>\n#include <unistd.h>\n\n#define STRINGIFY(x) #x\n#define VERSION_STRING(x) STRINGIFY(x)\n\n#ifndef VERSION\n#define VERSION HEAD\n#endif\n\nstatic void sigdown(int signo) {\n  psignal(signo, "Shutting down, got signal");\n  exit(0);\n}\n\nstatic void sigreap(int signo) {\n  while (waitpid(-1, NULL, WNOHANG) > 0)\n    ;\n}\n\nint main(int argc, char **argv) {\n  int i;\n  for (i = 1; i < argc; ++i) {\n    if (!strcasecmp(argv[i], "-v")) {\n      printf("pause.c %s\\n", VERSION_STRING(VERSION));\n      return 0;\n    }\n  }\n\n  if (getpid() != 1)\n    /* Not an error because pause sees use outside of infra containers. */\n    fprintf(stderr, "Warning: pause should be the first process\\n");\n\n  if (sigaction(SIGINT, &(struct sigaction){.sa_handler = sigdown}, NULL) < 0)\n    return 1;\n  if (sigaction(SIGTERM, &(struct sigaction){.sa_handler = sigdown}, NULL) < 0)\n    return 2;\n  if (sigaction(SIGCHLD, &(struct sigaction){.sa_handler = sigreap,\n                                             .sa_flags = SA_NOCLDSTOP},\n                NULL) < 0)\n    return 3;\n\n  for (;;)\n    pause();\n  fprintf(stderr, "Error: infinite loop terminated\\n");\n  return 42;\n}\n')),(0,r.kt)("h2",{id:"cri-impact"},"CRI Impact"),(0,r.kt)("p",null,"\u6700\u5f8c\u4f86\u5206\u4eab\u7684\u662f ",(0,r.kt)("strong",{parentName:"p"},"CRI")," \u5c0d ",(0,r.kt)("strong",{parentName:"p"},"CNI")," \u7684\u95dc\u4fc2"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"CNI")," \u4f5c\u70ba\u5b8c\u6210\u6574\u9ad4 Container \u5275\u5efa\u7684\u4e00\u90e8\u4efd\uff0c\u6240\u4ee5\u90fd\u662f\u7531 CRI \u89e3\u6c7a\u65b9\u6848\u90a3\u908a\u53bb\u8655\u7406\u76f8\u95dc\u6d41\u7a0b\uff0c\u56e0\u6b64\u4e0d\u540c\u7684 ",(0,r.kt)("strong",{parentName:"p"},"CRI")," \u89e3\u6c7a\u65b9\u6848\u5c0d\u65bc ",(0,r.kt)("strong",{parentName:"p"},"CNI")," \u7684\u8655\u7406\u6d41\u7a0b\u4e5f\u5c31\u4e0d\u4e00\u5b9a\u76f8\u4f3c\u3002\n\u8b6c\u5982\u4e0a\u8ff0\u6709\u63d0\u5230\u65bc ",(0,r.kt)("strong",{parentName:"p"},"dockershime")," \u7684\u74b0\u5883\u4e0b\uff0c\u6703\u5c07 ",(0,r.kt)("strong",{parentName:"p"},"--cni-conf-dir")," \u5167\u7684\u8a2d\u5b9a\u6a94\u6848\u9032\u884c\u6392\u5e8f\uff0c\u4e26\u4e14\u4f7f\u7528\u7b2c\u4e00\u500b\u5408\u6cd5\u7684\u8a2d\u5b9a\u6a94\u6848\u3002"),(0,r.kt)("p",null,"\u76f8\u95dc\u7684\u539f\u59cb\u78bc\u53ef\u4ee5\u53c3\u8003 ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/kubernetes/kubernetes/blob/master/pkg/kubelet/dockershim/network/cni/cni.go#L154-L216"},"GitHub")),(0,r.kt)("p",null,"\u800c\u5982\u679c\u63a1\u7528\u7684\u662f\u57fa\u65bc ",(0,r.kt)("inlineCode",{parentName:"p"},"containerd")," \u6216\u662f ",(0,r.kt)("inlineCode",{parentName:"p"},"cri-o")," \u9019\u7a2e\u89e3\u6c7a\u65b9\u6848\u7684\u8a71\uff0c\u6700\u5f8c\u90fd\u6703\u900f\u904e ",(0,r.kt)("strong",{parentName:"p"},"ocicni")," \u9019\u500b\u5de5\u5177\u53bb\u8655\u7406\uff0c\u800c\u540c\u6a23\u7684\u6d41\u7a0b\u5176\u904b\u4f5c\u904e\u7a0b\u5c31\u4e0d\u592a\u4e00\u6a23\uff0c\u53cd\u800c\u6703\u662f\u4e00\u6b21\u8b80\u53d6\u5168\u90e8\u7684\u8cc7\u6599\u9032\u4f86\uff0c\u4e4b\u5f8c\u518d\u6162\u6162\u8655\u7406"),(0,r.kt)("p",null,"\u76f8\u95dc\u7684\u539f\u59cb\u78bc\u53ef\u4ee5\u53c3\u8003 ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/cri-o/ocicni/blob/master/pkg/ocicni/ocicni.go#L266"},"GitHub")),(0,r.kt)("h1",{id:"summary"},"Summary"),(0,r.kt)("p",null,"\u672c\u7bc7\u6587\u7ae0\u8ddf\u5927\u5bb6\u8a0e\u8ad6\u4e86\u4e0b Kubernets \u8207 CNI \u76f8\u95dc\u7684\u8a2d\u5b9a\uff0c\u53ea\u8981\u5c0d\u9019\u4e9b\u8cc7\u6599\u593e\u6709\u57fa\u672c\u7684\u7406\u89e3\uff0c\u4ee5\u5f8c\u770b\u5230\u4efb\u4f55 kubernetes cluster \u90fd\u80fd\u5920\u6709\u8fa6\u6cd5\u7c97\u7565\u7684\u770b\u4e00\u4e0b\u9019\u500b cluster \u662f\u7528\u54ea\u5957  CNI \u4f86\u63d0\u4f9b\u670d\u52d9\u7684\u3002\n\u7279\u5225\u7684\u662f\u5982\u679c\u4f60\u4eca\u5929\u4f7f\u7528\u7684\u662f\u516c\u6709\u96f2\u7684\u670d\u52d9\uff0c\u8b6c\u5982 GKE, AKS, EKS \u7b49\u670d\u52d9\uff0c\u4f60\u4e5f\u53ef\u4ee5\u5617\u8a66\u53bb\u770b\u770b\u9019\u4e9b\u516c\u6709\u96f2\u5230\u5e95\u662f\u7528\u54ea\u5957 CNI, \u5176\u8a2d\u5b9a\u6a94\u6848\u53c8\u662f\u5982\u4f55\uff0c\u63a5\u8005\u53ef\u4ee5\u642d\u914d\u4ed6\u5011\u7684\u6587\u4ef6\u6216\u662f\u539f\u59cb\u78bc\u53bb\u7406\u89e3\u5176\u5176\u904b\u4f5c\u539f\u7406\u3002"))}k.isMDXComponent=!0}}]);
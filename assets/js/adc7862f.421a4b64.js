"use strict";(self.webpackChunkhwchiu=self.webpackChunkhwchiu||[]).push([[88515],{3905:(e,t,l)=>{l.d(t,{Zo:()=>k,kt:()=>I});var n=l(67294);function r(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}function o(e,t){var l=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),l.push.apply(l,n)}return l}function a(e){for(var t=1;t<arguments.length;t++){var l=null!=arguments[t]?arguments[t]:{};t%2?o(Object(l),!0).forEach((function(t){r(e,t,l[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(l)):o(Object(l)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(l,t))}))}return e}function u(e,t){if(null==e)return{};var l,n,r=function(e,t){if(null==e)return{};var l,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)l=o[n],t.indexOf(l)>=0||(r[l]=e[l]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)l=o[n],t.indexOf(l)>=0||Object.prototype.propertyIsEnumerable.call(e,l)&&(r[l]=e[l])}return r}var p=n.createContext({}),i=function(e){var t=n.useContext(p),l=t;return e&&(l="function"==typeof e?e(t):a(a({},t),e)),l},k=function(e){var t=i(e.components);return n.createElement(p.Provider,{value:t},e.children)},P="mdxType",s={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},N=n.forwardRef((function(e,t){var l=e.components,r=e.mdxType,o=e.originalType,p=e.parentName,k=u(e,["components","mdxType","originalType","parentName"]),P=i(l),N=r,I=P["".concat(p,".").concat(N)]||P[N]||s[N]||o;return l?n.createElement(I,a(a({ref:t},k),{},{components:l})):n.createElement(I,a({ref:t},k))}));function I(e,t){var l=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=l.length,a=new Array(o);a[0]=N;var u={};for(var p in t)hasOwnProperty.call(t,p)&&(u[p]=t[p]);u.originalType=e,u[P]="string"==typeof e?e:r,a[1]=u;for(var i=2;i<o;i++)a[i]=l[i];return n.createElement.apply(null,a)}return n.createElement.apply(null,l)}N.displayName="MDXCreateElement"},8789:(e,t,l)=>{l.r(t),l.d(t,{assets:()=>p,contentTitle:()=>a,default:()=>s,frontMatter:()=>o,metadata:()=>u,toc:()=>i});var n=l(87462),r=(l(67294),l(3905));const o={title:"\u5f9e\u7db2\u8def\u89c0\u9ede\u4f86\u770b\u5c0e\u5165 Kubernetes \u7684\u53ef\u80fd\u75db\u9ede",authors:"hwchiu",tags:["CNI","Kubernetes","Network"],description:"\u63a2\u8a0e Kubernetes \u67b6\u69cb\u4e0b\u7db2\u8def\u80fd\u529b\u7684\u4e0d\u8db3\uff0c\u5c0e\u5165 Kubernetes \u6642\u6709\u53ef\u80fd\u6703\u7121\u6cd5\u89e3\u6c7a\u7684\u7db2\u8def\u67b6\u69cb\u554f\u984c\u3002",date:new Date("2021-04-25T11:16:06.000Z")},a="\u524d\u8a00",u={unversionedId:"techPost/2021/k8s-network-issue",id:"techPost/2021/k8s-network-issue",title:"\u5f9e\u7db2\u8def\u89c0\u9ede\u4f86\u770b\u5c0e\u5165 Kubernetes \u7684\u53ef\u80fd\u75db\u9ede",description:"\u63a2\u8a0e Kubernetes \u67b6\u69cb\u4e0b\u7db2\u8def\u80fd\u529b\u7684\u4e0d\u8db3\uff0c\u5c0e\u5165 Kubernetes \u6642\u6709\u53ef\u80fd\u6703\u7121\u6cd5\u89e3\u6c7a\u7684\u7db2\u8def\u67b6\u69cb\u554f\u984c\u3002",source:"@site/docs/techPost/2021/k8s-network-issue.md",sourceDirName:"techPost/2021",slug:"/techPost/2021/k8s-network-issue",permalink:"/docs/techPost/2021/k8s-network-issue",draft:!1,tags:[{label:"CNI",permalink:"/docs/tags/cni"},{label:"Kubernetes",permalink:"/docs/tags/kubernetes"},{label:"Network",permalink:"/docs/tags/network"}],version:"current",frontMatter:{title:"\u5f9e\u7db2\u8def\u89c0\u9ede\u4f86\u770b\u5c0e\u5165 Kubernetes \u7684\u53ef\u80fd\u75db\u9ede",authors:"hwchiu",tags:["CNI","Kubernetes","Network"],description:"\u63a2\u8a0e Kubernetes \u67b6\u69cb\u4e0b\u7db2\u8def\u80fd\u529b\u7684\u4e0d\u8db3\uff0c\u5c0e\u5165 Kubernetes \u6642\u6709\u53ef\u80fd\u6703\u7121\u6cd5\u89e3\u6c7a\u7684\u7db2\u8def\u67b6\u69cb\u554f\u984c\u3002",date:"2021-04-25T11:16:06.000Z"},sidebar:"techPost",previous:{title:"Summary",permalink:"/docs/techPost/2021/iThome_Challenge/day30"},next:{title:"Kubernetes \u4e4b\u5c01\u5305\u53bb\u54ea\u5152",permalink:"/docs/techPost/2021/k8s-tcpdump"}},p={},i=[{value:"\u56fa\u5b9a IP/MAC",id:"\u56fa\u5b9a-ipmac",level:2},{value:"\u4e3b\u5f9e\u7db2\u8def\u67b6\u69cb",id:"\u4e3b\u5f9e\u7db2\u8def\u67b6\u69cb",level:2},{value:"\u591a\u79df\u6236\u7db2\u8def\u9700\u6c42",id:"\u591a\u79df\u6236\u7db2\u8def\u9700\u6c42",level:2},{value:"Kube-Proxy",id:"kube-proxy",level:2},{value:"CNI",id:"cni",level:2},{value:"IP/MAC \u56fa\u5b9a",id:"ipmac-\u56fa\u5b9a",level:2},{value:"\u4e3b\u5f9e\u7db2\u8def\u67b6\u69cb",id:"\u4e3b\u5f9e\u7db2\u8def\u67b6\u69cb-1",level:2},{value:"\u591a\u5f9e\u79df\u6236\u9700\u6c42",id:"\u591a\u5f9e\u79df\u6236\u9700\u6c42",level:2},{value:"\u6df7\u642d CNI",id:"\u6df7\u642d-cni",level:2},{value:"\u62bd\u96e2 Kubernetes",id:"\u62bd\u96e2-kubernetes",level:2}],k={toc:i},P="wrapper";function s(e){let{components:t,...l}=e;return(0,r.kt)(P,(0,n.Z)({},k,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"\u524d\u8a00"},"\u524d\u8a00"),(0,r.kt)("p",null,"\u96a8\u8005 Kubernetes \u5bb9\u5668\u7ba1\u7406\u5e73\u53f0\u7684\u98a8\u884c\uff0c\u6108\u4f86\u6108\u591a\u7684\u884c\u696d\u958b\u59cb\u8e0f\u5165\u5230\u5bb9\u5668\u5316\u7684\u4e16\u754c\u3002\u8a31\u591a\u7b2c\u4e00\u6b21\u63a5\u89f8\u5bb9\u5668\u5316\u7684\u4f7f\u7528\u8005\u90fd\u6703\u770b\u5230\u5404\u7a2e\u95dc\u65bc\u5bb9\u5668\u5316\u7684\u597d\u8655\uff0c\u9664\u4e86\u8ddf Bare Metal \u76f4\u63a5\u76f8\u6bd4\u5916\uff0cVM \u9019\u7a2e\u91cd\u91cf\u7d1a\u865b\u64ec\u5316\u7684\u6280\u8853\u4e5f\u662f\u975e\u5e38\u5bb9\u6613\u88ab\u62ff\u4f86\u6bd4\u8f03\u7684\u5c0d\u8c61\u3002"),(0,r.kt)("p",null,"\u8ac7\u8ad6\u5230 VM \u7684\u4f7f\u7528\u65b9\u5f0f\u6642\uff0c\u6700\u5e38\u4f7f\u7528\u7684\u65b9\u5f0f\u5c31\u662f\u900f\u904e\u516c\u6709\u96f2\u7684\u74b0\u5883\u4f86\u67b6\u8a2d\u74b0\u5883\uff0c\u4efb\u4f55\u898f\u683c\u7684\u6a5f\u5668\u90fd\u53ef\u4ee5\u65bc\u5f48\u6307\u4e4b\u9593\u5275\u5efa\u5b8c\u6210\uff0c\u4f46\u662f\u6709\u4e00\u90e8\u5206\u7684\u7522\u696d\u8207\u4f7f\u7528\u8005\u537b\u6c92\u6709\u8fa6\u6cd5\u9019\u9ebc\u8f15\u6613\u7684\u5c07\u6240\u6709\u9700\u6c42\u8f49\u79fb\u5230\u516c\u6709\u96f2\u4e0a\uff0c\u53ef\u80fd\u6703\u5fc5\u9808\u8981\u65bc\u5730\u7aef\u6a5f\u623f\u4e2d\u900f\u904e OpenStack \u7b49\u65b9\u5f0f\u4f86\u81ea\u884c\u7ba1\u7406 VM\u3002"),(0,r.kt)("p",null,"\u5c0e\u5165 Kubernetes \u6642\u6709\u4e00\u500b\u5f88\u91cd\u8981\u7684\u4e8b\u60c5\u5c31\u662f\uff0c\u5718\u968a\u5230\u5e95\u6709\u6c92\u6709\u8fa6\u6cd5\u4e00\u6b21\u5230\u4f4d\uff1f\u901a\u5e38\u60c5\u6cc1\u4e0b\u662f\u4e0d\u592a\u53ef\u80fd\u4e00\u6b65\u5230\u4f4d\u3002\u9019\u610f\u5473\u8005\u6574\u500b\u5c0e\u5165\u904e\u7a0b\u4e2d\u6703\u6709\u4e00\u500b\u904e\u6e21\u6642\u671f\uff0c\u67b6\u69cb\u4e2d\u540c\u6642\u6703\u540c\u6642\u5b58\u5728\u820a\u6709\u67b6\u69cb\u4ee5\u53ca  Kubernetes\uff0c\u8981\u5982\u4f55\u78ba\u4fdd\u820a\u6709\u7684\u5546\u696d\u908f\u8f2f\u4e0d\u88ab\u5f71\u97ff\u5247\u662f\u5c0e\u5165 Kubernetes \u4e2d\u6975\u70ba\u56f0\u96e3\u7684\u554f\u984c\u3002"),(0,r.kt)("p",null,"\u672c\u7bc7\u6587\u7ae0\u5247\u6703\u5f9e\u7db2\u8def\u67b6\u69cb\u7684\u89d2\u5ea6\u53bb\u63a2\u8a0e\u4e0d\u540c\u7684\u4f7f\u7528\u8b70\u984c\uff0c\u800c\u9019\u4e9b\u8b70\u984c\u76ee\u524d\u6709\u54ea\u4e9b\u53ef\u80fd\u7684\u89e3\u6c7a\u65b9\u6848\u3002"),(0,r.kt)("p",null,"\u8a3b: \u9019\u4e9b\u56f0\u5883\u4e26\u4e0d\u4e00\u5b9a\u6bcf\u500b\u5718\u968a\u90fd\u6709\u9700\u6c42\uff0c\u53ea\u662f\u55ae\u7d14\u5f9e\u6280\u8853\u5c64\u9762\u63a2\u8a0e\u5230\u5e95 K8S \u7684\u7db2\u8def\u67b6\u69cb\u9084\u6709\u54ea\u4e9b\u4e0d\u8db3\u7684\u90e8\u5206\u3002"),(0,r.kt)("h1",{id:"\u56f0\u5883"},"\u56f0\u5883"),(0,r.kt)("h2",{id:"\u56fa\u5b9a-ipmac"},"\u56fa\u5b9a IP/MAC"),(0,r.kt)("p",null,"\u904e\u5f80\u900f\u904e Bare Metal \u6216\u662f VM \u4f86\u7ba1\u7406\u670d\u52d9\u6642\uff0c\u56fa\u5b9a IP/MAC \u662f\u500b\u5e38\u898b\u7684\u505a\u6cd5\u8207\u9700\u6c42\u3002\n\u4f7f\u7528 DHCP \u7ba1\u7406 IP \u5206\u914d\u8207\u767c\u9001\u7684\u67b6\u69cb\u6703\u5e0c\u671b VM \u53ef\u4ee5\u7d81\u5b9a MAC \u5730\u5740\uff0c\u5982\u6b64\u4e00\u4f86\u624d\u53ef\u4ee5\u78ba\u4fdd\u8a72\u670d\u52d9\u53ef\u80fd\u4f7f\u7528\u76f8\u540c\u7684 IP \u5730\u5740(\u5373\u4f7f VM \u9077\u79fb\u5230\u4e0d\u540c\u5be6\u9ad4\u6a5f\u5668)\u3002\n\u800c\u63a1\u7528\u975c\u614b IP \u90e8\u7f72\u7684\u5247\u6703\u5e0c\u671b\u670d\u52d9 IP \u56fa\u5b9a\u3002"),(0,r.kt)("p",null,"\u57fa\u65bc\u4e0a\u8ff0\u7684\u8a2d\u8a08\uff0c\u516c\u53f8\u5718\u968a\u901a\u5e38\u7fd2\u6163\u6240\u6709\u670d\u52d9\u90fd\u6703\u6709\u500b\u56fa\u5b9a IP\uff0c\u56e0\u6b64\u5167\u90e8\u9632\u706b\u7246\u6216\u662f\u76f8\u95dc\u670d\u52d9\u90fd\u6703\u900f\u904e\u4f7f\u7528\u9019\u4e9b IP \u4f86\u8655\u7406\u6d41\u91cf\u3002"),(0,r.kt)("p",null,"\u7576\u9019\u4e9b\u670d\u52d9\u6e96\u5099\u900f\u904e\u5bb9\u5668\u4f86\u8655\u7406\u6642\uff0c\u6703\u767c\u73fe\u5c31\u7b97\u662f\u900f\u904e docker container \u90fd\u5f88\u96e3\u8655\u7406\uff0c\u4f55\u6cc1\u662f Kubernetes \u66f4\u70ba\u8907\u96dc\u7684\u7ba1\u7406\u5e73\u53f0\u3002\n\u8a31\u8a31\u591a\u591a\u7684\u6587\u7ae0\u90fd\u6703\u544a\u8a34\u4f60\uff0c\u65bc\u5bb9\u5668\u5316\u7684\u4e16\u754c\u4e2d\u4e0d\u8981\u518d\u57f7\u8457\u65bc\u56fa\u5b9a IP \u4e86\uff0c\u8acb\u6539\u7528 DNS \u7684\u65b9\u5f0f\u4f86\u5b58\u53d6\u670d\u52d9\uff0c\u8b6c\u5982 Kubernetes \u5167\u7684 Service \u670d\u52d9\u3002"),(0,r.kt)("p",null,"\u4f7f\u7528\u9019\u985e\u578b\u7684\u89e3\u6c7a\u65b9\u6848\u5f9e\u908f\u8f2f\u4e0a\u770b\u53ef\u4ee5\u6eff\u8db3\u5927\u90e8\u5206\u9700\u6c42\uff0c\u5be6\u52d9\u4e0a\u5247\u6c92\u6709\u60f3\u50cf\u7684\u9019\u9ebc\u5f37\u5927\uff0c\u4ee5\u4e0a\u8ff0\u7684\u5167\u90e8\u9632\u706b\u7246\u70ba\u7bc4\u4f8b\uff0c\u53ef\u80fd\u7684\u5931\u6557\u539f\u56e0\u6709"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u9019\u985e\u578b\u7684 DNS \u7d00\u9304\u9810\u8a2d\u90fd\u662f\u7531\u53e2\u96c6\u5167\u7684 CoreDNS \u4f86\u7ba1\u7406\uff0c\u9019\u610f\u5473\u5916\u90e8\u670d\u52d9\u8b6c\u5982\u516c\u53f8\u9632\u706b\u7246\u6839\u672c\u6c92\u6709\u8fa6\u6cd5\u53d6\u5f97\u9019\u4e9b\u8cc7\u8a0a\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u5c07 DNS \u670d\u52d9\u4e32\u9023\u53ef\u4ee5\u6b63\u78ba\u5b58\u53d6\u5f8c\uff0c\u6709\u53ef\u80fd\u9632\u706b\u7246\u4e0d\u652f\u63f4\u4f7f\u7528 DNS \u8a2d\u5b9a\uff0c\u53ea\u80fd\u4f7f\u7528 IP \u5730\u5740\u3002"),(0,r.kt)("li",{parentName:"ol"},"Kubernetes Service \u56de\u50b3\u7684 IP \u5730\u5740\u662f\u57fa\u65bc ClusterIP \u7684\u8a2d\u8a08\uff0c\u5176\u6307\u5411\u7684\u662f\u4e00\u500b virtual IP\uff0c\u672c\u8eab\u662f\u6c92\u6709\u8fa6\u6cd5\u88ab\u5916\u90e8\u8a2a\u554f\u7684\uff0c\u56e0\u6b64\u672c\u4f86\u5c31\u4e0d\u6703\u6709\u4efb\u4f55\u5916\u90e8\u6d41\u91cf\u4f7f\u7528 ClusterIP \u4f86\u5b58\u53d6 Kubernetes \u5167\u7684\u670d\u52d9\uff0c\u9019\u7a2e\u8a2d\u5b9a\u672c\u8cea\u4e0a\u53cd\u800c\u6c92\u6709\u610f\u7fa9\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u82e5\u900f\u904e NodePort/Load-Balancer \u7b49\u65b9\u5f0f\u4f86\u8a2d\u5b9a\u7db2\u8def\u5b58\u53d6\uff0c\u5247\u9632\u706b\u7246\u9762\u5c0d\u7684\u5c0d\u8c61\u5c31\u4e0d\u662f\u539f\u751f\u61c9\u7528\u7a0b\u5f0f IP\uff0c\u800c\u662f\u4e2d\u9593\u5c64\u7684 LoadBalacner \u6216\u662f\u6240\u6709\u7bc0\u9ede(NodePort)\u3002\u5982\u679c Port Number \u6703\u96a8\u8005\u90e8\u7f72\u66f4\u65b0\u800c\u6539\u8b8a\u6642\uff0c\u9632\u706b\u7246\u5167\u7684\u8a2d\u5b9a\u5c31\u904e\u671f\u4e86\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u53e6\u5916\u4e00\u7a2e\u53ef\u80fd\u6027\u5c31\u662f\u76f4\u63a5\u6253\u901a\u6240\u6709\u7db2\u8def\uff0c\u8b93 Contaienr Pod \u7684 IP \u76f4\u63a5\u8207\u73fe\u6709\u67b6\u69cb\u662f\u76f8\u540c\u7db2\u6bb5\uff0c\u9019\u6a23\u5916\u90e8\u670d\u52d9\u53ef\u4ee5\u76f4\u63a5\u900f\u904e PodIP \u5b58\u53d6\u8a72\u61c9\u7528\u7a0b\u5f0f\uff0c\u4f46\u662f\u554f\u984c\u5c31\u6703\u56de\u6b78\u5230\u539f\u672c\u72c0\u614b\uff0c\u6bcf\u6b21 Pod \u91cd\u555f\u7522\u751f\u4e0d\u540c IP \u4f7f\u5f97\u9632\u706b\u7246\u6c92\u6709\u8fa6\u6cd5\u8a2d\u5b9a\u3002")),(0,r.kt)("p",null,"\u9664\u4e86\u4e0a\u8ff0\u7bc4\u4f8b\u5916\uff0c\u5982\u679c\u61c9\u7528\u7a0b\u5f0f\u672c\u8eab\u4f7f\u7528\u7684\u5354\u5b9a\u4e0d\u662f\u5e38\u898b\u7684 TCP/UDP \u9019\u7a2e\uff0c\u8b6c\u5982 SCTP\u3002\u53ea\u8981 Kubernetes \u5167\u7684 Service \u6c92\u6709\u63d0\u4f9b\u6210\u719f\u7684\u652f\u63f4\uff0c\u6709\u53ef\u80fd\u767c\u751f SNAT/DNAT \u6c92\u8fa6\u6cd5\u6b63\u5e38\u904b\u4f5c\uff0c\u9019\u7a2e\u60c5\u6cc1\u4e0b\u6703\u5e0c\u671b\u80fd\u5920\u8b93\u8a72\u670d\u52d9\u6709\u4e00\u500b\u53ef\u76f4\u63a5\u5b58\u53d6\u7684\u56fa\u5b9a IP\uff0c\u4e0d\u9700\u8981\u900f\u904e ClusterIP/NodePort \u7b49\u670d\u52d9\u5b58\u53d6\u3002"),(0,r.kt)("h2",{id:"\u4e3b\u5f9e\u7db2\u8def\u67b6\u69cb"},"\u4e3b\u5f9e\u7db2\u8def\u67b6\u69cb"),(0,r.kt)("p",null,"\u7b2c\u4e8c\u500b\u8981\u63a2\u8a0e\u7684\u5247\u662f\u4e3b\u5f9e\u7db2\u8def\u67b6\u69cb\uff0c\u751a\u81f3\u53ef\u4ee5\u8aaa\u591a\u91cd\u7db2\u8def\u67b6\u69cb\u3002\n\u8209\u4e00\u500b\u7bc4\u4f8b\uff0c\u67b6\u8a2d Ceph \u9019\u5957\u5206\u6563\u5f0f\u5132\u5b58\u67b6\u69cb\u6642\uff0c\u6703\u91dd\u5c0d\u6d41\u91cf\u8a2d\u8a08\u5169\u7a2e\u4e0d\u540c\u7684\u67b6\u69cb\uff0c\u5206\u5225\u8655\u7406 Control Plane \u4ee5\u53ca Data Plane\u3002"),(0,r.kt)("p",null,"Control \u53ef\u4ee5\u60f3\u6210 Ceph \u67b6\u69cb\u4e0b\u6240\u6709\u4f3a\u670d\u5668\u4e0a\u5143\u4ef6\u4e92\u76f8\u6e9d\u901a\u7528\u7684\u7db2\u8def\uff0c\u800c Data plane \u5247\u662f\u5c08\u9580\u7528\u4f86\u50b3\u9001\u771f\u6b63\u4f7f\u7528\u8005\u9700\u8981\u7684\u8cc7\u6599\u3002"),(0,r.kt)("p",null,"\u900f\u904e\u9019\u7a2e\u5206\u5c64\u67b6\u69cb\u7684\u8a2d\u8a08\uff0c\u53ef\u4ee5\u8b93 Control/Data \u5169\u7a2e\u6d41\u91cf\u5206\u958b\u8655\u7406"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u4e0d\u6703\u56e0\u70ba Data \u6d41\u91cf\u904e\u5927\u5c0e\u81f4\u6574\u500b\u7db2\u8def\u983b\u5bec\u88ab\u585e\u7206\u4f7f\u5f97 Control \u6d41\u91cf\u6c92\u6709\u8fa6\u6cd5\u6b63\u78ba\u4ea4\u63db\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u540c\u6642\u91dd\u5c0d\u5169\u7a2e\u4e0d\u540c\u9700\u6c42\uff0c\u7db2\u8def\u67b6\u69cb\u4e5f\u53ef\u4ee5\u5206\u958b\u8a2d\u8a08\uff0c\u8b6c\u5982 Control Plane \u63a1\u7528 1G \u7db2\u8def\u800c Data Plane \u5247\u662f\u4f7f\u7528 100G \u7db2\u8def\u3002")),(0,r.kt)("p",null,"\u5982\u679c\u5718\u968a\u5167\u672c\u4f86\u7684\u61c9\u7528\u74b0\u5883\u4e5f\u6709\u9019\u7a2e\u9700\u6c42\u7684\u8a71\uff0c\u4e0b\u4e00\u500b\u554f\u984c\u5c31\u662f\uff0c\u5c0e\u5165 Kubernetes \u5f8c\u8a72\u600e\u9ebc\u8655\u7406?"),(0,r.kt)("p",null,"\u719f\u6089 Linux \u7db2\u8def\u7684\u4eba\u53ef\u80fd\u6703\u60f3\u8aaa\u9019\u500b\u554f\u984c\u53ef\u4ee5\u900f\u904e Routing Table \u7684\u6982\u5ff5\u4f86\u8655\u7406\uff0c\u5c0d k8s \u7684\u7bc0\u9ede\u8a2d\u5b9a\u4e0d\u540c\u7684 Routing table \u898f\u5247\uff0c\u8b93\u5c01\u5305\u53ef\u4ee5\u6839\u64da\u4e0d\u540c\u7684 destination IP \u7db2\u6bb5\u8d70\u4e0d\u540c\u7684\u7db2\u5361\u3002\u4f46\u662f\u9019\u500b\u65b9\u6cd5\u5176\u5be6\u6709\u4e00\u4e9b\u4ee4\u4eba\u56f0\u64fe\u7684\u4e8b\u60c5"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u76ee\u524d Kubernetes \u4e26\u6c92\u6709\u9019\u7a2e\u6a5f\u5236\uff0c\u8981\u9054\u6210\u5c31\u5247\u662f\u7ba1\u7406\u4eba\u54e1\u8981\u60f3\u8fa6\u6cd5\u53bb\u5b8c\u6210\u9019\u4e9b\u8a2d\u5b9a\u3002\u8a2d\u5b9a\u7684\u540c\u6642\u4e5f\u8981\u8003\u91cf\u5230\u65b0\u7bc0\u9ede\u52a0\u5165\u5f8c\u4e5f\u8981\u81ea\u52d5\u88ab\u8a2d\u5b9a\uff0c\u540c\u6642\u6bcf\u500b\u7bc0\u9ede\u4e0a\u7684\u7db2\u5361\u540d\u7a31\u4e5f\u6709\u53ef\u80fd\u4e0d\u540c\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u4e0d\u540c CNI \u5982\u4f55\u5be6\u4f5c\u8de8\u7bc0\u9ede Pod \u5b58\u53d6\u7684\u65b9\u5f0f\u4e0d\u540c\uff0c\u8b6c\u5982\u4f7f\u7528\u55ae\u7d14 Routing\uff0c\u900f\u904e Tunnel \u6280\u8853(VXLAN...etc)\u7b49\u4e0d\u540c\u6280\u8853\u3002\u4e5f\u56e0\u70ba\u9019\u4e9b\u7db2\u8def\u5e95\u5c64\u7684\u6280\u8853\u4e0d\u540c\uff0c\u56e0\u6b64\u5982\u4f55\u8a2d\u5b9a\u9019\u4e9b Routing rules \u4f7f\u7528\u7684\u7b56\u7565\u4e5f\u90fd\u5b8c\u5168\u4e0d\u540c")),(0,r.kt)("h2",{id:"\u591a\u79df\u6236\u7db2\u8def\u9700\u6c42"},"\u591a\u79df\u6236\u7db2\u8def\u9700\u6c42"),(0,r.kt)("p",null,"\u7b2c\u4e09\u500b\u8981\u63a2\u8a0e\u7684\u9700\u6c42\u662f\u591a\u79df\u6236\u7684\u9694\u96e2\u653f\u7b56\uff0c\u719f\u6089 Kubernetes \u7684\u670b\u53cb\u90fd\u77e5\u9053 Kubernetes \u900f\u904e namespace \u7684\u6982\u5ff5\u63d0\u4f9b\u4e00\u500b\u9694\u96e2\u7684\u7528\u6cd5\uff0c\u7136\u800c namespace \u5be6\u969b\u4e0a\u5b8c\u5168\u53ea\u662f\u4e00\u500b\u908f\u8f2f\u4e0a\u7684\u9694\u96e2\uff0c\u6240\u6709\u7684\u4f7f\u7528\u8cc7\u6e90(\u904b\u7b97\u7db2\u8def\u5132\u5b58)\u5f7c\u6b64\u4e4b\u9593\u4e26\u975e\u771f\u6b63\u9694\u96e2\u3002"),(0,r.kt)("p",null,"\u5047\u8a2d\u4eca\u5929\u60f3\u8981\u900f\u904e Kubernetes \u6253\u9020\u4e00\u500b\u670d\u52d9\u591a\u4f4d\u4f7f\u7528\u8005\u7684\u5e73\u53f0\uff0c\u4f7f\u7528\u8005\u900f\u904e Container \u4f86\u904b\u884c\u6240\u9700\u7684\u5de5\u4f5c\uff0c\u9019\u7a2e\u60c5\u6cc1\u4e0b\u8981\u5982\u4f55\u9054\u5230\u7db2\u8def\u7684\u9694\u96e2?"),(0,r.kt)("p",null,"Kubernetes \u8a2d\u8a08\u4e86 NetworkPolicy \u7684\u6a19\u6e96\u683c\u5f0f\uff0c\u4ef0\u8cf4\u5404\u7a2e CNI \u7684\u5be6\u4f5c\u4f86\u63d0\u4f9b Kubernetes \u5143\u4ef6\u4e4b\u9593\u7684\u9632\u706b\u7246\uff0c\u7136\u800c\u6211\u8a8d\u70ba\u900f\u904e NetworkPolicy \u4e26\u6c92\u6709\u8fa6\u6cd5\u9054\u6210\u771f\u6b63\u7684\u7db2\u8def\u9694\u96e2\uff0c\u539f\u56e0\u6709"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u63a1\u7528\u7684 CNI \u5982\u679c\u6c92\u6709\u5be6\u4f5c\u9019\u65b9\u9762\u7684\u529f\u80fd\uff0cNetworkPolicy \u5c31\u4e0d\u80fd\u904b\u4f5c"),(0,r.kt)("li",{parentName:"ol"},"\u57fa\u65bc IP/Port \u7684\u9632\u706b\u7246\u53ea\u80fd\u8aaa\u662f\u9632\u706b\u7246\uff0c\u6c92\u6709\u8fa6\u6cd5\u7576\u4f5c\u771f\u6b63\u7684\u9694\u96e2\uff0c\u76f8\u540c\u7db2\u57df\u4e0b\u7684\u5176\u4ed6\u6d41\u91cf\u5c01\u5305\u5982\u5ee3\u64ad\u98a8\u5305\u662f\u5426\u9084\u662f\u6709\u6a5f\u6703\u7ac4\u6d41\u5230\u5176\u4ed6\u7684 Pod \u4e2d\uff1f \u900f\u904e\u9019\u7a2e\u65b9\u5f0f\u662f\u5426\u6709\u8fa6\u6cd5\u7671\u7613\u5176\u4ed6 Pod \u7684\u7db2\u8def\u529f\u80fd\uff0c\u9020\u6210\u5176\u6c92\u6709\u8fa6\u6cd5\u6536\u9001\u771f\u6b63\u7684\u6d41\u91cf"),(0,r.kt)("li",{parentName:"ol"},"\u76f8\u5c0d\u65bc\u904e\u5f80\u4f7f\u7528 VLAN TAG \u7b49\u65b9\u5f0f\u4f86\u9694\u96e2\u7528\u6236\u9593\u7684\u6d41\u91cf\uff0c\u751a\u81f3\u900f\u904e Trunk \u4f86\u8a2d\u5b9a\u66f4\u70ba\u8907\u96dc\u7684\u9694\u96e2\u95dc\u4fc2\uff0c\u60f3\u8981\u900f\u904e NetworkPolicy \u4f86\u5be6\u73fe\u57fa\u672c\u4e0a\u662f\u975e\u5e38\u75db\u82e6\u4e14\u56f0\u96e3\u7684")),(0,r.kt)("h1",{id:"kubenetes-\u7db2\u8def\u529f\u80fd"},"Kubenetes \u7db2\u8def\u529f\u80fd"),(0,r.kt)("p",null,"\u5c0d\u65bc\u4e09\u500b\u56f0\u5883\u6709\u4e9b\u8a31\u982d\u7dd2\u5f8c\uff0c\u63a5\u4e0b\u4f86\u8981\u601d\u8003\u7684\u5c31\u662f\uff0c\u5982\u4f55\u65bc Kubernetes \u7684\u74b0\u5883\u4e2d\u89e3\u6c7a\u4e09\u500b\u56f0\u5883\u3002"),(0,r.kt)("p",null,"\u8981\u89e3\u6c7a\u9019\u500b\u554f\u984c\uff0c\u5fc5\u9808\u8981\u5148\u7406\u89e3\u5230\u5e95 Kubernetes \u5167\u7684\u7db2\u8def\u529f\u80fd\u662f\u5982\u4f55\u5be6\u4f5c\u7684\uff0c\u900f\u904e\u5c0d Kubernetes \u5be6\u4f5c\u7684\u7406\u89e3\uff0c\u624d\u6709\u8fa6\u6cd5\u4ed4\u7d30\u7684\u601d\u8003\u53ef\u80fd\u7684\u89e3\u6c7a\u65b9\u6848\u3002"),(0,r.kt)("p",null,"\u5c31\u6211\u500b\u4eba\u5c0d Kubernetes \u7684\u7406\u89e3\uff0c\u76ee\u524d\u7db2\u8def\u529f\u80fd\u7531\u5169\u5927\u584a\u5143\u4ef6\u7d44\u6210\uff0c\u7136\u800c\u9019\u5169\u500b\u5143\u4ef6\u7684\u7dad\u8b77\u662f\u5206\u958b\u7684\uff0c\u56e0\u70ba\u5206\u958b\u4e5f\u9020\u5c31\u6574\u5408\u4e0a\u901a\u5e38\u6703\u6709\u843d\u5dee\uff0c\u76ee\u524d\u80fd\u5920\u540c\u6642\u517c\u9867\u9019\u5169\u584a\u7684\u89e3\u6c7a\u65b9\u6848\u4e26\u6c92\u6709\u592a\u591a\u3002"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Kube-Proxy"),(0,r.kt)("li",{parentName:"ol"},"CNI")),(0,r.kt)("h2",{id:"kube-proxy"},"Kube-Proxy"),(0,r.kt)("p",null,"Kube-Proxy \u6700\u7c21\u55ae\u7684\u529f\u7528\u5c31\u662f Service \u7684\u5be6\u4f5c\uff0c\u5982\u4f55\u628a ClusterIP,NodePort \u9019\u4e9b IP:Port \u7d66\u8f49\u63db\u5230\u6700\u7d42\u7684 PodIP/Port \u5247\u662f Kube-Proxy \u8981\u5b8c\u6210\u7684\u4e8b\u60c5\u3002\n\u76ee\u524d\u5167\u5efa\u7684\u5be6\u4f5c\u4e3b\u6d41\u6709\u5169\u6d3e\uff0c\u5206\u5225\u662f\u57fa\u65bc iptables \u8207 ipvs \u5169\u7a2e\u4e0d\u540c\u7684\u65b9\u5f0f\u3002\n\u9019\u5169\u7a2e\u65b9\u5f0f\u90fd\u662f\u900f\u904e Kernel \u5167\u7684 conntrack \u914d\u4e0a\u5404\u7a2e netfilter \u7684\u6a21\u7d44\u4f86\u5b8c\u6210 service \u7684\u8f49\u63db"),(0,r.kt)("p",null,"\u8a3b: iptables \u8207 ipvs \u4e3b\u6d41\u4e0a\u6700\u5927\u7684\u5dee\u7570\u662f\u6548\u80fd\uff0c\u6709\u8208\u8da3\u77ad\u89e3\u5dee\u7570\u7684\u53ef\u4ee5\u53c3\u8003\u6211\u4e4b\u524d\u7dda\u4e0a\u6f14\u8b1b\u5f71\u7247\uff0c\u6709\u8a73\u7d30\u4ecb\u7d39\u5169\u8005\u7684\u5e95\u5c64\u67b6\u69cb\u8207\u5be6\u4f5c\u65b9\u5f0f"),(0,r.kt)("p",null,"\u9019\u908a\u8981\u6ce8\u610f\u7684\uff0c kube-proxy \u5e6b\u5fd9\u8a2d\u5b9a\u597d\u7684\u9019\u4e9b\u898f\u5247\uff0c\u76ee\u7684\u662f",(0,r.kt)("strong",{parentName:"p"},"\u5e6b\u5fd9\u8f49\u63db ClusterIP, NodePort \u5230 Pod IP(\u9019\u908a\u6703\u767c\u751f\u4e00\u6b21\u7684\u8ca0\u8f09\u5e73\u8861\u7684\u9078\u64c7)"),"\uff0c\u81f3\u65bc\u5c01\u5305\u5230\u5e95\u5982\u4f55\u65bc\u591a\u7bc0\u9ede\u4e4b\u9593\u8f49\u9001\u5247\u4e0d\u662f kube-proxy \u8981\u8655\u7406\u7684\uff0c\u800c\u662f\u8b93 CNI \u5e6b\u5fd9\u8655\u7406\u3002"),(0,r.kt)("h2",{id:"cni"},"CNI"),(0,r.kt)("p",null,"CNI(Container Network Interface) \u57fa\u672c\u4e0a\u9700\u8981\u8ca0\u8cac\u5169\u4ef6\u4e8b\u60c5\uff0c\u5206\u5225\u662f"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"IPAM (IP Address Management)"),(0,r.kt)("li",{parentName:"ol"},"Network Connectivity (\u5982\u4f55\u8b93 Pods \u53ef\u4ee5\u4e92\u76f8\u6e9d\u901a)")),(0,r.kt)("p",null,"\u4e0a\u8ff0\u5169\u500b\u6982\u5ff5\u771f\u6b63\u8981\u505a\u7684\u4e8b\u60c5\u975e\u5e38\u7c21\u55ae\uff0c\u5c31\u662f ",(0,r.kt)("strong",{parentName:"p"},"\u5982\u4f55\u8b93\u4f60\u7bc0\u9ede\u4e0a\u7684 Pod \u53ef\u4ee5\u5b58\u53d6\u5230\u53e6\u5916\u4e00\u500b\u7bc0\u9ede\u4e0a\u7684 Pod"),"\uff0c\u6240\u4ee5\u7b2c\u4e00\u4ef6\u4e8b\u60c5\u5c31\u662f\u5e6b\u4f60\u7684 Pod \u5206\u914d\u4e00\u500b IP \u5730\u5740\uff0c\u63a5\u8005\u60f3\u8fa6\u6cd5\u8b93\u4e0d\u540c\u7bc0\u9ede\u4e4b\u9593\u7684\u7db2\u8def\u53ef\u4ee5\u6253\u901a\u3002"),(0,r.kt)("p",null,"\u4ee5\u4e0b\u986f\u793a\u4e86\u5169\u7a2e\u53ef\u80fd\u7684\u67b6\u69cb\u6a21\u578b"),(0,r.kt)("p",null,"\u7b2c\u4e00\u7a2e\u6a21\u578b\u7684\u60c5\u5883\u662f\uff0c\u4f60\u60f3\u8981\u5c07\u4e0d\u540c\u5730\u5340\u7684\u7bc0\u9ede\u5275\u5efa\u51fa\u4e00\u500b\u5927 Kubernetes \u53e2\u96c6\uff0c\u5982\u4e0b\u5716\u7bc4\u4f8b\u3002\n\u53e2\u96c6\u4e2d\u6709\u4e09\u500b\u7bc0\u9ede\uff0c\u5206\u5225\u4f4d\u65bc Taipei,Hsinchu \u4ee5\u53ca Taichung\u3002\u6bcf\u500b\u7bc0\u9ede\u81ea\u5df1\u672c\u8eab\u6240\u5c6c\u7684\u6a5f\u623f\u90fd\u6709\u81ea\u5df1\u7684\u7db2\u6bb5\uff0c\u5206\u5225\u662f 192.168.56.0/24, 10.23.45.0/24 \u4ee5\u53ca 10.54.78.0/24\uff0c\u800c\u9019\u4e09\u500b\u7bc0\u9ede\u672c\u8eab\u7684 IP \u5730\u5740\u4e5f\u5c6c\u65bc\u9019\u4e09\u500b\u7db2\u6bb5(\u662f\u7bc0\u9edeIP\uff0c\u8ddf Pod \u6c92\u6709\u95dc\u4fc2)\n",(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/8sXLjdz.png",alt:null})),(0,r.kt)("p",null,"\u9019\u4e09\u500b\u7bc0\u9ede\u7684\u6a5f\u623f\u672c\u8eab\u8981\u5148\u8655\u7406\u597d\u7db2\u8def\u7684\u554f\u984c\uff0c\u78ba\u4fdd\u9019\u4e9b\u7bc0\u9ede\u5f7c\u6b64\u4e4b\u9593\u53ef\u4ee5\u4e92\u901a\uff0c\u9019\u4e9b\u4e92\u901a\u7684\u904e\u7a0b\u6211\u7d71\u7a31\u70baWAN \u7db2\u8def(Underlay Network)\u3002"),(0,r.kt)("p",null,"\u4e09\u500b\u7bc0\u9ede\u4e0a\u90fd\u8981\u5b89\u88dd CNI \u7684\u61c9\u7528\u7a0b\u5f0f(k8s CNI \u662f\u7bc0\u9ede\u70ba\u55ae\u4f4d\uff0c\u4f60\u53ef\u4ee5\u767c\u73fe\u6240\u6709CNI\u90fd\u4f7f\u7528 Daemonset \u4f86\u5b89\u88dd\u76f8\u95dc\u6a94\u6848)\uff0c\u9019\u4e9b CNI \u8981\u60f3\u8fa6\u6cd5\u5e6b\u5404\u81ea\u7bc0\u9ede\u4e0a\u7684 Pod \u53bb\u7dad\u8b77 IP\uff0c\u4e26\u4e14\u57fa\u65bc\u5df2\u7d93\u6253\u901a\u7684 underlay network \u518d\u53bb\u7dad\u8b77\u4e00\u5c64 overlay network\u3002"),(0,r.kt)("p",null,"\u800c\u7b2c\u4e8c\u500b\u6a21\u578b\u5247\u662f\uff0c\u5047\u8a2d\u6240\u6709\u7684 k8s \u7bc0\u9ede\u7269\u7406\u4f4d\u7f6e\u5c6c\u65bc\u540c\u4e00\u500b\u7bc0\u9ede\uff0c\u8b6c\u5982 Hsinchu\uff0c\u56e0\u6b64\u4e09\u500b\u7bc0\u9ede\u7684\u7db2\u6bb5\u90fd\u5c6c\u65bc 10.23.45.0/24"),(0,r.kt)("p",null,"\u9019\u7a2e\u60c5\u6cc1\u4e0b\uff0c\u4e09\u500b\u7bc0\u9ede\u5f7c\u6b64\u4e4b\u9593\u7684\u6e9d\u901a\u6703\u7c21\u55ae\u5f88\u591a\uff0c\u7531\u65bc\u90fd\u5c6c\u65bc\u540c\u4e00\u500b\u6a5f\u623f\u7db2\u6bb5\u4e2d\uff0c\u6211\u4f7f\u7528 LAN(Underlay) \u4f86\u7a31\u547c\n",(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/P126KoV.png",alt:null})),(0,r.kt)("p",null,"CNI \u7684\u5de5\u4f5c\u8ddf\u4e0a\u8ff0\u67b6\u69cb\uff0c\u4e0d\u8ad6\u5e95\u5c64\u67b6\u69cb\u9577\u600e\u6a23\uff0c\u90fd\u9700\u8981\u5e6b\u5fd9\u5206\u914d PodIP \u5730\u5740\uff0c\u4e26\u4e14\u6253\u901a\u5f7c\u6b64\u3002"),(0,r.kt)("p",null,"\u5c31\u5be6\u52d9\u4e0a\u7684\u7d93\u9a57\uff0c\u5927\u90e8\u5206\u7684\u60c5\u6cc1\u90fd\u662f\u57fa\u65bc\u7b2c\u4e8c\u7a2e\u67b6\u69cb\uff0c\u5927\u90e8\u5206\u8de8\u5730\u5340\u7684\u53e2\u96c6\u90fd\u6703\u662f\u7368\u7acb\u4e00\u5957\u81ea\u5df1\u7684 k8s \u53e2\u96c6\uff0c\u800c\u4e0d\u6703\u8b93\u5f7c\u6b64\u7bc0\u9ede\u8de8\u5730\u5340\u3002"),(0,r.kt)("p",null,"\u91dd\u5c0d\u4e0a\u8ff0\u7684\u67b6\u69cb\uff0c\u53ef\u4ee5\u884d\u4f38\u51fa\u81f3\u5c11\u4e09\u7a2e\u4e0d\u540c\u7684 IPAM \u8655\u7406\u65b9\u5f0f\uff0c\u5206\u5225\u5982\u4e0b"),(0,r.kt)("p",null,"\u7b2c\u4e00\u7a2e\u662f\u6700\u5e38\u898b\u7684\u4f5c\u6cd5\uff0c\u4e5f\u662f\u76ee\u524d\u81ea\u67b6\u53e2\u96c6\u6642 CNI \u6703\u63a1\u53d6\u7684\u7b56\u7565\uff0c\u91dd\u5c0d\u6574\u500b Cluster \u7d66\u4e88\u4e00\u500b\u5f88\u5927\u7684\u865b\u64ecIP\u5730\u5740\uff0c\u8b6c\u5982\u7bc4\u4f8b\u4e2d\u7684 10.123.16.0/20\uff0c\u610f\u7fa9\u662f\u6574\u500b k8s \u53e2\u96c6\u5167\u7684 Pod \u90fd\u5fc5\u9808\u8981\u7b26\u5408\u9019\u500b\u7db2\u6bb5"),(0,r.kt)("p",null,"\u63a5\u8005\u70ba\u4e86\u65b9\u4fbf\u8207\u7ba1\u7406\uff0c\u540c\u6642\u57fa\u65bc\u6bcf\u500b Pod \u7684 IP \u8981\u552f\u4e00\u4e0d\u885d\u7a81\uff0c\u6bcf\u500b k8s \u7bc0\u9ede\u6703\u9700\u8981\u8a2d\u5b9a\u80fd\u5920\u5bb9\u91cf\u7684 Pod \u6578\u91cf\u4e0a\u9650\u3002\u91dd\u5c0d\u9019\u500b\u4e0a\u9650\u53cd\u63a8\u51fa\u9700\u8981\u4f7f\u7528\u7684\u7db2\u6bb5\u5927\u5c0f\uff0c\u8b6c\u5982\u8981\u7528 256 \u500bPod \u5c31\u9700\u8981 /24 \u9019\u6a23\u7684\u7db2\u6bb5\uff0c\u800c\u9019\u500b\u7db2\u6bb5\u5fc5\u9808\u7b26\u5408\u53e2\u96c6\u7bc4\u570d 10.123.16.0/20\u3002"),(0,r.kt)("p",null,"\u7531\u65bc\u53e2\u96c6\u7684\u7bc4\u570d\u662f/20,\u6bcf\u500b\u7bc0\u9ede\u9700\u8981/24\uff0c\u56e0\u6b64\u5dee\u8ddd\u5c31\u662f(24-20)\uff0c\u63db\u7b97\u51fa\u4f86\u5c31\u662f 2^4=16\u3002\n\u9019\u610f\u5473\u6574\u500b k8s \u53e2\u96c6\u53ea\u80fd\u6709 16 \u500b\u7bc0\u9ede\uff0c\u6bcf\u500b\u7bc0\u9ede 256 \u500b Pod\uff0c\u6574\u500b\u53e2\u96c6\u5bb9\u91cf\u5c31\u662f 4096 \u500b Pod\u3002"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/DzXngJa.png",alt:null})),(0,r.kt)("p",null,"\u7bc4\u4f8b\u4e2d\u53ef\u4ee5\u770b\u5230\u4e09\u500b\u7bc0\u9ede\u5206\u5225\u5206\u914d\u4e86 10.123.24.4, 10.123.25.4 \u4ee5\u53ca 10.123.26.4 \u7684IP\uff0c\u7cbe\u6e96\u5730\u8b1b\u53ef\u4ee5\u8aaa\u9019\u4e09\u500b\u7bc0\u9ede\u4e0a\u7684Pod IP \u7bc4\u570d\u5fc5\u9808\u5c6c\u65bc 10.123.24.0/24, 10.123.25.0/24 \u4ee5\u53ca 10.123.26.0/24\u3002"),(0,r.kt)("p",null,"\u7531\u65bc 10.123.16.0/20 \u662f\u4e00\u500b\u79c1\u6709\u7684IP\uff0c\u6bcf\u500b\u4f7f\u7528\u8005\u7684\u53e2\u96c6\u90fd\u53ef\u4ee5\u6709\u4e00\u500b\u5c6c\u65bc\u81ea\u5df1\u7684 10.123.16.0/24 \u7db2\u6bb5\uff0c\u56e0\u6b64\u5982\u4f55\u8b93\u7bc0\u9edeA\u4e0a\u9762\u7684 10.123.24.4 \u8de8\u7e23\u5e02\u5b58\u53d6\u5230\u7bc0\u9edeC\u4e0a\u9762\u7684 10.123.26.4\uff0c\u9019\u90e8\u5206\u5c31\u662f Overlay \u51fa\u99ac\u7684\u6642\u5019\u4e86\u3002"),(0,r.kt)("p",null,"CNI \u6839\u64da\u8a2d\u5b9a\u8207\u9700\u6c42\uff0c\u5e6b\u5fd9\u642d\u5efa\u51fa Overlay \u7db2\u8def\uff0c\u6700\u7c21\u55ae\u7684\u6982\u5ff5\u5c31\u662f\u900f\u904e\u5c01\u88dd(Encapsulating)\u5354\u5b9a\uff0c\u5c07Pod\u7684\u7db2\u8def\u5c01\u5305\u7d66\u5c01\u88dd\u8d77\u4f86\uff0c\u5e38\u898b\u7684 Flannel \u5c31\u6703\u4f7f\u7528 VXLAN \u4f86\u9032\u884c\u5c01\u88dd\uff0c\u5176\u4ed6\u89e3\u6cd5\u4e5f\u6709 IPIP(IP in IP Encapsulation) \u7b49\u4e0d\u540c\u5354\u5b9a\u3002"),(0,r.kt)("p",null,"\u8a3b:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u9019\u7a2e IP \u5206\u914d\u65b9\u6cd5\u76f4\u89ba\u4e14\u7c21\u55ae\uff0c\u552f\u4e00\u8981\u6ce8\u610f\u7684\u662f Pod & Node \u7684\u6578\u91cf"),(0,r.kt)("li",{parentName:"ol"},"Pod \u5982\u679c\u91cd\u555f\u88ab\u5206\u914d\u5230\u4e0d\u540c\u7bc0\u9ede\uff0c\u88ab\u5206\u914d\u5230\u7684 IP \u7db2\u6bb5\u76f4\u63a5\u4e0d\u540c\uff0c\u56e0\u6b64 IP \u4e00\u5b9a\u4e0d\u540c\u3002")),(0,r.kt)("p",null,"\u7b2c\u4e8c\u7a2e\u67b6\u69cb\u5f88\u985e\u4f3c\uff0c\u4e5f\u662f\u5148\u5b9a\u7fa9\u4e00\u500b\u57fa\u65bc k8s \u53e2\u96c6\u7684\u7db2\u6bb5\uff0c\u6240\u6709\u7684 Pod \u90fd\u8981\u7b26\u5408\u9019\u500b\u7db2\u6bb5\u3002\u63a5\u8005\u5e0c\u671b\u9019\u500b\u7db2\u6bb5\u662f\u4f9b\u6240\u6709\u7bc0\u9ede\u5171\u7528\uff0c\u7bc0\u9ede\u4e4b\u9593\u4e0d\u518d\u53bb\u5340\u5206\u5f7c\u6b64\uff0c\u7c21\u55ae\u4f86\u8aaa\u3002"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u4e0d\u53bb\u8003\u616e\u7bc0\u9ede\u6700\u591a\u80fd\u5206\u914d\u591a\u5c11 Pod"),(0,r.kt)("li",{parentName:"ol"},"\u6240\u6709\u7bc0\u9ede\u76f4\u63a5\u5171\u7528 /20 \u500b\u7db2\u6bb5")),(0,r.kt)("p",null,"\u4e0b\u5716\u7bc4\u4f8b\u4e2d\uff0c\u7bc0\u9edeA\u4e0a\u7684Pod\u4f7f\u7528 10.123.24.4 \u800c\u7bc0\u9ede B \u4e0a\u7684Pod\u5247\u4f7f\u7528 10.123.24.7\uff0c\u5169\u8005\u90fd\u5c6c\u65bc 10.123.16.0/20 \u7684\u7db2\u6bb5\u3002\n",(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/38Me1Ye.png",alt:null})),(0,r.kt)("p",null,"\u9019\u7a2e\u67b6\u69cb\u5e36\u4f86\u7684\u597d\u8655\u5c31\u662f Pod \u4e0d\u8ad6\u5206\u914d\u5230\u54ea\u500b\u7bc0\u9ede\uff0c\u90fd\u53ef\u4ee5\u64c1\u6709\u76f8\u540c\u7684\u7db2\u6bb5\uff0c\u610f\u5473\u8005\u6709\u53ef\u80fd\u4fdd\u7559\u76f8\u540c\u7684 IP\u3002"),(0,r.kt)("p",null,"\u4f46\u662f\u6b64\u67b6\u69cb\u5e36\u4f86\u7684\u58de\u8655\u5c31\u662f\uff0c\u975e\u5e38\u96e3\u5be6\u4f5c\u8207\u7ba1\u7406\u3002"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u6bcf\u500b\u7bc0\u9ede\u4e0a\u7684 CNI \u90fd\u662f\u7368\u7acb\u904b\u4f5c\uff0c\u8981\u5982\u4f55\u78ba\u4fdd\u6bcf\u500b CNI \u7368\u7acb\u904b\u4f5c\u6642\u4e0d\u6703\u767c\u751f IP \u5206\u914d\u885d\u7a81\u7684\u554f\u984c\u3002\u9019\u610f\u5473\u5fc5\u9808\u8981\u6709\u4e00\u500b\u96c6\u4e2d\u7ba1\u7406\u7684\u8cc7\u6599\u5eab\u4f86\u5206\u914d\u8207\u8a08\u756b"),(0,r.kt)("li",{parentName:"ol"},"Overlay Network \u7684\u7ba1\u7406\u5fc5\u9808\u8981\u4ee5 IP \u70ba\u55ae\u4f4d\u53bb\u8a2d\u8a08\uff0c\u4e0d\u80fd\u4ee5\u7db2\u6bb5\u70ba\u55ae\u4f4d\u53bb\u8a2d\u8a08\u3002")),(0,r.kt)("p",null,"\u6211\u4e4b\u524d\u6709\u5617\u8a66\u4f7f\u7528 k8s \u5167\u5efa\u7684 etcd \u4f5c\u70ba\u8cc7\u6599\u5eab\u4f86\u5b8c\u6210\u9019\u7a2e\u7bc4\u4f8b\uff0c\u4f46\u662f\u4f7f\u7528\u60c5\u5883\u5176\u5be6\u4e0d\u592a\u591a\uff0c\u55ae\u7d14\u662f\u4e00\u7a2e\u7db2\u8def\u67b6\u69cb\u7684\u63a2\u8a0e\u8207\u7814\u7a76\uff0c\u540c\u6642\u5e95\u5c64 CNI \u4e5f\u5fc5\u9808\u8981\u81ea\u5df1\u91cd\u65b0\u5be6\u4f5c\u4f86\u652f\u63f4\u9019\u7a2e\u5206\u914d\u3002"),(0,r.kt)("p",null,"\u6700\u5f8c\u4e00\u7a2e\u67b6\u69cb\u5247\u662f\u96f2\u7aef\u696d\u8005\u6700\u559c\u6b61\u63d0\u4f9b\u7684\u985e\u578b\uff0c\u76f4\u63a5\u5c07 Pod \u80fd\u5920\u4f7f\u7528\u7684\u7db2\u6bb5\u8207\u7bc0\u9ede\u7684\u7db2\u6bb5\u76f4\u63a5\u4e32\u4e00\u8d77\u3002"),(0,r.kt)("p",null,"\u5c31",(0,r.kt)("strong",{parentName:"p"},"\u7db2\u8def\u662f\u5426\u80fd\u901a\uff0c\u662f\u5426\u53ef\u4ee5\u5be6\u4f5c"),"\u7684\u6982\u5ff5\u4f86\u4e0b\uff0c\u524d\u8ff0\u5169\u500b\u6982\u5ff5\u90fd\u53ef\u4ee5\u8207\u7b2c\u4e09\u7a2e\u6574\u5408\uff0c\u4e5f\u5c31\u662f"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Pod \u8207\u7bc0\u9ede\u5171\u4eab\u7db2\u6bb5\uff0c\u4f46\u662f\u6bcf\u500b\u7bc0\u9ede\u6703\u5728\u5206\u914d\u81ea\u5df1\u7684\u4e00\u500b\u5c0f\u7db2\u6bb5\u3002"),(0,r.kt)("li",{parentName:"ol"},"Pod \u8207\u7bc0\u9ede\u5171\u4eab\u7db2\u6bb5\uff0c\u4f46\u662f\u6bcf\u500b\u7bc0\u9ede\u5f7c\u6b64\u4e0d\u6703\u6709\u81ea\u5df1\u7684\u5c0f\u7db2\u6bb5\uff0c\u5927\u5bb6\u76f4\u63a5\u6524\u5e73\u4f7f\u7528\u3002")),(0,r.kt)("p",null,"\u5047\u8a2d\u4eca\u5929\u900f\u904e AWS \u7684\u670d\u52d9\u4f86\u67b6\u8a2d VM\uff0c\u4e26\u4e14\u65bc VM \u4e0a\u9762\u90e8\u7f72 Kubernetes \u53e2\u96c6\u3002\u80fd\u5920\u8b93 VM \u8207 K8S Pod \u4f7f\u7528\u7684\u7db2\u6bb5\u5168\u90e8\u90fd\u662f\u57fa\u65bc VPC \u7684\u8a2d\u5b9a\uff0c\u9019\u7a2e\u67b6\u69cb\u975e\u5e38\u4ef0\u8cf4\u5e95\u5c64\u7db2\u8def\u904b\u4f5c\u4ee5\u53ca CNI \u7684\u8a2d\u5b9a"),(0,r.kt)("p",null,"\u6b64\u67b6\u69cb\u5e36\u4f86\u7684\u597d\u58de\u8655"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u7db2\u6bb5\u5171\u4eab\uff0c\u7ba1\u7406\u4eba\u54e1\u5c11\u4e00\u5c64\u7db2\u6bb5\u9700\u8981\u7ba1\u7406\uff0c\u76f4\u63a5\u900f\u904e\u4e00\u500b\u5927\u7db2\u6bb5\u7ba1\u7406\u7bc0\u9ede\u8207 Pod"),(0,r.kt)("li",{parentName:"ol"},"\u4efb\u4f55\u80fd\u5920\u91dd\u5c0d\u8a72\u7db2\u6bb5\u8655\u7406\u7684\u670d\u52d9\u73fe\u5728\u90fd\u53ef\u4ee5\u91dd\u5c0d Pod \u4f7f\u7528"),(0,r.kt)("li",{parentName:"ol"},"\u5c01\u5305\u7d93\u904e\u6108\u5c11 NAT\u7684\u8f49\u63db\uff0c\u9664\u932f\u65b9\u9762\u6703\u66f4\u7c21\u55ae(\u4f46\u662f\u56e0\u70ba\u4f60\u4f7f\u7528\u7684\u662f\u5225\u4eba\u7684\u5e95\u5c64\u67b6\u69cb\uff0c\u5176\u5be6\u9664\u932f\u9084\u662f\u5f88\u9ebb\u7169\uff0c\u56e0\u70ba\u81ea\u5df1\u80fd\u5920\u78b0\u5230\u7684\u5730\u65b9\u592a\u5c11)\u3002"),(0,r.kt)("li",{parentName:"ol"},"CNI \u672c\u8eab\u90fd\u8981\u5ba2\u88fd\u5316\uff0c\u91dd\u5c0d\u4e0d\u540c\u96f2\u7aef\u696d\u8005\u53bb\u8a2d\u8a08\uff0c\u56e0\u6b64 GCP/Azure/AWS \u90fd\u6709\u8a2d\u8a08\u81ea\u5df1\u7684 CNI\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u81f3\u65bc\u9019\u4e9b CNI \u60f3\u8981\u5982\u4f55\u5206\u914d IP\uff0c\u8981\u6524\u5e73\u5171\u4eab\u9084\u662f\u4f9d\u8cf4\u7bc0\u9ede\u53bb\u5206\u914d\uff0c\u5247\u662f\u4f9d\u8cf4\u6bcf\u5bb6\u696d\u8005\u7684\u5be6\u4f5c\u3002\n",(0,r.kt)("img",{parentName:"li",src:"https://i.imgur.com/alJLUHX.png",alt:null}))),(0,r.kt)("h1",{id:"\u56f0\u5883\u5206\u6790"},"\u56f0\u5883\u5206\u6790"),(0,r.kt)("p",null,"\u770b\u5b8c\u4e0a\u8ff0\u5206\u6790\uff0c\u5c0d\u65bc Kubernetes \u7684\u7db2\u8def\u6709\u57fa\u672c\u6982\u5ff5\u5f8c\uff0c\u63a5\u4e0b\u4f86\u5c31\u8981\u56de\u5230\u4e3b\u984c\u7684\u4e09\u5927\u56f0\u5883\uff0c\u4f86\u804a\u804a\u9019\u4e09\u5927\u56f0\u5883\u70ba\u4ec0\u9ebc\u9019\u9ebc\u96e3\u6eff\u8db3"),(0,r.kt)("h2",{id:"ipmac-\u56fa\u5b9a"},"IP/MAC \u56fa\u5b9a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"IP\u7684\u5206\u914d\u662f\u7531 CNI \u63d0\u4f9b\u7684\uff0c\u56e0\u6b64 CNI \u672c\u8eab\u82e5\u4e0d\u63d0\u4f9b\u975c\u614bIP\u7684\u5206\u914d -> \u57fa\u672c\u4e0a\u6c92\u6551"),(0,r.kt)("li",{parentName:"ol"},"\u5982\u679c IP \u662f\u57fa\u65bc\u7bc0\u9ede\u70ba\u55ae\u4f4d\uff0c\u5247\u56fa\u5b9aIP \u7684Pod\u4e0d\u80fd\u5920\u63db\u7bc0\u9ede\uff0c\u5426\u5247\u6574\u500b\u7db2\u8def\u90fd\u4e0d\u6703\u901a"),(0,r.kt)("li",{parentName:"ol"},"\u76ee\u524d CNI \u5b98\u65b9\u7dad\u8b77\u7684\u4e09\u7a2e ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/containernetworking/plugins/tree/master/plugins/ipam"},"IPAM"),"\uff0c\u5206\u5225\u662f DHCP, Host-local \u4ee5\u53ca Static",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"DHCP -> \u5c31\u662f DHCP\uff0c\u4f46\u662f\u4f7f\u7528\u4e0a\u8981\u5148\u8003\u616e\u4f60\u7684 Pod \u662f\u5426\u6709\u8fa6\u6cd5\u6536\u5230 DHCP \u5c01\u5305"),(0,r.kt)("li",{parentName:"ul"},"Host-local -> \u4ee5\u7bc0\u9ede\u70ba\u55ae\u4f4d\u7684\u5206\u914d\u65b9\u5f0f\uff0c Flannel \u5be6\u969b\u4e0a\u662f\u5077\u5077\u547c\u53eb host-local \u4f86\u5b8c\u6210 IP \u5206\u914d"),(0,r.kt)("li",{parentName:"ul"},"Static -> \u56fa\u5b9a IP\uff0c\u6a19\u699c\u5c31\u662f\u6e2c\u8a66\u7528\u3002\u5be6\u52d9\u4e0a\u5f88\u96e3\u6574\u5408\uff0c\u539f\u56e0\u662f\u7576 Pod \u8981\u5275\u7acb\u6642\uff0c kubelet \u6703\u53eb\u8d77 CNI \u4f86\u5e6b\u5fd9\u5206\u914d\uff0c\u800c CNI \u8981\u600e\u9ebc\u77e5\u9053\u54ea\u4e9b Pod \u8981\u7528 Static\uff0c\u54ea\u4e9b\u8981\u7528\u5176\u4ed6\u7684 IPAM?"))),(0,r.kt)("li",{parentName:"ol"},"\u6c92\u6709\u5ba2\u88fd\u5316 CNI \u7684\u8a71\uff0c\u5f88\u96e3\u6eff\u8db3\u6b64\u9700\u6c42")),(0,r.kt)("p",null,"\u6b64\u5916\u56fa\u5b9a IP \u7684\u67b6\u69cb\u9084\u8981\u8003\u616e\u5230"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u57fa\u672c\u4e0a\u4e0d\u53ef\u80fd\u4f7f\u7528\u591a\u91cd\u526f\u672c\u7684\u6982\u5ff5\uff0c\u5426\u5247 IP \u5fc5\u5b9a\u885d\u7a81")),(0,r.kt)("h2",{id:"\u4e3b\u5f9e\u7db2\u8def\u67b6\u69cb-1"},"\u4e3b\u5f9e\u7db2\u8def\u67b6\u69cb"),(0,r.kt)("p",null,"\u4e3b\u5f9e\u7db2\u8def\u67b6\u69cb\u4e0b\uff0c Underlay \u7db2\u8def\u53ef\u80fd\u6703\u6709\u591a\u689d\uff0c\u67b6\u69cb\u53ef\u80fd\u8b8a\u6210\u5982\u4e0b\u5716\n",(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/o2YhjEu.png",alt:null})),(0,r.kt)("p",null,"\u6574\u500b\u5e95\u5c64\u7db2\u8def\u5206\u6210 Control Plane \u4ee5\u53ca Data Plane\uff0c\u7db2\u6bb5\u5206\u5225\u662f 10.23.45.0/24 \u4ee5\u53ca 10.23.44.0/24\u3002"),(0,r.kt)("p",null,"\u9019\u6642\u5019\u7b2c\u4e00\u500b\u554f\u984c\u5c31\u662f\uff0c\u4ec0\u9ebc\u6d41\u91cf\u8d70 Control Plane\uff0c\u4ec0\u9ebc\u6d41\u91cf\u8d70 Data Plane\uff0c\u7bc4\u4f8b\u5982"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Pod \u4e4b\u9593\u7684\u6e9d\u901a\u5168\u90e8\u8d70 Data Plane"),(0,r.kt)("li",{parentName:"ol"},"\u9664\u6b64\u4e4b\u5916\u7684\u6d41\u91cf\u5168\u90e8\u90fd\u8d70 Control Plane\uff0c\u8b6c\u5982 API-Server, Scheullder, Controller \u4e4b\u9593\u7684\u6e9d\u901a")),(0,r.kt)("p",null,"\u5982\u540c\u524d\u8ff0\u63d0\u5230\u7684\uff0c Pod \u8207 Pod \u4e4b\u9593\u8a72\u600e\u9ebc\u6e9d\u901a\u662f CNI \u8ca0\u8cac\u641e\u5b9a\u7684\uff0c\u5982\u679c CNI \u672c\u8eab\u6839\u672c\u4e0d\u77e5\u9053\u5e95\u5c64\u6709\u5169\u689d\u7db2\u8def\u53ef\u4ee5\u9078\uff0c\u6839\u672c\u6c92\u6709\u8fa6\u6cd5\u8655\u7406\u3002"),(0,r.kt)("p",null,"\u5927\u90e8\u5206\u7684\u57fa\u672c\u4e0a CNI \u90fd\u662f\u4ef0\u8cf4 Linux Kernel \u5167\u7684 Routing Table \u4f86\u8655\u7406 Underlay \u7684\u8f49\u767c\uff0c\u56e0\u6b64\u6709\u4e9b\u4eba\u6703\u601d\u8003\u5230\u5229\u7528\u4fee\u6539 Routing Table \u7684\u65b9\u5f0f\uff0c\u8b93 Kernel \u77e5\u9053\u4ec0\u9ebc\u6a23\u7684\u5c01\u5305\u8981\u8d70\u54ea\u5f35\u7db2\u5361\u51fa\u53bb\uff0c\u4e5f\u5c31\u662f\u8d70\u54ea\u7a2e\u7db2\u8def\u51fa\u53bb\u3002"),(0,r.kt)("p",null,"\u4e0a\u8ff0\u7684\u601d\u8def\u8981\u8003\u616e\u7684\u9ede"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u5982\u679c CNI \u63a1\u7528\u7684\u662f\u5c01\u88dd\u6280\u8853\u7684\u8a71\uff0c\u5247\u5c01\u88dd\u904e\u7a0b\u5fc5\u9808\u8981\u77e5\u9053\u76ee\u6a19\u7bc0\u9ede\u8981\u4f7f\u7528\u7684\u662f\u5c6c\u65bc Data Plane \u7684\u7db2\u6bb5\uff0c\u4e0d\u80fd\u4f7f\u7528 Control Plane \u7684\u7db2\u6bb5"),(0,r.kt)("li",{parentName:"ol"},"\u5982\u679c CNI \u63a1\u7528\u7684 Routing \u4f86\u8655\u7406\u7684\u8a71\uff0c\u5247\u4e5f\u5fc5\u9808\u8981\u77e5\u9053 Data Plane \u4f7f\u7528\u7684\u7db2\u6bb5\u8207\u7bc0\u9ede\u8cc7\u8a0a")),(0,r.kt)("p",null,"\u7c21\u55ae\u4f86\u8aaa\uff0c\u5982\u679c CNI \u672c\u8eab\u5b89\u88dd\u6642\u53ef\u4ee5\u8a2d\u5b9a Underlay Network \u7684\u8cc7\u8a0a\u7684\u8a71\uff0c\u9019\u500b\u90e8\u5206\u4e0d\u6703\u662f\u592a\u5927\u7684\u554f\u984c\uff0c\u800c\u6eff\u591a CNI \u7684\u78ba\u4e5f\u90fd\u652f\u63f4\u9019\u65b9\u9762\u7684\u8a2d\u5b9a\u3002"),(0,r.kt)("p",null,'\u4f46\u662f\u5982\u679c\u4eca\u5929\u4e0a\u8ff0\u7684\u9700\u6c42\u6539\u6210 "\u7279\u5b9a\u7684Pod\u8d70 Data Plane\uff0c\u7279\u5b9a\u7684 Pod \u8d70 Control Plane" \u6216\u662f "\u7279\u5b9a\u7684 Protocol:IP:Port \u8d70 Data Plane, \u5269\u4e0b\u8d70 Control Plane" \u9019\u7a2e\u5f88\u5f48\u6027\u7684\u8a2d\u8a08\uff0c\u5247 CNI \u4e5f\u5f88\u96e3\u8655\u7406\u3002\n\u5c31\u5982\u540c\u524d\u8ff0\u6240\u8b1b\uff0cCNI \u5c31\u662f\u5275\u7acb Pod \u6642\u5c31\u6703\u88ab\u547c\u53eb\u8d77\u4f86\u53bb\u8a2d\u5b9aIP\u8207\u7db2\u8def\uff0c\u56e0\u6b64\u67b6\u69cb\u662f\u4ee5 Pod \u70ba\u55ae\u4f4d\uff0c\u6c92\u6709\u8fa6\u6cd5\u91dd\u5c0d\u61c9\u7528\u7a0b\u5f0f\u6216\u662f\u7279\u5b9a\u7684 Pod \u9032\u884c\u7d30\u90e8\u9846\u7c92\u7684\u8655\u7406\u3002'),(0,r.kt)("h2",{id:"\u591a\u5f9e\u79df\u6236\u9700\u6c42"},"\u591a\u5f9e\u79df\u6236\u9700\u6c42"),(0,r.kt)("p",null,"\u5f9e\u4e0a\u8ff0\u7684\u67b6\u69cb\u4f86\u770b\uff0c CNI \u5c31\u662f\u57fa\u65bc Underlay \u7684\u67b6\u69cb\u4e0b\uff0c\u642d\u5efa\u51fa\u4e00\u500b\u80fd\u5920\u8b93\u4e0d\u540c\u7bc0\u9edePod\u4e92\u901a\u7684 overlay \u7db2\u8def\u3002 CNI \u672c\u8eab\u88ab\u547c\u53eb\u6642\u4e5f\u6c92\u6709\u592a\u591a\u95dc\u65bc\u5404\u5225 Pod \u7684\u8cc7\u8a0a\uff0c\u552f\u4e00\u6709\u7684\u53ea\u6709 Pod Sandbox ID \u9019\u7a2e\u975e\u5e38\u7c97\u7565\u7684\u8cc7\u8a0a\uff0c\u56e0\u6b64\u60f3\u8981 CNI \u53ef\u4ee5\u7406\u89e3 Pod \u8207\u4f7f\u7528\u8005\u7684\u95dc\u4fc2\u57fa\u672c\u4e0a\u53ea\u80fd\u91cd\u5beb CNI\uff0c\u5f15\u5165\u9019\u500b\u6a5f\u5236\u8207\u6982\u5ff5\u624d\u6709\u53ef\u80fd\u89e3\u6c7a\uff0c\u5426\u5247\u9810\u8a2d\u7684 CNI \u6839\u672c\u4e0d\u7406\u89e3\u9019\u7a2e\u6982\u5ff5\u3002"),(0,r.kt)("p",null,"CNI \u6709\u80fd\u529b\u77e5\u9053\u6bcf\u500b Pod \u5206\u914d\u7684IP(\u56e0\u70ba\u5c31\u662fCNI\u5206\u914d\u7684)\uff0c\u540c\u6642\u4e5f\u6709\u80fd\u529b\u53bb\u642d\u5efa\u51fa\u4e32\u9023\u5f7c\u6b64\u7684 Overlay \u7db2\u8def\uff0c\u56e0\u6b64 NetworkPolicy \u7684\u5f15\u5165\u8b93 CNI \u80fd\u5920\u91dd\u5c0d\u7db2\u8def\u6d41\u91cf\u7684\u9632\u706b\u7246\u8ca2\u737b\u4e00\u9ede\u5fae\u8584\u4e4b\u529b\u3002"),(0,r.kt)("p",null,'Network Policy \u90e8\u5206\u5982\u4f55\u5be6\u4f5c\u5b8c\u5168\u53d6\u6c7a\u65bc "CNI \u5982\u4f55\u5be6\u4f5c Network Connectivity"\uff0c\u5982\u679c\u662f\u5b8c\u5168\u4ef0\u8cf4 Linux Kernel \u4f86\u8655\u7406\u5c01\u5305\u6d41\u5411\u7684\uff0c\u5c31\u6709\u53ef\u80fd\u6703\u900f\u904e iptables \u7684\u898f\u5247\u4f86\u963b\u64cb\u5c01\u5305\u50b3\u905e\u3002'),(0,r.kt)("p",null,"\u6240\u4ee5\u5c0d\u65bc\u4f7f\u7528\u8005\u4f86\u8aaa\uff0c\u5047\u5982\u900f\u904e Network Policy \u53bb\u8a2d\u5b9a\u67d0\u5169\u500b Pod \u5f7c\u6b64\u4e4b\u9593\u4e0d\u80fd\u4e92\u901a\uff0c\u9019\u4e9b Pod \u7684 IP \u6703\u88ab\u8f49\u63db\u6210\u5c0d\u61c9\u7684 iptables \u898f\u5247\u4e26\u4e14\u8a2d\u5b9a\u3002\u4e00\u4f46 Pod \u88ab\u91cd\u65b0\u90e8\u7f72\u5c0e\u81f4 IP \u6539\u8b8a\uff0c\u5247 CNI \u4e5f\u8981\u6709\u80fd\u529b\u5075\u6e2c\u5230\u8b8a\u5316\u4e26\u91cd\u65b0\u8a2d\u65b0\u7684\u898f\u5247"),(0,r.kt)("p",null,"\u8a3b:\u7cbe\u6e96\u7684\u8aaa\uff0cCNI \u662f\u4e00\u500b\u55ae\u6b21\u547c\u53eb\u7684 Process\uff0c\u800c CNI \u89e3\u6c7a\u65b9\u6848\u901a\u5e38\u6703\u5305\u542b CNI \u57f7\u884c\u6a94\u6848\u4ee5\u53ca\u5c0d\u61c9\u7684 Controller\uff0c\u9019\u500b\u7bc4\u4f8b\u4e2d\u6307\u7684\u662f\u5c0d\u61c9\u7684 Controller\u3002"),(0,r.kt)("p",null,'\u7e3d\u7d50\u4f86\u8aaa\uff0c\u5f9e\u7db2\u8def\u7684\u89d2\u5ea6\u4f86\u770b\uff0c CNI \u662f\u5b8c\u5168\u6709\u8fa6\u6cd5\u53bb\u505a\u5230\u5f88\u5f37\u5927\u7684\u7db2\u8def\u9694\u96e2\uff0c\u4f46\u662f CNI \u7684\u67b6\u69cb\u8b93\u5176\u5f88\u96e3\u7406\u89e3 Pod \u8207\u4f7f\u7528\u8005\u7684\u95dc\u4fc2\uff0c\u6240\u4ee5\u60f3\u8981\u9054\u6210 "\u57fa\u65bc\u4f7f\u7528\u8005\u7684\u7db2\u8def\u9694\u96e2" \u662f\u975e\u5e38\u56f0\u96e3\u7684\u3002\n\u4e0d\u904e\u8edf\u9ad4\u5f88\u96e3\u8aaa\u6709\u4ec0\u9ebc\u8fa6\u4e0d\u5230\u7684\u4e8b\u60c5\uff0c\u81ea\u5df1\u64b0\u5beb CNI \u5c31\u6709\u8fa6\u6cd5\u9054\u6210\uff0c\u53ea\u662f\u6210\u672c\u6548\u76ca\u7684\u53d6\u6368\u800c\u5df2\u3002'),(0,r.kt)("h1",{id:"\u53ef\u80fd\u89e3\u6cd5"},"\u53ef\u80fd\u89e3\u6cd5"),(0,r.kt)("p",null,"\u4e0a\u8ff0\u4e09\u500b\u554f\u984c\u5404\u5225\u8655\u7406\u90fd\u5f88\u9ebb\u7169\uff0c\u4f55\u6cc1\u60f3\u8981\u540c\u6642\u89e3\u6c7a\u4e09\u500b\u554f\u984c\uff0c\u6839\u64da\u6211\u904e\u5f80\u7684\u7d93\u9a57\u8207\u7406\u89e3\uff0c\u76ee\u524d\u67b6\u69cb\u4e0b\u8981\u5b8c\u6210\u9019\u500b\u8b70\u984c\u6700\u6709\u6548\u7684\u65b9\u5f0f\u5c31\u662f\u4e0b\u5217\u5169\u7a2e\u65b9\u5f0f"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u6df7\u642d\u4f7f\u7528 CNI"),(0,r.kt)("li",{parentName:"ol"},"\u62bd\u96e2 Kubernetes")),(0,r.kt)("p",null,"\u601d\u8003\u7684\u8d77\u9ede\u5f88\u7c21\u55ae\uff0c\u6839\u64da"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"CNI \u5be6\u4f5c\u767e\u767e\u7a2e\uff0c\u6bcf\u7a2e\u5be6\u4f5c\u90fd\u6709\u81ea\u5df1\u9069\u5408\u7684\u5834\u666f\uff0c\u5982\u679c\u53ef\u4ee5\u6839\u64da\u4e0d\u540c\u7684\u9700\u6c42(\u8b6c\u5982\u4e0d\u540c\u7684Pod)\u800c\u547c\u53eb\u4e0d\u540c\u7684 CNI\uff0c\u9019\u6a23\u5c31\u53ef\u4ee5\u5f48\u6027\u7684\u53bb\u6eff\u8db3 IPAM \u4ee5\u53ca\u7db2\u8def\u50b3\u8f38\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u540c\u6642\u5982\u679c Kubernetes \u76ee\u524d\u5c31\u662f\u6c92\u6709\u8fa6\u6cd5\u9806\u5229\u8655\u7406\u9019\u7a2e\u7db2\u8def\u554f\u984c\uff0c\u90a3\u5c31\u60f3\u8fa6\u6cd5\u5c07\u7db2\u8def\u7684\u7ba1\u7406\u7d66\u5f80\u5916\u5ef6\u4f38\u3002\u8b93 Kubernetes \u5c08\u5fc3\u8655\u7406 Pod/Container \u7684\u8655\u7406\uff0c\u800c\u9019\u4e9b\u7279\u5225\u7684\u7db2\u8def\u9700\u6c42\u5247\u8b93\u64c5\u9577\u7684\u89e3\u6c7a\u65b9\u6848\u4f86\u8655\u7406\u3002")),(0,r.kt)("h2",{id:"\u6df7\u642d-cni"},"\u6df7\u642d CNI"),(0,r.kt)("p",null,"\u91cd\u65b0\u8907\u7fd2\u4e00\u6b21\uff0c\u6839\u64da\u76ee\u524d k8s \u7684\u67b6\u69cb\uff0ckubelet \u6703\u65bc\u5275\u5efa/\u522a\u9664 Pod \u7684\u6642\u5019\u53bb\u547c\u53eb CNI \u4f86\u8655\u7406\u7db2\u8def\u9700\u6c42\u3002\u7531\u65bc\u6c92\u6709\u8fa6\u6cd5\u5f88\u52d5\u614b\u7684\u53bb\u6c7a\u5b9a\u6bcf\u500b Pod \u8981\u547c\u53eb\u54ea\u7a2e CNI\uff0c\u90a3\u5c31\u64b0\u5beb\u4e00\u500b\u5168\u65b0\u7684 CNI \u4f86\u63d0\u4f9b\u9019\u7a2e\u529f\u80fd\uff0c\u9019\u7a2e CNI \u4fd7\u7a31\u70ba metaplugin CNI\u3002"),(0,r.kt)("p",null,"Metaplugin CNI \u53ef\u4ee5\u6839\u64da\u9700\u6c42\u91dd\u5c0d\u55ae\u4e00 Pod \u547c\u53eb\u591a\u7a2e\u4e0d\u540c\u7684 CNI \u4f86\u8a2d\u5b9a\u7db2\u8def\uff0c\u6240\u4ee5\u6574\u500b\u67b6\u69cb\u8b8a\u5316\u5982\u4e0b\u3002"),(0,r.kt)("p",null,"\u4e0b\u5716\u4e2d\u5ffd\u7565\u5e95\u5c64\u7684\u7a0b\u5f0f\u547c\u53eb\u7d30\u7bc0(CRI)\uff0c\u4e3b\u8981\u662f\u5c08\u6ce8\u65bc CNI \u7684\u547c\u53eb\u908f\u8f2f\u3002\n\u4e0a\u65b9\u5448\u73fe\u7684\u662f\u672c\u6587\u4e00\u76f4\u63a2\u8a0e\u7684 CNI \u67b6\u69cb\uff0c\u4e5f\u662f\u5e7e\u4e4e\u6240\u6709 K8s \u73a9\u5bb6\u6703\u4f7f\u7528\u7684\u67b6\u69cb\uff0c\u900f\u904e\u4e00\u5957 CNI \u4f86\u8655\u7406 k8s \u53e2\u96c6\u5167\u7684\u6240\u6709 Pod\u3002\n",(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/NMklAAn.png",alt:null}),"\n\u4e0b\u65b9\u5448\u73fe\u7684\u5247\u662f Metaplugin CNI \u67b6\u69cb\uff0c Metaplugin CNI \u672c\u8eab\u6709\u984d\u5916\u7684\u8a2d\u5b9a\u6a94\u6848\uff0c\u8a72\u6a94\u6848\u4e2d\u63cf\u8ff0\u652f\u63f4\u54ea\u4e9b CNI\uff0c\u4ee5\u53ca\u5f7c\u6b64\u7684\u547c\u53eb\u9806\u5e8f\u3002\u7576 Pod \u88ab\u5275\u5efa\u6642\uff0c Kubelet \u5c31\u6703\u628a Pod \u7684\u8cc7\u8a0a\u50b3\u7d66 Metaplugin CNI\uff0c\u8a72 CNI \u5247\u6839\u64da\u8a2d\u5b9a\u6a94\u4f9d\u5e8f\u547c\u53eb\u591a\u500b CNI \u4f86\u8655\u7406\u76f8\u540c\u7684\u4e00\u500b Pod\u3002"),(0,r.kt)("p",null,"\u8209\u4f8b\u4f86\u8aaa\uff0c\u5be6\u52d9\u4e0a\u7684\u4f7f\u7528\u6d41\u7a0b\u70ba"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u5b89\u88dd Metaplugin CNI"),(0,r.kt)("li",{parentName:"ol"},"\u8a2d\u5b9a\u60f3\u8981\u4f7f\u7528\u5230\u7684\u6240\u6709 CNI"),(0,r.kt)("li",{parentName:"ol"},"\u5275\u5efa Pod \u6642\u65bc Annotation \u5167\u53bb\u63cf\u8ff0\u5e0c\u671b\u8a72 Pod \u8981\u4f7f\u7528\u54ea\u4e9b CNI\u3002"),(0,r.kt)("li",{parentName:"ol"},"Metaplugin \u88ab\u547c\u53eb\u6642\uff0c\u6703\u53bb\u6293\u53d6\u5230\u8a72 Pod \u63cf\u8ff0\u7684\u8cc7\u8a0a\uff0c\u63a5\u8005\u547c\u53eb\u8981\u4f7f\u7528\u7684 CNI")),(0,r.kt)("p",null,"\u5e38\u898b\u7684 Metaplugin CNI \u89e3\u6c7a\u65b9\u6848\u6709 ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/k8snetworkplumbingwg/multus-cni"},"Multus-CNI")," \u4ee5\u53ca ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/nokia/danm"},"DANM")," \u5169\u7a2e\u89e3\u6c7a\u65b9\u6848\u3002"),(0,r.kt)("p",null,"\u900f\u904e\u9019\u7a2e\u67b6\u69cb\uff0c K8s \u53ef\u4ee5\u7372\u5f97\u66f4\u5f48\u6027\u7684 CNI \u67b6\u69cb\uff0c\u8b6c\u5982\u53ef\u4ee5\u8b93\u55ae\u4e00 Pod \u88cf\u9762\u5275\u5efa\u591a\u500b\u7db2\u8def\u4ecb\u9762\uff0c\u540c\u6642\u6709\u4e0d\u540c\u7684 IP \u8a2d\u5b9a\u3002"),(0,r.kt)("p",null,"\u4ee5\u4e0b\u662f\u5169\u500b\u4f7f\u7528\u7bc4\u4f8b(\u53ea\u662f\u7bc4\u4f8b\uff0c\u4e0d\u4ee3\u8868\u771f\u7684\u6703\u9019\u6a23\u7528)"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},'\u7cfb\u7d71\u5167\u5b89\u88dd\u5169\u7a2e\u4e0d\u540c\u7684 CNI\uff0c\u9019\u5169\u500b CNI \u8a2d\u5b9a\u4f7f\u7528\u4e0d\u540c\u7684 overlay network\uff0c\u5275\u5efa Pod \u7684\u6642\u5019\u6839\u64da\u9700\u6c42\u6c7a\u5b9a\u8981\u4f7f\u7528\u54ea\u5957 CNI \u5c31\u53ef\u4ee5\u9054\u6210 "\u6839\u64da Pod \u4f86\u6c7a\u5b9a\u8981\u8b93\u5176\u6d41\u91cf\u8d70\u54ea\u689d\u7db2\u8def"\u3002')),(0,r.kt)("p",null,"\u9019\u7a2e\u67b6\u69cb\u4e0b\u6bcf\u500b Pod \u5167\u90fd\u53ea\u6703\u6709\u4e00\u5f35\u7db2\u5361\uff0c\u6240\u6709\u5f9e\u8a72 Pod \u51fa\u53bb\u7684\u6d41\u91cf\u5c31\u6703\u8d70\u7279\u5b9a\u7684\u7db2\u8def\u51fa\u53bb\u3002\n",(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/nVEgGmF.png",alt:null})),(0,r.kt)("p",null,"PodA \u8207 PodC \u5c6c\u65bc\u540c\u4e00\u500b\u7db2\u8def\uff0c\u800c PodB \u8207 PodD \u5c6c\u65bc\u540c\u4e00\u500b\u7db2\u8def\uff0c\u4f46\u662f PodA \u4e0d\u4e00\u5b9a\u53ef\u4ee5\u8ddf PodB \u6e9d\u901a\uff0c\u9019\u90e8\u5206\u4e3b\u8981\u53d6\u6c7a\u65bc Underlay \u7db2\u8def\u7684\u8a2d\u8a08\u3002"),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"\u7cfb\u7d71\u5167\u5b89\u88dd\u5169\u7a2e\u4e0d\u540c\u7684 CNI\uff0c\u9019\u5169\u500b CNI \u8a2d\u5b9a\u4f7f\u7528\u4e0d\u540c\u7684 overlay network\uff0c\u5275\u5efa Pod \u7684\u6642\u5019\u540c\u6642\u547c\u53eb\u5169\u7a2e CNI\uff0c\u63a5\u8005 Pod \u88e1\u9762\u900f\u904e Routing Table \u4f86\u6c7a\u5b9a\u5c01\u5305\u8a72\u5982\u4f55\u8f49\u767c\u3002")),(0,r.kt)("p",null,"\u7b2c\u4e8c\u7a2e\u67b6\u69cb\u6bd4\u8f03\u5e38\u898b\uff0c\u8b93\u6240\u6709\u7684 Pod \u540c\u6642\u90fd\u64c1\u6709\u5169\u7a2e\u7db2\u8def\u80fd\u529b\uff0cPod \u5167\u7684\u61c9\u7528\u7a0b\u5f0f\u6839\u64da Routing Table \u7684\u898f\u5247\u4f86\u6c7a\u5b9a\u5c01\u5305\u8a72\u5982\u4f55\u8f49\u9001\uff0c\u7bc4\u4f8b\u5982\u4e0b\u5169\u5716\u3002\n",(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/at8aYOy.png",alt:null})),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/H4MtKsd.png",alt:null})),(0,r.kt)("p",null,"\u9019\u7a2e\u67b6\u69cb\u4e0b\u53ef\u4ee5\u7d44\u5408\u51fa\u4e00\u500b\u6709\u8da3\u7684\u73a9\u6cd5\uff0c\u8b6c\u5982\u7b2c\u4e00\u500bCNI\u4f7f\u7528\u5e38\u898b\u7684 CNI\uff0c\u7b2c\u4e8c\u500b CNI \u5247\u4f7f\u7528\u642d\u914d Static IPAM \u7684\u65b9\u5f0f\u4f86\u8a2d\u5b9a\u56fa\u5b9a IP\u3002\n\u56e0\u6b64\u8a72 Pod \u672c\u8eab\u6703\u6709\u5169\u500b\u7db2\u5361\uff0c\u5176\u4e2d\u4e00\u500b\u662f\u52d5\u614b\u53d6\u5f97\u7684IP\uff0c\u8a72 IP \u6703\u8d70 Control Plane \u7684\u7db2\u8def\uff0c\u800c\u7b2c\u4e8c\u500b\u7db2\u5361\u5247\u662f\u8a2d\u5b9a\u56fa\u5b9a IP\uff0c\u8a72 IP \u6703\u8d70 Data Plane Network\u3002"),(0,r.kt)("p",null,"\u7e3d\u7d50\u4f86\u8aaa\uff0c\u5f15\u5165 Metaplugin CNI \u7684\u67b6\u69cb\uff0c\u53ef\u4ee5\u8b93 k8s \u7684 CNI \u8b8a\u5f97\u5f48\u6027\u8207\u9748\u6d3b\uff0c\u4e0d\u904e\u524d\u63d0\u662f\n",(0,r.kt)("strong",{parentName:"p"},"\u5718\u968a\u91dd\u5c0d\u7db2\u8def\u6709\u7279\u5225\u9700\u6c42"),"\uff0c\u5426\u5247\u4f7f\u7528\u6700\u7c21\u55ae\u7684 CNI \u67b6\u69cb\u5373\u53ef\u3002"),(0,r.kt)("h2",{id:"\u62bd\u96e2-kubernetes"},"\u62bd\u96e2 Kubernetes"),(0,r.kt)("p",null,"\u6709\u4e86\u9019\u7a2e\u6df7\u96dc\u4f7f\u7528 CNI \u7684\u80fd\u529b\u5f8c\uff0c\u4e0b\u4e00\u500b\u601d\u8003\u7684\u554f\u984c\u5c31\u662f\u5982\u4f55\u5c07 Pod \u8207\u73fe\u6709\u7684\u7db2\u8def\u67b6\u69cb\u76f4\u63a5\u6574\u5408\uff0c\u80fd\u5426\u8df3\u812b Kubernetes \u7684\u67b6\u69cb?"),(0,r.kt)("p",null,"\u4e00\u7a2e\u6700\u7c21\u55ae\u7684\u505a\u6cd5\u5c31\u662f\u4f7f\u7528 ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/k8snetworkplumbingwg/sriov-network-device-plugin"},"SRIOV")," \u9019\u7a2e\u7db2\u8def\u6a21\u578b\uff0c\u5c07\u652f\u63f4\u7684\u5be6\u9ad4\u7db2\u5361(PF)\u62c6\u5206\u591a\u500b\u865b\u64ec\u4ecb\u9762(VF)\u4e26\u4e14\u5c07\u9019\u4e9b\u865b\u64ec\u4ecb\u9762\u76f4\u63a5\u9001\u5230 Pod \u5167\u4f7f\u7528\u3002\n\u9019\u7a2e\u67b6\u69cb\u4e0b\uff0c Pod \u5167\u6240\u6709\u5f9e\u8a72\u7db2\u5361\u51fa\u53bb\u7684\u6d41\u91cf\u90fd\u6703\u76f4\u63a5\u5f9e\u7bc0\u9ede\u4e0a\u7684\u7db2\u5361\u51fa\u53bb\uff0c\u4e0d\u6703\u53d7\u5230\u7bc0\u9ede\u672c\u8eab ",(0,r.kt)("strong",{parentName:"p"},"Linux Kernel Network Stack")," \u773e\u591a\u529f\u80fd\u7684\u5f71\u97ff\uff0c\u5e38\u898b\u7684 conntrack, iptables \u90fd\u6c92\u6709\u8fa6\u6cd5\u904b\u4f5c\u3002 \u76f8\u5c0d\u7684\u8a72\u6d41\u91cf\u6703\u76f4\u63a5\u6d41\u5165\u5230\u8a72\u5be6\u9ad4\u7db2\u5361\u6240\u5c0d\u63a5\u7684\u7db2\u8def\u4e2d\uff0c\u6240\u6709\u7684\u6d41\u91cf\u63a7\u7ba1\u8207\u8655\u7406\u5c31\u53ef\u4ee5\u65bc\u8a72\u7db2\u8def\u4e2d\u53bb\u8655\u7406\uff0c\u8b6c\u5982 vlan, ACL \u7b49\u3002"),(0,r.kt)("p",null,"\u4e0b\u5217\u9019\u5f35\u5716\u5c55\u793a\u4e86\u4e00\u7a2e\u4f7f\u7528 SR-IOV \u7684\u67b6\u69cb\n",(0,r.kt)("img",{parentName:"p",src:"https://i.imgur.com/Ik4XkP0.png",alt:null})),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u74b0\u5883\u4e2d\u6709\u5169\u7a2e\u7db2\u8def\uff0c\u6240\u6709 ",(0,r.kt)("strong",{parentName:"li"},"\u5c0d\u4f7f\u7528 data plane network \u6709\u8208\u8da3\u7684 Pod")," \u90fd\u63cf\u8ff0\u8981\u4f7f\u7528 SR-IOV CNI\u3002"),(0,r.kt)("li",{parentName:"ol"},"SR-IOV CNI \u53ef\u4ee5\u642d\u914d ",(0,r.kt)("strong",{parentName:"li"},"\u56fa\u5b9aIP")," \u6216\u662f ",(0,r.kt)("strong",{parentName:"li"},"\u56fa\u5b9a MAC Address")," \u4f86\u4f7f\u7528\uff0c\u5982\u679c\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"li"},"\u56fa\u5b9a MAC address")," \u7684\u8a71\u4e5f\u53ef\u4ee5\u642d\u914d DHCP \u4f86\u5206\u914d\u56fa\u5b9a IP\u3002"),(0,r.kt)("li",{parentName:"ol"},"Pod \u5275\u7acb\u5f8c\u7cfb\u7d71\u4e2d\u5c31\u6703\u7522\u751f\u5169\u5f35\u7db2\u5361\uff0c\u5206\u5225\u5c0d\u61c9\u5230 Control Plane \u4ee5\u53ca Data Plane"),(0,r.kt)("li",{parentName:"ol"},"\u4f7f\u7528 Data Plane \u7684\u7db2\u5361\u7531\u65bc\u6d41\u91cf\u4e0d\u6703\u7d93\u904e\u7bc0\u9ede\u672c\u8eab\u7684 Linux Kernel \u8655\u7406\uff0c\u56e0\u6b64\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u8ddf data plane network \u76f8\u540c\u7684\u7db2\u6bb5\u4f86\u8a2d\u5b9a\uff0c\u4e0d\u9700\u8981\u984d\u5916\u7684 NAT \u4f86\u8f49\u63db\u5c01\u5305\u3002")),(0,r.kt)("p",null,"\u6b64\u67b6\u69cb\u4e0b\u91cd\u65b0\u6aa2\u8996\u6700\u521d\u7684\u4e09\u500b\u56f0\u5883"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u56fa\u5b9a IP/MAC"),(0,r.kt)("li",{parentName:"ol"},"\u4e3b\u5f9e\u7db2\u8def"),(0,r.kt)("li",{parentName:"ol"},"\u591a\u79df\u6236\u9694\u96e2")),(0,r.kt)("p",null,"\u900f\u904e Metaplugin \u7684\u67b6\u69cb\uff0c\u524d\u8ff0\u5169\u500b\u8b70\u984c\u90fd\u6709\u8fa6\u6cd5\u5b8c\u6210\uff0c\u800c\u7b2c\u4e09\u500b\u4e3b\u8981\u53d6\u6c7a\u65bc\u60f3\u8981\u9694\u96e2\u7684\u5f37\u5ea6\uff0c\u57fa\u672c\u4e0a\u91d0\u6e05\u9700\u6c42\u5f8c\uff0c\u90fd\u6709\u8fa6\u6cd5\u900f\u904e\u5be6\u4f5c\u51fa\u4f86\u3002"),(0,r.kt)("p",null,"\u4f46\u662f Metaplugin CNI \u4e5f\u4e26\u975e\u5b8c\u7f8e\uff0c\u56e0\u70ba Pod \u64c1\u6709\u80fd\u529b\u8a2d\u5b9a\u591a\u500b\u7db2\u5361\u8207 IP\uff0c\u9019\u500b\u4f5c\u6cd5\u5be6\u969b\u4e0a\u8207 Kubernetes \u662f\u5b8c\u5168\u4e0d\u5408\u7684\u3002\nKubernetes \u9810\u8a2d\u662f\u6bcf\u500b Pod \u53ea\u6703\u6709\u4e00\u500b IP\uff0c\u6240\u4ee5\u5176\u5167\u90e8\u7684\u8cc7\u6599\u7d50\u69cb\u53ea\u6703\u8a18\u9304\u4e00\u500b IP \u5730\u5740\uff0c\u540c\u6642\u5982\u679c\u8981\u4f7f\u7528 Kubernetes Service \u6642\uff0c\u5230\u5e95\u8a72 Service \u8981\u4f7f\u7528\u54ea\u500b IP \u4f86\u50b3\u8f38?"),(0,r.kt)("p",null,"\u5982\u679c\u4f7f\u7528\u7684\u662f Mutlus \u9019\u5957\u89e3\u6c7a\u65b9\u6848\u7684\u8a71\uff0c\u7b2c\u4e8c\u5f35\u7db2\u5361\u4ee5\u5f8c\u7684\u8cc7\u8a0a\u90fd\u6c92\u6709\u8fa6\u6cd5\u8b93 K8s Service \u4f7f\u7528\uff0c\u7684\u4f46\u662f\u5982\u679c\u4f7f\u7528\u7684\u662f DANM \u7684\u8a71\u5247\u63d0\u4f9b\u4e86\u8fa6\u6cd5\u89e3\u6c7a\uff0c\u8b93\u4f60\u53ef\u4ee5\u7e7c\u7e8c\u4f7f\u7528 k8s service \u4f86\u8a2a\u554f\u4e0d\u540c\u7684\u7db2\u5361\u3002"),(0,r.kt)("h1",{id:"\u7d50\u8ad6"},"\u7d50\u8ad6"),(0,r.kt)("p",null,"Kubernetes \u4e26\u975e\u842c\u80fd\uff0c\u5c0d\u65bc\u5927\u591a\u7684\u61c9\u7528\u4f86\u8aaa\u7db2\u8def\u4e00\u76f4\u90fd\u4e0d\u662f\u91cd\u9ede\uff0c\u80fd\u901a\u4e92\u76f8\u5b58\u53d6\u5373\u53ef\u3002\u4f46\u662f\u5c0d\u90e8\u5206\u7522\u696d\u8207\u61c9\u7528\u7a0b\u5f0f\u4f86\u8aaa\uff0c\u7db2\u8def\u5247\u662f\u4e00\u500b\u786c\u9700\u6c42\uff0c\u9019\u7a2e\u60c5\u6cc1\u4e0b\u5c31\u6703\u767c\u89ba Kubernetes \u672c\u8eab\u7684\u4e0d\u8db3\u3002"),(0,r.kt)("p",null,"Metaplugin CNI \u7684\u6982\u5ff5\u6211\u8a8d\u70ba\u5927\u698299%\u7684\u4f7f\u7528\u8005\u90fd\u6c92\u6709\u9019\u500b\u9700\u6c42\uff0c\u4f46\u662f\u5b78\u7fd2\u9019\u7a2e\u6982\u5ff5\u7684\u8a2d\u8a08\u53ef\u4ee5\u5e6b\u52a9\u7406\u89e3\u5176\u4ed6\u89e3\u6c7a\u65b9\u6848\u7684\u8a2d\u8a08\uff0c\u8b6c\u5982 Kubevirt \u5c08\u6848\u5e95\u4e0b\u5c31\u4f7f\u7528 Multus \u4f86\u8a2d\u5b9a VM \u9593\u7684\u7db2\u8def\u3002"),(0,r.kt)("p",null,"\u6700\u5f8c\u9084\u662f\u8001\u8a71\u4e00\u53e5\uff0c\u7db2\u8def\u597d\u96e3"))}s.isMDXComponent=!0}}]);
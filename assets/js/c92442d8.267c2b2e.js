"use strict";(self.webpackChunkhwchiu=self.webpackChunkhwchiu||[]).push([[64219],{3905:(e,n,t)=>{t.d(n,{Zo:()=>k,kt:()=>u});var a=t(67294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=a.createContext({}),s=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},k=function(e){var n=s(e.components);return a.createElement(l.Provider,{value:n},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,k=p(e,["components","mdxType","originalType","parentName"]),c=s(t),m=r,u=c["".concat(l,".").concat(m)]||c[m]||d[m]||i;return t?a.createElement(u,o(o({ref:n},k),{},{components:t})):a.createElement(u,o({ref:n},k))}));function u(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,o=new Array(i);o[0]=m;var p={};for(var l in n)hasOwnProperty.call(n,l)&&(p[l]=n[l]);p.originalType=e,p[c]="string"==typeof e?e:r,o[1]=p;for(var s=2;s<i;s++)o[s]=t[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},60050:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>p,toc:()=>s});var a=t(87462),r=(t(67294),t(3905));const i={title:"\u6dfa\u8ac7 Container \u5be6\u73fe\u539f\u7406, \u4ee5 Docker \u70ba\u4f8b(III)",sidebar_position:3,date:new Date("2019-09-19T06:19:50.000Z"),tags:["Docker","Container","iThome","Network","Storage"],description:"\u672c\u7bc7\u6587\u7ae0\u4f5c\u70ba Container \u4ecb\u7d39\u7684\u6700\u5f8c\u4e00\u7bc7\uff0c\u7c21\u55ae\u7684\u900f\u904e namespace \u7684\u64cd\u4f5c\u8b93\u5927\u5bb6\u770b\u770b network \u4ee5\u53ca storage \u672c\u8eab\u7684\u904b\u884c\u6a21\u5f0f\uff0c\u63a5\u4e0b\u4f86\u5230 CNI \u4ee5\u53ca CSI \u76f8\u95dc\u7684\u7ae0\u7bc0\u7684\u6642\u5019\u6703\u518d\u4ed4\u7d30\u4ecb\u7d39 kubernetes \u4e2d\u662f\u600e\u9ebc\u8655\u7406 network \u8207 storage \u9019\u5169\u5927\u91cd\u8981\u8cc7\u6e90\u3002"},o="\u524d\u8a00",p={unversionedId:"techPost/2019/iThome_Challenge/container-design-iii",id:"techPost/2019/iThome_Challenge/container-design-iii",title:"\u6dfa\u8ac7 Container \u5be6\u73fe\u539f\u7406, \u4ee5 Docker \u70ba\u4f8b(III)",description:"\u672c\u7bc7\u6587\u7ae0\u4f5c\u70ba Container \u4ecb\u7d39\u7684\u6700\u5f8c\u4e00\u7bc7\uff0c\u7c21\u55ae\u7684\u900f\u904e namespace \u7684\u64cd\u4f5c\u8b93\u5927\u5bb6\u770b\u770b network \u4ee5\u53ca storage \u672c\u8eab\u7684\u904b\u884c\u6a21\u5f0f\uff0c\u63a5\u4e0b\u4f86\u5230 CNI \u4ee5\u53ca CSI \u76f8\u95dc\u7684\u7ae0\u7bc0\u7684\u6642\u5019\u6703\u518d\u4ed4\u7d30\u4ecb\u7d39 kubernetes \u4e2d\u662f\u600e\u9ebc\u8655\u7406 network \u8207 storage \u9019\u5169\u5927\u91cd\u8981\u8cc7\u6e90\u3002",source:"@site/docs/techPost/2019/iThome_Challenge/container-design-iii.md",sourceDirName:"techPost/2019/iThome_Challenge",slug:"/techPost/2019/iThome_Challenge/container-design-iii",permalink:"/docs/techPost/2019/iThome_Challenge/container-design-iii",draft:!1,tags:[{label:"Docker",permalink:"/docs/tags/docker"},{label:"Container",permalink:"/docs/tags/container"},{label:"iThome",permalink:"/docs/tags/i-thome"},{label:"Network",permalink:"/docs/tags/network"},{label:"Storage",permalink:"/docs/tags/storage"}],version:"current",sidebarPosition:3,frontMatter:{title:"\u6dfa\u8ac7 Container \u5be6\u73fe\u539f\u7406, \u4ee5 Docker \u70ba\u4f8b(III)",sidebar_position:3,date:"2019-09-19T06:19:50.000Z",tags:["Docker","Container","iThome","Network","Storage"],description:"\u672c\u7bc7\u6587\u7ae0\u4f5c\u70ba Container \u4ecb\u7d39\u7684\u6700\u5f8c\u4e00\u7bc7\uff0c\u7c21\u55ae\u7684\u900f\u904e namespace \u7684\u64cd\u4f5c\u8b93\u5927\u5bb6\u770b\u770b network \u4ee5\u53ca storage \u672c\u8eab\u7684\u904b\u884c\u6a21\u5f0f\uff0c\u63a5\u4e0b\u4f86\u5230 CNI \u4ee5\u53ca CSI \u76f8\u95dc\u7684\u7ae0\u7bc0\u7684\u6642\u5019\u6703\u518d\u4ed4\u7d30\u4ecb\u7d39 kubernetes \u4e2d\u662f\u600e\u9ebc\u8655\u7406 network \u8207 storage \u9019\u5169\u5927\u91cd\u8981\u8cc7\u6e90\u3002"},sidebar:"techPost",previous:{title:"\u6dfa\u8ac7 Container \u5be6\u73fe\u539f\u7406, \u4ee5 Docker \u70ba\u4f8b(II)",permalink:"/docs/techPost/2019/iThome_Challenge/container-design-ii"},next:{title:"Kubernetes & CRI (I)",permalink:"/docs/techPost/2019/iThome_Challenge/k8s-cri-i"}},l={},s=[{value:"Namespace",id:"namespace",level:2}],k={toc:s},c="wrapper";function d(e){let{components:n,...t}=e;return(0,r.kt)(c,(0,a.Z)({},k,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"\u524d\u8a00"},"\u524d\u8a00"),(0,r.kt)("p",null,"\u524d\u4e00\u5929\u7684\u6587\u7ae0\u4e2d\uff0c\u6211\u5011\u63a2\u8a0e\u4e86\u5982\u4f55\u900f\u904e\u73fe\u6709\u7684\u5de5\u5177\u4f86\u5275\u9020\u51fa\u6eff\u8db3 ",(0,r.kt)("inlineCode",{parentName:"p"},"OCI")," \u6a19\u6e96\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"Container")," \u4e26\u4e14\u7a0d\u5fae\u4ecb\u7d39\u4e86\u4e00\u4e0b ",(0,r.kt)("inlineCode",{parentName:"p"},"Docker")," \u5167\u7684\u67b6\u69cb\uff0c\u7406\u89e3\u4e00\u4e0b ",(0,r.kt)("inlineCode",{parentName:"p"},"Docker Client"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"Docker Engine"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"Containerd")," \u4ee5\u53ca ",(0,r.kt)("inlineCode",{parentName:"p"},"Containered-shim")),(0,r.kt)("p",null,"\u76f8\u5c0d\u65bc\u524d\u5e7e\u5929\u90fd\u5728\u89c0\u5bdf ",(0,r.kt)("inlineCode",{parentName:"p"},"OCP")," \u4ee5\u53ca ",(0,r.kt)("inlineCode",{parentName:"p"},"Docker")," \u5275\u5efa\u5bb9\u5668\u7684\u904e\u7a0b\uff0c\u4eca\u5929\u5247\u662f\u6703\u66f4\u7d30\u90e8\u7684\u91dd\u5c0d\u5e95\u5c64\u8cc7\u6e90\u9032\u884c\u7814\u7a76\uff0c\u8b6c\u5982 ",(0,r.kt)("inlineCode",{parentName:"p"},"Networking")," \u8207 ",(0,r.kt)("inlineCode",{parentName:"p"},"Storage"),"."),(0,r.kt)("p",null,"\u5728\u524d\u8ff0\u7684\u6587\u7ae0\u4e2d\u6709\u63d0\u5230",(0,r.kt)("inlineCode",{parentName:"p"},"Linux")," \u74b0\u5883\u4e2d\u662f\u900f\u904e\u4e86 ",(0,r.kt)("inlineCode",{parentName:"p"},"Namespace")," \u4f86\u63d0\u4f9b\u5404\u5f0f\u5404\u7a2e\u4e0d\u540c\u8cc7\u6e90\u9694\u96e2\uff0c\u800c\u5176\u4e2d\u6709\u5169\u500b\u4e4b\u5f8c\u518d ",(0,r.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u4e2d\u4e5f\u6703\u983b\u7e41\u51fa\u73fe\u7684\u5206\u5225\u662f ",(0,r.kt)("inlineCode",{parentName:"p"},"Networking")," \u4ee5\u53ca ",(0,r.kt)("inlineCode",{parentName:"p"},"Storage"),"."),(0,r.kt)("p",null,"\u6240\u4ee5\u4eca\u5929\u7684\u6587\u7ae0\u5c31\u8981\u4f86\u63a2\u8a0e\u4e00\u4e9b\u95dc\u65bc\u4e0a\u8ff0\u5169\u7a2e\u8cc7\u6e90\u662f\u5982\u4f55\u5b8c\u6210\u9694\u96e2\u5316\u7684\u3002"),(0,r.kt)("h1",{id:"networking"},"Networking"),(0,r.kt)("h2",{id:"namespace"},"Namespace"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Network")," namespace \u672c\u8eab\u9694\u96e2\u4e86 ",(0,r.kt)("inlineCode",{parentName:"p"},"Network Stack"),", \u9019\u610f\u5473\u5305\u542b\u4e86 ",(0,r.kt)("inlineCode",{parentName:"p"},"interface"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"ip address"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"iptagbles"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"route")," \u7b49\u5404\u5f0f\u5404\u6a23\u8ddf\u7db2\u8def\u6709\u95dc\u7684\u8cc7\u6e90\u90fd\u88ab\u9694\u96e2\u3002"),(0,r.kt)("p",null,"\u63a5\u4e0b\u4f86\u6211\u5011\u53ef\u4ee5\u505a\u4e00\u500b\u7c21\u55ae\u7684\u64cd\u4f5c\u4f86\u770b\u770b\uff0c\u518d\u64cd\u4f5c\u4e0a\u6211\u5011\u90fd\u6703\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"ip netns")," \u7684\u6307\u4ee4\u4f86\u4f7f\u7528"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash="},"#create network namespace ns1\nip netns add ns1\n##exec in ns1\nip netns exec ns1 bash\n#check interface\nifconfig -a\n")),(0,r.kt)("p",null,"\u9019\u6642\u5019\u4f60\u61c9\u8a72\u6703\u770b\u5230\u985e\u4f3c\u4e0b\u9762\u7684\u756b\u9762\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash="},"lo: flags=8<LOOPBACK>  mtu 65536\n        loop  txqueuelen 1000  (Local Loopback)\n        RX packets 0  bytes 0 (0.0 B)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 0  bytes 0 (0.0 B)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n")),(0,r.kt)("p",null,"\u56e0\u70ba\u8a72\u65b0\u5275\u5efa\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"network namespace")," \u662f\u5b8c\u5168\u7a7a\u7684\uff0c\u6240\u4ee5\u88e1\u9762\u9664\u4e86\u6700\u57fa\u672c\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"loopback")," \u4e4b\u5916\u4e0d\u6703\u6709\u4efb\u4f55\u5176\u4ed6\u7684\u7db2\u5361\u3002"),(0,r.kt)("p",null,"\u6b64\u5916\uff0c\u9019\u6642\u5019\u524d\u5f80 ",(0,r.kt)("inlineCode",{parentName:"p"},"/var/run/netns")," \u4f60\u6703\u89c0\u5bdf\u5230\u6709\u4e00\u500b\u540d\u70ba ",(0,r.kt)("inlineCode",{parentName:"p"},"ns1")," \u7684\u6a94\u6848\uff0c\u4e0a\u8ff0",(0,r.kt)("inlineCode",{parentName:"p"},"ip netns")," \u76f8\u95dc\u7684\u6307\u4ee4\u5247\u6703\u6839\u64da\u9019\u500b\u6a94\u6848\u9032\u884c\u8655\u7406\u3002"),(0,r.kt)("h1",{id:"docker"},"docker"),(0,r.kt)("p",null,"\u63a5\u4e0b\u4f86\u5617\u8a66\u5275\u5efa\u4e00\u500b ",(0,r.kt)("inlineCode",{parentName:"p"},"docker container"),", \u4e26\u4e14\u89c0\u5bdf\u770b\u770b\u662f\u5426\u6709\u8fa6\u6cd5\u900f\u904e ",(0,r.kt)("inlineCode",{parentName:"p"},"ip netns")," \u7684\u65b9\u5f0f\u4f86\u89c0\u5bdf\u8a72 ",(0,r.kt)("inlineCode",{parentName:"p"},"container"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash="},"sudo docker run -d hwchiu/netutils\n")),(0,r.kt)("p",null,"\u9019\u6642\u5019\u6309\u7167\u4e0a\u8ff0\u7684\u65b9\u6cd5\u53bb\u89c0\u5bdf"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash="},"sudo ip netns ls\nsudo ls /var/run/netns\n")),(0,r.kt)("p",null,"\u6703\u767c\u73fe\u5b8c\u5168\u6c92\u6709\u770b\u5230\u5176\u4ed6\u7684\u8cc7\u8a0a\uff0c\u4f9d\u7136\u53ea\u6709\u5148\u524d\u5275\u7acb\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"ns1"),"\uff0c\u539f\u56e0\u662f\n",(0,r.kt)("inlineCode",{parentName:"p"},"docker")," \u5275\u5efa ",(0,r.kt)("inlineCode",{parentName:"p"},"network namespace")," \u5f8c\u6703\u5c07\u8a72\u6a94\u6848\u5f9e ",(0,r.kt)("inlineCode",{parentName:"p"},"/var/run/netns/")," \u4e2d\u79fb\u9664\uff0c\u6240\u4ee5\u5c0e\u81f4\u6c92\u6709\u8fa6\u6cd5\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"ip netns")," \u76f8\u95dc\u7684\u6307\u4ee4\u53bb\u6aa2\u8996\u3002"),(0,r.kt)("p",null,"\u4f46\u662f\u5176\u5be6\u9019\u4e9b\u6a94\u6848\u4e00\u76f4\u90fd\u5728\u7cfb\u7d71\u4e4b\u4e2d\uff0c\u7562\u7adf\u7cfb\u7d71\u8981\u904b\u884c\uff0c\u8cc7\u8a0a\u4e5f\u5fc5\u9808\u5b58\u5728\uff0c\u6240\u4ee5\u6211\u5011\u53ef\u4ee5\u900f\u904e\u4e00\u4e9b\u65b9\u6cd5\u628a\u8a72\u6a94\u6848\u91cd\u65b0\u627e\u56de\u4f86\uff0c\u6700\u5f8c\u91cd\u65b0\u653e\u56de ",(0,r.kt)("inlineCode",{parentName:"p"},"/var/run/netns")," \u4e2d\uff0c\u6700\u5f8c\u5c31\u53ef\u4ee5\u900f\u904e ",(0,r.kt)("inlineCode",{parentName:"p"},"ip netns")," \u7684\u65b9\u5f0f\u4f86\u64cd\u4f5c\u3002"),(0,r.kt)("ol",{start:0},(0,r.kt)("li",{parentName:"ol"},"\u5148\u53d6\u5f97\u5f85\u89c0\u5bdf\u4e4b ",(0,r.kt)("inlineCode",{parentName:"li"},"container")," \u7684 ",(0,r.kt)("inlineCode",{parentName:"li"},"containerID")),(0,r.kt)("li",{parentName:"ol"},"\u5148\u53d6\u5f97\u8a72 ",(0,r.kt)("inlineCode",{parentName:"li"},"Container Process")," \u65bc ",(0,r.kt)("inlineCode",{parentName:"li"},"Host")," \u4e0a\u7684 ",(0,r.kt)("inlineCode",{parentName:"li"},"PID")),(0,r.kt)("li",{parentName:"ol"},"\u524d\u5f80\u8a72 ",(0,r.kt)("inlineCode",{parentName:"li"},"PID")," \u65bc ",(0,r.kt)("inlineCode",{parentName:"li"},"/proc/xxxx/ns")," \u5e95\u4e0b\u627e\u5230\u6240\u6709\u7684 ",(0,r.kt)("inlineCode",{parentName:"li"},"namespace")),(0,r.kt)("li",{parentName:"ol"},"\u5c07\u4e0a\u8ff0\u767c\u73fe\u7684 ",(0,r.kt)("inlineCode",{parentName:"li"},"namespace")," \u5efa\u7acb\u9023\u7d50\u5230 ",(0,r.kt)("inlineCode",{parentName:"li"},"/var/run/ns")),(0,r.kt)("li",{parentName:"ol"},"\u53ef\u4ee5\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"li"},"ip netns")," \u7b49\u6307\u4ee4\u4f86\u64cd\u4f5c")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash="},"sudo docker ps\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'hwchiu@k8s-dev:/var/run$ sudo docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES\n2be547d81b69        hwchiu/netutils     "/bin/bash ./entrypo\u2026"   6 minutes ago       Up 6 minutes                            priceless_cray\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash="},"container_id=2be547d81b69\npid=$(sudo docker inspect -f '{{.State.Pid}}' ${container_id})\nsudo ln -sfT /proc/$pid/ns/net /var/run/netns/${container_id}\nsudo ls /proc/19265/ns\nsudo ls /proc/19265/ns/\nsudo ip netns ls\nsudo ip netns exec ${container_id} ifconfig\n")),(0,r.kt)("p",null,"\u9019\u6642\u5019\u4f60\u61c9\u8a72\u6703\u770b\u5230\u985e\u4f3c\u4e0b\u9762\u7684\u8f38\u51fa"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash="},"eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n        inet 172.18.0.2  netmask 255.255.0.0  broadcast 172.18.255.255\n        ether 02:42:ac:12:00:02  txqueuelen 0  (Ethernet)\n        RX packets 14  bytes 1116 (1.1 KB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 0  bytes 0 (0.0 B)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\nlo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536\n        inet 127.0.0.1  netmask 255.0.0.0\n        loop  txqueuelen 1000  (Local Loopback)\n        RX packets 0  bytes 0 (0.0 B)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 0  bytes 0 (0.0 B)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\n")),(0,r.kt)("p",null,"\u9019\u6642\u5019\u53ef\u4ee5\u5617\u8a66\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"docker")," \u7cfb\u5217\u7684\u6307\u4ee4\u4f86\u89c0\u5bdf\u770b\u5230\u7684\u8cc7\u8a0a\u662f\u5426\u4e00\u81f4"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash="},"sudo docker exec -it ${container_id} bash\nifconfig\n")),(0,r.kt)("p",null,"\u7406\u8ad6\u4e0a\u6211\u5011\u5148\u524d\u900f\u904e ",(0,r.kt)("inlineCode",{parentName:"p"},"ip netns")," \u64cd\u4f5c\u7684\u5c0d\u8c61\u5c31\u662f\u8a72 ",(0,r.kt)("inlineCode",{parentName:"p"},"container")," \u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"network namespace"),", \u6240\u4ee5\u770b\u5230\u7684\u8cc7\u8a0a\u5fc5\u9808\u8981\u4e00\u81f4\u4e14\u4e00\u6a23\u7684\u3002"),(0,r.kt)("p",null,"\u9664\u4e86\u9019\u500b\u57fa\u672c\u6982\u5ff5\u4e4b\u5916\uff0c\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"docker")," \u8207 ",(0,r.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u88e1\u9762\u90fd\u6709\u4e00\u500b\u7db2\u8def\u9078\u9805\u662f ",(0,r.kt)("inlineCode",{parentName:"p"},"net=hostnetwork"),", \u9019\u500b\u7684\u610f\u601d\u5c31\u662f",(0,r.kt)("inlineCode",{parentName:"p"},"\u8acb\u4e0d\u8981\u5275\u5efa\u984d\u5916\u7684 network namespace"),",\u8acb\u4f7f\u7528\u8207 ",(0,r.kt)("inlineCode",{parentName:"p"},"host")," \u76f8\u540c\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"network namespace"),". \u9019\u500b\u60c5\u7269\u4e0b\uff0c\u4f60\u5c31\u53ef\u4ee5\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"container")," \u5167\u5916\u90fd\u770b\u5230\u76f8\u540c\u7684\u7db2\u8def\u8cc7\u6e90 ",(0,r.kt)("inlineCode",{parentName:"p"},"NIC, Route, IP, IPtables..etc")),(0,r.kt)("h1",{id:"storage"},"Storage"),(0,r.kt)("p",null,"\u5e38\u5e38\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"docker")," \u7684\u4eba\u4e00\u5b9a\u5c0d\u65bc ",(0,r.kt)("inlineCode",{parentName:"p"},"volume mount")," \u9019\u500b\u6982\u5ff5\u4e0d\u964c\u751f\uff0c\u4e0d\u8ad6\u662f ",(0,r.kt)("inlineCode",{parentName:"p"},"docker volume")," \u66f4\u4e0a\u5c64\u7684\u62bd\u8c61\u5316\u6216\u662f\u55ae\u7d14\u904b\u884c\u6642\u671f\u639b\u8f09\u4e0a\u53bb\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"docker run -v xxx:xxx")," \u7b49\u90fd\u80fd\u5920\u7528\u4f86\u89e3\u6c7a\u90e8\u5206\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"Container")," \u5167\u7684\u9700\u8981\u7684\u5132\u5b58\u554f\u984c"),(0,r.kt)("p",null,"\u65bc ",(0,r.kt)("inlineCode",{parentName:"p"},"linux")," \u5e95\u4e0b\uff0c\u901a\u5e38\u6211\u5011\u90fd\u6703\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"mount")," \u4f86\u8655\u7406\u6a94\u6848\u7684\u639b\u8f09\u554f\u984c"),(0,r.kt)("p",null,"\u9996\u5148\u6211\u5011\u5148\u555f\u52d5\u4e00\u500b\u7c21\u55ae\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"Container")," \u4f86\u639b\u8f09\u4e00\u500b\u5916\u90e8\u7684\u8cc7\u6599\u593e\u5230 ",(0,r.kt)("inlineCode",{parentName:"p"},"Container")," \u5167\u4f7f\u7528"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash="},"sudo docker run -d -v /home/:/outside-home hwchiu/netutils\n")),(0,r.kt)("p",null,"\u9019\u6642\u5019\u900f\u904e\u672c\u6a5f\u7684\u6307\u4ee4\u53bb\u6aa2\u67e5 ",(0,r.kt)("inlineCode",{parentName:"p"},"host mount namespace")," \u6703\u5b8c\u5168\u770b\u4e0d\u5230\u8ddf ",(0,r.kt)("inlineCode",{parentName:"p"},"/home")," \u6709\u95dc\u7684\u4efb\u4f55\u8cc7\u6599"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash="},"mount | grep home\nsudo cat /proc/self/mountinfo | grep home\n")),(0,r.kt)("p",null,"\u9019\u662f\u56e0\u70ba\u8a72\u5bb9\u5668\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"mount")," \u76f8\u95dc\u8cc7\u8a0a\u4e5f\u90fd\u88ab ",(0,r.kt)("inlineCode",{parentName:"p"},"mount namespace")," \u9694\u96e2\u4e86\uff0c\u5c31\u5982\u540c ",(0,r.kt)("inlineCode",{parentName:"p"},"networking")," \u4e00\u6a23\uff0c\u6211\u5011\u5176\u5be6\u4e5f\u53ef\u4ee5\u5728\u8a72 ",(0,r.kt)("inlineCode",{parentName:"p"},"container process")," \u7684\u76f8\u95dc\u6a94\u6848\u4e2d\u627e\u5230\u8a72\u8cc7\u8a0a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash="},"#change the id to your container id\ncontainer_id=b9428568d3ff\npid=$(sudo docker inspect -f '{{.State.Pid}}' ${container_id})\nsudo cat /proc/$pid/mountinfo | grep home\nsudo docker exec $container_id cat /proc/self/mountinfo | grep home\n")),(0,r.kt)("p",null,"\u9019\u6642\u5019\u5c31\u6703\u770b\u5230\u76f8\u95dc\u7684\u8cc7\u8a0a\uff0c\u8b6c\u5982"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash="},"478 459 8:1 /home /outside-home rw,relatime - ext4 /dev/sda1 rw,data=ordered\n")),(0,r.kt)("p",null,"\u53cd\u904e\u4f86\u8aaa\uff0c\u5982\u679c\u4eca\u5929\u4f60\u77e5\u9053\u76ee\u6a19\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"ContainerID"),"\uff0c\u4f60\u5c31\u53ef\u4ee5\u900f\u904e\u985e\u4f3c\u7684\u65b9\u5f0f\u627e\u5230\u7576\u521d\u5275\u5efa\u8a72 ",(0,r.kt)("inlineCode",{parentName:"p"},"Container")," \u6642\u8a2d\u5b9a\u7684\u76f8\u95dc ",(0,r.kt)("inlineCode",{parentName:"p"},"Mount")," \u8cc7\u8a0a"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Mount")," \u76f8\u95dc\u7684\u6982\u5ff5\u975e\u5e38\u9f90\u5927\u4e5f\u975e\u5e38\u8907\u96dc\uff0c\u6211\u975e\u5e38\u63a8\u85a6\u6709\u8208\u8da3\u7684\u53ef\u4ee5\u628a",(0,r.kt)("a",{parentName:"p",href:"https://www.kernel.org/doc/Documentation/filesystems/sharedsubtree.txt"},"\u9019\u7bc7\u6587\u7ae0"),"\u770b\u5b8c\u3002\n\u9664\u4e86\u57fa\u672c\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"mount")," \u7684\u4f7f\u7528\u65b9\u6cd5\u5916\uff0c\u5176\u5be6\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u88e1\u9762\u9084\u6709\u4e00\u500b ",(0,r.kt)("inlineCode",{parentName:"p"},"mount propagation")," \u7684\u8a2d\u5b9a\u53ef\u4ee5\u4f7f\u7528\uff0c\u4f46\u662f\u9019\u500b\u8a2d\u5b9a\u5176\u5be6\u672c\u8eab\u80cc\u5f8c\u7684\u6982\u5ff5\u4e26\u4e0d\u7c21\u55ae\uff0c\u4e00\u822c\u7684\u4f7f\u7528\u8005\u57fa\u672c\u4e0a\u90fd\u4e0d\u6703\u78b0\u5230\u9019\u500b\u8a2d\u5b9a\uff0c\u4f46\u662f\u4e00\u65e6\u9047\u5230\u7684\u6642\u5019\u5c31\u6703\u9700\u8981\u4e86\u3002"),(0,r.kt)("p",null,"\u6b64\u5916\u5c0d\u65bc ",(0,r.kt)("inlineCode",{parentName:"p"},"Container")," \u4f86\u8aaa\uff0c\u6211\u5011\u4e5f\u53ef\u4ee5\u89c0\u5bdf\u5230\u5176\u5be6 ",(0,r.kt)("inlineCode",{parentName:"p"},"Contianer")," \u672c\u8eab\u4e0d\u592a\u53bb\u7ba1\u5230\u5e95\u600e\u9ebc\u8ddf\u5916\u754c\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"Storage")," \u4e32\u9023\u7684\uff0c \u4e00\u5207\u5c31\u662f\u4f9d\u8cf4 ",(0,r.kt)("inlineCode",{parentName:"p"},"Mount Namespace")," \u5c07\u9019\u4e9b\u5132\u5b58\u7a7a\u9593\u639b\u9032\u53bb\uff0c\u81f3\u65bc\u4f60\u8981\u63a1\u7528\u4ec0\u9ebc\u6a94\u6848\u7cfb\u7d71\uff0c\u80cc\u5f8c\u6709\u4ec0\u9ebc\u5099\u63f4\u6a5f\u5236\uff0c\u90fd\u662f ",(0,r.kt)("inlineCode",{parentName:"p"},"host")," \u672c\u8eab\u53bb\u7ba1\u7406\uff0c ",(0,r.kt)("inlineCode",{parentName:"p"},"Container")," \u672c\u8eab\u4e0d\u8655\u7406\u3002"),(0,r.kt)("h1",{id:"summary"},"Summary"),(0,r.kt)("p",null,"\u4eca\u5929\u900f\u904e\u4e00\u4e9b\u57fa\u672c\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"linux")," \u5de5\u5177\u5e36\u5927\u5bb6\u7a0d\u5fae\u904e\u4e86\u4e00\u4e0b ",(0,r.kt)("inlineCode",{parentName:"p"},"docker container")," \u5e95\u4e0b\u95dc\u65bc ",(0,r.kt)("inlineCode",{parentName:"p"},"networking")," \u4ee5\u53ca ",(0,r.kt)("inlineCode",{parentName:"p"},"storage")," \u7684\u4e00\u4e9b\u51b7\u77e5\u8b58\uff0c\u8ddf\u5927\u5bb6\u5206\u4eab\u5e73\u5e38\u5728\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"docker container")," \u6642\u5230\u5e95\u80cc\u5f8c\u6709\u54ea\u4e9b\u6a5f\u5236\u6490\u8d77\u4e86\u9019\u8907\u96dc\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"container")," \u7cfb\u7d71\uff0c\u540c\u6642\u85c9\u7531\u7406\u89e3\u9019\u4e9b\u8cc7\u8a0a\uff0c\u672a\u4f86\u60f3\u8981\u505a\u66f4\u9032\u4e00\u6b65\u7684\u9664\u932f\u4e5f\u90fd\u53ef\u4ee5\u6709\u5176\u4ed6\u7684\u5de5\u4f5c\u4f86\u5e6b\u5fd9\u8f14\u52a9\u3121"),(0,r.kt)("p",null,"\u9664\u4e86 ",(0,r.kt)("inlineCode",{parentName:"p"},"networking")," \u4ee5\u53ca ",(0,r.kt)("inlineCode",{parentName:"p"},"mount")," \u5916\uff0c\u9084\u6709\u5176\u4ed6\u7684\u5982 ",(0,r.kt)("inlineCode",{parentName:"p"},"user"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"uts")," \u7b49\u4e0d\u540c\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"namespace")," \u5e6b\u5fd9\u9694\u96e2\u5176\u9918\u7684\u7cfb\u7d71\u8cc7\u6e90\u4ee5\u5b8c\u6210\u6240\u8b02\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"container")," \u865b\u64ec\u5316\u3002\n\u6709\u8208\u8da3\u7684\u4eba\u90fd\u53ef\u4ee5\u91dd\u5c0d\u5176\u4ed6\u7684\u8cc7\u6e90\u53bb\u7814\u7a76\u770b\u770b\u8981\u5982\u4f55\u518d ",(0,r.kt)("inlineCode",{parentName:"p"},"host")," \u7aef\u5b58\u53d6\u76f8\u95dc\u7684\u8cc7\u8a0a\u4e26\u4e14\u5b78\u7fd2\u66f4\u591a\u5e95\u5c64\u7684\u5be6\u4f5c\u3002"),(0,r.kt)("h1",{id:"reference"},"Reference"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"http://man7.org/linux/man-pages/man5/proc.5.html"},"http://man7.org/linux/man-pages/man5/proc.5.html"))))}d.isMDXComponent=!0}}]);
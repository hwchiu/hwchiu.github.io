"use strict";(self.webpackChunkhwchiu=self.webpackChunkhwchiu||[]).push([[79312],{3905:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>s});var a=t(67294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function p(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function r(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},l=Object.keys(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var o=a.createContext({}),k=function(e){var n=a.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):p(p({},n),e)),t},d=function(e){var n=k(e.components);return a.createElement(o.Provider,{value:n},e.children)},m="mdxType",N={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},C=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,l=e.originalType,o=e.parentName,d=r(e,["components","mdxType","originalType","parentName"]),m=k(t),C=i,s=m["".concat(o,".").concat(C)]||m[C]||N[C]||l;return t?a.createElement(s,p(p({ref:n},d),{},{components:t})):a.createElement(s,p({ref:n},d))}));function s(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var l=t.length,p=new Array(l);p[0]=C;var r={};for(var o in n)hasOwnProperty.call(n,o)&&(r[o]=n[o]);r.originalType=e,r[m]="string"==typeof e?e:i,p[1]=r;for(var k=2;k<l;k++)p[k]=t[k];return a.createElement.apply(null,p)}return a.createElement.apply(null,t)}C.displayName="MDXCreateElement"},8555:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>p,default:()=>N,frontMatter:()=>l,metadata:()=>r,toc:()=>k});var a=t(87462),i=(t(67294),t(3905));const l={title:"[netfilter] Introduction to ebtables",date:new Date("2018-09-13T02:22:06.000Z"),tags:["Network","Netfilter","Linux","Kernel"],description:"\u672c\u6587\u662f iptables/ebtables \u7cfb\u5217\u5206\u4eab\u6587\u7684\u7b2c\u4e00\u7bc7\uff0c\u6703\u5148\u8457\u91cd\u65bc iptables/ebtables \u672c\u8eab\u7684\u67b6\u69cb\uff0c\u66f4\u6e96\u78ba\u7684\u662f netfilter \u7684\u67b6\u69cb\u4ecb\u7d39\uff0c\u5f9e User-Space \u5230 Kernel-Space \u7684\u7d44\u6210\u5143\u4ef6\uff0c\u4e26\u4e14\u7c21\u55ae\u6558\u8ff0\u4e00\u4e0b\u6574\u9ad4\u7684\u904b\u4f5c\u6d41\u7a0b\u3002\u6700\u5f8c\u958b\u59cb\u4ecb\u7d39 ebtables \u9019\u500b\u5b58\u5728\u4f46\u662f\u8f03\u5c11\u4eba\u77e5\u9053\u7684\u5de5\u5177\uff0c\u4e0d\u540c\u65bc iptables, ebtables \u66f4\u5c08\u6ce8\u65bc\u57fa\u65bc MAC \u5730\u5740\u7684 Layer2 \u8f49\u767c\u3002 \u6587\u7ae0\u6700\u5f8c\u4ecb\u7d39\u4e86 ebtables \u7684\u898f\u5247\u7d44\u6210\uff0c\u4e26\u4e14\u5c07 ebtables \u898f\u5247\u7684\u8655\u7406\u9806\u5e8f\u4ee5\u5716\u8868\u7684\u65b9\u5f0f\u5448\u73fe\uff0c\u8b93\u5927\u5bb6\u66f4\u5bb9\u6613\u7406\u89e3\u5728 Layer2 \u8f49\u767c\u6642\uff0c\u8a72\u600e\u9ebc\u900f\u904e `ebtables` \u53bb\u8a2d\u5b9a\u76f8\u95dc\u7684\u898f\u5247\u4f86\u8655\u7406\u5c01\u5305\u3002"},p=void 0,r={unversionedId:"2018/netfilter-eiptables-i",id:"2018/netfilter-eiptables-i",title:"[netfilter] Introduction to ebtables",description:"\u672c\u6587\u662f iptables/ebtables \u7cfb\u5217\u5206\u4eab\u6587\u7684\u7b2c\u4e00\u7bc7\uff0c\u6703\u5148\u8457\u91cd\u65bc iptables/ebtables \u672c\u8eab\u7684\u67b6\u69cb\uff0c\u66f4\u6e96\u78ba\u7684\u662f netfilter \u7684\u67b6\u69cb\u4ecb\u7d39\uff0c\u5f9e User-Space \u5230 Kernel-Space \u7684\u7d44\u6210\u5143\u4ef6\uff0c\u4e26\u4e14\u7c21\u55ae\u6558\u8ff0\u4e00\u4e0b\u6574\u9ad4\u7684\u904b\u4f5c\u6d41\u7a0b\u3002\u6700\u5f8c\u958b\u59cb\u4ecb\u7d39 ebtables \u9019\u500b\u5b58\u5728\u4f46\u662f\u8f03\u5c11\u4eba\u77e5\u9053\u7684\u5de5\u5177\uff0c\u4e0d\u540c\u65bc iptables, ebtables \u66f4\u5c08\u6ce8\u65bc\u57fa\u65bc MAC \u5730\u5740\u7684 Layer2 \u8f49\u767c\u3002 \u6587\u7ae0\u6700\u5f8c\u4ecb\u7d39\u4e86 ebtables \u7684\u898f\u5247\u7d44\u6210\uff0c\u4e26\u4e14\u5c07 ebtables \u898f\u5247\u7684\u8655\u7406\u9806\u5e8f\u4ee5\u5716\u8868\u7684\u65b9\u5f0f\u5448\u73fe\uff0c\u8b93\u5927\u5bb6\u66f4\u5bb9\u6613\u7406\u89e3\u5728 Layer2 \u8f49\u767c\u6642\uff0c\u8a72\u600e\u9ebc\u900f\u904e `ebtables` \u53bb\u8a2d\u5b9a\u76f8\u95dc\u7684\u898f\u5247\u4f86\u8655\u7406\u5c01\u5305\u3002",source:"@site/docs/2018/netfilter-eiptables-i.md",sourceDirName:"2018",slug:"/2018/netfilter-eiptables-i",permalink:"/docs/2018/netfilter-eiptables-i",draft:!1,tags:[{label:"Network",permalink:"/docs/tags/network"},{label:"Netfilter",permalink:"/docs/tags/netfilter"},{label:"Linux",permalink:"/docs/tags/linux"},{label:"Kernel",permalink:"/docs/tags/kernel"}],version:"current",lastUpdatedBy:"HungWei Chiu",frontMatter:{title:"[netfilter] Introduction to ebtables",date:"2018-09-13T02:22:06.000Z",tags:["Network","Netfilter","Linux","Kernel"],description:"\u672c\u6587\u662f iptables/ebtables \u7cfb\u5217\u5206\u4eab\u6587\u7684\u7b2c\u4e00\u7bc7\uff0c\u6703\u5148\u8457\u91cd\u65bc iptables/ebtables \u672c\u8eab\u7684\u67b6\u69cb\uff0c\u66f4\u6e96\u78ba\u7684\u662f netfilter \u7684\u67b6\u69cb\u4ecb\u7d39\uff0c\u5f9e User-Space \u5230 Kernel-Space \u7684\u7d44\u6210\u5143\u4ef6\uff0c\u4e26\u4e14\u7c21\u55ae\u6558\u8ff0\u4e00\u4e0b\u6574\u9ad4\u7684\u904b\u4f5c\u6d41\u7a0b\u3002\u6700\u5f8c\u958b\u59cb\u4ecb\u7d39 ebtables \u9019\u500b\u5b58\u5728\u4f46\u662f\u8f03\u5c11\u4eba\u77e5\u9053\u7684\u5de5\u5177\uff0c\u4e0d\u540c\u65bc iptables, ebtables \u66f4\u5c08\u6ce8\u65bc\u57fa\u65bc MAC \u5730\u5740\u7684 Layer2 \u8f49\u767c\u3002 \u6587\u7ae0\u6700\u5f8c\u4ecb\u7d39\u4e86 ebtables \u7684\u898f\u5247\u7d44\u6210\uff0c\u4e26\u4e14\u5c07 ebtables \u898f\u5247\u7684\u8655\u7406\u9806\u5e8f\u4ee5\u5716\u8868\u7684\u65b9\u5f0f\u5448\u73fe\uff0c\u8b93\u5927\u5bb6\u66f4\u5bb9\u6613\u7406\u89e3\u5728 Layer2 \u8f49\u767c\u6642\uff0c\u8a72\u600e\u9ebc\u900f\u904e `ebtables` \u53bb\u8a2d\u5b9a\u76f8\u95dc\u7684\u898f\u5247\u4f86\u8655\u7406\u5c01\u5305\u3002"},sidebar:"techPost",previous:{title:"[Golang] aggregate in mongo",permalink:"/docs/2018/mgo-aggregate"},next:{title:"[netfilter] Introduction to iptables",permalink:"/docs/2018/netfilter-eiptables-ii"}},o={},k=[{value:"Preface",id:"preface",level:2},{value:"Introduction",id:"introduction",level:2},{value:"User Space",id:"user-space",level:3},{value:"Kernel Space",id:"kernel-space",level:3},{value:"Network Interface Card",id:"network-interface-card",level:3},{value:"Workflow",id:"workflow",level:3},{value:"iptables/ebtables",id:"iptablesebtables",level:2},{value:"Component",id:"component",level:3},{value:"Table",id:"table",level:3},{value:"Chain",id:"chain",level:3},{value:"Match",id:"match",level:3},{value:"Target",id:"target",level:3},{value:"ebtables",id:"ebtables",level:2},{value:"Table",id:"table-1",level:3},{value:"Chain",id:"chain-1",level:3},{value:"Match",id:"match-1",level:3},{value:"Target",id:"target-1",level:3},{value:"Summary",id:"summary",level:3},{value:"Reference",id:"reference",level:2}],d={toc:k},m="wrapper";function N(e){let{components:n,...t}=e;return(0,i.kt)(m,(0,a.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"preface"},"Preface"),(0,i.kt)("p",null,"\u518d\u4e4b\u524d\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"kubernetes server")," \u7cfb\u5217\u6587\u4e2d\u6709\u7a0d\u5fae\u4ecb\u7d39\u904e ",(0,i.kt)("inlineCode",{parentName:"p"},"iptables")," \u7684\u4e00\u4e9b\u7528\u6cd5\uff0c\u4ee5\u53ca\u5982\u4f55\u900f\u904e ",(0,i.kt)("inlineCode",{parentName:"p"},"iptables")," \u4f86\u5b8c\u6210 ",(0,i.kt)("inlineCode",{parentName:"p"},"kubernetes service"),". \u82e5\u6709\u4efb\u4f55\u4e0d\u719f\u6089\u7684\u6982\u5ff5\u53ef\u4ee5\u91cd\u65b0\u95b1\u8b80\u4e00\u6b21\u8a72\u7cfb\u5217\u6587\u7ae0."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.hwchiu.com/docs/2018/kubernetes-service-ii"},"[Kubernetes] How To Implement Kubernetes Service - ClusterIP"))),(0,i.kt)("p",null,"\u56de\u5230\u4e3b\u984c\uff0c\u9019\u6b21\u60f3\u8981\u8ddf\u5927\u5bb6\u6162\u6162\u4ecb\u7d39\u7684\u5c31\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"iptables")," \u9019\u500b\u5e38\u898b\u4e5f\u5e38\u7528\u7684\u5de5\u5177\u3002\n\u7db2\u8def\u4e0a\u5176\u5be6\u5df2\u7d93\u53ef\u4ee5\u641c\u5c0b\u5230\u975e\u5e38\u591a\u95dc\u65bc ",(0,i.kt)("inlineCode",{parentName:"p"},"iptables")," \u76f8\u95dc\u7684\u6587\u7ae0\u3002\n\u4e0d\u8ad6\u662f\u57fa\u672c\u4ecb\u7d39\uff0c\u6216\u662f\u4e00\u4e9b\u76f8\u95dc\u7528\u6cd5\uff0c\u5176\u5be6\u90fd\u6709\u6eff\u591a\u7684\u8cc7\u6e90\u53ef\u4ee5\u5b78\u7fd2\uff0c\u4e0d\u904e\u6211\u8a8d\u70ba\u9019\u4e9b\u6587\u7ae0\u90fd\u6563\u843d\u5404\u5730\uff0c\u6240\u4ee5\u60f3\u8981\u6574\u7406\u4e00\u4e0b\u9019\u4e9b\u8cc7\u8a0a\u4e26\u4e14\u7d71\u6574\u8d77\u4f86\u505a\u4e00\u500b\u4e00\u7cfb\u5217\u7684",(0,i.kt)("inlineCode",{parentName:"p"},"iptables"),"\u6587\u7ae0\u3002\n\u9019\u500b\u7cfb\u5217\u6587\u7684\u5167\u5bb9\u5927\u81f4\u4e0a\u5982\u4e0b"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"iptables/ebtables \u7684\u57fa\u672c\u67b6\u69cb\u4ecb\u7d39\uff0c\u5305\u542b\u4e0b\u5217\u5404\u7a2e\u7d44\u6210\u7684\u6982\u5ff5",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Target/Chain/Table/Match"))),(0,i.kt)("li",{parentName:"ol"},"\u900f\u904e ",(0,i.kt)("inlineCode",{parentName:"li"},"docker")," \u9810\u8a2d\u7db2\u8def",(0,i.kt)("inlineCode",{parentName:"li"},"Bridge"),"\u7684\u60c5\u6cc1\u4f86\u89e3\u91cb\uff0c\u5bb9\u5668\u8207\u5916\u754c\u7db2\u8def\uff0c\u5bb9\u5668\u8207\u5bb9\u5668\u5f7c\u6b64\u4e4b\u9593\u7684\u7db2\u8def\u50b3\u8f38\uff0c\u5be6\u969b\u4e0a\u518d ",(0,i.kt)("inlineCode",{parentName:"li"},"iptables")," \u4e2d\u5230\u5e95\u6703\u600e\u9ebc\u904b\u4f5c\uff0c\u5982\u679c\u60f3\u8981\u8655\u7406\u9019\u4e9b\u5c01\u5305\uff0c\u8a72\u600e\u9ebc\u8a2d\u5b9a\u76f8\u95dc\u898f\u5247\u3002"),(0,i.kt)("li",{parentName:"ol"},"\u4ecb\u7d39\u76f8\u95dc ",(0,i.kt)("inlineCode",{parentName:"li"},"iptables")," \u5e38\u898b\u7684\u4f7f\u7528\u554f\u984c"),(0,i.kt)("li",{parentName:"ol"},"\u6700\u5f8c\u5247\u662f\u6703\u8ddf\u5927\u5bb6\u4ecb\u7d39\uff0c\u5982\u4f55\u81ea\u5df1\u624b\u52d5\u64b0\u5beb\u4e00\u500b ",(0,i.kt)("inlineCode",{parentName:"li"},"iptables")," \u64f4\u5145\u6a21\u7d44\uff0c\u8b93\u4f60\u7684",(0,i.kt)("inlineCode",{parentName:"li"},"iptables"),"\u64c1\u6709\u7368\u4e00\u7121\u4e8c\u7684\u529f\u80fd")),(0,i.kt)("p",null,"\u672c\u6587\u5247\u662f\u7cfb\u5217\u6587\u7b2c\u4e00\u7bc7\uff0c\u5c07\u8457\u91cd\u65bc",(0,i.kt)("inlineCode",{parentName:"p"},"netfilter"),"\u7684\u67b6\u69cb\u4ecb\u7d39\uff0c\u8b93\u5927\u5bb6\u5c0d\u65bc",(0,i.kt)("inlineCode",{parentName:"p"},"netfilter")," \u7684\u6982\u5ff5\u6709\u500b\u57fa\u672c\u7684\u8a8d\u77e5\u8207\u77ad\u89e3\u3002\n\u6700\u5f8c\u5247\u6703\u4ecb\u7d39\u4e00\u4e0b ",(0,i.kt)("inlineCode",{parentName:"p"},"ebtables")," \u7684\u6982\u5ff5\u4ee5\u53ca\u5c01\u5305\u50b3\u905e\u904e\u7a0b\u3002"),(0,i.kt)("p",null,"\u76f8\u95dc\u7cfb\u5217\u6587\u7ae0"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.hwchiu.com/docs/2018/netfilter-eiptables-ii"},"[netfilter] Introduction to iptables")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.hwchiu.com/docs/2018/netfilter-eiptables-iii"},"[netfilter] Dig Into Docker Bridge Network By iptables/ebtables"))),(0,i.kt)("h2",{id:"introduction"},"Introduction"),(0,i.kt)("p",null,"\u4e00\u822c\u6211\u5011\u5e38\u5e38\u5728\u8b1b\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"iptables"),"\uff0c\u5176\u5be6\u80cc\u5f8c\u771f\u6b63\u7684\u5c08\u6848\u4ee5\u53ca\u76f8\u95dc\u6280\u8853\u90fd\u8ddf ",(0,i.kt)("inlineCode",{parentName:"p"},"netfilter")," \u5bc6\u5207\u76f8\u95dc\u3002"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"netfilter")," \u7684",(0,i.kt)("a",{parentName:"p",href:"https://www.netfilter.org/"},"\u5b98\u65b9\u7db2\u7ad9")," \u4e0a\u9762\u6709\u975e\u5e38\u8a73\u7d30\u7684\u4ecb\u7d39\uff0c\u540c\u6642\u6709\u975e\u5e38\u591a\u76f8\u95dc\u7684\u5c08\u6848\u3002\n\u8b6c\u5982\u5f9e\u4f7f\u7528\u8005\u6703\u4f7f\u7528\u7684\u6307\u4ee4\u5230\u7d66\u4f7f\u7528\u8005\u958b\u767c\u7684\u51fd\u5f0f\u5eab\u5168\u90e8\u90fd\u8a72\u7db2\u7ad9\u4e0a\u9762\u627e\u5230\uff0c\u800c\u4eca\u5929\u6211\u5011\u7684\u4e3b\u89d2 ",(0,i.kt)("inlineCode",{parentName:"p"},"iptables")," \u5247\u662f\u5c6c\u65bc",(0,i.kt)("inlineCode",{parentName:"p"},"\u7d66\u4f7f\u7528\u8005\u4f7f\u7528\u7684\u6307\u4ee4"),"."),(0,i.kt)("p",null,"\u4e0b\u5716\u662f\u4e00\u500b\u53ef\u4ee5\u7c21\u55ae\u63cf\u8ff0\u6574\u500b ",(0,i.kt)("inlineCode",{parentName:"p"},"iptables/netfilter")," \u7684\u67b6\u69cb\u5716\u3002\n\u6574\u500b\u7cfb\u7d71\u7684\u7d44\u6210\u5206\u6210\u4e09\u5927\u90e8\u5206\uff0c\u5206\u5225\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"user-space"),",",(0,i.kt)("inlineCode",{parentName:"p"},"kernel-space")," \u4ee5\u53ca ",(0,i.kt)("inlineCode",{parentName:"p"},"network interface cards"),"."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://i.imgur.com/WlcgN7L.png",alt:"Imgur"})),(0,i.kt)("h3",{id:"user-space"},"User Space"),(0,i.kt)("p",null,"\u5927\u5bb6\u6700\u5e38\u898b\u4e5f\u6700\u719f\u6089\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"iptables")," \u4ee5\u53ca\u6bd4\u8f03\u5c11\u4eba\u77e5\u9053\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"ebtalbes")," \u90fd\u662f\u6240\u8b02\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"user-space")," \u7684\u61c9\u7528\u7a0b\u5f0f\u3002\n\u9019\u985e\u7684\u61c9\u7528\u7a0b\u5f0f\u63d0\u4f9b\u4e86\u4e00\u500b\u53cb\u5584\u4e14\u6613\u65bc\u64cd\u4f5c\u7684\u74b0\u5883\u8b93",(0,i.kt)("inlineCode",{parentName:"p"},"\u4f7f\u7528\u8005/\u7cfb\u7d71\u7ba1\u7406\u8005"),"\u6709\u8fa6\u6cd5\u53bb\u5c0d",(0,i.kt)("inlineCode",{parentName:"p"},"kernel"),"\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"netfilter")," \u9032\u884c\u64cd\u4f5c\u3002"),(0,i.kt)("p",null,"\u9664\u4e86 ",(0,i.kt)("inlineCode",{parentName:"p"},"netfilter")," \u5c08\u6848\u672c\u8eab\u63d0\u4f9b\u7684\u5de5\u5177\u4e4b\u5916\uff0c\u4f7f\u7528\u8005\u4e5f\u53ef\u4ee5\u81ea\u884c\u7684\u900f\u904e\u76f8\u95dc\u7684\u7a0b\u5f0f\u8a9e\u8a00\u51fd\u5f0f\u5eab\u4f86\u8207 ",(0,i.kt)("inlineCode",{parentName:"p"},"kernel")," \u5167\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"netfilter")," \u6e9d\u901a\u3002"),(0,i.kt)("p",null,"\u8207",(0,i.kt)("inlineCode",{parentName:"p"},"kernel"),"\u7684\u6e9d\u901a\u65b9\u9762\uff0c\u4e00\u822c\u90fd\u662f\u63a1\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"system call")," \u7684\u65b9\u5f0f\u4f86\u6e9d\u901a\uff0c\u91dd\u5c0d\u4e00\u4e9b\u7279\u5225\u7684\u61c9\u7528\u751a\u81f3\u53ef\u4ee5\u63a1\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"netlink")," \u7684\u65b9\u5f0f\u53bb\u63a5\u6536\u5c01\u5305\u4f86\u9032\u884c\u4e8c\u6b21\u8655\u7406\u3002"),(0,i.kt)("p",null,"\u5c0d\u4e8c\u6b21\u8655\u7406\u6709\u8208\u8da3\u7684\u4eba\u53ef\u4ee5\u641c\u5c0b ",(0,i.kt)("inlineCode",{parentName:"p"},"NFQUEUE")," \u76f8\u95dc\u7684\u8cc7\u6e90"),(0,i.kt)("h3",{id:"kernel-space"},"Kernel Space"),(0,i.kt)("p",null,"\u6574\u500b ",(0,i.kt)("inlineCode",{parentName:"p"},"netfilter")," \u7684\u7cbe\u83ef\u8207\u64cd\u4f5c\u57fa\u672c\u4e0a\u90fd\u662f\u5728 ",(0,i.kt)("inlineCode",{parentName:"p"},"kernel")," \u5c64\u7d1a\u53bb\u5b8c\u6210\u7684\u3002\u518d\u6b64 ",(0,i.kt)("inlineCode",{parentName:"p"},"netfilter")," \u7684\u5b50\u7cfb\u7d71\u5167\uff0c\u5305\u542b\u4e86\u6240\u6709\u4f7f\u7528\u8005\u900f\u904e ",(0,i.kt)("inlineCode",{parentName:"p"},"iptables")," \u6240\u50b3\u9054\u7684\u6240\u6709\u6307\u4ee4\uff0c\u8b6c\u5982",(0,i.kt)("inlineCode",{parentName:"p"},"\u4e1f\u68c4\u6240\u6709\u4f86\u81eaa.b.c.d\u7684\u5c01\u5305")," \u9019\u7a2e\u985e\u4f3c\u7684\u898f\u5247\uff0c\u5168\u90e8\u90fd\u6703\u5b58\u5728 ",(0,i.kt)("inlineCode",{parentName:"p"},"kernel")," \u5167\u3002"),(0,i.kt)("p",null,"\u9019\u908a\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u56e0\u70ba ",(0,i.kt)("inlineCode",{parentName:"p"},"kernel")," \u6bcf\u6b21\u91cd\u65b0\u958b\u6a5f\u5f8c\uff0c\u4e0a\u6b21\u5b58\u5728\u8a18\u61b6\u9ad4\u5167\u7684\u8cc7\u8a0a\u90fd\u6703\u6d88\u5931\uff0c\u9019\u610f\u5473\u8005\u6240\u6709",(0,i.kt)("inlineCode",{parentName:"p"},"iptables"),"\u6240\u50b3\u9054\u7684\u547d\u4ee4\u90fd\u6703\u6d88\u5931\uff0c\u56e0\u6b64\u624d\u6703\u6709\u6240\u8b02\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"iptables save/restore")," \u7b49\u76f8\u95dc\u7684\u6307\u4ee4\u7136\u5f8c\u642d\u914d\u4e0a ",(0,i.kt)("inlineCode",{parentName:"p"},"systemd/upstart")," \u7b49\u6a5f\u5236\u4f86\u78ba\u4fdd\u6bcf\u6b21\u91cd\u65b0\u958b\u6a5f\u5f8c\u76f8\u95dc\u7684\u898f\u5247\u90fd\u6703\u91cd\u65b0\u90e8\u5c6c\u4e0a\u53bb\u3002"),(0,i.kt)("h3",{id:"network-interface-card"},"Network Interface Card"),(0,i.kt)("p",null,"\u5927\u5bb6\u6703\u4f7f\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"iptables")," \u4e00\u5b9a\u90fd\u662f\u60f3\u8981\u91dd\u5c0d\u7279\u5b9a\u7684\u7db2\u8def\u5c01\u5305\u9032\u884c\u4e00\u4e9b\u8655\u7406\uff0c\u800c\u9019\u4e9b\u7db2\u8def\u5c01\u5305\u5fc5\u7136\u4f34\u96a8\u7db2\u8def\u8a2d\u5099 ",(0,i.kt)("inlineCode",{parentName:"p"},"Network Interface Card")," \u4e00\u540c\u51fa\u73fe\u3002\n\u9019\u4e9b\u8a2d\u5099\u53ef\u4ee5\u662f\u5be6\u9ad4\u7684\u7db2\u8def\u5361\uff0c\u4e5f\u53ef\u4ee5\u662f\u7cfb\u7d71\u4e0a\u865b\u64ec\u51fa\u4f86\u7684\uff0c\u8b6c\u5982",(0,i.kt)("inlineCode",{parentName:"p"},"loopback"),",",(0,i.kt)("inlineCode",{parentName:"p"},"docker0(bridge0)"),",",(0,i.kt)("inlineCode",{parentName:"p"},"tuntap"),",",(0,i.kt)("inlineCode",{parentName:"p"},"veth")," \u7b49\u5404\u5f0f\u5404\u6a23\u7684\u865b\u64ec\u7db2\u5361\u3002"),(0,i.kt)("p",null,"\u7576\u9019\u4e9b\u7db2\u5361\u8ddf ",(0,i.kt)("inlineCode",{parentName:"p"},"kernel")," \u900f\u904e\u67d0\u7a2e\u95dc\u4fc2\u9023\u7d50\u5f8c\uff0c\u5f9e\u9019\u4e9b\u7db2\u5361",(0,i.kt)("inlineCode",{parentName:"p"},"\u9032/\u51fa"),"\u7684\u5c01\u5305\u5c31\u6703\u53d7\u5230 ",(0,i.kt)("inlineCode",{parentName:"p"},"netfilter")," \u7684\u5f71\u97ff\uff0c\u9032\u800c\u53ef\u4ee5\u900f\u904e ",(0,i.kt)("inlineCode",{parentName:"p"},"iptables")," \u6240\u50b3\u9054\u7684\u898f\u5247\u9032\u884c\u63a7\u5236\u8207\u7d04\u675f"),(0,i.kt)("h3",{id:"workflow"},"Workflow"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"\u7db2\u5361\u8207\u7cfb\u7d71\u639b\u52fe\uff0c\u6b64\u6642 ",(0,i.kt)("inlineCode",{parentName:"li"},"kernel")," \u77e5\u9053\u6709\u54ea\u4e9b\u7db2\u5361",(0,i.kt)("strong",{parentName:"li"},"Physical/Virtaul")," \u6b63\u5728\u7cfb\u7d71\u4e0a"),(0,i.kt)("li",{parentName:"ol"},"\u4f7f\u7528\u8005\u900f\u904e ",(0,i.kt)("inlineCode",{parentName:"li"},"iptables/ebtables")," \u7b49\u5de5\u5177\u5c07\u76f8\u95dc\u7684\u898f\u5247\u5beb\u5165\u5230 ",(0,i.kt)("inlineCode",{parentName:"li"},"kernel")," \u88e1\u9762\uff0c\u6b64\u6642 ",(0,i.kt)("inlineCode",{parentName:"li"},"kernel netfilter subsystem")," \u5167\u5c31\u6703\u6709\u5c0d\u61c9\u7684\u898f\u5247\u3002"),(0,i.kt)("li",{parentName:"ol"},"\u7576\u6709\u4efb\u4f55\u5c01\u5305\u5f9e\u4efb\u4f55\u7db2\u5361\u5167",(0,i.kt)("inlineCode",{parentName:"li"},"\u9032/\u51fa"),"\u6642\uff0c\u9019\u4e9b\u5c01\u5305\u5c31\u6703\u88ab\u4e0a\u8ff0\u5df2\u7d93\u5275\u7acb\u7684\u898f\u5247\u9032\u884c\u6bd4\u5c0d\uff0c\u4e26\u4e14\u9032\u884c\u5c0d\u61c9\u7684\u52d5\u4f5c\u3002")),(0,i.kt)("h2",{id:"iptablesebtables"},"iptables/ebtables"),(0,i.kt)("p",null,"\u6709\u4e86\u4e0a\u8ff0\u7684\u57fa\u672c\u6d41\u7a0b\u5f8c\uff0c\u6211\u5011\u63a5\u4e0b\u4f86\u8981\u5c08\u6ce8\u518d",(0,i.kt)("inlineCode",{parentName:"p"},"user-space")," \u7684\u898f\u5247\u65b9\u9762\uff0c\u77ad\u89e3\u8a72\u600e\u9ebc\u89e3\u8b80\u6bcf\u500b\u898f\u5247\u3002"),(0,i.kt)("p",null,"\u5927\u90e8\u5206\u7684\u4eba\u6bd4\u8f03\u5c11\u807d\u5230 ",(0,i.kt)("inlineCode",{parentName:"p"},"ebtalbes"),", \u7136\u800c\u70ba\u4e86\u66f4\u52a0\u7406\u89e3\u5bb9\u5668\u672c\u8eab\u7684\u7db2\u8def\u904b\u4f5c\u539f\u7406\uff0c\u56e0\u6b64\u9019\u908a\u9084\u662f\u8981\u8ddf\u5927\u5bb6\u4ecb\u7d39\u4e00\u4e0b ",(0,i.kt)("inlineCode",{parentName:"p"},"ebtalbes")," \u9019\u500b\u5de5\u5177\u3002"),(0,i.kt)("h3",{id:"component"},"Component"),(0,i.kt)("p",null,"\u898f\u5247\u7d44\u6210\u65b9\u9762\uff0c\u57fa\u672c\u4e0a ",(0,i.kt)("inlineCode",{parentName:"p"},"iptables/ebtables")," \u7684\u6982\u5ff5\u662f\u4e00\u81f4\u7684\uff0c\u6240\u4ee5\u70ba\u4e86\u7bc0\u7701\u7a7a\u9593\uff0c\u6c7a\u5b9a\u4e00\u8d77\u4ecb\u7d39\u3002"),(0,i.kt)("p",null,"\u9019\u908a\u6211\u5011\u5148\u96a8\u4fbf\u62ff\u4e00\u500b\u5e38\u898b\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"iptables")," \u898f\u5247\u4f86\u7576\u505a\u7bc4\u4f8b"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash="},"iptables -t nat -A POSTROUTING ! -s 10.244.0.0/16 -d 10.244.0.0/16 -j MASQUERADE\n")),(0,i.kt)("p",null,"\u4e0a\u8ff0\u7684\u898f\u5247\u7528\u4e2d\u6587\u4f86\u8aaa\u5c31\u662f",(0,i.kt)("inlineCode",{parentName:"p"},"\u6211\u5e0c\u671b\u4f86\u6e90IP\u4e0d\u5c6c\u65bc 10.244.0.0/16, \u4e14\u76ee\u7684IP\u5c6c\u65bc 10.244.0.0/16\u7684\u5c01\u5305\uff0c\u90fd\u9032\u884c MASQUERADE(SNAT) \u9019\u500b\u52d5\u4f5c")),(0,i.kt)("p",null,"\u4f46\u662f\u5c0d\u65bc\u6574\u500b\u7cfb\u7d71\u4f86\u8aaa\uff0c\u8a72\u6307\u4ee4\u5176\u5be6\u53ef\u4ee5\u5206\u6210\u56db\u5927\u90e8\u5206"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Table: ",(0,i.kt)("strong",{parentName:"li"},"-t nat")),(0,i.kt)("li",{parentName:"ol"},"Chain: ",(0,i.kt)("strong",{parentName:"li"},"-A POSTROUTING")),(0,i.kt)("li",{parentName:"ol"},"Match: ",(0,i.kt)("strong",{parentName:"li"},"! -s 10.244.0.0/16 -d 10.244.0.0/16")),(0,i.kt)("li",{parentName:"ol"},"TARGET: ",(0,i.kt)("strong",{parentName:"li"},"-j MASQUERADE"))),(0,i.kt)("p",null,"\u63a5\u4e0b\u4f86\u6703\u91dd\u5c0d\u9019\u56db\u500b\u90e8\u5206\u9032\u884c\u8aaa\u660e\u8207\u4ecb\u7d39"),(0,i.kt)("h3",{id:"table"},"Table"),(0,i.kt)("p",null,"\u9996\u5148\uff0c\u6211\u5011\u5df2\u7d93\u77e5\u9053\u6574\u500b ",(0,i.kt)("inlineCode",{parentName:"p"},"iptables/ebtables/netfilter")," \u7684\u904b\u4f5c\u662f\u7531\u5404\u5f0f\u5404\u6a23\u7684\u898f\u5247\u6240\u7d44\u6210\u7684\u3002"),(0,i.kt)("p",null,"\u7136\u800c\u6bcf\u689d\u898f\u5247\u7684\u7528\u9014\u4e0d\u6703\u5b8c\u5168\u76f8\u540c\uff0c\u70ba\u4e86\u59a5\u5584\u7ba1\u7406\u8207\u4f7f\u7528\uff0c\u6703\u5e0c\u671b\u5c07\u76f8\u540c\u7528\u9014\u7684\u898f\u5247\u653e\u7f6e\u5728\u76f8\u540c\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"Table")," \u88e1\u9762\u3002"),(0,i.kt)("p",null,"\u8209\u4f8b\u4f86\u8aaa\uff0c\u6700\u5e38\u898b\u4e5f\u662f\u5927\u90e8\u5206\u6307\u4ee4\u7684\u9810\u8a2d\u503c, ",(0,i.kt)("inlineCode",{parentName:"p"},"filter"),"\n\u5176\u529f\u80fd\u5c31\u5982\u540c\u5176\u540d\u7a31\u4e00\u6a23\uff0c\u7528\u4f86\u9032\u884c ",(0,i.kt)("inlineCode",{parentName:"p"},"filter")," \u76f8\u95dc\u7684\u898f\u5247\uff0c\u8b6c\u5982\u5c07\u5c01\u5305\u4e1f\u68c4\uff0c\u8b93\u5c01\u5305\u901a\u904e\u7b49\u5e38\u898b\u884c\u70ba\u90fd\u653e\u7f6e\u5728\u9019\u500b ",(0,i.kt)("inlineCode",{parentName:"p"},"filter")," \u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"table")," \u4e2d\u3002"),(0,i.kt)("p",null,"\u91dd\u5c0d\u4e0a\u8ff0\u7684\u7bc4\u4f8b, ",(0,i.kt)("inlineCode",{parentName:"p"},"-t nat")," \u7684\u610f\u601d\u5c31\u662f\u9019\u689d\u898f\u5247\u8981\u653e\u7f6e\u5728 ",(0,i.kt)("inlineCode",{parentName:"p"},"nat")," \u9019\u500b",(0,i.kt)("inlineCode",{parentName:"p"},"Table"),"\u4e4b\u4e2d\u3002"),(0,i.kt)("h3",{id:"chain"},"Chain"),(0,i.kt)("p",null,"Chain \u7684\u6982\u5ff5\u6bd4\u8f03\u8907\u96dc\uff0c\u5206\u70ba\u6240\u8b02\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"Build-in Chain")," \u4ee5\u53ca\u4f7f\u7528\u8005\u81ea\u5df1\u5275\u7acb\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"Chain"),"."),(0,i.kt)("p",null,"\u4f7f\u7528\u8005\u5275\u7acb\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"Chain")," \u6bd4\u8f03\u504f\u5411\u7528\u4f86\u7ba1\u7406\uff0c\u800c\u4e14\u5fc5\u9808\u8981\u5f9e ",(0,i.kt)("inlineCode",{parentName:"p"},"Build-in  Chain")," \u9019\u908a\u9032\u53bb\uff0c\u6240\u4ee5\u9019\u908a\u9084\u662f\u6703\u6bd4\u8f03\u5c08\u6ce8\u65bc ",(0,i.kt)("inlineCode",{parentName:"p"},"Build-in Chain")," \u7684\u4ecb\u7d39\u3002"),(0,i.kt)("p",null,"Chain \u76f8\u5c0d\u65bc ",(0,i.kt)("inlineCode",{parentName:"p"},"Table")," \u4f86\u8aaa\uff0c\u6211\u89ba\u5f97\u53ef\u4ee5\u60f3\u6210\u662f\u4e00\u500b\u72c0\u614b\u9ede\uff0c\u8a72\u72c0\u614b\u662f\u7528\u4f86\u63cf\u8ff0\u8a72\u5c01\u5305\u7576\u524d\u7684\u968e\u6bb5\u3002"),(0,i.kt)("p",null,"\u7528\u6bd4\u8f03\u53e3\u8a9e\u8a71\u7684\u8aaa\u6cd5\u5c31\u662f\u9019\u689d",(0,i.kt)("inlineCode",{parentName:"p"},"iptables"),"\u898f\u5247\u6703\u518d\u4ec0\u9ebc\u6642\u9593\u9ede\u53bb\u5c01\u5305\u9032\u884c\u5339\u914d\u3002\u8209 ",(0,i.kt)("inlineCode",{parentName:"p"},"INPUT chain")," \u4f86\u8aaa\uff0c\u9019\u500b\u72c0\u614b\u5c31\u4ee3\u8868\u5c01\u5305\u6e96\u5099\u9032\u5165\u5230\u7cfb\u7d71\u5f8c\u4f46\u662f\u9084\u6c92\u6709\u88ab\u5c0d\u61c9\u7684\u61c9\u7528\u7a0b\u5f0f\u63a5\u6536\u3002"),(0,i.kt)("p",null,"\u4ee5\u5e95\u5c64\u7684\u5be6\u73fe\u4f86\u8aaa\uff0c ",(0,i.kt)("inlineCode",{parentName:"p"},"Table")," \u8207 ",(0,i.kt)("inlineCode",{parentName:"p"},"Chain ")," \u5f7c\u6b64\u662f\u4e92\u76f8\u9023\u7d50\u7d81\u5b9a\u7684\u3002\n\u53ea\u6709\u7279\u5b9a\u76f8\u95dc\u908f\u8f2f\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"Table")," \u53ef\u4ee5\u518d\u7279\u5b9a\u6642\u9593\u9ede\u4e0a ",(0,i.kt)("inlineCode",{parentName:"p"},"Chain")," \u53bb\u7d44\u5408\u6210\u4e00\u500b\u5e38\u898b\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"iptables \u898f\u5247")),(0,i.kt)("p",null,"\u8b6c\u5982 ",(0,i.kt)("inlineCode",{parentName:"p"},"filter Table")," \u5c31\u53ef\u4ee5\u904b\u884c\u518d ",(0,i.kt)("inlineCode",{parentName:"p"},"INPUT")," Chain \u4f46\u662f\u537b\u4e0d\u80fd\u904b\u884c\u518d ",(0,i.kt)("inlineCode",{parentName:"p"},"PREROUTING Chain"),"."),(0,i.kt)("p",null,"\u5be6\u969b\u4e0a\u6703\u6709\u54ea\u4e9b ",(0,i.kt)("inlineCode",{parentName:"p"},"Chain")," \u4ee5\u53ca\u54ea\u4e9b ",(0,i.kt)("inlineCode",{parentName:"p"},"Table")," \u6703\u56e0\u70ba ",(0,i.kt)("inlineCode",{parentName:"p"},"iptables/ebtables")," \u672c\u8eab\u7684\u67b6\u69cb\u800c\u6709\u6240\u4e0d\u540c\uff0c\u56e0\u6b64\u6703\u5728\u4e0b\u9762\u7684\u90e8\u4efd\u518d\u8a73\u7d30\u4ecb\u7d39\u3002"),(0,i.kt)("p",null,"\u91dd\u5c0d\u4e0a\u8ff0\u7684\u7bc4\u4f8b ",(0,i.kt)("inlineCode",{parentName:"p"},"-A POSTROUTING")," \u4f86\u770b\u4e00\u4e0b\uff0c\u4ed6\u7684\u610f\u601d\u5c31\u662f\u6211\u5e0c\u671b\u7576\u524d\u9019\u689d\u898f\u5247\u8981\u653e\u5230 ",(0,i.kt)("inlineCode",{parentName:"p"},"POSTROUTING")," \u9019\u689d ",(0,i.kt)("inlineCode",{parentName:"p"},"chain")," \u88e1\u9762\uff0c\u540c\u6642\u56e0\u70ba ",(0,i.kt)("inlineCode",{parentName:"p"},"Chain")," \u88e1\u9762\u7684\u898f\u5247\u672c\u8eab\u662f\u6709",(0,i.kt)("strong",{parentName:"p"},"\u6b21\u5e8f\u6027\u7684"),", \u6240\u4ee5\u518d\u5beb\u5165\u898f\u5247\u7684\u6642\u5019\n\u53ef\u4ee5\u4f7f\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"-I (insert) \u6216\u662f -A (append)")," \u7684\u6982\u5ff5\u4f86\u6c7a\u5b9a\u9019\u689d\u65b0\u898f\u5247\u7684\u4f4d\u7f6e\u3002"),(0,i.kt)("h3",{id:"match"},"Match"),(0,i.kt)("p",null,"Match \u7684\u6982\u5ff5\u5c31\u975e\u5e38\u7c21\u55ae\uff0c\u6bcf\u500b\u898f\u5247\u90fd\u53ef\u4ee5\u53bb\u63cf\u8ff0\u7b26\u5408\u8a72\u898f\u5247\u7684\u5c01\u5305\u683c\u5f0f\uff0c\u9019\u90e8\u4efd\u9664\u4e86\u9810\u8a2d\u7684\u5c01\u5305\u683c\u5f0f\u4e4b\u5916\uff0c\u4e5f\u6709\u4e0d\u5c11\u64f4\u5145\u6a21\u7d44\u53ef\u4ee5\u4f7f\u7528\u3002\n\u8b6c\u5982\u6700\u5e38\u898b\u7684\u5c31\u662f\n",(0,i.kt)("inlineCode",{parentName:"p"},"-m tcp --dport 53")," \u9019\u7a2e\u91dd\u5c0d ",(0,i.kt)("inlineCode",{parentName:"p"},"TCP")," \u5c01\u5305\u4e14\u76ee\u6a19\u9023\u63a5\u57e0\u662f",(0,i.kt)("inlineCode",{parentName:"p"},"53"),"\u7684\u898f\u5247"),(0,i.kt)("p",null,"\u56de\u5230\u4e0a\u8ff0\u7684\u7bc4\u4f8b,",(0,i.kt)("strong",{parentName:"p"},"! -s 10.244.0.0/16 -d 10.244.0.0/16")," \u9019\u500b\u898f\u5247\u5e0c\u671b\u53ef\u4ee5\u6bd4\u5c0d\u5c01\u5305\u7684\u4f86\u6e90/\u76ee\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"IP")," \u4f4d\u7f6e\uff0c\u540c\u6642\u85c9\u7531 ",(0,i.kt)("inlineCode",{parentName:"p"},"!")," \u9019\u500b\u7b26\u865f\u4f86\u53cd\u8f49\u6bd4\u5c0d\u7d50\u679c\u3002\n\u56e0\u6b64\u5c31\u662f\u6240\u6709\u4f86\u6e90\u4e0d\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"10.244.0.0/16")," \u4f46\u662f\u537b\u8981\u9001\u5f80 ",(0,i.kt)("inlineCode",{parentName:"p"},"10.244.0.0/16")," \u7684\u5c01\u5305\u3002"),(0,i.kt)("p",null,"\u6b64\u5916\uff0c\u5728 ",(0,i.kt)("inlineCode",{parentName:"p"},"Match")," \u65b9\u9762\uff0c\u4e00\u689d\u898f\u5247\u53ef\u4ee5\u540c\u6642\u4f7f\u7528\u591a\u500b\u64f4\u5145\u6a21\u7d44\u4f86\u66f4\u52a0\u5f37\u5316\u8981\u6bd4\u5c0d\u7684\u898f\u5247\u3002"),(0,i.kt)("h3",{id:"target"},"Target"),(0,i.kt)("p",null,"\u6700\u5f8c\u4e00\u500b\u90e8\u5206\uff0c\u5c31\u662f\u7576\u898f\u5247\u7b26\u5408\u4e4b\u5f8c\uff0c\u8981\u9032\u884c\u4ec0\u9ebc\u6a23\u7684\u52d5\u4f5c\u3002\n\u5e38\u898b\u7684\u6709 ",(0,i.kt)("inlineCode",{parentName:"p"},"Acceptr"),",",(0,i.kt)("inlineCode",{parentName:"p"},"Drop")," \u9019\u7a2e\u7d66 ",(0,i.kt)("inlineCode",{parentName:"p"},"filter Table")," \u4f7f\u7528\u7684\u52d5\u4f5c\u3002\n\u8907\u96dc\u7684\u751a\u81f3\u53ef\u4ee5\u662f\u4fee\u6539\u5c01\u5305\u683c\u5f0f\uff0c\u8b6c\u5982 ",(0,i.kt)("inlineCode",{parentName:"p"},"Source Network Address Translation(SNAT), Destination Network Address Translation(DNAT)")," \u9019\u7a2e\u3002"),(0,i.kt)("p",null,"\u56de\u5230\u4e0a\u8ff0\u7684\u7bc4\u4f8b, ",(0,i.kt)("strong",{parentName:"p"},"-j MASQUERADE"),"\uff0c\u9019\u908a\u6703\u900f\u904e ",(0,i.kt)("inlineCode",{parentName:"p"},"-j")," \u7684\u65b9\u5f0f\u63cf\u8ff0\u5f8c\u9762\u8981\u929c\u63a5\u7684\u53c3\u6578\u5c31\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"Target"),", \u800c ",(0,i.kt)("inlineCode",{parentName:"p"},"MASQUERADE")," \u5247\u662f\u4e00\u7a2e\u8b93",(0,i.kt)("inlineCode",{parentName:"p"},"kernel"),"\u5e6b\u4f60\u7dad\u8b77\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"SNAT")," \u52d5\u4f5c\u3002"),(0,i.kt)("h2",{id:"ebtables"},"ebtables"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"ebtalbes")," \u76f8\u5c0d\u65bc ",(0,i.kt)("inlineCode",{parentName:"p"},"iptables")," \u4f86\u8aaa\u4f7f\u7528\u7684\u60c5\u5883\u6bd4\u8f03\u5c11\uff0c\u4e3b\u8981\u662f\u5176\u91dd\u5c0d\u7684\u76ee\u6a19\u7bc4\u570d\u90fd\u8457\u91cd\u65bc ",(0,i.kt)("inlineCode",{parentName:"p"},"Layer2")," \u9019\u5c64\u6b21\uff0c\u4e5f\u5c31\u662f Ethernet Frame \u9019\u908a\u3002"),(0,i.kt)("p",null,"\u5c0d\u65bc\u5927\u90e8\u5206\u7684\u4f7f\u7528\u8005\u4ee5\u53ca\u7ba1\u7406\u8005\u4f86\u8aaa\uff0c\u901a\u5e38\u90fd\u662f\u4ee5 ",(0,i.kt)("inlineCode",{parentName:"p"},"IP")," \u70ba\u57fa\u672c\u55ae\u4f4d\u4f86\u9032\u884c\u7ba1\u7406\u7684\uff0c\u7136\u800c\u90e8\u5206\u7684\u7db2\u8def\u5143\u4ef6\u8a2d\u8a08\u8005\uff0c\u8b6c\u5982 ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/Mirantis/virtlet/blob/master/docs/networking.md"},"\nVirtlet, a Kubernetes runtime server")," \u518d\u5176\u67b6\u69cb\u4e2d\u5c31\u6709\u4f7f\u7528\u5230 ",(0,i.kt)("inlineCode",{parentName:"p"},"ebtables")," \u4f86\u5e6b\u5fd9\u5b8c\u6210\u7279\u5b9a\u7684\u529f\u80fd\u3002"),(0,i.kt)("p",null,"\u6b64\u5916\uff0c\u70ba\u4e86\u4e0b\u4e00\u7bc7\u6587\u7ae0\u80fd\u5920\u66f4\u7406\u89e3\u6574\u500b ",(0,i.kt)("inlineCode",{parentName:"p"},"docker bridge network")," \u7684\u50b3\u8f38\u904e\u7a0b\uff0c\u5c0d\u65bc ",(0,i.kt)("inlineCode",{parentName:"p"},"ebtables")," \u9084\u662f\u8981\u6709\u9ede\u57fa\u672c\u6982\u5ff5\uff0c\u9019\u6a23\u624d\u53ef\u4ee5\u5c0d\u6574\u9ad4\u67b6\u69cb\u6709\u500b\u5b8c\u6574\u7684\u8a8d\u8b58"),(0,i.kt)("h3",{id:"table-1"},"Table"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Table")," \u65b9\u9762\uff0c\u76ee\u524d\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"ebtalbe")," \u7e3d\u5171\u6709\u4e09\u5f35 ",(0,i.kt)("inlineCode",{parentName:"p"},"tables"),", \u5206\u5225\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"filter"),",",(0,i.kt)("inlineCode",{parentName:"p"},"nat")," \u4ee5\u53ca ",(0,i.kt)("inlineCode",{parentName:"p"},"broute"),"."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"filter")," \u5247\u662f\u5c08\u6ce8\u65bc ",(0,i.kt)("inlineCode",{parentName:"li"},"Accept/Drop")," \u76f8\u95dc\u904e\u6ffe\u7684\u884c\u70ba"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"nat"),"  \u9019\u908a\u5247\u5c08\u6ce8\u65bc\u91dd\u5c0d ",(0,i.kt)("inlineCode",{parentName:"li"},"MacAddress")," \u76f8\u95dc\u7684\u8f49\u63db"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"broute")," \u9019\u908a\u53ef\u4ee5\u7528\u4f86\u6c7a\u5b9a\u5c01\u5305\u5230\u5e95\u8981\u9032\u884c ",(0,i.kt)("inlineCode",{parentName:"li"},"Layer2 Bridging")," \u6216\u662f ",(0,i.kt)("inlineCode",{parentName:"li"},"Layer3 Routing"),"\u3002\u7b97\u662f\u4e00\u500b\u6bd4\u8f03\u7279\u5225\u7684\u898f\u5247\u3002")),(0,i.kt)("h3",{id:"chain-1"},"Chain"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Chain")," \u7684\u8a71\uff0c\u518d ",(0,i.kt)("inlineCode",{parentName:"p"},"ebtables")," \u4e2d\u7e3d\u5171\u6709\u516d\u689d ",(0,i.kt)("inlineCode",{parentName:"p"},"chain"),"."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"brouting"),": \u9019\u500b ",(0,i.kt)("inlineCode",{parentName:"li"},"chain")," \u7684\u57f7\u884c\u9806\u5e8f\u975e\u5e38\u7684\u65e9\uff0c\u57fa\u672c\u4e0a\u662f",(0,i.kt)("inlineCode",{parentName:"li"},"ebtalbes")," \u88e1\u9762\u6700\u65e9\u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"chain"),". \u53ea\u8981\u7576\u4efb\u4f55 ",(0,i.kt)("inlineCode",{parentName:"li"},"linux bridge")," \u4e0a\u9762\u7684\u4efb\u4f55\u4e00\u500b ",(0,i.kt)("inlineCode",{parentName:"li"},"port")," \u6709\u6536\u5230\u4efb\u4f55 ",(0,i.kt)("inlineCode",{parentName:"li"},"Frame")," \u9032\u4f86\u5f8c\uff0c\u5c31\u6703\u5230\u9019\u500b",(0,i.kt)("inlineCode",{parentName:"li"},"Chain"),"\u88e1\u9762\u53bb\u9032\u884c\u6bd4\u5c0d. \u9019\u908a\u901a\u5e38\u4e0d\u592a\u6703\u53bb\u8a2d\u5b9a\uff0c\u800c\u662f\u90fd\u6703\u4f9d\u8cf4\u5f8c\u7e8c\u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"Bridging Decision"),"\u900f\u904e",(0,i.kt)("inlineCode",{parentName:"li"},"Mac Address")," \u53bb\u6c7a\u5b9a\u5c01\u5305\u5230\u5e95\u8a72\u600e\u9ebc\u8d70\u3002")),(0,i.kt)("p",null,"\u56e0\u70ba ",(0,i.kt)("inlineCode",{parentName:"p"},"Linux Bridge")," \u672c\u8eab\u6703\u6709 ",(0,i.kt)("inlineCode",{parentName:"p"},"STP(Spanning Tree Protocol)")," \u7684\u904b\u4f5c\uff0c\u56e0\u6b64\u53ea\u6709\u6b78\u985e\u65bc\u53ef\u8f49\u767c\u7684\u9023\u63a5\u57e0\u624d\u9700\u8981\u53bb\u9032\u884c\u9019\u4e9b\u5c01\u5305\u6bd4\u5c0d\u3002"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"input"),": \u5982\u679c\u4eca\u5929\u5c01\u5305\u7684\u76ee\u6a19 ",(0,i.kt)("inlineCode",{parentName:"p"},"Mac Address")," \u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"Linux Bridge")," \u672c\u8eab\u7684\u8a71\uff0c\u90a3\u5c01\u5305\u5c31\u6703\u9032\u5165\u5230 ",(0,i.kt)("inlineCode",{parentName:"p"},"input chain")," \u4f86\u8655\u7406\u3002\u6700\u5e38\u898b\u7684\u7bc4\u4f8b\u5c31\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"docker")," \u5bb9\u5668\u60f3\u8981\u5c0d\u4e0d\u540c\u7db2\u6bb5\u9032\u884c\u5b58\u53d6\uff0c\u6703\u5148\u9032\u5165\u5230 ",(0,i.kt)("inlineCode",{parentName:"p"},"gateway")," \u4e5f\u5c31\u662f\u6240\u8b02\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"linux bridge")," \u672c\u8eab\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"output"),":  \u91dd\u5c0d\u8981\u5f9e ",(0,i.kt)("inlineCode",{parentName:"p"},"Linux Bridge")," \u96e2\u958b\u7684\u5c01\u5305\u90fd\u6703\u9032\u884c\u8655\u7406\u7684",(0,i.kt)("inlineCode",{parentName:"p"},"Chain"),"\uff0c\u9019\u985e\u578b\u7684\u5c01\u5305\u5927\u81f4\u4e0a\u6709\u5169\u7a2e\u53ef\u80fd\u3002\u7b2c\u4e00\u7a2e\u662f\u4e3b\u6a5f\u672c\u8eab\u7522\u751f\u7684\u5c01\u5305\uff0c\u76ee\u7684\u5c31\u662f\u8981\u5f9e\u8a72",(0,i.kt)("inlineCode",{parentName:"p"},"linux bridge"),"\u5e95\u4e0b\u7684\u67d0\u4e9b ",(0,i.kt)("inlineCode",{parentName:"p"},"Port")," \u8f49\u767c\u51fa\u53bb\uff0c\u6216\u662f\u8a72\u5c01\u5305\u662f\u5f9e ",(0,i.kt)("inlineCode",{parentName:"p"},"linux bridge")," \u7684\u67d0\u4e9b ",(0,i.kt)("inlineCode",{parentName:"p"},"Port")," \u8f49\u767c\u5230\u5176\u4ed6\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"Port"),".")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"forward"),": \u91dd\u5c0d\u6703\u88ab",(0,i.kt)("inlineCode",{parentName:"p"},"Linux Bridge"),"\u9032\u884c",(0,i.kt)("inlineCode",{parentName:"p"},"Layer2 Bridging")," \u8f49\u767c\u7684\u5c01\u5305\u6240\u9032\u884c\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"Chain"),". \u57fa\u672c\u4e0a\u540c\u7db2\u6bb5\u7684\u5bb9\u5668\u9593\u50b3\u8f38\u7684\u5c01\u5305\u90fd\u6703\u5230\u9019\u500b\u968e\u6bb5\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"prerouting"),": \u9019\u500b ",(0,i.kt)("inlineCode",{parentName:"p"},"Chian")," \u5c31\u662f\u5176\u540d\u7a31\u7684\u89e3\u8b80\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"Pre-Routing"),", \u518d\u5c01\u5305\u9032\u5165\u5230 ",(0,i.kt)("inlineCode",{parentName:"p"},"Linux Bridge")," \u5f8c\uff0c\u4f46\u662f\u9084\u6c92\u6709\u78b0\u5230 ",(0,i.kt)("inlineCode",{parentName:"p"},"Bridging Decision")," \u524d\u53ef\u4ee5\u9032\u884c\u7684\u968e\u6bb5\u3002")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"postrouting"),": \u9019\u500b ",(0,i.kt)("inlineCode",{parentName:"p"},"Chian")," \u5c31\u662f\u5176\u540d\u7a31\u7684\u89e3\u8b80\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"Post-Routing"),", \u518d\u5c01\u5305\u6e96\u5099\u96e2\u958b ",(0,i.kt)("inlineCode",{parentName:"p"},"Linux Bridge")," \u524d\uff0c\u4f46\u662f\u9084\u6c92\u6709\u78b0\u5230 \u771f\u6b63\u7684\u900f\u904e\u7db2\u5361\u9001\u51fa\u53bb\u524d\u53ef\u4ee5\u9032\u884c\u7684\u968e\u6bb5\u3002"))),(0,i.kt)("p",null,"\u5176\u5be6\u5c0d\u65bc ",(0,i.kt)("inlineCode",{parentName:"p"},"ebtables")," \u4f86\u8aaa\uff0c\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"pre-forwarding")," \u4ee5\u53ca ",(0,i.kt)("inlineCode",{parentName:"p"},"post-forwarding")," \u6703\u66f4\u8cbc\u5207\uff0c\u7562\u7adf ",(0,i.kt)("inlineCode",{parentName:"p"},"routing")," \u662f\u66f4\u504f\u5411 ",(0,i.kt)("inlineCode",{parentName:"p"},"Layer3")," \u8def\u7531\u65b9\u9762\u7684\u898f\u5247\u3002"),(0,i.kt)("p",null,"\u9019\u908a\u56e0\u70ba ",(0,i.kt)("inlineCode",{parentName:"p"},"iptables")," \u9577\u671f\u7684\u7fd2\u6163\u6240\u4ee5\u5728\u547d\u540d\u65b9\u9762\u4e5f\u5c31\u9077\u5c31\u65bc\u6b64"),(0,i.kt)("h3",{id:"match-1"},"Match"),(0,i.kt)("p",null,"\u5728\u6bd4\u5c0d\u7684\u898f\u5247\u4f86\u8aaa\uff0c ",(0,i.kt)("inlineCode",{parentName:"p"},"ebtalbes")," \u5c08\u81f3\u65bc ",(0,i.kt)("inlineCode",{parentName:"p"},"Layer2")," \u76f8\u95dc\u7684\u8655\u7406\uff0c\u8b6c\u5982 ",(0,i.kt)("inlineCode",{parentName:"p"},"unitcast/multicast/broadcast"),"\uff0c\u751a\u81f3\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"vlan/stp")," \u7b49\n\u5c01\u5305\u90fd\u53ef\u4ee5\u8655\u7406\u3002"),(0,i.kt)("p",null,"\u6b64\u5916\uff0c\u9664\u4e86\u5e38\u898b\u7684\u5c01\u5305\u5167\u5bb9\u5916\uff0c\u4e5f\u53ef\u4ee5\u900f\u904e",(0,i.kt)("inlineCode",{parentName:"p"},"-m"),"\u9019\u500b\u65b9\u5f0f\u53bb\u4f7f\u7528\u64f4\u5145\u6a21\u7d44\u4f86\u9054\u5230\u66f4\u9748\u6d3b\u7684\u6bd4\u5c0d\u529f\u80fd\u3002"),(0,i.kt)("h3",{id:"target-1"},"Target"),(0,i.kt)("p",null,"\u5c31\u5982\u540c\u524d\u9762\u6240\u63cf\u8ff0\u7684\uff0c\u9810\u8a2d\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"Target")," \u5176\u5be6\u90fd\u6703\u8ddf\u5c0d\u61c9\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"Table")," \u6709\u95dc\uff0c\u8b6c\u5982 ",(0,i.kt)("inlineCode",{parentName:"p"},"ACCEPT/DROP")," \u5c31\u6703\u5728 ",(0,i.kt)("inlineCode",{parentName:"p"},"filter/brouting")," \u9019\u4e9b",(0,i.kt)("inlineCode",{parentName:"p"},"Table"),"."),(0,i.kt)("p",null,"\u96d6\u7136\u90fd\u53eb\u505a ",(0,i.kt)("inlineCode",{parentName:"p"},"ACCEPT/DROP"),", \u5176\u5169\u8005\u7684\u610f\u601d\u5728 ",(0,i.kt)("inlineCode",{parentName:"p"},"filter/brouting")," \u7684\u7528\u9014\u537b\u662f\u4e0d\u4e00\u6a23\u7684\uff0c\u6709\u8208\u8da3\u7684\u4eba\u53ef\u4ee5\u76f4\u63a5\u53c3\u8003 ",(0,i.kt)("inlineCode",{parentName:"p"},"man page")," \u4f86\u5b78\u7fd2\u66f4\u591a\u7684\u7528\u6cd5\u8207\u6982\u5ff5\u3002"),(0,i.kt)("p",null,"\u9664\u6b64\u4e4b\u5916\uff0c\u4e5f\u6709\u8a31\u591a\u7684\u64f4\u5145\u6a21\u7d44\u63d0\u4f9b\u66f4\u591a\u5f37\u5927\u7684\u529f\u80fd\uff0c\u8b6c\u5982\u53ef\u4ee5\u900f\u904e ",(0,i.kt)("inlineCode",{parentName:"p"},"arp")," \u7b49\u76f8\u95dc\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"Target"),", \u91dd\u5c0d ",(0,i.kt)("inlineCode",{parentName:"p"},"ARP")," \u76f8\u95dc\u7684\u5c01\u5305\u76f4\u63a5\u8b93\u7cfb\u7d71\u5e6b\u4f60\u56de\u61c9\u5c0d\u61c9\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"ARP Reply"),"\u3002"),(0,i.kt)("h3",{id:"summary"},"Summary"),(0,i.kt)("p",null,"\u770b\u5230\u9019\u908a\uff0c\u6211\u5011\u7528\u4e00\u5f35\u5716\u7247\uff0c\u5c07\u4e0a\u8ff0\u7684\u6982\u5ff5\u91cd\u65b0\u6574\u5408\u4e00\u6b21\uff0c\u5c07 ",(0,i.kt)("inlineCode",{parentName:"p"},"Table/Chain")," \u8207 ",(0,i.kt)("inlineCode",{parentName:"p"},"ebtables")," \u9032\u884c\u6574\u5408\u3002"),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"https://i.imgur.com/q1SSG2l.png",alt:"Imgur"})),(0,i.kt)("p",null,"\u9996\u5148\uff0c\u95dc\u65bc\u8a72\u5716\u7247\u4e2d\u6211\u5927\u81f4\u4e0a\u5206\u6210\u4e09\u500b\u5c64\u6b21\uff0c\u5206\u5225"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"user-space")," \u7684\u4efb\u4f55\u7db2\u8def\u61c9\u7528\u7a0b\u5f0f"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"kernel-space")," \u88e1\u9762\u504f\u5411 ",(0,i.kt)("inlineCode",{parentName:"li"},"Layer3")," \u76f8\u95dc\u7684\u8655\u7406\uff0c\u9019\u90e8\u4efd\u5176\u5be6\u662f",(0,i.kt)("inlineCode",{parentName:"li"},"iptables"),"\u7684\u4e3b\u6230\u5834\uff0c\u4f46\u662f\u56e0\u70ba\u6574\u9ad4\u67b6\u69cb\u7684\u539f\u56e0\uff0c\u9019\u908a\u53ea\u6703\u7a0d\u5fae\u5e36\u904e"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"kernel-space")," \u88e1\u9762\u504f\u5411 ",(0,i.kt)("inlineCode",{parentName:"li"},"Layer2")," \u76f8\u95dc\u7684\u8655\u7406\uff0c\u9019\u908a\u5c31\u662f\u504f\u5411 ",(0,i.kt)("inlineCode",{parentName:"li"},"ebtalbes")," \u7684\u8655\u7406")),(0,i.kt)("p",null,"\u9996\u5148\u7576\u5c01\u5305\u5f9e\u8ddf",(0,i.kt)("inlineCode",{parentName:"p"},"Linux Bridge"),"\u6709\u95dc\u7684\u7db2\u5361\uff0c\u5de6\u908a\u7684",(0,i.kt)("inlineCode",{parentName:"p"},"nic")," \u8fd1\u4f86\u4e4b\u5f8c\uff0c\u9996\u5148\u6703\u5148\u9032\u5165\u5230 ",(0,i.kt)("inlineCode",{parentName:"p"},"brouting")," \u9019\u500b ",(0,i.kt)("inlineCode",{parentName:"p"},"chain"),"\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"brouting")," \u9019\u500b ",(0,i.kt)("inlineCode",{parentName:"p"},"chain")," \u88e1\u9762\u53ea\u652f\u63f4 ",(0,i.kt)("inlineCode",{parentName:"p"},"brouintg Table"),", \u82e5\u6709\u4efb\u4f55\u898f\u5247\u8981\u5c07\u8a72\u5c01\u5305\u76f4\u63a5\u900f\u904e",(0,i.kt)("inlineCode",{parentName:"p"},"routing"),"\u8655\u7406\u7684\u8a71\uff0c\u5c01\u5305\u5c31\u6703\u76f4\u63a5\u62c9\u5230 ",(0,i.kt)("inlineCode",{parentName:"p"},"kernel-space/layer3")," \u5c64\u7d1a\u4f86\u8655\u7406\uff0c \u9019\u500b\u7bc4\u4f8b\u4e2d\u5148\u7528\u4e00\u500b ",(0,i.kt)("inlineCode",{parentName:"p"},"Magic")," \u7684\u6982\u5ff5\u4f86\u4ee3\u8868\u4efb\u4f55\u8ddf ",(0,i.kt)("inlineCode",{parentName:"p"},"Layer3")," \u6709\u95dc\u7684\u64cd\u4f5c\u3002"),(0,i.kt)("p",null,"\u63a5\u8005\u5c01\u5305\u6703\u8dd1\u5230 ",(0,i.kt)("inlineCode",{parentName:"p"},"Prerouting")," \u9019\u908a\uff0c\u8a72",(0,i.kt)("inlineCode",{parentName:"p"},"chain"),"\u88e1\u9762\u53ea\u6709",(0,i.kt)("inlineCode",{parentName:"p"},"nat"),"\u53ef\u4ee5\u57f7\u884c\uff0c\u9019\u610f\u5473\u5230\u9019\u500b\u968e\u6bb5\u9802\u591a\u53ea\u80fd\u5c0d\u5c01\u5305\u9032\u884c\u5167\u5bb9\u7684\u4fee\u6539\uff0c\u9084\u6c92\u6709\u8fa6\u6cd5\u4e1f\u68c4\u3002\n\u9019\u908a\u8981\u6ce8\u610f\uff0c\u9019\u6642\u5019\u9084\u6c92\u6c7a\u5b9a\u5230\u5e95\u5c01\u5305\u8a72\u600e\u9ebc\u8f49\u9001\uff0c\u6240\u4ee5\u53ef\u4ee5\u900f\u904e\u4fee\u6539\u5c01\u5305\u7684\u76ee\u6a19 ",(0,i.kt)("inlineCode",{parentName:"p"},"Mac Address")," \u4f86\u5f71\u97ff\u5230\u5e95\u4e4b\u5f8c\u8a72\u600e\u9ebc\u8f49\u9001\u5c01\u5305\uff0c\u56e0\u6b64\u9019\u4e5f\u662f\u9019\u908a ",(0,i.kt)("inlineCode",{parentName:"p"},"Chian")," \u70ba\u4ec0\u9ebc\u53eb\u505a ",(0,i.kt)("inlineCode",{parentName:"p"},"PreRouting"),"."),(0,i.kt)("p",null,"\u63a5\u4e0b\u4f86\u5c31\u6703\u5230\u6240\u8b02\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"Bridging Decision"),". \u9019\u908a\u5176\u5be6\u5c31\u6703\u904b\u884c ",(0,i.kt)("inlineCode",{parentName:"p"},"Learning Bridging")," \u76f8\u95dc\u7684\u7b97\u6cd5\uff0c\u6839\u64da ",(0,i.kt)("inlineCode",{parentName:"p"},"Mac Address")," \u4f86\u6c7a\u5b9a\u8f49\u767c\u7684\u65b9\u5411\uff0c\u82e5\u76ee\u6a19\u5c0d\u8c61\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"Linux Bridge")," \u672c\u8eab\uff0c\u5247\u6703\u900f\u904e ",(0,i.kt)("inlineCode",{parentName:"p"},"input chain")," \u4e00\u8def\u5f80\u4e0a\u9001\u5230 ",(0,i.kt)("inlineCode",{parentName:"p"},"Layer3")," \u53bb\u8655\u7406\u3002\n\u5c0d\u65bc ",(0,i.kt)("inlineCode",{parentName:"p"},"input")," \u4f86\u8aaa\uff0c\u53ef\u4ee5\u900f\u904e ",(0,i.kt)("inlineCode",{parentName:"p"},"filter")," \u4f86\u9032\u884c\u5c01\u5305\u7684\u8655\u7406\uff0c\u6c7a\u5b9a\u54ea\u4e9b\u5c01\u5305\u8981\u904e\uff0c\u54ea\u4e9b\u4e0d\u8981\u904e\u3002"),(0,i.kt)("p",null,"\u5982\u679c\u53ea\u662f\u8a72 ",(0,i.kt)("inlineCode",{parentName:"p"},"Linux Bridge")," \u4e0b\u4e0d\u540c\u9023\u63a5\u57e0\u7684\u8f49\u767c\u7684\u8a71\uff0c\u5c31\u6703\u8d70 ",(0,i.kt)("inlineCode",{parentName:"p"},"Forward")," \u9019\u908a\uff0c\u6700\u5f8c\u900f\u904e ",(0,i.kt)("inlineCode",{parentName:"p"},"Postrouting")," \u9019\u908a\u9032\u884c\u5f8c\u7e8c\u7684\u4fee\u6539\uff0c\u6700\u5f8c\u5c31\u5f9e\u76ee\u6a19\u7684\u7db2\u5361\u5c07\u8a72\u5c01\u5305\u9001\u51fa\u53bb\u3002"),(0,i.kt)("p",null,"\u5982\u679c\u4eca\u5929\u662f\u4e3b\u6a5f\u4e0a\u9762\u7684\u61c9\u7528\u7a0b\u5f0f\u8981\u9001\u5c01\u5305\u51fa\u53bb\uff0c\u4e14\u8a72\u5c01\u5305\u76ee\u7684\u5730\u6700\u5f8c\u6703\u900f\u904e ",(0,i.kt)("inlineCode",{parentName:"p"},"Linux Bridge")," \u4f86\u8f49\u767c\n\u5247\u8a72\u5c01\u5305\u6700\u5f8c\u7d93\u904e ",(0,i.kt)("inlineCode",{parentName:"p"},"Layer3")," \u795e\u7955\u7684\u8655\u7406\u5f8c\uff0c\u6700\u5f8c\u6703\u8dd1\u56de\u5230 ",(0,i.kt)("inlineCode",{parentName:"p"},"Layer2")," \u9019\u908a\uff0c\u4e26\u4e14\u7d93\u904e ",(0,i.kt)("inlineCode",{parentName:"p"},"output chain")," \u4ee5\u53ca ",(0,i.kt)("inlineCode",{parentName:"p"},"postrouting")," \u4f9d\u5e8f\u7684\u8655\u7406\uff0c\u6700\u5f8c\u4e5f\u8d70\u5230\u7db2\u5361\u51fa\u53bb\u3002"),(0,i.kt)("p",null,"\u672c\u6587\u5230\u9019\u908a\u6211\u5011\u5148\u5efa\u7acb\u4e00\u500b\u57fa\u672c\u7684\u6982\u5ff5\uff0c\u5230\u5e95 ",(0,i.kt)("inlineCode",{parentName:"p"},"iptables/ebtables")," \u7684\u7d44\u6210\u5143\u4ef6\u4ee5\u53ca\u5c0d\u61c9\u7684\u6982\u5ff5\u3002\n\u540c\u6642\u4e5f\u7a0d\u5fae\u89c0\u770b\u4e86\u4e00\u4e0b ",(0,i.kt)("inlineCode",{parentName:"p"},"ebtables")," \u672c\u8eab\u7684\u5c01\u5305\u50b3\u8f38\u6d41\u7a0b\u3002\n\u7136\u800c\u53ea\u6709\u55ae\u55ae\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"ebtables")," \u662f\u6c92\u6709\u8fa6\u6cd5\u7406\u89e3\u4ee5\u53ca\u89e3\u91cb\u6574\u500b ",(0,i.kt)("inlineCode",{parentName:"p"},"docker bridge network")," \u7684\u904b\u4f5c\u53ca\u50b3\u8f38\u3002\n\u56e0\u6b64\u6211\u5011\u6703\u5728\u4e0b\u7bc7\u6587\u7ae0\u4ee5\u76f8\u540c\u7684\u89c0\u9ede\u4f86\u5206\u6790 ",(0,i.kt)("inlineCode",{parentName:"p"},"iptables"),", \u4e26\u4e14\u5c07 ",(0,i.kt)("inlineCode",{parentName:"p"},"iptables")," \u4ee5\u53ca ",(0,i.kt)("inlineCode",{parentName:"p"},"ebtables")," \u7d66\u6574\u5408\u8d77\u4f86\u5206\u6790\u6574\u9ad4\u7684\u904b\u4f5c\u6d41\u7a0b\u3002\n\u5230\u6642\u5019\u5728\u5206\u6790 ",(0,i.kt)("inlineCode",{parentName:"p"},"docker bridge network")," \u7684\u6642\u5019\uff0c\u80fd\u5920\u6709\u66f4\u8a73\u7d30\u7684\u6982\u5ff5\u8207\u80cc\u666f\u53bb\u77ad\u89e3\u6574\u9ad4\u5c01\u5305\u7684\u50b3\u8f38\u904e\u7a0b"),(0,i.kt)("h2",{id:"reference"},"Reference"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://linux.die.net/man/8/ebtables"},"ebtables man page")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"http://ebtables.netfilter.org/br_fw_ia/br_fw_ia.html"},"ebtables/iptables interaction on a Linux-based bridge"))))}N.isMDXComponent=!0}}]);
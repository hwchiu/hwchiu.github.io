"use strict";(self.webpackChunkhwchiu=self.webpackChunkhwchiu||[]).push([[74838],{3905:(e,n,t)=>{t.d(n,{Zo:()=>k,kt:()=>c});var i=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,i,a=function(e,n){if(null==e)return{};var t,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var o=i.createContext({}),m=function(e){var n=i.useContext(o),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},k=function(e){var n=m(e.components);return i.createElement(o.Provider,{value:n},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},s=i.forwardRef((function(e,n){var t=e.components,a=e.mdxType,r=e.originalType,o=e.parentName,k=p(e,["components","mdxType","originalType","parentName"]),d=m(t),s=a,c=d["".concat(o,".").concat(s)]||d[s]||u[s]||r;return t?i.createElement(c,l(l({ref:n},k),{},{components:t})):i.createElement(c,l({ref:n},k))}));function c(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=t.length,l=new Array(r);l[0]=s;var p={};for(var o in n)hasOwnProperty.call(n,o)&&(p[o]=n[o]);p.originalType=e,p[d]="string"==typeof e?e:a,l[1]=p;for(var m=2;m<r;m++)l[m]=t[m];return i.createElement.apply(null,l)}return i.createElement.apply(null,t)}s.displayName="MDXCreateElement"},55235:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>p,toc:()=>m});var i=t(87462),a=(t(67294),t(3905));const r={title:"Container Runtime - Virtual Machine",sidebar_position:8,date:new Date("2019-09-24T07:01:37.000Z"),tags:["Kubernetes","CRI","VM","iThome"],description:"\u672c\u6587\u4f5c\u70ba CRI \u7cfb\u5217\u6587\u7ae0\u7684\u6700\u5f8c\u4e00\u7bc7\u6587\u7ae0\uff0c\u8981\u4f86\u8ddf\u5927\u5bb6\u5206\u4eab\u4e00\u500b\u6bd4\u8f03\u5c11\u898b\u7684\u7528\u6cd5\uff0c\u900f\u904e kubernetes \u7ba1\u7406 Pod \u7684\u65b9\u5f0f\u4f86\u7ba1\u7406 Virtual Machine\uff0c\u5e95\u5c64\u6240\u6709\u904b\u884c\u7684\u670d\u52d9\u90fd\u662f\u57fa\u65bc Virtual Machine \u53bb\u8dd1\uff0c\u4f46\u662f\u5c0d\u65bc Kubernetes \u4f86\u8aaa\u5b8c\u5168\u4e0d\u77e5\u60c5\uff0c\u4f9d\u7136\u8a8d\u70ba\u662f\u4e00\u500b Pod \u7684\u5f62\u5f0f\u3002 \u9019\u90e8\u5206\u4f9d\u8cf4\u91cd\u65b0\u64b0\u5beb\u4e00\u500b\u7b26\u5408 CRI \u6a19\u6e96\u61c9\u7528\u7a0b\u5f0f\u4f86\u5c0d\u63a5 kubelet, \u4e26\u4e14\u5e95\u4e0b\u6240\u6709\u7684\u904b\u4f5c\u90fd\u4f7f\u7528 virtual machine  \u4f86\u64cd\u4f5c\uff0c\u56e0\u6b64\u9019\u500b\u7bc4\u4f8b\u5c31\u5b8c\u5168\u4e0d\u6703\u6709 OCI \u7684\u5b58\u5728\uff0c\u56e0\u70ba\u662f\u771f\u6b63\u7684 virtual machine, \u800c\u975e container."},l="\u524d\u8a00",p={unversionedId:"techPost/2019/iThome_Challenge/container-runtime-vm",id:"techPost/2019/iThome_Challenge/container-runtime-vm",title:"Container Runtime - Virtual Machine",description:"\u672c\u6587\u4f5c\u70ba CRI \u7cfb\u5217\u6587\u7ae0\u7684\u6700\u5f8c\u4e00\u7bc7\u6587\u7ae0\uff0c\u8981\u4f86\u8ddf\u5927\u5bb6\u5206\u4eab\u4e00\u500b\u6bd4\u8f03\u5c11\u898b\u7684\u7528\u6cd5\uff0c\u900f\u904e kubernetes \u7ba1\u7406 Pod \u7684\u65b9\u5f0f\u4f86\u7ba1\u7406 Virtual Machine\uff0c\u5e95\u5c64\u6240\u6709\u904b\u884c\u7684\u670d\u52d9\u90fd\u662f\u57fa\u65bc Virtual Machine \u53bb\u8dd1\uff0c\u4f46\u662f\u5c0d\u65bc Kubernetes \u4f86\u8aaa\u5b8c\u5168\u4e0d\u77e5\u60c5\uff0c\u4f9d\u7136\u8a8d\u70ba\u662f\u4e00\u500b Pod \u7684\u5f62\u5f0f\u3002 \u9019\u90e8\u5206\u4f9d\u8cf4\u91cd\u65b0\u64b0\u5beb\u4e00\u500b\u7b26\u5408 CRI \u6a19\u6e96\u61c9\u7528\u7a0b\u5f0f\u4f86\u5c0d\u63a5 kubelet, \u4e26\u4e14\u5e95\u4e0b\u6240\u6709\u7684\u904b\u4f5c\u90fd\u4f7f\u7528 virtual machine  \u4f86\u64cd\u4f5c\uff0c\u56e0\u6b64\u9019\u500b\u7bc4\u4f8b\u5c31\u5b8c\u5168\u4e0d\u6703\u6709 OCI \u7684\u5b58\u5728\uff0c\u56e0\u70ba\u662f\u771f\u6b63\u7684 virtual machine, \u800c\u975e container.",source:"@site/docs/techPost/2019/iThome_Challenge/container-runtime-vm.md",sourceDirName:"techPost/2019/iThome_Challenge",slug:"/techPost/2019/iThome_Challenge/container-runtime-vm",permalink:"/docs/techPost/2019/iThome_Challenge/container-runtime-vm",draft:!1,tags:[{label:"Kubernetes",permalink:"/docs/tags/kubernetes"},{label:"CRI",permalink:"/docs/tags/cri"},{label:"VM",permalink:"/docs/tags/vm"},{label:"iThome",permalink:"/docs/tags/i-thome"}],version:"current",sidebarPosition:8,frontMatter:{title:"Container Runtime - Virtual Machine",sidebar_position:8,date:"2019-09-24T07:01:37.000Z",tags:["Kubernetes","CRI","VM","iThome"],description:"\u672c\u6587\u4f5c\u70ba CRI \u7cfb\u5217\u6587\u7ae0\u7684\u6700\u5f8c\u4e00\u7bc7\u6587\u7ae0\uff0c\u8981\u4f86\u8ddf\u5927\u5bb6\u5206\u4eab\u4e00\u500b\u6bd4\u8f03\u5c11\u898b\u7684\u7528\u6cd5\uff0c\u900f\u904e kubernetes \u7ba1\u7406 Pod \u7684\u65b9\u5f0f\u4f86\u7ba1\u7406 Virtual Machine\uff0c\u5e95\u5c64\u6240\u6709\u904b\u884c\u7684\u670d\u52d9\u90fd\u662f\u57fa\u65bc Virtual Machine \u53bb\u8dd1\uff0c\u4f46\u662f\u5c0d\u65bc Kubernetes \u4f86\u8aaa\u5b8c\u5168\u4e0d\u77e5\u60c5\uff0c\u4f9d\u7136\u8a8d\u70ba\u662f\u4e00\u500b Pod \u7684\u5f62\u5f0f\u3002 \u9019\u90e8\u5206\u4f9d\u8cf4\u91cd\u65b0\u64b0\u5beb\u4e00\u500b\u7b26\u5408 CRI \u6a19\u6e96\u61c9\u7528\u7a0b\u5f0f\u4f86\u5c0d\u63a5 kubelet, \u4e26\u4e14\u5e95\u4e0b\u6240\u6709\u7684\u904b\u4f5c\u90fd\u4f7f\u7528 virtual machine  \u4f86\u64cd\u4f5c\uff0c\u56e0\u6b64\u9019\u500b\u7bc4\u4f8b\u5c31\u5b8c\u5168\u4e0d\u6703\u6709 OCI \u7684\u5b58\u5728\uff0c\u56e0\u70ba\u662f\u771f\u6b63\u7684 virtual machine, \u800c\u975e container."},sidebar:"techPost",previous:{title:"Container Runtime - Security Container",permalink:"/docs/techPost/2019/iThome_Challenge/container-runtime-security-container"},next:{title:"Container Network Interface \u4ecb\u7d39",permalink:"/docs/techPost/2019/iThome_Challenge/cni"}},o={},m=[{value:"Introduction",id:"introduction",level:2},{value:"Design",id:"design",level:2},{value:"CRI Proxy",id:"cri-proxy",level:3},{value:"Architecture",id:"architecture",level:3},{value:"Installation",id:"installation",level:2},{value:"Steps",id:"steps",level:3}],k={toc:m},d="wrapper";function u(e){let{components:n,...t}=e;return(0,a.kt)(d,(0,i.Z)({},k,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"\u524d\u8a00"},"\u524d\u8a00"),(0,a.kt)("p",null,"\u672c\u7bc7\u6587\u7ae0\u4f5c\u70ba ",(0,a.kt)("inlineCode",{parentName:"p"},"Container Runtime Interface")," \u7cfb\u5217\u6587\u7684\u6700\u5f8c\u4e00\u7bc7\uff0c\u9019\u6b21\u7684\u4e3b\u984c\u4e5f\u662f\u5ef6\u7e8c\u524d\u5169\u7bc7\uff0c\u7e7c\u7e8c\u63a2\u8a0e\u5404\u7a2e\u4e0d\u540c\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI")," \u89e3\u6c7a\u65b9\u6848\u3002\n\u85c9\u7531\u77ad\u89e3\u9019\u4e9b\u4e0d\u540c\u76ee\u7684\u9700\u6c42\u7684\u89e3\u6c7a\u65b9\u6848\uff0c\u53ef\u4ee5\u5e6b\u52a9\u6211\u5011\u53bb\u63a2\u7d22\u5c0d\u65bc ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u7684\u5404\u7a2e\u61c9\u7528\uff0c\u7562\u7adf\u6709\u9700\u6c42\u624d\u6703\u6709\u958b\u767c\uff0c\u6709\u4eba\u9047\u5230\u4e86\u75db\u9ede\u662f\u7576\u524d\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u6c92\u6709\u8fa6\u6cd5\u89e3\u6c7a\u7684\uff0c\u6240\u4ee5\u624d\u6703\u958b\u59cb\u8457\u624b\u958b\u767c\u7b26\u5408\u81ea\u5df1\u9700\u6c42\u7684\u65b9\u5f0f\u3002\n\u5982\u540c\u6700\u4e00\u958b\u59cb\u95e1\u8ff0\u904e\uff0c\u900f\u904e ",(0,a.kt)("inlineCode",{parentName:"p"},"Container Runtime Inteface")," \u7684\u67b6\u69cb\uff0c\u53ef\u4ee5\u8b93\u958b\u767c\u8005\u66f4\u81ea\u7531\u4e14\u5f48\u6027\u7684\u53bb\u958b\u767c\u8207\u767c\u5e03\u9019\u4e9b\u529f\u80fd\uff0c\u800c\u4e0d\u7528\u8ddf ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u672c\u8eab\u7d81\u5b9a\u5c0e\u81f4\u958b\u767c\u9031\u671f\u904e\u9577\u3002"),(0,a.kt)("p",null,"\u524d\u5169\u7bc7\u6211\u5011\u63a2\u8a0e\u4e86\u5169\u7a2e ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI "),"\u4f7f\u7528\u60c5\u5883"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u5207\u63db\u4e0d\u540c\u7684 ",(0,a.kt)("inlineCode",{parentName:"li"},"CRI")," \u89e3\u6c7a\u65b9\u6848\uff0c\u8b6c\u5982 ",(0,a.kt)("inlineCode",{parentName:"li"},"containerd")," \u8207 ",(0,a.kt)("inlineCode",{parentName:"li"},"cri-o"),", \u4f46\u662f\u5e95\u5c64\u90fd\u662f\u57fa\u65bc ",(0,a.kt)("inlineCode",{parentName:"li"},"runc")," \u9019\u500b ",(0,a.kt)("inlineCode",{parentName:"li"},"OCI Runtime")," \u4f86\u7522\u751f ",(0,a.kt)("inlineCode",{parentName:"li"},"Container"),"."),(0,a.kt)("li",{parentName:"ol"},"\u70ba\u4e86\u5b89\u5168\u6027\u800c\u8a95\u751f\u7684 ",(0,a.kt)("inlineCode",{parentName:"li"},"OCI Runtime"),", \u8b6c\u5982 ",(0,a.kt)("inlineCode",{parentName:"li"},"gVisor")," \u8207 ",(0,a.kt)("inlineCode",{parentName:"li"},"kata container")," \u7b49\u3002 \u900f\u904e ",(0,a.kt)("inlineCode",{parentName:"li"},"OCI")," \u7684\u6a19\u6e96\u67b6\u69cb\uff0c\u958b\u767c\u8005\u8207\u4f7f\u7528\u8005\u90fd\u53ef\u4ee5\u65bc ",(0,a.kt)("inlineCode",{parentName:"li"},"containerd")," \u6216\u662f ",(0,a.kt)("inlineCode",{parentName:"li"},"cri-o")," \u4e2d\u5c07 ",(0,a.kt)("inlineCode",{parentName:"li"},"runc")," \u5207\u63db\u6210\u9019\u4e9b\u66f4\u52a0\u5b89\u5168\u7684 ",(0,a.kt)("inlineCode",{parentName:"li"},"container"),"\u3002")),(0,a.kt)("p",null,"\u800c\u4eca\u5929\u8981\u63a2\u8a0e\u7684\u5247\u662f\u7b2c\u4e09\u7a2e\u60c5\u5f62\uff0c\u662f\u771f\u6b63\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Virtual Machine"),"\uff0c\u76ee\u7684\u975e\u5e38\u7c21\u55ae\uff0c\u5c31\u662f\u900f\u904e ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u53bb\u7ba1\u7406 ",(0,a.kt)("inlineCode",{parentName:"p"},"Virtual Machine"),"\uff0c\u7d71\u4e00\u900f\u904e ",(0,a.kt)("inlineCode",{parentName:"p"},"Pod/Deployment")," \u7b49\u7fd2\u6163\u7684\u65b9\u5f0f\u540c\u4e8b\u53bb\u7ba1\u7406 ",(0,a.kt)("inlineCode",{parentName:"p"},"Container")," \u8207 ",(0,a.kt)("inlineCode",{parentName:"p"},"Virtual Machine"),"."),(0,a.kt)("p",null,"\u4e0d\u540c\u65bc ",(0,a.kt)("inlineCode",{parentName:"p"},"Kata Container")," \u9019\u7a2e\u57fa\u65bc ",(0,a.kt)("inlineCode",{parentName:"p"},"Virtual Machine")," \u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Container")," \u89e3\u6c7a\u65b9\u6848\uff0c\u672c\u6587\u63a2\u8a0e\u7684\u5c31\u662f\u5be6\u5be6\u5728\u5728\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Virtual Machine"),"\uff0c\u4e00\u9ede ",(0,a.kt)("inlineCode",{parentName:"p"},"Container")," \u7684\u6982\u5ff5\u90fd\u4e0d\u5b58\u5728\u7684\u74b0\u5883\uff0c\u4f7f\u7528\u8005\u5728\u5efa\u7acb\u8a72\u8cc7\u6e90\u7684\u6642\u5019\u751a\u81f3\u4e0d\u662f\u63d0\u4f9b ",(0,a.kt)("inlineCode",{parentName:"p"},"Container Image"),"\uff0c\u800c\u662f\u63d0\u4f9b ",(0,a.kt)("inlineCode",{parentName:"p"},"VM Image")," \u4f86\u5275\u7acb\u670d\u52d9\u3002"),(0,a.kt)("h1",{id:"\u7de3\u7531"},"\u7de3\u7531"),(0,a.kt)("p",null,"\u5982\u540c\u524d\u7bc7\u6587\u4e2d\u6240\u8ff0\uff0c ",(0,a.kt)("inlineCode",{parentName:"p"},"Container")," \u8207 ",(0,a.kt)("inlineCode",{parentName:"p"},"Virtual Machine")," \u5f7c\u6b64\u7684\u6bd4\u8f03\u5f9e\u4f86\u6c92\u6709\u4e2d\u65b7\u904e\uff0c\u7136\u800c\u96a8\u8005\u5fae\u670d\u52d9\u6982\u5ff5\u7684\u666e\u53ca\u8207\u767c\u5c55\uff0c\u6108\u4f86\u6108\u591a\u7684\u4f7f\u7528\u60c5\u5883\u90fd\u5728\u5617\u8a66\u4f7f\u7528\u5bb9\u5668\u4f86\u7ba1\u7406\uff0c\u5728\u9019\u7a2e\u524d\u63d0\u4e0b\uff0c\u70ba\u4ec0\u9ebc\u6703\u6709\u9019\u7a2e\u7d14 ",(0,a.kt)("inlineCode",{parentName:"p"},"Virtual Machine")," \u7684\u9700\u6c42\u88ab\u63d0\u51fa?"),(0,a.kt)("p",null,"\u5982\u679c\u4eca\u5929\u7684\u4f7f\u7528\u60c5\u5883\u90fd\u662f\u57fa\u65bc\u81ea\u5df1\u516c\u53f8\u5167\u90e8\u958b\u767c\uff0c\u90a3\u6211\u89ba\u5f97\u901a\u5e38\u4e0d\u6703\u6709\u9019\u500b\u554f\u984c\uff0c\u56e0\u70ba\u4e0d\u540c\u7d44\u5225\u4e4b\u9593\u53ef\u4ee5\u4e92\u76f8\u5354\u8abf\uff0c\u898f\u5283\u51fa\u4e00\u500b\u5c0d\u65bc\u958b\u767c\uff0c\u7dad\u904b\u8207\u6e2c\u8a66\u90fd\u63a5\u53d7\u7684\u6a21\u5f0f\u8207\u67b6\u69cb\u3002"),(0,a.kt)("p",null,"\u4f46\u662f\u6709\u4e9b\u60c5\u6cc1\u662f\u904b\u884c\u7684\u670d\u52d9\u4e26\u975e\u81ea\u884c\u958b\u767c\uff0c\u800c\u662f\u7b2c\u4e09\u65b9\u5ee0\u5546\u7684\u89e3\u6c7a\u65b9\u6848\uff0c\u4e26\u4e14\u5c07\u8a72\u89e3\u6c7a\u65b9\u6848\u7d66\u6574\u5408\u5230 ",(0,a.kt)("inlineCode",{parentName:"p"},"Virtual Machine")," \u4e4b\u4e2d\u3002\n\u7562\u7adf ",(0,a.kt)("inlineCode",{parentName:"p"},"Virtual Machine")," \u767c\u5c55\u7684\u6642\u9593\u66f4\u4e45\uff0c\u6709\u5f88\u591a\u5df2\u7d93\u958b\u767c\u8a31\u4e45\u7684\u8edf\u9ad4\u90fd\u662f\u57fa\u65bc ",(0,a.kt)("inlineCode",{parentName:"p"},"Virtual Machine")," \u7684\u74b0\u5883\u9032\u884c\u8a2d\u8a08\u8207\u4f7f\u7528\uff0c\u540c\u6642\u5728\u8ca9\u552e\u8207\u5408\u4f5c\u65b9\u9762\u4e5f\u90fd\u662f\u57fa\u65bc ",(0,a.kt)("inlineCode",{parentName:"p"},"VM Image")," \u7684\u65b9\u5f0f\u5728\u767c\u5e03\uff0c\u56e0\u6b64\u9019\u6703\u9020\u6210\u670d\u52d9\u63d0\u4f9b\u5546\u7684\u670d\u52d9\u90e8\u5206\u4f86\u81ea ",(0,a.kt)("inlineCode",{parentName:"p"},"Container"),"\uff0c\u90e8\u5206\u4f86\u81ea ",(0,a.kt)("inlineCode",{parentName:"p"},"Virtual Machine"),"\uff0c\u90a3 ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u80fd\u4e0d\u80fd\u89e3\u6c7a\u9019\u500b\u554f\u984c ?"),(0,a.kt)("p",null,"\u4e8b\u5be6\u4e0a\u5c31\u6211\u76ee\u524d\u63a5\u89f8\u5230\u7684\u6240\u6709\u6848\u4f8b\u88e1\u9762\uff0c\u5e7e\u4e4e\u5168\u90e8\u90fd\u8ddf ",(0,a.kt)("inlineCode",{parentName:"p"},"Network Function Virtualization(NFV)")," \u6709\u95dc\u3002\u96a8\u8005 ",(0,a.kt)("inlineCode",{parentName:"p"},"NFV")," \u8207 ",(0,a.kt)("inlineCode",{parentName:"p"},"OpenStaack")," \u7684\u767c\u5c55\uff0c\u5f88\u591a\u7684\u5ee0\u5546\u958b\u59cb\u5c07\u81ea\u5df1\u7684\u670d\u52d9\u5f9e\u8edf\u786c\u9ad4\u7d81\u5728\u4e00\u8d77\u5230\u7576\u7d14\u53ea\u8ce3\u8edf\u9ad4\uff0c\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"VM")," \u65b9\u5f0f\u91cb\u51fa\u8a72 ",(0,a.kt)("inlineCode",{parentName:"p"},"VM Image")," \u4f9b\u4ed6\u4eba\u4f7f\u7528\u3002"),(0,a.kt)("p",null,"\u5c0d\u65bc\u4e00\u822c\u7684\u7814\u7a76\u4eba\u54e1\u6216\u662f\u958b\u767c\u8005\u4f86\u8aaa\uff0c\u9019\u500b\u554f\u984c\u66f4\u52a0\u56b4\u91cd\uff0c\u56e0\u70ba\u652f\u63f4\u4e0d\u8db3\u8207\u5730\u4f4d\u5dee\u8ddd\uff0c\u4f60\u4eca\u5929\u6839\u672c\u6c92\u6709\u8fa6\u6cd5\u8981\u6c42\u539f\u958b\u767c\u5546\u5c07\u8edf\u9ad4\u5f9e ",(0,a.kt)("inlineCode",{parentName:"p"},"VM")," \u8f49\u79fb\u5230 ",(0,a.kt)("inlineCode",{parentName:"p"},"Container"),"\uff0c\u9019\u7a2e\u60c5\u6cc1\u4e0b\u4f60\u6703\u89ba\u5f97\u5f88\u96e3\u8655\u7406\uff0c\u56e0\u70ba\u6839\u672c\u6c92\u6709\u8fa6\u6cd5\u904b\u884c\u3002"),(0,a.kt)("p",null,"\u6240\u4ee5\u5c31\u6f38\u6f38\u6709\u4e0d\u540c\u7684\u65b9\u5f0f\u88ab\u63d0\u51fa\u4f86\u89e3\u6c7a\u9019\u500b\u554f\u984c\uff0c\u8b6c\u5982 ",(0,a.kt)("inlineCode",{parentName:"p"},"OpenStack")," \u5806\u758a\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"Kubernetes "),"\u4e0a\uff0c\u6216\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"Kubernetes")," \u5806\u758a\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"OPenStack")," \u4e0a\uff0c\u7136\u5f8c\u91cd\u65b0\u958b\u767c\u5176\u4ed6\u7684\u7ba1\u7406\u5de5\u5177\u540c\u6642\u638c\u7ba1 ",(0,a.kt)("inlineCode",{parentName:"p"},"Kubernetes")," \u4ee5\u53ca ",(0,a.kt)("inlineCode",{parentName:"p"},"OpenStack"),"\u3002"),(0,a.kt)("p",null,"\u9019\u6a23\u7684\u67b6\u69cb\u4e5f\u8a31\u53ef\u884c\uff0c\u4f46\u662f\u537b\u5c07\u8907\u96dc\u5ea6\u63d0\u5347\u5230\u4e00\u500b\u96e3\u4ee5\u7406\u89e3\u7684\u5730\u65b9\uff0c\u5c0d\u65bc\u958b\u767c\u8005\uff0c\u4f7f\u7528\u8005\uff0c\u7dad\u904b\u8005\u90fd\u5e36\u4f86\u96e3\u4ee5\u9664\u932f\u8207\u7ba1\u7406\u7684\u554f\u984c\uff0c\u6240\u4ee5\u554f\u984c\u5c31\u9000\u56de\u5230\uff0c\u80fd\u4e0d\u80fd\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u76f4\u63a5\u7ba1\u7406 ",(0,a.kt)("inlineCode",{parentName:"p"},"Virtual Machine"),"?"),(0,a.kt)("p",null,"\u66fe\u7d93\u89ba\u5f97\u56f0\u96e3\u7684\u554f\u984c\uff0c\u73fe\u5728\u5982\u679c\u77ad\u89e3\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI")," \u7684\u67b6\u69cb\u8207\u904b\u4f5c\u6a21\u5f0f\uff0c\u5c0d\u9019\u500b\u554f\u984c\u4f3c\u4e4e\u5c31\u4e0d\u6703\u89ba\u5f97\u592a\u56f0\u96e3\u4e86\uff0c\u53ef\u4ee5\u76f4\u63a5\u6253\u9020\u4e00\u500b\u6eff\u8db3 ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI")," \u4ecb\u9762\u7684\u7a0b\u5f0f\uff0c\u80cc\u5f8c\u5168\u90e8\u90fd\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"Virtual Machine")," \u53bb\u5be6\u73fe\u3002"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u9019\u500b\u60c5\u6cc1\u4e0b\u53ef\u4ee5\u5b8c\u5168\u4e0d\u9700\u8981\u53bb\u7ba1 OCI \u6a19\u6e96\u4e86\uff0c\u56e0\u70ba\u6211\u5011\u7684\u76ee\u6a19\u662f\u7d14 Virtual Machine\uff0c\u4e0d\u592a\u9700\u8981\u7ba1 Container\u3002")),(0,a.kt)("p",null,"\u9664\u4e86\u4e0a\u8ff0\u7684\u96e3\u4ee5\u5bb9\u5668\u5316\u7684\u539f\u56e0\u5916\uff0c\u9084\u6709\u4e00\u4e9b\u539f\u56e0\u662f\u6253\u9020\u9019\u7a2e\u5c08\u6848\u7684\u5951\u6a5f"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u6df7\u5408\u4f5c\u696d\u7cfb\u7d71\u74b0\u5883\u7684\u904b\u884c\u74b0\u5883\uff0c\u5c0d\u65bc\u4e00\u500b\u5168\u90e8\u90fd\u63a1\u7528 ",(0,a.kt)("inlineCode",{parentName:"li"},"Linux")," \u74b0\u5883\u67b6\u8a2d\u7684 ",(0,a.kt)("inlineCode",{parentName:"li"},"Kubernetes"),"  \u53e2\u96c6\uff0c\u8981\u5982\u4f55\u5728\u5176\u4e2d\u904b\u884c\u4e00\u4e9b\u57fa\u65bc ",(0,a.kt)("inlineCode",{parentName:"li"},"Windows")," \u74b0\u5883\u7684\u670d\u52d9?"),(0,a.kt)("li",{parentName:"ol"},"\u5b89\u5168\u6027\u8003\u91cf\uff0c\u5c31\u7b97\u6709\u4e86\u524d\u5e7e\u5929\u95dc\u65bc ",(0,a.kt)("inlineCode",{parentName:"li"},"gVisror")," \u8207 ",(0,a.kt)("inlineCode",{parentName:"li"},"Kata Container")," \u76f8\u95dc\u7684\u89e3\u6c7a\u65b9\u6848\uff0c\u4e5f\u672a\u5fc5\u80fd\u5920\u8aaa\u670d\u6240\u6709\u4eba\u76ee\u524d\u9019\u5169\u500b\u5c08\u6848\u7684\u958b\u767c\u4ee5\u7d93\u8655\u65bc ",(0,a.kt)("inlineCode",{parentName:"li"},"Production Ready"),"\uff0c\u6240\u4ee5\u5982\u679c\u53ef\u4ee5\u7e7c\u7e8c\u7814\u7a76\u5df2\u7d93\u904b\u884c\u9577\u671f\u7684 ",(0,a.kt)("inlineCode",{parentName:"li"},"Virtual Machine")," \u74b0\u5883\u662f\u518d\u597d\u4e0d\u904e\u3002")),(0,a.kt)("p",null,"\u9019\u65b9\u9762\u6211\u76ee\u524d\u77e5\u9053\u6bd4\u8f03\u6709\u540d\u7684\u5c08\u6848\u70ba ",(0,a.kt)("inlineCode",{parentName:"p"},"kubevirt")," \u4ee5\u53ca ",(0,a.kt)("inlineCode",{parentName:"p"},"virtlet"),"\uff0c\u90a3\u63a5\u4e0b\u4f86\u6703\u91dd\u5c0d ",(0,a.kt)("inlineCode",{parentName:"p"},"virtlet")," \u70ba\u4e3b\u53bb\u4ecb\u7d39\u63a2\u8a0e\u4e00\u4e0b\u9019\u7a2e\u67b6\u69cb\u7684\u8a2d\u8a08\uff0c\u4ee5\u53ca\u600e\u9ebc\u4f7f\u7528"),(0,a.kt)("h1",{id:"virtlet"},"Virtlet"),(0,a.kt)("h2",{id:"introduction"},"Introduction"),(0,a.kt)("p",null,"\u5c31\u8ddf\u524d\u8ff0\u7684\u6163\u4f8b\u4e00\u4e0b\uff0c\u5148\u770b\u4e00\u4e0b ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/Mirantis/virtlet"},"\u5b98\u65b9 GitHub")," \u662f\u5982\u4f55\u63cf\u8ff0\u81ea\u5df1\u9019\u500b\u5c08\u6848\u7684"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"Virtlet is a Kubernetes runtime server which allows you to run VM workloads, based on QCOW2 images.")),(0,a.kt)("p",null,"\u9019\u908a\u503c\u5f97\u6ce8\u610f\u7684\u662f\u5176\u7528\u7684\u8a5e\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"Kubernetes runtime server"),", \u9019\u908a\u6240\u6307\u7684\u5c31\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"Container Runtime Interface"),"\uff0c\u8a72\u5c08\u6848\u672c\u8eab\u984d\u5916\u5be6\u73fe\u4e86\u4e00\u500b\u5168\u65b0\u7684\u61c9\u7528\u7a0b\u5f0f\uff0c\u8a72\u61c9\u7528\u7a0b\u5f0f\u672c\u8eab\u652f\u63f4 ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI")," \u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"gRPC")," \u4ecb\u9762\uff0c\u4f46\u662f\u5e95\u4e0b\u5be6\u73fe\u9019\u4e9b\u529f\u80fd\u6642\u5168\u90e8\u90fd\u4f7f\u7528\u57fa\u65bc ",(0,a.kt)("inlineCode",{parentName:"p"},"QCOW2 Images")," \u683c\u5f0f\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Virtual Machine"),"\u3002"),(0,a.kt)("h2",{id:"design"},"Design"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"virtlet")," \u958b\u767c\u7684\u521d\u8877\u4e26\u4e0d\u662f\u8981\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"VM")," \u53d6\u4ee3\u6240\u6709\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Container"),", \u800c\u662f\u5e0c\u671b\u80fd\u5920\u63d0\u4f9b\u53e6\u5916\u4e00\u7a2e\u9078\u64c7\u3002\u70ba\u4e86\u9054\u6210\u9019\u500b\u76ee\u7684\uff0c\u5247 ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI")," \u7684\u90e8\u5206\u52e2\u5fc5\u8981\u91cd\u65b0\u64b0\u5beb\uff0c\u4e0d\u80fd\u4f7f\u7528\u539f\u751f\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"containerd")," \u6216\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"cri-o"),"\u3002"),(0,a.kt)("p",null,"\u540c\u6642\u9019\u500b\u5168\u65b0\u8a2d\u8a08\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI"),"\u8655\u7406\u7a0b\u5f0f\u4e5f\u8981\u80fd\u5920\u6839\u64da\u60c5\u6cc1\u6c7a\u5b9a\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"Virtual Machine")," \u6216\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"Container")," \u4f86\u5275\u5efa\u5c0d\u61c9\u7684\u904b\u7b97\u8cc7\u6e90\u3002\n\u65bc\u662f\u4e4e\uff0c",(0,a.kt)("inlineCode",{parentName:"p"}," CRI Proxy")," \u9019\u500b\u5c08\u6848\u5c31\u56e0\u61c9\u9019\u500b\u9700\u6c42\u800c\u751f"),(0,a.kt)("h3",{id:"cri-proxy"},"CRI Proxy"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"CRI Proxy Server")," \u7684\u529f\u80fd\u5206\u6210\u7c21\u55ae\uff0c\u5c31\u662f\u6839\u64da\u689d\u4ef6\u8f49\u767c ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI")," \u8acb\u6c42\u5230\u4e0d\u540c\u7684\u5f8c\u7aef\uff0c\u91dd\u5c0d ",(0,a.kt)("inlineCode",{parentName:"p"},"container")," \u7684\u90e8\u5206\uff0c\u76ee\u524d\u652f\u63f4 ",(0,a.kt)("inlineCode",{parentName:"p"},"dockershim")," \u6216\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"containerd")," \uff0c\u800c\u91dd\u5c0d ",(0,a.kt)("inlineCode",{parentName:"p"},"Virtual Machine")," \u7684\u90e8\u5206\u5247\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"virtlet")," server \u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/ixMsRIl.png",alt:null}),"\n\u672c\u5716\u7bc0\u9304\u81ea",(0,a.kt)("a",{parentName:"p",href:"https://github.com/Mirantis/criproxy"},"GitHub CRIProxy")),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"CRI Proxy")," \u8981\u7528\u4ec0\u9ebc\u689d\u4ef6\u4f86\u5224\u65b7\u5230\u5e95\u8a72\u600e\u9ebc\u8655\u7406\u9019\u500b\u8acb\u6c42\uff0c\u9019\u90e8\u5206\u5c31\u4f7f\u7528\u4e0a\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u672c\u8eab\u91dd\u5c0d\u5176\u8cc7\u6e90\u5167\u90e8\u63d0\u4f9b\u7684\u6a19\u8a18\u6b04\u4f4d\uff0c\u4e5f\u5c31\u662f\u6240\u8b02\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"annotation")),(0,a.kt)("p",null,"\u5c0d\u65bc\u6bcf\u500b\u5275\u5efa\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Pod"),"\uff0c\u53ea\u8981\u65bc ",(0,a.kt)("inlineCode",{parentName:"p"},"metadata.annotations.kubernetes.io/target-runtime")," \u8a2d\u5b9a\u70ba ",(0,a.kt)("inlineCode",{parentName:"p"},"virtlet.cloud"),", \u5247 ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI Proxy")," \u5c31\u6703\u8a8d\u5f97\u9019\u500b ",(0,a.kt)("inlineCode",{parentName:"p"},"Pod")," \u8981\u8d70 ",(0,a.kt)("inlineCode",{parentName:"p"},"VM")," \u53bb\u8655\u7406\uff0c\u800c\u975e\u50b3\u7d71\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Container"),"\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml="},"apiVersion: v1\nkind: Pod\nmetadata:\n  name: cirros-vm\n  annotations:\n    kubernetes.io/target-runtime: virtlet.cloud\n...\n")),(0,a.kt)("p",null,"\u900f\u904e\u9019\u7a2e\u6a19\u8a18\u7684\u65b9\u5f0f\u8207\u67b6\u69cb\uff0c\u53ef\u4ee5\u8b93\u4f7f\u7528\u8005\u65b9\u4fbf\u7684\u53bb\u6839\u64da\u9700\u6c42\u4f86\u6c7a\u5b9a\u8981\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"VM")," \u9084\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"Container"),"\u3002"),(0,a.kt)("p",null,"\u6b64\u5916 ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI Proxy")," \u6703\u88ab ",(0,a.kt)("inlineCode",{parentName:"p"},"kubelet")," \u547c\u53eb\uff0c\u6240\u4ee5\u672c\u8eab\u4e5f\u662f\u6bcf\u500b\u7bc0\u9ede\u4e0a\u90fd\u8981\u5b58\u5728\uff0c\u56e0\u6b64\u4e00\u958b\u59cb\u6703\u5148\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"systemd")," \u7684\u65b9\u5f0f\u5728\u6bcf\u53f0\u7bc0\u9ede\u4e0a\u90fd\u904b\u884c\u5b89\u88dd\uff0c\u9019\u6a23\u57fa\u672c\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"kubelet")," \u624d\u53ef\u4ee5\u555f\u52d5\u3002 \u63a5\u8005\u6240\u6709\u6c92\u6709\u8a2d\u5b9a\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Pod")," \u5c31\u6703\u8d70 ",(0,a.kt)("inlineCode",{parentName:"p"},"kubelet")," -> ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI Proxy")," -> ",(0,a.kt)("inlineCode",{parentName:"p"},"dockershim/containerd")," \u7684\u65b9\u5f0f\u4ee5 ",(0,a.kt)("inlineCode",{parentName:"p"},"Container")," \u88ab\u5275\u5efa\u51fa\u4f86\u3002"),(0,a.kt)("h3",{id:"architecture"},"Architecture"),(0,a.kt)("p",null,"\u9664\u4e86\u4e0a\u8ff0\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI Proxy")," \u4e4b\u5916\uff0c\u6211\u5011\u63a5\u4e0b\u4f86\u770b\u4e00\u4e0b\u5176\u5b8c\u6574\u7684\u904b\u4f5c\u67b6\u69cb\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/Kbf0zaf.png",alt:null}),"\n\u672c\u5716\u7bc0\u9304\u81ea ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/Mirantis/virtlet/blob/master/docs/docs/dev/architecture.md"},"Architecture")),(0,a.kt)("p",null,"\u7576 ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI Proxy")," \u6536\u5230\u5275\u5efa ",(0,a.kt)("inlineCode",{parentName:"p"},"VM")," \u7684\u8acb\u6c42\u5f8c\uff0c\u5c31\u6703\u5c07\u8a72 ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI")," \u7684\u8acb\u6c42\u8f49\u767c\u5230\u5f8c\u7aef\u8655\u7406\uff0c\u9019\u500b\u8655\u7406\u7684\u89d2\u8272\u5c31\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"Virtlet Container"),"\uff0c\u4e5f\u662f\u4fd7\u7a31\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"virtlet Manager"),"\u3002"),(0,a.kt)("p",null,"\u7576\u6574\u500b ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u7cfb\u7d71\u8d77\u4f86\u5f8c\uff0c\u6703\u900f\u904e ",(0,a.kt)("inlineCode",{parentName:"p"},"daemonset")," \u7684\u65b9\u5f0f\u53bb\u90e8\u7f72 ",(0,a.kt)("inlineCode",{parentName:"p"},"virtlet Manager")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash="},"vagrant@k8s-dev:~$ sudo kubectl -n kube-system get daemonset\nNAME         DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE\nkube-proxy   3         3         3       3            3           <none>          8h\nvirtlet      1         1         1       1            1           <none>          8h\n\nvagrant@k8s-dev:~$ sudo kubectl get pods --all-namespaces -l runtime=virtlet\nNAMESPACE     NAME            READY   STATUS    RESTARTS   AGE\nkube-system   virtlet-gghd4   3/3     Running   0          8h\n")),(0,a.kt)("p",null,"\u7136\u800c\u8a72 DaemonSet \u672c\u8eab\u5176\u5be6\u4e5f\u6709\u8a2d\u5b9a\u7bc0\u9ede\u7684\u9078\u64c7\u689d\u4ef6\uff0c\u4e26\u975e\u6240\u6709\u7684\u7bc0\u9ede\u90fd\u6703\u90e8\u7f72\uff0c\u7562\u7adf\u8a72\u7bc0\u9ede\u8981\u6709\u80fd\u529b\u7522\u751f ",(0,a.kt)("inlineCode",{parentName:"p"},"VM"),"\uff0c\u76ee\u524d\u4f7f\u7528\u7684\u898f\u5247\u662f\u8a72\u7bc0\u9ede\u5fc5\u9808\u8981\u542b\u6709\u500b\u6a19\u7c64 ",(0,a.kt)("inlineCode",{parentName:"p"},"extraRuntime: virtlet")," \u5373\u53ef\uff0c\u503c\u5f97\u6ce8\u610f\u7684\u662f\u5176\u4f7f\u7528\u7684\u689d\u4ef6\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"In"),", \u6240\u4ee5\u53ea\u8981\u542b\u6709 ",(0,a.kt)("inlineCode",{parentName:"p"},"virtlet")," \u9019\u500b\u5b57\u7684\u7bc0\u9ede\u90fd\u6703\u88ab\u90e8\u7f72 ",(0,a.kt)("inlineCode",{parentName:"p"},"virtlet Manager"),"\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash="},"...\n      spec:\n        affinity:\n          nodeAffinity:\n            requiredDuringSchedulingIgnoredDuringExecution:\n              nodeSelectorTerms:\n              - matchExpressions:\n                - key: extraRuntime\n                  operator: In\n                  values:\n                    - virtlet\n...\n")),(0,a.kt)("p",null,"\u7576 ",(0,a.kt)("inlineCode",{parentName:"p"},"virtlet Manager")," \u6536\u5230\u6307\u4ee4\u5f8c\uff0c\u6703\u900f\u904e ",(0,a.kt)("inlineCode",{parentName:"p"},"libvirt")," API \u7684\u65b9\u5f0f\u9032\u884c\u5f8c\u7e8c\u7684\u8655\u7406\uff0c\u53eb\u8d77 ",(0,a.kt)("inlineCode",{parentName:"p"},"vmwrapper")," \u4f86\u7522\u751f\u5c0d\u61c9\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"VM")," \u74b0\u5883"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"vmrapper is run by libvirt and wraps the emulator (QEMU/KVM). It requests tap file descriptor from Virtlet, adds command line arguments needed by the emulator to use the tap device and then execs the emulator.")),(0,a.kt)("p",null,"\u5176\u5b8c\u6574\u67b6\u69cb\u975e\u5e38\u8907\u96dc\uff0c\u5176\u4e2d\u81ea\u884c\u8a2d\u8a08\u4e86\u4e0d\u5c11\u5143\u4ef6\u4f86\u8655\u7406\u8cc7\u6e90\u7684\u8655\u7406\uff0c\u8b6c\u5982\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"tapmanager")," \u4f86\u8655\u7406\u6574\u500b ",(0,a.kt)("inlineCode",{parentName:"p"},"CNI"),"\uff0c\u9019\u90e8\u5206\u5e7e\u4e4e\u6c92\u6709\u6587\u4ef6\uff0c\u53ea\u80fd\u4f9d\u8cf4\u95b1\u8b80\u539f\u59cb\u78bc\u7684\u65b9\u5f0f\u4f86\u7406\u89e3\u5176\u5be6\u4f5c\u65b9\u6cd5\u3002"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/Mirantis/virtlet/blob/master/docs/docs/dev/vm-pod-lifecycle.md"},"vm-pod-lifecycle")," \u9019\u908a\u63cf\u8ff0\u4e86\u95dc\u65bc ",(0,a.kt)("inlineCode",{parentName:"p"},"Pod")," \u5275\u9020\u8207\u522a\u9664\u6642\u6574\u9ad4\u8655\u7406\u6d41\u7a0b\uff0c\u975e\u5e38\u7684\u9577\uff0c\u6709\u8208\u8da3\u7684\u53ef\u4ee5\u81ea\u884c\u95b1\u8b80\u3002"),(0,a.kt)("h2",{id:"installation"},"Installation"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://docs.virtlet.cloud/user-guide/virtlet-on-kdc/"},"\u5b98\u65b9\u6587\u4ef6")," \u4e2d\u6709\u63d0\u4f9b\u5169\u7a2e\u5b89\u88dd\u65b9\u5f0f\uff0c\u4e00\u7a2e\u662f\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes-dind-cluster")," \u53bb\u5b89\u88dd\u6574\u500b\u6e2c\u8a66\u74b0\u5883\uff0c\u53e6\u5916\u4e00\u7a2e\u5247\u662f\u6309\u90e8\u5c31\u73ed\u7684\u63cf\u8ff0\u8981\u5b89\u88dd\u7684\u6240\u6709\u5143\u4ef6\uff0c\u53ea\u662f\u55ae\u7d14\u6e2c\u8a66\u8ddf\u7814\u7a76\u7684\u8a71\uff0c\u6211\u8a8d\u70ba\u9078\u64c7\u7b2c\u4e00\u7a2e\u6703\u6bd4\u8f03\u65b9\u4fbf"),(0,a.kt)("p",null,"\u6211\u81ea\u5df1\u7684\u96fb\u8166\u74b0\u5883\u662f",(0,a.kt)("inlineCode",{parentName:"p"},"MAC Pro"),"\uff0c\u5e73\u5e38\u90fd\u6703\u900f\u904e ",(0,a.kt)("inlineCode",{parentName:"p"},"Vagrant + VirtualBox")," \u7522\u751f\u4e00\u500b Linux \u74b0\u5883\u4f86\u6e2c\u8a66\uff0c\u9019\u6b21\u5c31\u57fa\u65bc\u9019\u500b ",(0,a.kt)("inlineCode",{parentName:"p"},"Linux")," \u7684\u74b0\u5883\u4f7f\u7528 kubernetes-dind-cluster \u5b89\u88dd kubernetes \u4e26\u4e14\u5728\u88e1\u9762\u4f7f\u7528 virtlet \u7522\u751f VM\u3002"),(0,a.kt)("p",null,"\u67b6\u69cb\u5982\u4e0b\uff0c\u975e\u5e38\u7684\u6709\u8da3"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u5148\u758a\u4e00\u5c64 VM"),(0,a.kt)("li",{parentName:"ol"},"\u88e1\u9762\u5275\u4e09\u500b ",(0,a.kt)("inlineCode",{parentName:"li"},"Container"),", \u4ee5\u9019\u4e09\u500b ",(0,a.kt)("inlineCode",{parentName:"li"},"Container")," \u7d44\u6210\u4e00\u500b ",(0,a.kt)("inlineCode",{parentName:"li"},"Kubernetes Cluster")),(0,a.kt)("li",{parentName:"ol"},"Kubernetes \u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"li"},"Virtlet")," \u4f5c\u70ba\u5176 ",(0,a.kt)("inlineCode",{parentName:"li"},"CRI")," \u89e3\u6c7a\u65b9\u6848\uff0c\u6700\u5f8c\u5728\u88e1\u9762\u7522\u751f\u4e00\u500b\u57fa\u65bc ",(0,a.kt)("inlineCode",{parentName:"li"},"Virtual Machine")," \u7684 ",(0,a.kt)("inlineCode",{parentName:"li"},"Pod"),(0,a.kt)("img",{parentName:"li",src:"https://i.imgur.com/Gsh8hwW.png",alt:null}))),(0,a.kt)("h3",{id:"steps"},"Steps"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u6e96\u5099\u597d Ubuntu \u74b0\u5883\uff0c\u4e0b\u8f09",(0,a.kt)("a",{parentName:"li",href:"https://github.com/Mirantis/virtlet/blob/master/deploy/demo.sh"},"demo.sh")),(0,a.kt)("li",{parentName:"ol"},"\u57f7\u884c\u5b89\u88dd\uff0c\u6211\u81ea\u5df1\u662f\u6c92\u6709\u9047\u5230\u4efb\u4f55\u554f\u984c"),(0,a.kt)("li",{parentName:"ol"},"\u6700\u5f8c\u6703\u5e6b\u4f60\u5275\u5efa\u597d VM \u4e26\u4e14\u8981\u4f60\u900f\u904e ssh \u767b\u5165\u5230\u8a72 VM, \u5bc6\u78bc\u662f ",(0,a.kt)("inlineCode",{parentName:"li"},"gocubsgo"),".")),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/7e93E60.png",alt:null})),(0,a.kt)("p",null,"\u53ef\u4ee5\u770b\u5230\u5275\u5efa\u51fa\u4f86\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"pod"),", \u6709\u7279\u5225\u6a19\u6ce8\u4e00\u500b ",(0,a.kt)("inlineCode",{parentName:"p"},"annotations"),"\uff0c\u9019\u6a23 ",(0,a.kt)("inlineCode",{parentName:"p"},"CRIProxy")," \u5c31\u6703\u6839\u64da\u9700\u6c42\u4f7f\u7528 ",(0,a.kt)("inlineCode",{parentName:"p"},"containerd")," \u6216\u662f ",(0,a.kt)("inlineCode",{parentName:"p"},"VM")," \u4f86\u5275\u5efa\u670d\u52d9\n",(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/WRQiVBg.png",alt:null})),(0,a.kt)("p",null,"\u9019\u6642\u5019\u900f\u904e ",(0,a.kt)("inlineCode",{parentName:"p"},"kubectl get pods -o wide")," \u53d6\u5f97\u8a72 ",(0,a.kt)("inlineCode",{parentName:"p"},"Pod")," \u904b\u884c\u7684\u7bc0\u9ede\u4f4d\u7f6e\uff0c\u4e26\u4e14\u900f\u904e ",(0,a.kt)("inlineCode",{parentName:"p"},"docker exec -it $name bash")," \u5230\u7bc0\u9ede\u88e1\u9762\u9032\u884c\u89c0\u5bdf"),(0,a.kt)("p",null,"\u900f\u904e\u89c0\u5bdf\u771f\u7684\u767c\u73fe\u8a72\u7bc0\u9ede\u5167\u900f\u904e ",(0,a.kt)("inlineCode",{parentName:"p"},"qemu")," \u5275\u5efa\u4e86\u4e00\u500b ",(0,a.kt)("inlineCode",{parentName:"p"},"VM"),"\n",(0,a.kt)("img",{parentName:"p",src:"https://i.imgur.com/gxHHxuN.jpg",alt:null})),(0,a.kt)("p",null,"\u9664\u4e86\u4e0a\u8ff0\u6700\u7c21\u55ae\u7684\u7bc4\u4f8b\u4e4b\u5916\uff0c",(0,a.kt)("a",{parentName:"p",href:"https://github.com/Mirantis/virtlet/tree/master/examples"},"GitHub")," \u9019\u908a\u9084\u6709\u63d0\u4f9b\u5176\u4ed6\u4e0d\u540c\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"Yaml"),", \u5176\u4e2d\u6211\u89ba\u5f97\u975e\u5e38\u6709\u8da3\u7684\u5c31\u662f ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/Mirantis/virtlet/blob/master/examples/k8s.yaml"},"k8s.yml")),(0,a.kt)("p",null,"\u53ef\u4ee5\u8b93\u4f60\u5728 ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u88e1\u9762\u900f\u904e ",(0,a.kt)("inlineCode",{parentName:"p"},"VM")," \u7522\u751f\u53e6\u5916\u4e00\u500b ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," cluster\uff0c \u6211\u66ab\u6642\u60f3\u4e0d\u5230\u61c9\u7528\u60c5\u5883\uff0c\u4f46\u662f\u5c31\u662f\u4e00\u500b\u5f88\u6709\u8da3\u7684\u67b6\u69cb\u3002\n\u7bc0\u9304\u4e00\u4e0b\u88e1\u9762\u7684\u5167\u5bb9\uff0c\u53ef\u4ee5\u770b\u5230\u8a72 ",(0,a.kt)("inlineCode",{parentName:"p"},"VM")," \u8d77\u4f86\u5f8c\u6703\u900f\u904e ",(0,a.kt)("inlineCode",{parentName:"p"},"kubeadm")," \u7684\u65b9\u5f0f\u53bb\u521d\u59cb\u5316\u4e00\u500b cluster."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml="},'\n          - path: /usr/local/bin/provision.sh\n            permissions: "0755"\n            owner: root\n            content: |\n              #!/bin/bash\n              set -u -e\n              set -o pipefail\n              curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -\n              apt-get update\n              apt-get install -y docker.io kubelet kubeadm kubectl kubernetes-cni\n              sed -i \'s/--cluster-dns=10\\.96\\.0\\.10/--cluster-dns=10.97.0.10/\' /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\n              systemctl daemon-reload\n              if [[ $(hostname) =~ -0$ ]]; then\n                # master node\n                kubeadm init --token adcb82.4eae29627dc4c5a6 --pod-network-cidr=10.200.0.0/16 --service-cidr=10.97.0.0/16 --apiserver-cert-extra-sans=127.0.0.1,localhost\n                export KUBECONFIG=/etc/kubernetes/admin.conf\n                export kubever=$(kubectl version | base64 | tr -d \'\\n\')\n                kubectl apply -f "https://cloud.weave.works/k8s/net?k8s-version=$kubever"\n                while ! kubectl get pods -n kube-system -l k8s-app=kube-dns|grep \' 1/1\'; do\n                  sleep 1\n                done\n                mkdir -p /root/.kube\n                chmod 700 /root/.kube\n                cp "${KUBECONFIG}" /root/.kube/config\n                echo "Master setup complete." >&2\n              else\n                # worker node\n                kubeadm join --token adcb82.4eae29627dc4c5a6 --discovery-token-unsafe-skip-ca-verification k8s-0.k8s:6443\n                echo "Node setup complete." >&2\n              fi\n\n')),(0,a.kt)("h1",{id:"summary"},"Summary"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"Container Runtime Interface(CRI)")," \u7684\u6587\u7ae0\u5230\u9019\u908a\u544a\u4e86\u4e00\u500b\u6bb5\u843d\uff0c\u6211\u500b\u4eba\u5c0d\u65bc ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI")," \u9019\u7a2e\u4ecb\u9762\u7684\u8a2d\u8a08\u662f\u6eff\u559c\u6b61\u7684\uff0c\u900f\u904e\u4ecb\u9762\u5c07\u5be6\u4f5c\u8207\u4e3b\u9ad4\u62bd\u96e2\uff0c\u80fd\u5920\u8b93\u793e\u7fa4\u958b\u767c\u8005\u81ea\u5df1\u958b\u767c\u60f3\u8981\u7684\u529f\u80fd\uff0c\u540c\u6642\u53c8\u80fd\u5920\u7c21\u55ae\u4e14\u9806\u5229\u7684\u8207 ",(0,a.kt)("inlineCode",{parentName:"p"},"kubernetes")," \u6574\u5408\u3002"),(0,a.kt)("p",null,"\u4e5f\u6b63\u662f\u56e0\u70ba\u5982\u6b64\u624d\u53ef\u4ee5\u770b\u5230\u5404\u5f0f\u5404\u6a23\u91dd\u5c0d\u4e0d\u540c\u8b70\u984c\u800c\u52aa\u529b\u7684\u5c08\u6848\uff0c\u6bcf\u500b\u5c08\u6848\u90fd\u6709\u81ea\u5df1\u7684\u7279\u8272\u8207\u512a\u52a3\uff0c\u6240\u4ee5\u5c0d\u65bc\u4e00\u500b\u7ba1\u7406\u8005\u4f86\u8aaa\uff0c\u5982\u679c\u80fd\u5920\u7406\u89e3\u9019\u4e9b\u4e0d\u540c\u7684\u89e3\u6c7a\u65b9\u6848\u7684\u512a\u52a3\u4e4b\u8655\uff0c\u4e0d\u8ad6\u662f\u57fa\u65bc ",(0,a.kt)("inlineCode",{parentName:"p"},"CRI")," \u6a19\u6e96\u7684\u65b9\u6848\uff0c\u6216\u662f\u66f4\u5e95\u4e0b\u76f8\u5bb9\u65bc ",(0,a.kt)("inlineCode",{parentName:"p"},"OCI Runtime")," \u7684\u5be6\u4f5c\uff0c\u5c0d\u65bc\u672a\u4f86\u9047\u5230\u4efb\u4f55\u4e0d\u540c\u7684\u4f7f\u7528\u60c5\u5883\u8207\u554f\u984c\u6642\uff0c\u8166\u4e2d\u5c31\u53ef\u4ee5\u5f88\u5feb\u7684\u53cd\u5c04\u51fa\u662f\u4e0d\u662f\u6709\u76f8\u95dc\u7684\u8b70\u984c\u8207\u8cc7\u6e90\u53ef\u4ee5\u53bb\u7814\u7a76\uff0c\u800c\u4e0d\u6703\u53ea\u7528\u4e00\u5957 ",(0,a.kt)("inlineCode",{parentName:"p"},"docker")," \u6253\u5929\u4e0b\u3002"),(0,a.kt)("p",null,"\u63a5\u4e0b\u4f86\u5c07\u91dd\u5c0d\u7db2\u8def\u7684\u90e8\u5206\uff0c\u5f9e ",(0,a.kt)("inlineCode",{parentName:"p"},"Container Network Interface(CNI)")," \u70ba\u51fa\u767c\u9ede\u4ecb\u7d39\u5176\u6982\u5ff5\u8207\u67b6\u69cb\uff0c\u4e5f\u5305\u542b\u4e86 ",(0,a.kt)("inlineCode",{parentName:"p"},"ipam")," \u7684\u4ecb\u7d39\uff0c\u8b93\u5927\u5bb6\u77e5\u9053\u5230\u5e95 ",(0,a.kt)("inlineCode",{parentName:"p"},"IP")," \u662f\u600e\u9ebc\u88ab\u5206\u914d\u8207\u6307\u6d3e\u7684\uff0c\u63a5\u8005\u4e5f\u6703\u63a2\u8a0e\u5e38\u898b\u7684 ",(0,a.kt)("inlineCode",{parentName:"p"},"flannel")," \u5176\u5be6\u4f5c\u6982\u5ff5\u8207\u904b\u4f5c\u6d41\u7a0b\u3002"),(0,a.kt)("h1",{id:"\u53c3\u8003"},"\u53c3\u8003"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/Mirantis/criproxy"},"https://github.com/Mirantis/criproxy")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://github.com/Mirantis/virtlet"},"https://github.com/Mirantis/virtlet"))))}u.isMDXComponent=!0}}]);
"use strict";(self.webpackChunkhwchiu=self.webpackChunkhwchiu||[]).push([[81040],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>h});var l=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,l)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,l,a=function(e,t){if(null==e)return{};var n,l,a={},o=Object.keys(e);for(l=0;l<o.length;l++)n=o[l],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(l=0;l<o.length;l++)n=o[l],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var i=l.createContext({}),m=function(e){var t=l.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},s=function(e){var t=m(e.components);return l.createElement(i.Provider,{value:t},e.children)},u="mdxType",k={inlineCode:"code",wrapper:function(e){var t=e.children;return l.createElement(l.Fragment,{},t)}},c=l.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,s=p(e,["components","mdxType","originalType","parentName"]),u=m(n),c=a,h=u["".concat(i,".").concat(c)]||u[c]||k[c]||o;return n?l.createElement(h,r(r({ref:t},s),{},{components:n})):l.createElement(h,r({ref:t},s))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,r=new Array(o);r[0]=c;var p={};for(var i in t)hasOwnProperty.call(t,i)&&(p[i]=t[i]);p.originalType=e,p[u]="string"==typeof e?e:a,r[1]=p;for(var m=2;m<o;m++)r[m]=n[m];return l.createElement.apply(null,r)}return l.createElement.apply(null,n)}c.displayName="MDXCreateElement"},39117:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>r,default:()=>k,frontMatter:()=>o,metadata:()=>p,toc:()=>m});var l=n(87462),a=(n(67294),n(3905));const o={slug:"gitops-repo-structure",title:"GitOps \u4e0b\u7684 Git Repo \u67b6\u69cb\u63a2\u8a0e",keywords:["Kubernetes","GitOps","DevOps"],date:new Date("2023-09-05T01:03:21.000Z"),authors:"hwchiu",tags:["Kubernetes","DevOps","GitOps"],description:"\u63a2\u8a0e GitOps \u6d41\u7a0b\u4e0b\uff0cGit repo \u6703\u53bb\u600e\u9ebc\u8a2d\u8a08\u4f86\u6539\u5584\u6574\u9ad4\u5de5\u4f5c\u6d41\u7a0b"},r="\u524d\u8a00",p={unversionedId:"techPost/2023/gitops-git-repo-structure",id:"techPost/2023/gitops-git-repo-structure",title:"GitOps \u4e0b\u7684 Git Repo \u67b6\u69cb\u63a2\u8a0e",description:"\u63a2\u8a0e GitOps \u6d41\u7a0b\u4e0b\uff0cGit repo \u6703\u53bb\u600e\u9ebc\u8a2d\u8a08\u4f86\u6539\u5584\u6574\u9ad4\u5de5\u4f5c\u6d41\u7a0b",source:"@site/docs/techPost/2023/gitops-git-repo-structure.md",sourceDirName:"techPost/2023",slug:"/techPost/2023/gitops-repo-structure",permalink:"/docs/techPost/2023/gitops-repo-structure",draft:!1,tags:[{label:"Kubernetes",permalink:"/docs/tags/kubernetes"},{label:"DevOps",permalink:"/docs/tags/dev-ops"},{label:"GitOps",permalink:"/docs/tags/git-ops"}],version:"current",frontMatter:{slug:"gitops-repo-structure",title:"GitOps \u4e0b\u7684 Git Repo \u67b6\u69cb\u63a2\u8a0e",keywords:["Kubernetes","GitOps","DevOps"],date:"2023-09-05T01:03:21.000Z",authors:"hwchiu",tags:["Kubernetes","DevOps","GitOps"],description:"\u63a2\u8a0e GitOps \u6d41\u7a0b\u4e0b\uff0cGit repo \u6703\u53bb\u600e\u9ebc\u8a2d\u8a08\u4f86\u6539\u5584\u6574\u9ad4\u5de5\u4f5c\u6d41\u7a0b"},sidebar:"techPost",previous:{title:"2023",permalink:"/docs/category/2023"},next:{title:"Kubernetes 1.28 Sidecar Container \u521d\u9ad4\u9a57",permalink:"/docs/techPost/2023/k8s-sidecar"}},i={},m=[{value:"Vanilla YAML",id:"vanilla-yaml",level:2},{value:"Helm",id:"helm",level:2},{value:"Kustomize",id:"kustomize",level:2},{value:"Jsonnet",id:"jsonnet",level:2},{value:"Tools",id:"tools",level:2},{value:"Code/YAML in the Same Repo",id:"codeyaml-in-the-same-repo",level:2},{value:"Code/YAML in the Different Repo",id:"codeyaml-in-the-different-repo",level:2},{value:"Mixed",id:"mixed",level:2}],s={toc:m},u="wrapper";function k(e){let{components:t,...n}=e;return(0,a.kt)(u,(0,l.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"\u524d\u8a00"},"\u524d\u8a00"),(0,a.kt)("p",null,"\u96a8\u8005 GitOps \u7684\u65e5\u6f38\u666e\u53ca\uff0cArgoCD, Flux \u7b49\u89e3\u6c7a\u65b9\u6848\u5e6b\u52a9\u773e\u591a Kubernetes \u74b0\u5883\u89e3\u6c7a\u4e86 CD \u7684\u56f0\u5883\u8207\u6d41\u7a0b\u3002\n\u7136\u800c GitOps \u610f\u5473\u8457 Git + Ops\uff0c\u5176\u4e2d Git \u7684\u4f7f\u7528\u65b9\u5f0f\u5247\u6703\u4f9d\u74b0\u5883\u8207\u5718\u968a\u800c\u7570\u3002\n\u672c\u7bc7\u6587\u7ae0\u5617\u8a66\u6574\u7406\u5e7e\u7a2e\u53ef\u80fd\u7684\u4f7f\u7528\u65b9\u5f0f\uff0c\u5be6\u52d9\u4e0a\u4e26\u6c92\u6709\u4e00\u7a2e\u5b8c\u7f8e\u7684\u89e3\u6c7a\u65b9\u6848\uff0c\u9084\u662f\u8981\u591a\u6bd4\u8f03\u591a\u91d0\u6e05\u5718\u968a\u7684\u9700\u6c42\u8207\u80fd\u529b\uff0c\u6253\u9020\u51fa\u9069\u5408\u7684\u65b9\u5f0f\u70ba\u4e3b\u3002"),(0,a.kt)("h1",{id:"gitops-\u6311\u6230"},"GitOps \u6311\u6230"),(0,a.kt)("p",null,"\u82e5\u4ee5 GitOps \u4f86\u90e8\u7f72\u61c9\u7528\u7a0b\u5f0f\u5230 Kubernetes \u4e2d\uff0c\u4e0b\u5716\u5247\u662f\u4e00\u500b\u53ef\u80fd\u7684\u6d41\u7a0b\u5716"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://hackmd.io/_uploads/SJ5pMgMC2.png",alt:null})),(0,a.kt)("p",null,"\u6574\u500b\u6d41\u7a0b\u5305\u542b"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u61c9\u7528\u7a0b\u5f0f\u7684\u539f\u59cb\u78bc"),(0,a.kt)("li",{parentName:"ol"},"\u5bb9\u5668\u5316\u5f8c\u7684\u61c9\u7528\u7a0b\u5f0f"),(0,a.kt)("li",{parentName:"ol"},"\u5c07\u5bb9\u5668\u4fdd\u5b58\u65bc\u9060\u65b9\u7684\u5bb9\u5668\u5009\u5eab"),(0,a.kt)("li",{parentName:"ol"},"\u540c\u6642\u66f4\u65b0\u4ee5\u6e96\u5099\u6700\u65b0\u7684 K8s YAML"),(0,a.kt)("li",{parentName:"ol"},"GitOps \u900f\u904e Webhook \u6216\u662f Pulling \u6a5f\u5236\u77ad\u89e3 YAML \u6709\u66f4\u52d5"),(0,a.kt)("li",{parentName:"ol"},"\u5c07\u66f4\u52d5\u7d66\u66f4\u65b0\u5230\u76ee\u6a19 Kubernetes \u53e2\u96c6\u5167"),(0,a.kt)("li",{parentName:"ol"},"Kubernetes \u66f4\u65b0\u61c9\u7528\u7a0b\u5f0f\uff0c\u5230\u5bb9\u5668\u5009\u5eab\u6293\u53d6\u6700\u65b0\u7684\u61c9\u7528\u7a0b\u5f0f")),(0,a.kt)("p",null,"\u4e0a\u8ff0\u7684\u6d41\u7a0b\u770b\u8d77\u4f86\u76f4\u89c0\u4e14\u7c21\u55ae\uff0c\u4f46\u662f\u5be6\u4f5c\u8d77\u4f86\u5247\u6703\u6709\u5404\u7a2e\u4e0d\u540c\u7684\u8b8a\u5316\uff0c\u5176\u4e2d\u6709\u5e7e\u500b\u554f\u984c\u662f\u5e38\u5e38\u88ab\u63a2\u8a0e\u7684"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"K8S YAML \u8981\u7528\u54ea\u5957\u5de5\u5177\u4f86\u7dad\u8b77? Helm? Kustomize? Jsonnet?"),(0,a.kt)("li",{parentName:"ol"},"Source Code \u8207 K8s YAML \u7684\u6b78\u5c6c\uff0c\u5230\u5e95\u8981\u653e\u5230\u540c\u4e00\u500b Git Repo \u9084\u662f\u8981\u5206\u958b?"),(0,a.kt)("li",{parentName:"ol"},"Container \u7522\u751f\u65b0\u7248\u5f8c\uff0c\u66f4\u65b0 K8s YAML\u662f\u8ab0\u7684\u8cac\u4efb\uff1f\u662f\u61c9\u7528\u7a0b\u5f0f\u958b\u767c\u8005\u9084\u662f DevOps \u4eba\u54e1\uff1f")),(0,a.kt)("p",null,"\u63a5\u4e0b\u4f86\u5c31\u91dd\u5c0d\u9019\u4e09\u500b\u554f\u984c\u5206\u4eab\u4e00\u4e9b\u66fe\u7d93\u770b\u904e\u7684\u89e3\u6cd5\uff0c\u5c31\u5982\u540c\u524d\u8ff0\u6240\u8ff0\uff0c\u6c92\u6709\u4e00\u500b\u5b8c\u7f8e\u7684\u89e3\u6c7a\u65b9\u6848\uff0c\u6bcf\u500b\u5be6\u4f5c\u65b9\u5f0f\u80cc\u5f8c\u90fd\u6709\u88ab\u9078\u64c7\u7684\u7406\u7531\uff0c\u4e5f\u8a31\u662f\u56e0\u70ba\u5718\u968a\u5927\u5c0f\uff0c\u6642\u7a0b\u58d3\u529b..\u7b49\u5404\u7a2e\u56e0\u7d20\u3002"),(0,a.kt)("h1",{id:"k8s-manifest"},"K8s Manifest"),(0,a.kt)("p",null,"Kubernetes \u8cc7\u6e90\u63cf\u8ff0\u53ef\u4ee5\u57fa\u65bc YAML \u8207 JSON \u5169\u7a2e\u683c\u5f0f\uff0c\u800c\u666e\u904d\u4e3b\u6d41\u90fd\u662f\u57fa\u65bc YAML \u7684\u683c\u5f0f\u4f86\u9032\u884c\u63cf\u8ff0\uff0c"),(0,a.kt)("p",null,"\u5e95\u4e0b\u5e6b\u5927\u5bb6\u5feb\u901f\u56de\u61b6\u5e7e\u500b\u5e38\u898b\u7684\u5de5\u5177\uff0c\u5305\u542b"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Vanilla YAML"),(0,a.kt)("li",{parentName:"ol"},"Helm"),(0,a.kt)("li",{parentName:"ol"},"Kustomize"),(0,a.kt)("li",{parentName:"ol"},"Jsonnet")),(0,a.kt)("h2",{id:"vanilla-yaml"},"Vanilla YAML"),(0,a.kt)("p",null,"\u76f4\u63a5\u5c07\u6240\u6709 Kubernetes \u7269\u4ef6\u4ee5 YAML \u683c\u5f0f\u4f86\u63cf\u8ff0"),(0,a.kt)("p",null,"\u512a\u9ede:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u76f4\u89c0\uff0c\u9069\u5408\u521d\u5b78\u8005"),(0,a.kt)("li",{parentName:"ol"},"\u7121\u9700\u4efb\u4f55\u5de5\u5177\uff0c\u6e96\u5099 YAML \u6a94\u6848\u5c31\u53ef\u4ee5\u642d\u914d kubectl \u4f7f\u7528")),(0,a.kt)("p",null,"\u7f3a\u9ede:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u7f3a\u4e4f\u5f48\u6027\uff0c\u6709\u4efb\u4f55\u5ba2\u88fd\u5316\u9700\u6c42\u5c31\u9700\u8981\u7dad\u8b77\u591a\u4efd\u6a94\u6848"),(0,a.kt)("li",{parentName:"ol"},"\u6c92\u6709\u7248\u672c\u7684\u6982\u5ff5"),(0,a.kt)("li",{parentName:"ol"},"\u90e8\u7f72\u74b0\u5883\u6108\u591a\uff0c\u7dad\u8b77\u8207\u4f7f\u7528\u8d77\u4f86\u6108\u8907\u96dc\u8207\u9ebb\u7169")),(0,a.kt)("p",null,"\u56e0\u70ba\u4e0a\u8ff0\u539f\u56e0\uff0c\u5f88\u5c11\u5718\u968a\u6703\u76f4\u63a5\u4f7f\u7528\u9019\u7a2e\u65b9\u5f0f\u4f86\u7ba1\u7406\u8907\u96dc\u4e14\u591a\u74b0\u5883\u7684\u61c9\u7528\u7a0b\u5f0f\u3002\n\u4f46\u662f\u6709\u4e9b\u7b2c\u4e09\u65b9\u89e3\u6c7a\u65b9\u6848\u6703\u900f\u904e\u9019\u7a2e\u65b9\u5f0f\u4f86\u5b9a\u7fa9\u5176\u4f7f\u7528\uff0c\u539f\u56e0\u6709"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u4f7f\u7528\u5230\u7684 K8s \u7269\u4ef6\u5c11\uff0c\u4e0d\u8907\u96dc"),(0,a.kt)("li",{parentName:"ol"},"\u5c08\u6848\u66f4\u5c08\u6ce8\u65bc\u61c9\u7528\u7a0b\u5f0f\u958b\u767c\uff0c\u90e8\u7f72\u90e8\u5206\u5247\u7531\u958b\u767c\u8005\u81ea\u884c\u8655\u7406"),(0,a.kt)("li",{parentName:"ol"},"\u900f\u904e Git Branch \u7684\u65b9\u5f0f\u4f86\u7dad\u8b77\u4e0d\u540c\u7248\u672c\u7684\u5dee\u7570")),(0,a.kt)("p",null,"\u6b64\u7a2e\u65b9\u5f0f\u4e5f\u5f88\u9069\u5408\u521d\u5b78\u8005\u7528\u4f86\u5b78\u7fd2 K8s \u7684\u6982\u5ff5\u8207\u7df4\u7fd2\uff0c\u719f\u6089\u6982\u5ff5\u5f8c\u518d\u4f7f\u7528\u63a5\u4e0b\u4f86\u7684\u5de5\u5177\u53bb\u7ba1\u7406\u624d\u4e0d\u6703\u592a\u964c\u751f\u3002"),(0,a.kt)("p",null,"\u4ee5\u4e0b\u5716\u7e3d\u7d50\u4f86\u8aaa\uff0c\u6bcf\u500b\u74b0\u5883\u90fd\u9700\u8981\u7dad\u8b77\u4e00\u6574\u4efd\u8fd1\u4e4e\u4e00\u6a23\u7684\u4e00\u7fa4\u6a94\u6848\uff0c\u7dad\u8b77\u4e0a\u975e\u5e38\u56f0\u96e3\n",(0,a.kt)("img",{parentName:"p",src:"https://hackmd.io/_uploads/rJeI9bG0h.png",alt:null})),(0,a.kt)("h2",{id:"helm"},"Helm"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://helm.sh/"},"Helm")," \u53ef\u4ee5\u8aaa\u662f\u76ee\u524d Kubernetes \u61c9\u7528\u7a0b\u5f0f\u5b9a\u7fa9\u6700\u77e5\u540d\u7684\u5de5\u5177\u4e4b\u4e00\uff0c\u900f\u904e Helm Chart \u8207 Go Template \u7b49\u6a5f\u5236\u8b93\u4f60\u53ef\u4ee5\u66f4\u8f15\u9b06\u7684\u6839\u64da\u74b0\u5883\u5ba2\u88fd\u5316\u90e8\u7f72\u8cc7\u6e90\u3002"),(0,a.kt)("p",null,"\u512a\u9ede\uff1a"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u57fa\u65bc Go Template \u4f86\u52d5\u614b\u7522\u51fa\u6700\u5f8c\u7684 k8s \u8cc7\u6e90"),(0,a.kt)("li",{parentName:"ol"},"\u53ef\u6253\u5305\u6210\u4e00\u500b\u5bb9\u6613\u6563\u4f48\u8207\u5b89\u88dd\u7684\u683c\u5f0f\uff0c\u4e26\u4e14\u652f\u63f4\u7248\u672c\u63a7\u5236"),(0,a.kt)("li",{parentName:"ol"},"\u652f\u63f4 Dependency \u6982\u5ff5\uff0c\u53ef\u4ee5\u7d44\u5408\u51fa Umbrella Chart"),(0,a.kt)("li",{parentName:"ol"},"\u751f\u614b\u7cfb\u8c50\u5bcc\uff0c\u773e\u591a\u7b2c\u4e09\u65b9\u5c08\u6848\u90fd\u6709\u652f\u63f4 Helm Chart \u7684\u5b89\u88dd\uff0c\u56e0\u6b64\u5b78\u6703 Helm \u5c0d\u65bc\u4f7f\u7528\u9019\u4e9b\u5c08\u6848\u6703\u8f03\u5c11\u963b\u529b")),(0,a.kt)("p",null,"\u7f3a\u9ede:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u5b78\u7fd2\u66f2\u7dda\u504f\u9ad8\uff0cTemplate \u7684\u8a9e\u6cd5\u53ef\u80fd\u904e\u65bc\u8907\u96dc"),(0,a.kt)("li",{parentName:"ol"},"\u9700\u8981\u984d\u5916\u5b89\u88dd Helm \u6307\u4ee4\u4f7f\u7528"),(0,a.kt)("li",{parentName:"ol"},"\u6709\u53ef\u80fd\u9084\u9700\u8981\u984d\u5916\u7dad\u8b77 Helm Chart Server")),(0,a.kt)("p",null,"Helm \u7684\u7279\u6027\u4f7f\u5f97\u5718\u968a\u53ea\u9700\u8981\u91dd\u5c0d\u4e3b\u9ad4\u7dad\u8b77\u4e00\u4efd\u6a94\u6848\uff0c\u91dd\u5c0d\u4e0d\u540c\u7684\u90e8\u7f72\u74b0\u5883\u6e96\u5099\u76f8\u5c0d\u61c9\u7684 ",(0,a.kt)("strong",{parentName:"p"},"values.yaml")," \u5c31\u53ef\u4ee5\u52d5\u614b\u7684\u7522\u751f\u51fa\u7b26\u5408\u5404\u74b0\u5883\u9700\u6c42\u7684 K8s \u7269\u4ef6\uff0c\u6574\u500b\u6d41\u7a0b\u5982\u4e0b"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://hackmd.io/_uploads/r1IgWMzCh.png",alt:null})),(0,a.kt)("p",null,"Helm Chart \u672c\u8eab\u9664\u4e86\u672c\u5730\u76f4\u63a5\u8f09\u5165\u4f7f\u7528\u5916\uff0c\u4e5f\u53ef\u4ee5\u5c07\u5176\u6253\u5305\u4e26\u4e14\u767c\u4f48\u5230 Helm Chart \u4f3a\u670d\u5668 \u53bb\uff0c\u5176\u672c\u8cea\u57fa\u672c\u4e0a\u5c31\u662f\u4e00\u500b web \u4f3a\u670d\u5668\uff0c\u76ee\u524d\u7a0d\u5fae\u6709\u4e9b\u898f\u6a21\u7684\u958b\u6e90\u5c08\u6848\u4e5f\u90fd\u6703\u900f\u904e\u9019\u7a2e\u65b9\u5f0f\u4f86\u767c\u5e03\u81ea\u5df1\u5c08\u6848\u7684 Helm Chart\uff0c\u56e0\u6b64\u4f7f\u7528\u8005\u5c31\u53ef\u4ee5\u5f88\u8f15\u6613\u5730\u9078\u64c7\u6240\u9700\u8981\u7684\u7248\u672c\u4e26\u4e14\u642d\u914d values.yaml \u4f86\u5ba2\u88fd\u5316\uff0c\u6574\u500b\u6d41\u7a0b\u985e\u4f3c\u4e0b\u5716"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://hackmd.io/_uploads/Bkp5WzMRh.png",alt:null})),(0,a.kt)("p",null,"\u6b64\u5916\uff0c\u6709\u4e9b\u5718\u968a\u6240\u958b\u767c\u4e14\u4ea4\u4ed8\u7684\u4e0d\u55ae\u7d14\u53ea\u662f\u4e00\u500b\u61c9\u7528\u7a0b\u5f0f\uff0c\u800c\u662f\u4e00\u500b\u7531\u773e\u591a\u61c9\u7528\u7a0b\u5f0f\u6240\u7d44\u5408\u800c\u6210\u7684\u670d\u52d9\uff0c\u9019\u7a2e\u9700\u6c42\u4e0b\u6703\u63a1\u7528 Umbrella Chart \u7684\u65b9\u5f0f\uff0c\u5176\u6982\u5ff5\u975e\u5e38\u7c21\u55ae"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u4ea4\u4ed8\u8207\u90e8\u7f72\u7684\u4e0d\u662f\u4e00\u500b\u61c9\u7528\u7a0b\u5f0f\uff0c\u800c\u662f\u4e00\u500b\u5b8c\u6574\u7684\u670d\u52d9"),(0,a.kt)("li",{parentName:"ol"},"\u8a72 Umbrella Helm Chart \u5be6\u52d9\u4e0a\u6703\u4f9d\u8cf4\u8a31\u591a\u66f4\u591a Helm Chart"),(0,a.kt)("li",{parentName:"ol"},"\u90e8\u7f72\u8a72 Helm Chart \u6703\u4e00\u4f75\u628a\u6240\u6709\u88ab\u4f9d\u8cf4\u7684 Helm Chart \u4e00\u4f75\u90e8\u7f72"),(0,a.kt)("li",{parentName:"ol"},"Umbrella Helm Chart \u7684 Values.yaml \u6703\u9f90\u5927\u4e14\u8907\u96dc\uff0c\u53ef\u4ee5\u52d5\u614b\u6c7a\u5b9a\u54ea\u4e9b\u4f9d\u8cf4\u9700\u8981\u5b89\u88dd\uff0c\u540c\u6642\u4e5f\u53ef\u4ee5\u5c07\u8a2d\u5b9a\u4e4b\u53c3\u6578\u7d66\u50b3\u905e\u904e\u53bb")),(0,a.kt)("p",null,"\u7bc4\u4f8b\u5982\u4e0b\u5716\uff0c\u6574\u500b\u74b0\u5883\u4e2d\u6709 ",(0,a.kt)("inlineCode",{parentName:"p"},"5")," \u500b Helm Chart\uff0c\u5176\u4e2d\u6709\u4e00\u500b\u4e3b\u8981\u7684 Helm Chart \u6703\u900f\u904e ",(0,a.kt)("a",{parentName:"p",href:"https://helm.sh/docs/helm/helm_dependency/"},"helm dependency")," \u4f86\u9023\u7d50 Helm Chart{A/B/C/D}\u3002\n\u4f7f\u7528\u8005\u53ea\u9700\u8981\u6e96\u5099\u4e00\u500b Values.yaml \u4e26\u4e14\u90e8\u7f72\u8a72 Umbrella Chart \u5373\u53ef\u9806\u5229\u7684\u628a\u6574\u5957\u670d\uff0c\u56db\u500b Helm Chart \u90fd\u4e00\u4f75\u90e8\u7f72\u5230\u76ee\u6a19\u53e2\u96c6\u5167\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://hackmd.io/_uploads/B1nj-MGRn.png",alt:null})),(0,a.kt)("h2",{id:"kustomize"},"Kustomize"),(0,a.kt)("p",null,"\u4e0d\u540c\u65bc Helm \u4f7f\u7528 Template \u7684\u65b9\u5f0f\uff0c",(0,a.kt)("a",{parentName:"p",href:"https://kustomize.io/"},"Kustomize")," \u63d0\u4f9b\u66f4\u70ba\u7c21\u55ae\u8207\u4e7e\u6de8\u7684\u65b9\u5f0f\u4f86\u9054\u5230\u5ba2\u88fd\u5316 Kubernetes \u8cc7\u6e90\u7269\u4ef6\uff0c\u6240\u6709\u6a94\u6848\u90fd\u6703\u7dad\u6301 K8s \u539f\u751f\u7684\u683c\u5f0f\uff0c\u900f\u904e Patch \u7b49\u758a\u52a0\u7684\u6982\u5ff5\u4f86\u52d5\u614b\u4fee\u6539\u8cc7\u6e90\u5167\u5bb9\u3002"),(0,a.kt)("p",null,"\u512a\u9ede\uff1a"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u57fa\u65bc\u539f\u751f YAML \u683c\u5f0f\uff0c\u6c92\u6709\u4efb\u4f55 Template \u7b49\u8a9e\u6cd5\u8981\u5b78\u7fd2"),(0,a.kt)("li",{parentName:"ol"},"\u5df2\u7d93\u6574\u5408\u81f3 kubectl \u4e2d\uff0c\u53ef\u4ee5\u4e0d\u9700\u8981\u5b89\u88dd\u984d\u5916\u6307\u4ee4"),(0,a.kt)("li",{parentName:"ol"},"\u900f\u904e\u758a\u52a0\u8207\u8986\u84cb\u7684\u65b9\u5f0f\u4f86")),(0,a.kt)("p",null,"\u7f3a\u9ede\uff1a"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u751f\u614b\u6027\u4e0d\u5982 Helm \u8c50\u5bcc"),(0,a.kt)("li",{parentName:"ol"},"\u6c92\u6709\u7248\u672c\u6982\u5ff5\uff0c\u4e0d\u65b9\u4fbf\u6563\u4f48\u7d66\u4e0d\u540c\u4f7f\u7528\u8005\u8207\u5ba2\u6236"),(0,a.kt)("li",{parentName:"ol"},"\u96d6\u7136\u6c92\u6709 Template\uff0c\u4f46\u662f\u6574\u9ad4\u67b6\u69cb\u8207\u4f7f\u7528\u65b9\u5f0f\u9084\u662f\u9700\u8981\u5b78\u7fd2")),(0,a.kt)("p",null,"\u4ee5\u4e0b\u4f8b\u7bc4\u4f8b\u4f86\u8aaa\uff0c\u6211\u5011\u6703\u65bc base \u8cc7\u6599\u593e\u5167\u6e96\u5099\u6211\u5011\u61c9\u7528\u7a0b\u5f0f\u7684\u57fa\u672c\u7269\u4ef6\uff0c\u63a5\u8005\u6bcf\u500b\u74b0\u5883\u8cc7\u6599\u593e\u5167\u5247\u6703\u6e96\u5099\u60f3\u8981\u5ba2\u88fd\u5316\u7684\u5167\u5bb9\uff0c\u6700\u5f8c\u9019\u4e00\u5207\u90fd\u6703\u4f9d\u7167 kustomization.yaml \u7684\u5167\u5bb9\u5168\u90e8\u4e32\u9023\u8d77\u4f86\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://hackmd.io/_uploads/BkeMnXMR2.png",alt:null})),(0,a.kt)("p",null,"\u904e\u5f80\u9700\u8981\u4f7f\u7528 ",(0,a.kt)("strong",{parentName:"p"},"kustomize")," \u9019\u500b\u6307\u4ee4\uff0c\u73fe\u5728\u5df2\u7d93\u6574\u5408\u5230 kubectl \u4e2d\uff0c\u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 ",(0,a.kt)("strong",{parentName:"p"},"kubectl apply -k")," \u7684\u65b9\u5f0f\u4f86\u64cd\u4f5c\u57fa\u65bc kustomize \u7684\u90e8\u7f72\u683c\u5f0f\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://hackmd.io/_uploads/H1b-CQMRn.png",alt:null})),(0,a.kt)("h2",{id:"jsonnet"},"Jsonnet"),(0,a.kt)("p",null,"Jsonnet \u5247\u662f\u4e00\u7a2e\u57fa\u65bc JSON \u683c\u5f0f\u7684\u7a0b\u5f0f\u8a9e\u8a00\uff0c\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u662f\u57fa\u65bc JSON \u4e26\u4e14\u6700\u5f8c\u8f38\u51fa\u4e5f\u662f JSON \u683c\u5f0f\uff0c\u800c\u524d\u9762\u4e5f\u6709\u63d0\u5230 Kubernetes \u4e5f\u63a5\u53d7\u57fa\u65bc JSON \u683c\u5f0f\u4f86\u63cf\u8ff0\u6240\u6709\u8cc7\u6e90\u72c0\u6cc1\uff0c\u56e0\u6b64\u4e5f\u6709\u90e8\u5206\u4eba\u6703\u63a1\u7528\u9019\u7a2e\u65b9\u5f0f\u4f86\u7dad\u8b77 K8s \u61c9\u7528\u7a0b\u5f0f\u3002"),(0,a.kt)("p",null,"\u7c21\u55ae\u4f86\u8aaa\uff0c\u5c31\u662f\u5229\u7528\u7a0b\u5f0f\u8a9e\u8a00\u64b0\u5beb\u7684\u7fd2\u6027\u4f86\u7522\u751f K8s \u7684\u7269\u4ef6\u63cf\u8ff0\u6a94\u6848"),(0,a.kt)("p",null,"\u512a\u9ede"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u652f\u63f4 if/else, \u8ff4\u5708, function \u7b49\u7a0b\u5f0f\u8a9e\u8a00\u5e38\u898b\u7684\u908f\u8f2f"),(0,a.kt)("li",{parentName:"ol"},"\u652f\u63f4 library \u7684\u6982\u5ff5\u6e1b\u5c11\u91cd\u8907\u64b0\u5beb\u7a0b\u5f0f\u78bc")),(0,a.kt)("p",null,"\u7f3a\u9ede:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u8981\u5b78\u7fd2\u5168\u65b0\u5de5\u5177 jsonnet"),(0,a.kt)("li",{parentName:"ol"},"\u6587\u4ef6\u8207\u751f\u614b\u6027\u4e0d\u5920\u8c50\u5bcc")),(0,a.kt)("p",null,"Jsonnet \u672c\u8eab\u662f\u91dd\u5c0d Json \u7269\u4ef6\u64cd\u4f5c\uff0c\u800c ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/jsonnet-libs/k8s"},"jsonnet k8s"),"\u8207 ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/jsonnet-libs/k8s-libsonnet"},"k8s-libsonnet")," \u5247\u662f\u5be6\u4f5c\u5404\u7a2e\u4ecb\u9762\u8b93\u4f60\u53ef\u4ee5\u5feb\u901f\u7522\u751f\u9069\u5408\u5404\u7a2e\u7248\u672c Kubernetes \u7684\u7269\u4ef6\u8cc7\u6e90\u3002"),(0,a.kt)("p",null,"\u8209\u4f8b\u4f86\u8aaa\uff0c\u4e0b\u5217\u7684\u8a9e\u6cd5\u6700\u5f8c\u53ef\u4ee5\u7522\u751f\u51fa\u4e00\u500b k8s deployment + service \u7684\u7269\u4ef6\uff0c\u9019\u4e9b\u6a94\u6848\u90fd\u53ef\u4ee5\u88ab\u91cd\u8907\u5229\u7528\uff0c\u9084\u53ef\u4ee5\u88ab\u52d5\u614b\u8986\u84cb\uff0c\u6574\u9ad4\u4f86\u8aaa\u5f48\u6027\u975e\u5e38\u9ad8"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsonnet="},'local k = import "vendor/1.27/main.libsonnet";\n\nlocal s= {\n  name: "demo",\n};\n\n[\n   k.apps.v1.deployment.new(name="demo", containers=[\n     k.core.v1.container.new(name="demo", image="hwchiu/netutils")\n   ]),\n   k.core.v1.service.new("demo", s, 5000)\n]\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell="},'azureuser@course:~/jsonnet$ jsonnet --yaml-stream main.jsonnet\n---\n{\n   "apiVersion": "apps/v1",\n   "kind": "Deployment",\n   "metadata": {\n      "name": "demo"\n   },\n   "spec": {\n      "replicas": 1,\n      "selector": {\n         "matchLabels": {\n            "name": "demo"\n         }\n      },\n      "template": {\n         "metadata": {\n            "labels": {\n               "name": "demo"\n            }\n         },\n         "spec": {\n            "containers": [\n               {\n                  "image": "hwchiu/netutils",\n                  "name": "demo"\n               }\n            ]\n         }\n      }\n   }\n}\n---\n{\n   "apiVersion": "v1",\n   "kind": "Service",\n   "metadata": {\n      "name": "demo"\n   },\n   "spec": {\n      "ports": [\n         5000\n      ],\n      "selector": {\n         "name": "demo"\n      }\n   }\n}\n')),(0,a.kt)("p",null,"\u6574\u500b\u6d41\u7a0b\u5927\u81f4\u4e0a\u5982\u4e0b\uff0c\u64b0\u5beb\u5404\u7a2e jsonnet \u7684\u6a94\u6848\uff0c\u6700\u5f8c\u900f\u904e jsonnet \u6307\u4ee4\u7522\u751f\u51fa\u7b26\u5408 K8s \u9700\u6c42\u7684\u6a94\u6848\uff0c\u63a5\u8005\u4f7f\u7528 kubectl \u6307\u4ee4\u5c07\u5176 Apply \u5230\u76ee\u6a19\u53e2\u96c6\u3002\n",(0,a.kt)("img",{parentName:"p",src:"https://hackmd.io/_uploads/SJ8YamGC3.png",alt:null})),(0,a.kt)("h2",{id:"tools"},"Tools"),(0,a.kt)("p",null,"\u4e0a\u8ff0\u56db\u7a2e\u5de5\u5177\u6c92\u6709\u7d55\u5c0d\u7684\u597d\u58de\u4e14 ArgoCD \u90fd\u652f\u63f4\uff0c\u6240\u4ee5\u53ea\u8981\u5176\u7279\u6027\u8207\u512a\u7f3a\u9ede\u7b26\u5408\u5718\u968a\u6240\u9700\uff0c\u4e8b\u5be6\u4e0a\u90fd\u53ef\u4ee5\u5617\u8a66\u4f7f\u7528\u3002"),(0,a.kt)("p",null,"\u5be6\u52d9\u4e0a\u66f4\u591a\u53ef\u80fd\u6982\u5ff5\u5247\u662f\u6df7\u7528\uff0c\u7562\u7adf\u73fe\u5728\u592a\u591a\u958b\u6e90\u5c08\u6848\u90fd\u662f\u57fa\u65bc Helm \u53bb\u767c\u5e03\uff0c\u800c\u5718\u968a\u53ef\u80fd\u63a1\u7528 Kustomize/Jsonnet \u7684\u65b9\u5f0f\u4f86\u7ba1\u7406\u81ea\u5df1\u7684\u61c9\u7528\u7a0b\u5f0f\uff0c\u6240\u4ee5\u5be6\u969b\u4e0a\u9019\u4e9b\u4e0d\u540c\u65b9\u5f0f\u53ef\u80fd\u6703\u540c\u6642\u5b58\u5728\uff0c\u53cd\u6b63 ArgoCD \u90fd\u652f\u63f4\u90fd\u53ef\u4ee5\u90e8\u7f72\uff0c\u552f\u4e00\u7684\u554f\u984c\u5247\u662f\u4f7f\u7528\u8005\u8981\u6709\u76f8\u95dc\u7684\u80cc\u666f\u77e5\u8b58\u4f86\u4f7f\u7528\uff0c\u9664\u932f\u8207\u8a2d\u5b9a\u3002"),(0,a.kt)("h1",{id:"git-repo"},"Git Repo"),(0,a.kt)("p",null,"\u5f9e Source Code \u8207 K8s Manifest \u7684\u89d2\u5ea6\u4f86\u770b\uff0c\u5e38\u898b\u6709\u5169\u7a2e\u9078\u64c7"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u6bcf\u4e00\u500b\u61c9\u7528\u7a0b\u5f0f\u6709\u4e00\u500b\u5c08\u5c6c\u7684 Git Repo\uff0c\u542b\u6709\u8a72\u61c9\u7528\u7a0b\u5f0f\u7684 Source Code , Dockerfile \u4ee5\u53ca K8s \u76f8\u95dc\u7269\u4ef6\u6a94\u6848"),(0,a.kt)("li",{parentName:"ol"},"\u6bcf\u4e00\u500b\u61c9\u7528\u7a0b\u5f0f\u6709\u4e00\u500b\u5c08\u5c6c\u7684 Git Repo\uff0c\u542b\u6709\u8a72\u61c9\u7528\u7a0b\u5f0f\u7684 Source Code \u8207 Dockerfile\u3002\u53e6\u5916\u6703\u6709\u4e00\u500b\u5c08\u5c6c\u7684 Git Repo \u5305\u542b\u6240\u6709\u61c9\u7528\u7a0b\u5f0f\u6240\u9700\u8981\u7684 K8s \u7269\u4ef6\u6a94\u6848\u3002")),(0,a.kt)("h2",{id:"codeyaml-in-the-same-repo"},"Code/YAML in the Same Repo"),(0,a.kt)("p",null,"\u7b2c\u4e00\u7a2e\u6982\u5ff5\u5982\u4e0b\n",(0,a.kt)("img",{parentName:"p",src:"https://hackmd.io/_uploads/S1dSh4zRh.png",alt:null})),(0,a.kt)("p",null,"\u9019\u7a2e\u6a21\u5f0f\u4e0b\u7684\u7279\u6027\u6709"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u5f9e\u61c9\u7528\u7a0b\u5f0f\u958b\u767c\u5230 K8s \u7684\u90e8\u7f72\u6240\u6709\u8cc7\u6e90\u90fd\u653e\u4e00\u8d77\uff0c\u5bb9\u6613\u67e5\u95b1\u5f7c\u6b64\u95dc\u806f"),(0,a.kt)("li",{parentName:"ol"},"\u5982\u679c\u61c9\u7528\u7a0b\u5f0f\u6709\u4efb\u4f55\u9700\u6c42\u4fee\u6539\uff0c\u53ef\u4ee5\u9023\u90e8\u7f72 YAML \u4e00\u8d77\u4fee\u6539\uff0c\u8b6c\u5982\u65b0\u589e\u67d0\u500b\u74b0\u5883\u8b8a\u6578\u7684\u8b80\u53d6\u3002"),(0,a.kt)("li",{parentName:"ol"},"CI/CD Pipeline \u53ef\u8655\u7406\u6240\u6709\u4e8b\u60c5\uff0c\u751a\u81f3\u53ef\u4ee5\u642d\u914d KIND \u7b49\u67b6\u69cb\u4f86\u6e2c\u8a66 K8s \u90e8\u7f72"),(0,a.kt)("li",{parentName:"ol"},"\u5982\u679c\u63a1\u7528 Helm Chart \u7684\u8a71\uff0c\u53ef\u65bc CI/CD pipeline \u6d41\u7a0b\u4e2d\u4e00\u8d77\u6253\u5305\u4e26\u4e14\u767c\u5e03"),(0,a.kt)("li",{parentName:"ol"},"\u5982\u679c\u8981\u63a1\u7528 jsonnet/kustomize \u7684\u65b9\u5f0f\u4f86\u8655\u7406\uff0c\u5247\u8de8\u61c9\u7528\u5171\u4eab\u7684\u6a94\u6848\u5c31\u4e0d\u65b9\u4fbf\u8655\u7406"),(0,a.kt)("li",{parentName:"ol"},"\u53ef\u900f\u904e Git branch/tag \u7684\u65b9\u5f0f\u4f86\u63a7\u5236\u7248\u672c"),(0,a.kt)("li",{parentName:"ol"},"\u7dad\u904b\u4eba\u54e1\u5f88\u96e3\u8f15\u9b06\u7684\u77ad\u89e3\u5230\u7cfb\u7d71\u4e0a\u5168\u9762\u4f7f\u7528\u7684\u90e8\u7f72\u65b9\u5f0f\u8207\u5167\u5bb9\uff0c\u5fc5\u9808\u8981\u6bcf\u500b Git repo \u9010\u6b65\u67e5\u627e")),(0,a.kt)("p",null,"\u6b64\u5916\uff0c\u63a1\u7528\u9019\u7a2e\u6a21\u578b\u4e5f\u5f88\u5e38\u9762\u5c0d\u5982\u4f55\u8655\u7406 image tag \u7684\u554f\u984c\n\u8209\u4f8b\u4f86\u8aaa"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u958b\u767c\u8005\u958b\u555f\u4e00\u500b PR \u52a0\u5165\u65b0\u529f\u80fd"),(0,a.kt)("li",{parentName:"ol"},"\u7531\u65bc\u4f7f\u7528\u8005\u4e26\u4e0d\u77e5\u9053\u6700\u5f8c\u7522\u751f\u7684 container image tag\uff0c\u56e0\u6b64\u7121\u6cd5\u540c\u6642\u66f4\u65b0 K8s YAML \u6a94\u6848")),(0,a.kt)("p",null,"\u5e38\u898b\u7684\u89e3\u6cd5\u5305\u542b"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u6c38\u9060\u90fd\u4f7f\u7528 latest tag \u4f86\u90e8\u7f72\u61c9\u7528\u7a0b\u5f0f"),(0,a.kt)("li",{parentName:"ol"},"\u958b\u555f\u7b2c\u4e8c\u500b PR \u4f86\u66f4\u65b0"),(0,a.kt)("li",{parentName:"ol"},"\u5275\u5efa\u4e00\u500b GitHub App \u4f86\u52d5\u614b\u66f4\u65b0 PR \u5167\u5bb9")),(0,a.kt)("p",null,"\u56e0\u6b64\u6d41\u7a0b\u5be6\u4f5c\u4e0a\u9084\u662f\u6709\u5f88\u591a\u7d30\u7bc0\u9700\u8981\u8003\u616e\u8207\u63a2\u8a0e\uff0c\u4e26\u6c92\u6709\u60f3\u50cf\u4e2d\u7684\u9019\u9ebc\u5b8c\u7f8e\u7c21\u55ae\u3002"),(0,a.kt)("h2",{id:"codeyaml-in-the-different-repo"},"Code/YAML in the Different Repo"),(0,a.kt)("p",null,"\u66f4\u591a\u5e38\u898b\u7684\u4f5c\u6cd5\u5247\u662f\u7b2c\u4e8c\u7a2e\uff0c\u6b0a\u8cac\u5206\u96e2\uff0c\u8b93\u958b\u767c\u4eba\u54e1\u5c08\u5fc3\u8655\u7406\u81ea\u5df1\u61c9\u7528\u7a0b\u5f0f\u7684\u958b\u767c\u8207\u5bb9\u5668\u5316\uff0c\u800c\u6e96\u5099\u4e00\u500b\u5c08\u5c6c\u7684 Git Repo \u4f86\u8655\u7406\u6240\u6709 GitOps \u7684\u7ba1\u7406\u8207\u90e8\u7f72"),(0,a.kt)("p",null,"\u57fa\u672c\u6982\u5ff5\u5982\u4e0b\u5716\n",(0,a.kt)("img",{parentName:"p",src:"https://hackmd.io/_uploads/HJAZ6IX02.png",alt:null})),(0,a.kt)("p",null,"\u9019\u7a2e\u67b6\u69cb\u4e0a\u5e38\u898b\u7684\u7279\u6027\u6709"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u6240\u6709\u90e8\u7f72\u7269\u4ef6\u90fd\u653e\u4e00\u8d77\uff0c\u5bb9\u6613\u67e5\u95b1\u5feb\u901f\u7406\u89e3\u6240\u6709\u90e8\u7f72\u7684\u5dee\u7570\u6027"),(0,a.kt)("li",{parentName:"ol"},"\u8207\u61c9\u7528\u7a0b\u5f0f\u7684\u958b\u767c\u5206\u96e2\uff0c\u66f4\u65b9\u4fbf\u8b93\u958b\u767c\u4eba\u54e1\u8207\u7dad\u904b\u4eba\u54e1\u5206\u5225\u8655\u7406"),(0,a.kt)("li",{parentName:"ol"},"\u82e5\u61c9\u7528\u7a0b\u5f0f\u65b0\u7248\u672c\u6709\u4efb\u4f55\u529f\u80fd\u589e\u6e1b\u9700\u8981 YAML \u914d\u5408\uff0c\u9700\u8981\u5230\u6b64 Repo \u984d\u5916\u8655\u7406\uff0c\u4e0d\u80fd\u4e00\u6b21\u641e\u5b9a"),(0,a.kt)("li",{parentName:"ol"},"\u7531\u65bc\u74b0\u5883\u90fd\u653e\u4e00\u8d77\uff0ckustomize/jsonnet \u7b49\u6982\u5ff5\u5c31\u76f8\u5c0d\u5bb9\u6613\u5171\u4eab"),(0,a.kt)("li",{parentName:"ol"},"\u53ef\u900f\u904e Branch/Folder \u7b49\u65b9\u5f0f\u4f86\u5340\u5206\u4e0d\u540c\u74b0\u5883\u7684\u90e8\u7f72\u8cc7\u6e90"),(0,a.kt)("li",{parentName:"ol"},"\u53ef\u6709\u5c08\u5c6c\u7684 CI/CD Pipeline \u4f86\u9a57\u8b49\u6574\u9ad4\u670d\u52d9\u7684\u90e8\u7f72\uff0c\u800c\u975e\u55ae\u4e00\u61c9\u7528\u7a0b\u5f0f")),(0,a.kt)("p",null,"\u4ee5 Kustomize \u6216 Jsonnet \u70ba\u57fa\u5e95\u7684\uff0c\u5f88\u5e38\u770b\u5230\u4e0b\u5217\u7684\u8cc7\u6599\u7d50\u69cb\uff0c\u900f\u904e\u8cc7\u6599\u593e\u4f86\u5340\u5206\u4e0d\u540c\u74b0\u5883\u7684\u90e8\u7f72\uff0c\u82e5\u6709\u7279\u5225\u7684\u9700\u6c42\u9084\u53ef\u4ee5\u642d\u914d Git tag \u7684\u65b9\u5f0f\u4f86\u5b9a\u7248\uff0c\u4ee5\u4fbf\u672a\u4f86\u9700\u8981\u8ffd\u8e64\u67d0\u500b\u7248\u672c\u90e8\u7f72\u7684\u5167\u5bb9\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"\u251c\u2500\u2500 base\n\u2502\xa0\xa0 \u251c\u2500\u2500 foo\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 deployment.yaml\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 kustomization.yaml\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 service.yaml\n\u2502\xa0\xa0 \u2514\u2500\u2500 foo2\n\u2502\xa0\xa0     \u251c\u2500\u2500 deployment.yaml\n\u2502\xa0\xa0     \u251c\u2500\u2500 kustomization.yaml\n\u2502\xa0\xa0     \u2514\u2500\u2500 service.yaml\n\u2514\u2500\u2500 overlays\n    \u251c\u2500\u2500 dev\n    \u2502\xa0\xa0 \u251c\u2500\u2500 foo\n    \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 kustomization.yaml\n    \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 resource.yaml\n    \u2502\xa0\xa0 \u2514\u2500\u2500 foo2\n    \u2502\xa0\xa0     \u251c\u2500\u2500 kustomization.yaml\n    \u2502\xa0\xa0     \u2514\u2500\u2500 resource.yaml\n    \u2514\u2500\u2500 prod\n        \u251c\u2500\u2500 foo\n        \u2502\xa0\xa0 \u251c\u2500\u2500 kustomization.yaml\n        \u2502\xa0\xa0 \u2514\u2500\u2500 resource.yaml\n        \u2514\u2500\u2500 foo2\n            \u251c\u2500\u2500 kustomization.yaml\n            \u2514\u2500\u2500 resource.yaml\n")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"\u251c\u2500\u2500 base\n\u2502\xa0\xa0 \u251c\u2500\u2500 app\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 foo\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 app.jsonnet\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 foo2\n\u2502\xa0\xa0 \u2502\xa0\xa0     \u2514\u2500\u2500 app.jsonnet\n\u2502\xa0\xa0 \u2514\u2500\u2500 component\n\u2502\xa0\xa0     \u251c\u2500\u2500 deployment.jsonnet\n\u2502\xa0\xa0     \u2514\u2500\u2500 service.jsonnet\n\u2514\u2500\u2500 env\n    \u251c\u2500\u2500 production\n    \u2502\xa0\xa0 \u251c\u2500\u2500 foo\n    \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 env.jsonnet\n    \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 main.jsonnet\n    \u2502\xa0\xa0 \u2514\u2500\u2500 foo2\n    \u2502\xa0\xa0     \u251c\u2500\u2500 env.jsonnet\n    \u2502\xa0\xa0     \u2514\u2500\u2500 main.jsonnet\n    \u2514\u2500\u2500 staging\n        \u251c\u2500\u2500 foo\n        \u2502\xa0\xa0 \u251c\u2500\u2500 env.jsonnet\n        \u2502\xa0\xa0 \u2514\u2500\u2500 main.jsonnet\n        \u2514\u2500\u2500 foo2\n            \u251c\u2500\u2500 env.jsonnet\n            \u2514\u2500\u2500 main.jsonnet\n\n")),(0,a.kt)("p",null,"\u6b64\u5916\uff0c\u7531\u65bc ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/kubernetes-sigs/kustomize/blob/master/examples/chart.md"},"Kustomize")," \u76ee\u524d\u4e5f\u652f\u63f4\u4f7f\u7528 Helm Chart \u4f86\u90e8\u7f72\uff0c\u6240\u4ee5\u4e5f\u6709\u53ef\u80fd\u6703\u770b\u5230\u5982\u4e0b\u5217\u7684\u8b8a\u5316\u884c\uff0c\u5c07 Kustomize \u8207 Helm \u7d66\u7d44\u5408\u4e00\u540c\u4f7f\u7528\u3002"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"\u251c\u2500\u2500 base\n\u2502\xa0\xa0 \u251c\u2500\u2500 foo\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 deployment.yaml\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 kustomization.yaml\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 service.yaml\n\u2502\xa0\xa0 \u2514\u2500\u2500 foo2\n\u2502\xa0\xa0     \u251c\u2500\u2500 deployment.yaml\n\u2502\xa0\xa0     \u251c\u2500\u2500 kustomization.yaml\n\u2502\xa0\xa0     \u2514\u2500\u2500 service.yaml\n\u251c\u2500\u2500 helm\n\u2502\xa0\xa0 \u2514\u2500\u2500 app\n\u2502\xa0\xa0     \u251c\u2500\u2500 charts\n\u2502\xa0\xa0     \u251c\u2500\u2500 Chart.yaml\n\u2502\xa0\xa0     \u251c\u2500\u2500 templates\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u251c\u2500\u2500 deployment.yaml\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u251c\u2500\u2500 _helpers.tpl\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u251c\u2500\u2500 hpa.yaml\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u251c\u2500\u2500 ingress.yaml\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u251c\u2500\u2500 NOTES.txt\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u251c\u2500\u2500 serviceaccount.yaml\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u251c\u2500\u2500 service.yaml\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u2514\u2500\u2500 tests\n\u2502\xa0\xa0     \u2502\xa0\xa0     \u2514\u2500\u2500 test-connection.yaml\n\u2502\xa0\xa0     \u2514\u2500\u2500 values.yaml\n\u2514\u2500\u2500 overlays\n    \u251c\u2500\u2500 dev\n    \u2502\xa0\xa0 \u251c\u2500\u2500 foo\n    \u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 kustomization.yaml\n    \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 resource.yaml\n    \u2502\xa0\xa0 \u2514\u2500\u2500 foo2\n    \u2502\xa0\xa0     \u251c\u2500\u2500 kustomization.yaml\n    \u2502\xa0\xa0     \u2514\u2500\u2500 resource.yaml\n    \u2514\u2500\u2500 prod\n        \u251c\u2500\u2500 foo\n        \u2502\xa0\xa0 \u251c\u2500\u2500 kustomization.yaml\n        \u2502\xa0\xa0 \u2514\u2500\u2500 resource.yaml\n        \u2514\u2500\u2500 foo2\n            \u251c\u2500\u2500 kustomization.yaml\n            \u2514\u2500\u2500 resource.yaml\n")),(0,a.kt)("h2",{id:"mixed"},"Mixed"),(0,a.kt)("p",null,"\u7531\u65bc Helm Chart \u672c\u8eab\u53ef\u4ee5\u6253\u5305\u4e26\u4e14\u63a8\u5411 Helm Chart Server\uff0c\u56e0\u6b64\u63a1\u7528 Helm Chart \u7684\u65b9\u5f0f\u66f4\u53ef\u80fd\u770b\u5230\u5169\u8005\u7d50\u5408\u7684\u7d50\u679c\uff0c\u5982\u4e0b\u5716\u3002"),(0,a.kt)("p",null,(0,a.kt)("img",{parentName:"p",src:"https://hackmd.io/_uploads/Hy1j0VfAn.png",alt:null})),(0,a.kt)("p",null,"\u9019\u7a2e\u60c5\u6cc1\u4e0b\u7684\u7279\u6027\u6709"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u61c9\u7528\u7a0b\u5f0f Repo \u53ea\u5c08\u5fc3\u7dad\u8b77 Helm Chart \u7684\u767c\u4f48\u8207\u8a2d\u5b9a"),(0,a.kt)("li",{parentName:"ol"},"\u61c9\u7528\u7a0b\u5f0f Repo \u6703\u900f\u904e CI/CD \u4f86\u6253\u5305 Helm Chart \u4e26\u4e14\u63a8\u5411\u5230 Helm Chart Server"),(0,a.kt)("li",{parentName:"ol"},"K8s YAML Repo \u5167\u5247\u900f\u904e Helm Chart \u6307\u5411\u9060\u65b9\u7684 Helm Chart Server \u4f86\u6293\u53d6\u5efa\u7f6e\u597d\u7684\u6a94\u6848\uff0c\u4e26\u4e14\u642d\u914d\u4e0d\u540c\u7684 values \u4f86\u90e8\u7f72\u5230\u4e0d\u540c\u74b0\u5883"),(0,a.kt)("li",{parentName:"ol"},"\u4fdd\u7559\u5206\u96e2 Repo \u7684\u7279\u6027\uff0c\u8077\u6b0a\u5206\u96e2\uff0c\u5404\u81ea\u6709\u5404\u81ea\u7684 Git \u6d41\u7a0b\u4f86\u7ba1\u7406")),(0,a.kt)("p",null,"\u7531\u65bc\u8a72\u67b6\u69cb\u901a\u5e38\u9700\u8981\u4e00\u500b\u984d\u5916\u7684 Helm Chart Server\uff0c\u9019\u90e8\u5206\u56e0\u70ba Helm Chart v3 \u652f\u63f4 OCI \u683c\u5f0f\uff0c\u6240\u4ee5\u53ef\u4ee5\u63a1\u7528\u652f\u63f4 OCI \u7684 Container Registry\uff0c\u5982 ECR, Harbor \u7b49\uff0c\u6216\u662f\u7e7c\u7e8c\u4f7f\u7528\u50b3\u7d71\u7684 ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/helm/chartmuseum"},"Chart Museum")," \u4f86\u90e8\u7f72\u3002"),(0,a.kt)("h1",{id:"image-updater"},"Image Updater"),(0,a.kt)("p",null,"\u63a1\u7528\u7b2c\u4e8c\u8207\u7b2c\u4e09\u5169\u7a2e\u67b6\u69cb\u4e0b\uff0c\u5f88\u591a\u5718\u968a\u90fd\u6703\u63a2\u8a0e\u63d0\u5347\u5de5\u4f5c\u6d41\u7a0b\uff0c\u7279\u5225\u662f\u7576 Container Image \u6709\u65b0\u7248\u672c\u6642\uff0c\u8981\u5982\u4f55\u81ea\u52d5\u66f4\u65b0\u8a72 Repo \u4e0b\u7684\u63cf\u8ff0\u6a94\u6848\u3002"),(0,a.kt)("p",null,"\u6709\u7684\u5718\u968a\u6703\u63a1\u7528 ",(0,a.kt)("a",{parentName:"p",href:"https://argocd-image-updater.readthedocs.io/en/stable/"},"Argo Image Updater")," \u6216\u662f\u81ea\u884c\u64b0\u5beb CI/CD \u6d41\u7a0b\u4f86\u66f4\u65b0\u3002"),(0,a.kt)("h1",{id:"summary"},"Summary"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"\u672c\u7bc7\u6587\u7ae0\u7e3d\u7d50\u4e86 GitOps \u67b6\u69cb\u4e0b\u5e38\u898b\u7684 Git \u7d50\u69cb\u554f\u984c\uff0c\u63a2\u8a0e\u4e86\u5e38\u898b\u7684\u5de5\u5177\u8207\u4f7f\u7528\u65b9\u5f0f"),(0,a.kt)("li",{parentName:"ol"},"K8s \u7684\u61c9\u7528\u7a0b\u5f0f\u53ef\u4ee5\u63a1\u7528\u539f\u751f YAML, Helm, Jsonnet, Kustomize \u7b49\u65b9\u5f0f\u4f86\u7ba1\u7406\uff0c\u4e0d\u540c\u65b9\u5f0f\u6709\u5404\u81ea\u4e0d\u540c\u7684\u7279\u6027\u4ee5\u53ca\u9069\u5408\u7684\u5834\u666f"),(0,a.kt)("li",{parentName:"ol"},"\u6c92\u6709\u4e00\u500b\u5b8c\u7f8e\u7684\u89e3\u6cd5\uff0c\u6240\u6709\u898f\u5283\u9084\u662f\u8981\u4ee5\u5718\u968a\u898f\u6a21\uff0c\u6d41\u7a0b\uff0c\u80fd\u529b\uff0c\u4ee5\u53ca\u5de5\u4f5c\u7b49\u4f86\u8a0e\u8ad6\u9069\u5408\u7684\u5de5\u5177")))}k.isMDXComponent=!0}}]);
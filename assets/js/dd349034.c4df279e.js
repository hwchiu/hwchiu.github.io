"use strict";(self.webpackChunkhwchiu=self.webpackChunkhwchiu||[]).push([[83e3],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>m});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=r.createContext({}),s=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=s(e.components);return r.createElement(c.Provider,{value:t},e.children)},u="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,c=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=s(n),d=o,m=u["".concat(c,".").concat(d)]||u[d]||g[d]||a;return n?r.createElement(m,l(l({ref:t},p),{},{components:n})):r.createElement(m,l({ref:t},p))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,l=new Array(a);l[0]=d;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i[u]="string"==typeof e?e:o,l[1]=i;for(var s=2;s<a;s++)l[s]=n[s];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},11558:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>g,frontMatter:()=>a,metadata:()=>i,toc:()=>s});var r=n(87462),o=(n(67294),n(3905));const a={title:"GitOps - ArgoCD \u4ecb\u7d39",sidebar_position:18,tags:["iThome","DevOps","Kubernetes"],description:"iThome-2020 \u7cfb\u5217\u6587\u7ae0",date:new Date("2020-12-22T02:11:15.000Z")},l=void 0,i={unversionedId:"techPost/2020/iThome_Challenge/cicd-18",id:"techPost/2020/iThome_Challenge/cicd-18",title:"GitOps - ArgoCD \u4ecb\u7d39",description:"iThome-2020 \u7cfb\u5217\u6587\u7ae0",source:"@site/docs/techPost/2020/iThome_Challenge/cicd-18.md",sourceDirName:"techPost/2020/iThome_Challenge",slug:"/techPost/2020/iThome_Challenge/cicd-18",permalink:"/docs/techPost/2020/iThome_Challenge/cicd-18",draft:!1,tags:[{label:"iThome",permalink:"/docs/tags/i-thome"},{label:"DevOps",permalink:"/docs/tags/dev-ops"},{label:"Kubernetes",permalink:"/docs/tags/kubernetes"}],version:"current",sidebarPosition:18,frontMatter:{title:"GitOps - ArgoCD \u4ecb\u7d39",sidebar_position:18,tags:["iThome","DevOps","Kubernetes"],description:"iThome-2020 \u7cfb\u5217\u6587\u7ae0",date:"2020-12-22T02:11:15.000Z"},sidebar:"techPost",previous:{title:"GitOps \u8207 Kubernetes \u7684\u6574\u5408",permalink:"/docs/techPost/2020/iThome_Challenge/cicd-17"},next:{title:"Container Registry \u7684\u4ecb\u7d39\u53ca\u9700\u6c42",permalink:"/docs/techPost/2020/iThome_Challenge/cicd-19"}},c={},s=[{value:"\u61c9\u7528\u7a0b\u5f0f",id:"\u61c9\u7528\u7a0b\u5f0f",level:2},{value:"\u67b6\u69cb",id:"\u67b6\u69cb",level:2}],p={toc:s},u="wrapper";function g(e){let{components:t,...n}=e;return(0,o.kt)(u,(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"\u524d\u7bc7\u6587\u7ae0\u4ecb\u7d39\u4e86 GitOps \u7684\u6982\u5ff5\u4ee5\u53ca GitOps & Kubernetes \u7684\u4e00\u4e9b\u53c3\u8003\u5be6\u4f5c\uff0c\u672c\u7bc7\u6587\u7ae0\u5247\u662f\u6703\u900f\u904e\u73a9\u800d ArgoCD \u9019\u5957 GitOps \u7684\u958b\u6e90\u8edf\u9ad4\uff0c\u4f86\u8ddf\u5927\u5bb6\u5c55\u793a\u4e00\u4e0b GitOps \u5be6\u969b\u4e0a\u7684\u904b\u4f5c\u6d41\u7a0b\u4ee5\u53ca\u64cd\u4f5c\u8d77\u4f86\u7684\u6a23\u5b50\u3002\u53ef\u4ee5\u6bd4\u8f03\u770b\u770b\u8ddf\u904e\u5f80\u6211\u5011\u719f\u6089\u7684 Push-Mode \u9019\u7a2e\u7531 CD pipeloine \u53bb\u89f8\u767c\u7684 CD \u6d41\u7a0b\u6709\u4ec0\u9ebc\u4e0d\u540c"),(0,o.kt)("h1",{id:"\u4ecb\u7d39"},"\u4ecb\u7d39"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://argoproj.github.io/argo-cd/"},"ArgoCD")," \u7684\u5b98\u7db2\u662f\u9019\u6a23\u4ecb\u7d39\u81ea\u5df1\u7684"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Argo CD is a declarative, GitOps continuous delivery tool for Kubernetes.")),(0,o.kt)("p",null,"\u7c21\u55ae\u660e\u78ba\uff0c\u8aaa\u660e\u81ea\u5df1\u5c31\u662f\u70ba\u4e86 GItOps & Kubernetes \u800c\u751f\u7684\u5de5\u5177"),(0,o.kt)("h2",{id:"\u61c9\u7528\u7a0b\u5f0f"},"\u61c9\u7528\u7a0b\u5f0f"),(0,o.kt)("p",null,"\u4e4b\u524d\u6709\u63d0\u5230\u5982\u4f55\u5305\u88dd\u8207\u7ba1\u7406 Kubernetes \u7684\u61c9\u7528\u7a0b\u5f0f\uff0c\u5be6\u969b\u4e0a\u6709\u975e\u5e38\u591a\u7a2e\u7528\u6cd5\nArgoCD \u652f\u63f4\u4ee5\u4e0b\u985e\u578b"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Helm"),(0,o.kt)("li",{parentName:"ol"},"kustomize"),(0,o.kt)("li",{parentName:"ol"},"jsoonet"),(0,o.kt)("li",{parentName:"ol"},"ksonnet"),(0,o.kt)("li",{parentName:"ol"},"\u539f\u751f Yaml"),(0,o.kt)("li",{parentName:"ol"},"\u5ba2\u88fd\u5316\u7684\u8a2d\u5b9a\u6a94\u6848 (\u81ea\u884c\u5be6\u73fe\u76f8\u95dc Plugin)")),(0,o.kt)("p",null,"\u652f\u63f4\u5ea6\u975e\u5e38\u5f37\u5927\uff0c\u57fa\u672c\u4e0a Kubernetes \u6703\u7528\u5230\u7684\u683c\u5f0f\u4ed6\u90fd\u652f\u63f4"),(0,o.kt)("h2",{id:"\u67b6\u69cb"},"\u67b6\u69cb"),(0,o.kt)("p",null,"\u4e0b\u5716\u7bc0\u9304\u81ea",(0,o.kt)("a",{parentName:"p",href:"https://argoproj.github.io/argo-cd/"},"ArgoCD")," \u7684\u67b6\u69cb\u4ecb\u7d39\uff0c\u6211\u5011\u7528\u9019\u5f35\u5716\u4f86\u5927\u6982\u770b\u4e00\u4e0b ArgoCD \u7684\u904b\u4f5c\u6a21\u5f0f"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://argoproj.github.io/argo-cd/assets/argocd_architecture.png",alt:"Argo CD Architecture"})),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"ArgoCD \u7684 API Server \u652f\u63f4\u591a\u7a2e\u63a7\u5236\uff0c\u8b6c\u5982\u4f7f\u7528 UI \u64cd\u4f5c\uff0c\u4f7f\u7528 CLI \u64cd\u4f5c\uff0c\u751a\u81f3\u53ef\u4ee5\u900f\u904e gRPC/REST \u7b49\u65b9\u5f0f\u63a7\u5236")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"\u7576\u958b\u767c\u8005\u5b8c\u6210 Git \u7a0b\u5f0f\u78bc\u7684\u5408\u4f75\u5f8c\uff0c Git \u53ef\u4ee5\u89f8\u767c webhook \u7684\u4e8b\u4ef6\u901a\u77e5 ArgoCD Git \u6709\u65b0\u7684\u7248\u672c\uff0c\u53ef\u4ee5\u4f86\u6e96\u5099\u66f4\u65b0"),(0,o.kt)("ol",{parentName:"li"},(0,o.kt)("li",{parentName:"ol"},"\u9664\u4e86 web hook \u5916\uff0c ArgoCD \u4e5f\u652f\u6301\u5b9a\u671f\u8a62\u554f\u8207\u624b\u52d5\u7684\u65b9\u5f0f\u4f86\u66f4\u65b0"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"ArgoCD \u53ef\u4ee5\u7528\u4f86\u7ba1\u7406\u591a\u5957 Kubernetes \u53e2\u96c6\uff0c\u5c0d\u65bc\u6e2c\u8a66\u74b0\u5883\u4f86\u8aaa\uff0c\u662f\u53ef\u4ee5\u7528\u4e00\u5957 ArgoCD \u7684\u670d\u52d9\uff0c\u63a7\u7ba1\u591a\u5957\u53e2\u96c6\uff0c\u4f46\u662f\u5982\u679c\u6709\u751f\u7522\u74b0\u5883\u7684\u6642\u5019\uff0c\u57fa\u65bc\u6b0a\u9650\u4e5f\u662f\u53ef\u4ee5\u8003\u616e\u5206\u958b\u4e0d\u540c\u7684 ArgoCD\uff0c\u9019\u90e8\u5206\u5c31\u6c92\u6709\u552f\u4e00\u89e3\u7b54\u3002")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"ArgoCD \u4e5f\u63d0\u4f9b\u76f8\u5c0d\u61c9\u7684\u6642\u9593 Hook, \u8b6c\u5982\u7576\u540c\u6b65\u5b8c\u6210\u5f8c\u5c31\u53ef\u4ee5\u89f8\u767c\u4e0d\u540c\u7684\u4e8b\u4ef6\uff0c\u8b6c\u5982\u901a\u77e5 Slack \u7b49"))),(0,o.kt)("p",null,"\u63a5\u4e0b\u4f86\u6211\u5011\u4f86\u770b\u4e00\u4e0b\u8981\u5982\u4f55\u4f7f\u7528 ArgoCD"),(0,o.kt)("h1",{id:"\u5b89\u88dd"},"\u5b89\u88dd"),(0,o.kt)("p",null,"\u63a5\u4e0b\u4f86\u7684\u64cd\u4f5c\u4e2d\u6211\u5011\u6703\u4f7f\u7528 ArgoCD \u7684 UI \u8207 CLI \u5169\u500b\u4ecb\u9762\u4f86\u64cd\u4f5c\uff0c\u56e0\u6b64\u5b89\u88dd\u904e\u7a0b\u5c31\u6703\u5305\u542b ArgoCD \u672c\u8eab\u4ee5\u53ca\u76f8\u95dc\u7684\u5de5\u5177"),(0,o.kt)("p",null,"\u9996\u5148\u5b89\u88dd ArgoCD \u7684\u670d\u52d9\uff0c\u900f\u904e ",(0,o.kt)("inlineCode",{parentName:"p"},"kubectl")," \u7d66\u5b89\u88dd\u5230\u53e2\u96c6\u4e2d\u5373\u53ef\uff0c\u975e\u5e38\u7c21\u55ae"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl create namespace argocd\nnamespace/argocd created\n$ kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml\ncustomresourcedefinition.apiextensions.k8s.io/applications.argoproj.io created\ncustomresourcedefinition.apiextensions.k8s.io/appprojects.argoproj.io created\nserviceaccount/argocd-application-controller created\nserviceaccount/argocd-dex-server created\nserviceaccount/argocd-server created\nrole.rbac.authorization.k8s.io/argocd-application-controller created\nrole.rbac.authorization.k8s.io/argocd-dex-server created\nrole.rbac.authorization.k8s.io/argocd-server created\nclusterrole.rbac.authorization.k8s.io/argocd-application-controller created\nclusterrole.rbac.authorization.k8s.io/argocd-server created\nrolebinding.rbac.authorization.k8s.io/argocd-application-controller created\nrolebinding.rbac.authorization.k8s.io/argocd-dex-server created\nrolebinding.rbac.authorization.k8s.io/argocd-server created\nclusterrolebinding.rbac.authorization.k8s.io/argocd-application-controller created\nclusterrolebinding.rbac.authorization.k8s.io/argocd-server created\nconfigmap/argocd-cm created\nconfigmap/argocd-gpg-keys-cm created\nconfigmap/argocd-rbac-cm created\nconfigmap/argocd-ssh-known-hosts-cm created\nconfigmap/argocd-tls-certs-cm created\nsecret/argocd-secret created\nservice/argocd-dex-server created\nservice/argocd-metrics created\nservice/argocd-redis created\nservice/argocd-repo-server created\nservice/argocd-server-metrics created\nservice/argocd-server created\ndeployment.apps/argocd-application-controller created\ndeployment.apps/argocd-dex-server created\ndeployment.apps/argocd-redis created\ndeployment.apps/argocd-repo-server created\ndeployment.apps/argocd-server created\n")),(0,o.kt)("p",null,"\u53ef\u4ee5\u770b\u5230\u5176\u5be6 ArgoCD \u5b89\u88dd\u7684\u6771\u897f\u9084\u4e0d\u5c11\uff0c\u524d\u9762\u4e00\u5927\u90e8\u5206\u90fd\u662f\u91dd\u5c0d\u4f7f\u7528\u8005\u5e33\u865f\u9032\u884c\u63a7\u5236\uff0c\u56e0\u70ba ArgoCD \u672c\u8eab\u8981\u53ef\u4ee5\u5c0d Kubernetes \u9032\u884c\u64cd\u63a7\uff0c\u6240\u4ee5\u6703\u5e6b\u4ed6\u5275\u7acb\u4e00\u500b ServiceAccount \u4e26\u4e14\u914d\u4e0a\u76f8\u5c0d\u61c9\u7684\u6b0a\u9650\u3002"),(0,o.kt)("p",null,"\u5f8c\u9762\u5247\u662f\u76f8\u95dc\u7684\u670d\u52d9\uff0c\u8b6c\u5982\u7528\u4f86\u7ba1\u7406\u5e33\u865f\u767b\u5165\u6a5f\u5236\u7684 OIDC \u4f3a\u670d\u5668 (Dex)\uff0c\u8ddf Git Repo \u9023\u52d5\u7684 repo-server, \u4ee5\u53ca\u6700\u91cd\u8981\u7684\u908f\u8f2f\u8655\u7406\u4e2d\u5fc3 Application-controller\u3002"),(0,o.kt)("p",null,"\u9810\u8a2d\u60c5\u6cc1\u4e0b\uff0c ArgoCD \u6703\u5c07\u670d\u52d9\u88dd\u6210 ClusterIP\uff0c\u9019\u610f\u5473\u8005\u4e0d\u65b9\u4fbf\u5b58\u53d6\uff0c\u9664\u975e\u4f60\u6709 Ingress Controller \u7b49\uff0c\u70ba\u4e86\u65b9\u4fbf Demo \u6211\u5011\u53ef\u4ee5"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u5c07\u5176\u4fee\u6539\u6210 NodePort"),(0,o.kt)("li",{parentName:"ol"},"\u900f\u904e kubectl port-forward \u7684\u65b9\u5f0f\u4f86\u5b58\u53d6")),(0,o.kt)("p",null,"\u5982\u679c\u662f\u57fa\u65bc\u6e2c\u8a66\u7684\u74b0\u5883\uff0c\u90a3\u9019\u5169\u7a2e\u65b9\u5f0f\u6211\u89ba\u5f97\u90fd\u6c92\u6709\u554f\u984c\uff0c\u4f46\u662f\u5982\u679c\u662f\u6b63\u5f0f\u74b0\u5883\uff0c\u6700\u597d\u9084\u662f\u6709\u4e00\u500b Ingress Controller \u5728\u524d\u9762\u5e6b\u5fd9\u7ba1\u7406\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl port-forward svc/argocd-server -n argocd 8080:443\n")),(0,o.kt)("p",null,"\u6253\u958b\u700f\u89bd\u5668\u5f8c\u6703\u51fa\u73fe\u4e0b\u65b9\u756b\u9762"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/8LnVJnP.png",alt:null})),(0,o.kt)("p",null,"\u767b\u5165\u5e33\u865f\u662f admin, \u9810\u8a2d\u7684\u767b\u5165\u5bc6\u78bc\u53ef\u4ee5\u900f\u904e\u4e0b\u5217\u6307\u4ee4\u7372\u5f97"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl get pods -n argocd -l app.kubernetes.io/name=argocd-server -o name | cut -d'/' -f 2\n")),(0,o.kt)("p",null,"\u63a5\u4e0b\u4f86\u6211\u5011\u4f86\u5b89\u88dd ArgoCD \u7684 CLI"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'$ wget https://github.com/argoproj/argo-cd/releases/download/v1.7.4/argocd-linux-amd64\n$ sudo chmod 755\n$ ./argocd-linux-amd64\nargocd controls a Argo CD server\n\nUsage:\n  argocd [flags]\n  argocd [command]\n\nAvailable Commands:\n  account     Manage account settings\n  app         Manage applications\n  cert        Manage repository certificates and SSH known hosts entries\n  cluster     Manage cluster credentials\n  completion  output shell completion code for the specified shell (bash or zsh)\n  context     Switch between contexts\n  gpg         Manage GPG keys used for signature verification\n  help        Help about any command\n  login       Log in to Argo CD\n  logout      Log out from Argo CD\n  proj        Manage projects\n  relogin     Refresh an expired authenticate token\n  repo        Manage repository connection parameters\n  repocreds   Manage repository connection parameters\n  version     Print version information\nFlags:\n      --auth-token string               Authentication token\n      --client-crt string               Client certificate file\n      --client-crt-key string           Client certificate key file\n      --config string                   Path to Argo CD config (default "/home/ubuntu/.argocd/config")\n      --grpc-web                        Enables gRPC-web protocol. Useful if Argo CD server is behind proxy which does not support HTTP2.\n      --grpc-web-root-path string       Enables gRPC-web protocol. Useful if Argo CD server is behind proxy which does not support HTTP2. Set web root.\n  -H, --header strings                  Sets additional header to all requests made by Argo CD CLI. (Can be repeated multiple times to add multiple headers, also supports comma separated headers)\n  -h, --help                            help for argocd\n      --insecure                        Skip server certificate and domain verification\n      --logformat string                Set the logging format. One of: text|json (default "text")\n      --loglevel string                 Set the logging level. One of: debug|info|warn|error (default "info")\n      --plaintext                       Disable TLS\n      --port-forward                    Connect to a random argocd-server port using port forwarding\n      --port-forward-namespace string   Namespace name which should be used for port forwarding\n      --server string                   Argo CD server address\n      --server-crt string               Server certificate file\n\nUse "argocd [command] --help" for more information about a command.\n')),(0,o.kt)("p",null,"\u63a5\u4e0b\u4f86\u6211\u5011\u4f7f\u7528\u4e00\u6a23\u7684\u5e33\u865f\u5bc6\u78bc\u4f86\u767b\u5165"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ ./argocd-linux-amd64 login localhost:8080\nWARNING: server certificate had error: x509: certificate signed by unknown authority. Proceed insecurely (y/n)? y\nUsername: admin\nPassword:\n'admin' logged in successfully\nContext 'localhost:8080' updated\n")),(0,o.kt)("p",null,"\u9019\u908a\u6e96\u5099\u5c31\u7dd2\u5f8c\uff0c\u6211\u5011\u5c31\u53ef\u4ee5\u958b\u59cb\u4f86\u4f7f\u7528\u56c9"),(0,o.kt)("h1",{id:"\u4f7f\u7528"},"\u4f7f\u7528"),(0,o.kt)("p",null,"\u5982\u540c\u524d\u8ff0\u63d0\u5230\uff0cGitOps \u672c\u8eab\u7684\u4e00\u500b\u91cd\u9ede\u662f\u900f\u904e Git \u4f86\u7ba1\u7406\u6240\u6709\u90e8\u7f72\u7684\u6a94\u6848\uff0c\u56e0\u6b64\u9019\u908a\u6211\u5011\u6703\u4f7f\u7528 ArgoCD \u6240\u6e96\u5099\u7684\u4e00\u500b\u793a\u7bc4 Git Repo\uff0c",(0,o.kt)("a",{parentName:"p",href:"https://github.com/argoproj/argocd-example-apps.git"},"argocd-example-apps")),(0,o.kt)("p",null,"\u53ef\u4ee5\u770b\u5230\u8a72 Repo \u5167\u6709\u6eff\u6eff\u7684\u4f7f\u7528\u4e0d\u540c\u65b9\u5f0f\u7ba1\u7406 Kubernetes \u61c9\u7528\u7684\u65b9\u6cd5"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/2AnE3sb.png",alt:null})),(0,o.kt)("p",null,"\u63a5\u4e0b\u4f86\u6211\u5011\u5c31\u8981\u544a\u8a34 ArgoCD\uff0c\u6211\u60f3\u8981\u90e8\u7f72\u4e00\u500b\u65b0\u7684\u61c9\u7528\u7a0b\u5f0f\uff0c\u9019\u500b\u61c9\u7528\u7a0b\u5f0f\u7684\u4f86\u6e90\u662f\u54ea\u500b Git \u4ee5\u53ca\u90e8\u7f72\u4e0a\u8981\u6ce8\u610f\u7684\u4e00\u4e9b\u5c0f\u8a2d\u5b9a"),(0,o.kt)("p",null,"\u9019\u90e8\u5206\u53ef\u4ee5\u900f\u904e UI \u64cd\u4f5c\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 CLI \u4f86\u64cd\u4f5c"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/7SYynMF.png",alt:null})),(0,o.kt)("p",null,"\u6211\u5011\u4f86\u5617\u8a66\u4f7f\u7528 CLI \u64cd\u4f5c\u770b\u770b"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ ./argocd-linux-amd64 app create guestbook --repo https://github.com/argoproj/argocd-example-apps.git --path guestbook --dest-server https://kubernetes.default.svc --dest-namespace default\napplication 'guestbook' created\n")),(0,o.kt)("p",null,"\u4e0a\u8ff0\u7684\u6307\u4ee4\u57fa\u672c\u4e0a\u8ddf UI \u63cf\u8ff0\u7684\u5167\u5bb9\u5dee\u4e0d\u591a\uff0c\u6709\u4e9b\u6c92\u6709\u586b\u5beb\u7684\u5c31\u662f\u9810\u8a2d\u503c\uff0c\u9019\u7a2e\u60c5\u6cc1\u4e0b\u6211\u5011\u6703\u5275\u7acb\u4e00\u500b\u65b0\u7684 app\uff0c\u76ee\u6a19\u662f\u4e0a\u8ff0\u63d0\u5230\u7684 GitRepo\uff0c\u4e26\u4e14\u8a73\u7d30\u7684\u5b89\u88dd\u6a94\u6848\u8acb\u4f7f\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"guestbook"),"\u9019\u500b\u8cc7\u6599\u593e\u5167\u7684\u6a94\u6848"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/Pf6A8eI.png",alt:null})),(0,o.kt)("p",null,"\u8a72\u8cc7\u6599\u593e\u5167\u7684\u8cc7\u6e90\u975e\u5e38\u7c21\u55ae\uff0c\u5c31\u662f\u4e00\u500b Deployment \u914d\u4e0a\u4e00\u500b Service\u3002"),(0,o.kt)("p",null,"\u9019\u6642\u5019\u5c31\u53ef\u4ee5\u56de\u5230 UI \u53bb\u770b\uff0c\u5c31\u6703\u770b\u5230\u4e00\u500b\u5168\u65b0\u7684 Application \u5df2\u7d93\u7522\u751f\u4e86"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/dVpmXa1.png",alt:null})," \u4f46\u662f\u53ef\u4ee5\u89c0\u5bdf\u5230\u756b\u9762\u4e2d\u76f8\u95dc\u7684\u61c9\u7528\u7a0b\u5f0f\u5176\u5be6\u9084\u6c92\u6709\u6b63\u5f0f\u88ab\u90e8\u7f72\u51fa\u4f86\uff0c\u4e3b\u8981\u662f\u6211\u5011\u53ea\u662f\u544a\u8a34 ",(0,o.kt)("inlineCode",{parentName:"p"},"ArgoCD")," \u6211\u5011\u8981\u5efa\u7acb\u4e00\u500b\u65b0\u7684 Application\uff0c\u4f46\u662f\u9084\u6c92\u6709\u8981\u540c\u6b65\u3002"),(0,o.kt)("p",null,"\u540c\u6642\u900f\u904e\u6307\u4ee4\u7684\u65b9\u5f0f(UI\u4e5f\u53ef\u4ee5)\u89c0\u5bdf\u5230\uff0c\u6211\u5011\u7684 Application \u76ee\u524d\u662f\u6c92\u6709\u958b\u555f ",(0,o.kt)("inlineCode",{parentName:"p"},"Auto Sync")," (Sync Policy: None)"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ ./argocd-linux-amd64 app get guestbook\nName:               guestbook\nProject:            default\nServer:             https://kubernetes.default.svc\nNamespace:          default\nURL:                https://localhost:8080/applications/guestbook\nRepo:               https://github.com/argoproj/argocd-example-apps.git\nTarget:\nPath:               guestbook\nSyncWindow:         Sync Allowed\nSync Policy:        <none>\nSync Status:        OutOfSync from  (6bed858)\nHealth Status:      Missing\n\nGROUP  KIND        NAMESPACE  NAME          STATUS     HEALTH   HOOK  MESSAGE\n       Service     default    guestbook-ui  OutOfSync  Missing\napps   Deployment  default    guestbook-ui  OutOfSync  Missing\n")),(0,o.kt)("p",null,"\u63a5\u4e0b\u4f86\u6211\u5011\u5c31\u900f\u904e CLI \u7684\u65b9\u5f0f(UI\u4e5f\u53ef\u4ee5) \u8981\u6c42 ArgoCD \u5e6b\u6211\u5011\u540c\u6b65 Guestbook \u9019\u500b\u61c9\u7528\u7a0b\u5f0f"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ ./argocd-linux-amd64 app sync guestbook\nTIMESTAMP                  GROUP        KIND   NAMESPACE                  NAME    STATUS    HEALTH        HOOK  MESSAGE\n2020-09-13T17:25:41+00:00            Service     default          guestbook-ui  OutOfSync  Missing\n2020-09-13T17:25:41+00:00   apps  Deployment     default          guestbook-ui  OutOfSync  Missing\n2020-09-13T17:25:41+00:00            Service     default          guestbook-ui    Synced  Healthy\n\nName:               guestbook\nProject:            default\nServer:             https://kubernetes.default.svc\nNamespace:          default\nURL:                https://localhost:8080/applications/guestbook\nRepo:               https://github.com/argoproj/argocd-example-apps.git\nTarget:\nPath:               guestbook\nSyncWindow:         Sync Allowed\nSync Policy:        <none>\nSync Status:        Synced to  (6bed858)\nHealth Status:      Progressing\n\nOperation:          Sync\nSync Revision:      6bed858de32a0e876ec49dad1a2e3c5840d3fb07\nPhase:              Succeeded\nStart:              2020-09-13 17:25:41 +0000 UTC\nFinished:           2020-09-13 17:25:41 +0000 UTC\nDuration:           0s\nMessage:            successfully synced (all tasks run)\n\nGROUP  KIND        NAMESPACE  NAME          STATUS  HEALTH       HOOK  MESSAGE\n       Service     default    guestbook-ui  Synced  Healthy            service/guestbook-ui created\napps   Deployment  default    guestbook-ui  Synced  Progressing        deployment.apps/guestbook-ui created\n")),(0,o.kt)("p",null,"\u9019\u6642\u5019 UI \u4e0a\u7684\u5448\u73fe\u5c31\u99ac\u4e0a\u6539\u8b8a"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/E8T4GfE.png",alt:null})," \u76f8\u95dc\u7684\u670d\u52d9\u90fd\u88ab\u90e8\u7f72\u5230 Kubernetes \u5167\uff0c\u900f\u904e ",(0,o.kt)("inlineCode",{parentName:"p"},"kubectl")," \u4e5f\u53ef\u4ee5\u89c0\u5bdf\u5230\u90e8\u7f72\u7684\u7d50\u679c\u3002"),(0,o.kt)("p",null,"ArgoCD \u7684 UI \u4e5f\u63d0\u4f9b\u4e86\u4e00\u4e9b\u7c21\u55ae\u7684\u64cd\u4f5c\uff0c\u5305\u542b\u89c0\u5bdf Log\uff0c\u89c0\u5bdf\u90e8\u7f72\u8cc7\u6e90\u7684\u72c0\u614b\uff0c\u5176\u4e2d\u6709\u4e00\u500b\u975e\u5e38\u597d\u7684\u529f\u80fd\u5c31\u662f\u5e6b\u4f60\u6bd4\u5c0d\u72c0\u614b\u7684\u5dee\u7570"),(0,o.kt)("p",null,"\u3002\u8209\u4f8b\u4f86\u8aaa\uff0c\u5982\u679c\u4eca\u5929\u6709\u4eba\u900f\u904e\u6307\u4ee4\u7684\u65b9\u5f0f\u624b\u52d5\u4fee\u6539\u6b63\u5728\u904b\u884c\u7684\u8cc7\u6e90\u72c0\u614b\uff0c\u6211\u5011\u5c07 deployment \u7684\u6578\u91cf\u5f9e 1\u500b\u8b8a\u6210 4\u500b"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ kubectl scale --replicas=4 deployment guestbook-ui\n$ kubectl get pods\nNAME                            READY   STATUS    RESTARTS   AGE\nguestbook-ui-65b878495d-7fthl   1/1     Running   0          15s\nguestbook-ui-65b878495d-hw9mt   1/1     Running   0          15s\nguestbook-ui-65b878495d-trsmz   1/1     Running   0          15s\nguestbook-ui-65b878495d-ts8cg   1/1     Running   0          4m39s\n")),(0,o.kt)("p",null,"\u9019\u6642\u5019\u53ef\u4ee5\u5f9e UI \u89c0\u5bdf\u5230\u76f8\u95dc\u7684\u61c9\u7528\u7a0b\u5f0f\u88ab\u6a19\u4e0a\u4e86 ",(0,o.kt)("inlineCode",{parentName:"p"},"OutOfSync")," \uff0c\u56e0\u70ba\u6211\u5011\u6c92\u6709\u958b\u555f ",(0,o.kt)("inlineCode",{parentName:"p"},"auto-sync")," , \u6240\u4ee5\u4e0d\u6703\u81ea\u52d5\u4fee\u5fa9\u56de\u4f86"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/AsBeFTC.png",alt:null})),(0,o.kt)("p",null,"\u540c\u6642\u6211\u5011\u4e5f\u53ef\u4ee5\u900f\u904e UI \u7684\u65b9\u5f0f\u4f86\u77ad\u89e3\u5230\u5e95\u7576\u524d",(0,o.kt)("inlineCode",{parentName:"p"},"\u671f\u671b\u72c0\u614b"),"\u8207",(0,o.kt)("inlineCode",{parentName:"p"},"\u904b\u884c\u72c0\u614b")," \u7684\u5dee\u7570\u662f\u4ec0\u9ebc\uff0c\u6211\u5011\u7684\u7bc4\u4f8b\u5c31\u662f\u8907\u672c\u6578\u91cf\u6709\u5dee"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://i.imgur.com/r7d6Hcg.png",alt:null})),(0,o.kt)("p",null,"\u5230\u9019\u908a\u6211\u5011\u7c21\u55ae\u73a9\u8f49\u4e86\u4e00\u4e0b ArgoCD \u7684\u529f\u80fd\uff0c\u5be6\u969b\u4e0a\u5176\u5167\u90e8\u6709\u66f4\u591a\u6709\u8da3\u4e14\u6709\u6548\u7387\u7684\u529f\u80fd\uff0c\u5982\u679c\u5c0d\u65bc GitOps \u6709\u8208\u8da3\u7684\u4eba\u90fd\u6b61\u8fce\u5617\u8a66\u770b\u770b\u9019\u500b\u5de5\u5177\uff0c\u5982\u679c\u9084\u6709\u6642\u9593\u4e5f\u4e00\u5b9a\u8981\u8a66\u8a66\u770b Flux \u53e6\u5916\u4e00\u5957\u4e0d\u540c\u7684 GitOps \u5be6\u73fe\u5de5\u5177\u3002"))}g.isMDXComponent=!0}}]);